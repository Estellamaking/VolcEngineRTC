/*
* Copyright (c) 2020 The VolcEngineRTC project authors. All Rights Reserved.
* @brief VolcEngine Advance API
* version: 4.47.6
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).VERTC=t()}(this,(function(){"use strict";function e(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}function t(e){var t,n,i,o=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,i=Symbol.iterator);o--;){if(n&&null!=(t=e[n]))return t.call(e);if(i&&null!=(t=e[i]))return new r(t.call(e));n="@@asyncIterator",i="@@iterator"}throw new TypeError("Object is not async iterable")}function r(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return(r=function(e){this.s=e,this.n=e.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new r(e)}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){h(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function o(){o=function(){return e};var e={},t=Object.prototype,r=t.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(C){c=function(e,t,r){return e[t]=r}}function d(e,t,r,i){var o=t&&t.prototype instanceof f?t:f,a=Object.create(o.prototype),s=new R(i||[]);return n(a,"_invoke",{value:E(e,r,s)}),a}function l(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(C){return{type:"throw",arg:C}}}e.wrap=d;var h={};function f(){}function p(){}function v(){}var _={};c(_,a,(function(){return this}));var m=Object.getPrototypeOf,y=m&&m(m(A([])));y&&y!==t&&r.call(y,a)&&(_=y);var g=v.prototype=f.prototype=Object.create(_);function S(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function i(n,o,a,s){var u=l(e[n],e,o);if("throw"!==u.type){var c=u.arg,d=c.value;return d&&"object"==typeof d&&r.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,a,s)}),(function(e){i("throw",e,a,s)})):t.resolve(d).then((function(e){c.value=e,a(c)}),(function(e){return i("throw",e,a,s)}))}s(u.arg)}var o;n(this,"_invoke",{value:function(e,r){function n(){return new t((function(t,n){i(e,r,t,n)}))}return o=o?o.then(n,n):n()}})}function E(e,t,r){var n="suspendedStart";return function(i,o){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw o;return{value:void 0,done:!0}}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var s=k(a,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=l(e,t,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===h)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}function k(e,t){var r=t.method,n=e.iterator[r];if(void 0===n)return t.delegate=null,"throw"===r&&e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method)||"return"!==r&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+r+"' method")),h;var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,h;var o=i.arg;return o?o.done?(t[e.resultName]=o.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,h):o:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,h)}function T(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function R(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(T,this),this.reset(!0)}function A(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:w}}function w(){return{value:void 0,done:!0}}return p.prototype=v,n(g,"constructor",{value:v,configurable:!0}),n(v,"constructor",{value:p,configurable:!0}),p.displayName=c(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},S(b.prototype),c(b.prototype,s,(function(){return this})),e.AsyncIterator=b,e.async=function(t,r,n,i,o){void 0===o&&(o=Promise);var a=new b(d(t,r,n,i),o);return e.isGeneratorFunction(r)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},S(g),c(g,u,"Generator"),c(g,a,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},e.values=A,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(r,n){return a.type="throw",a.arg=e,t.next=r,n&&(t.method="next",t.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var s=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(s&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,h):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),I(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;I(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:A(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},e}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t,r,n,i,o,a){try{var s=e[o](a),u=s.value}catch(c){return void r(c)}s.done?t(u):Promise.resolve(u).then(n,i)}function u(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var o=e.apply(t,r);function a(e){s(o,n,i,a,u,"next",e)}function u(e){s(o,n,i,a,u,"throw",e)}a(void 0)}))}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,A(n.key),n)}}function l(e,t,r){return t&&d(e.prototype,t),r&&d(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h(e,t,r){return(t=A(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||(i[r]=e[r]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return m(e)}function g(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=p(e);if(t){var i=p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return y(this,r)}}function S(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=p(e)););return e}function b(){return b="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=S(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},b.apply(this,arguments)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,o,a,s=[],u=!0,c=!1;try{if(o=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=o.call(r)).done)&&(s.push(n.value),s.length!==t);u=!0);}catch(d){c=!0,i=d}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(e,t)||T(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e){return function(e){if(Array.isArray(e))return I(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||T(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function T(e,t){if(e){if("string"==typeof e)return I(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(e,t):void 0}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function R(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=T(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function A(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}var w=function(e){return e[e.VIDEO_SOURCE_TYPE_EXTERNAL=0]="VIDEO_SOURCE_TYPE_EXTERNAL",e[e.VIDEO_SOURCE_TYPE_INTERNAL=1]="VIDEO_SOURCE_TYPE_INTERNAL",e}(w||{}),C=function(e){return e[e.AUDIO_SOURCE_TYPE_EXTERNAL=0]="AUDIO_SOURCE_TYPE_EXTERNAL",e[e.AUDIO_SOURCE_TYPE_INTERNAL=1]="AUDIO_SOURCE_TYPE_INTERNAL",e}(C||{}),O=function(e){return e[e.QUIT=0]="QUIT",e[e.DROPPED=1]="DROPPED",e[e.SWITCH_TO_INVISIBLE=2]="SWITCH_TO_INVISIBLE",e[e.KICKED_BY_ADMIN=3]="KICKED_BY_ADMIN",e}(O||{}),x=function(e){return e[e.CHANNEL_PROFILE_COMMUNICATION=0]="CHANNEL_PROFILE_COMMUNICATION",e[e.CHANNEL_PROFILE_LIVE_BROADCASTING=1]="CHANNEL_PROFILE_LIVE_BROADCASTING",e}(x||{}),N=function(e){return e[e.AUTO_SUBSCRIBE_MODE=0]="AUTO_SUBSCRIBE_MODE",e[e.MANUAL_SUBSCRIBE_MODE=1]="MANUAL_SUBSCRIBE_MODE",e}(N||{}),D=function(e){return e[e.SUBSCRIBE_SUCC=0]="SUBSCRIBE_SUCC",e[e.SUBSCRIBE_FAIL=1]="SUBSCRIBE_FAIL",e}(D||{}),P=function(e){return e[e.PUBLISH_SUCC=0]="PUBLISH_SUCC",e[e.PUBLISH_FAIL=1]="PUBLISH_FAIL",e}(P||{}),M=function(e){return e[e.MIRROR_MODE_OFF=0]="MIRROR_MODE_OFF",e[e.MIRROR_MODE_ON=1]="MIRROR_MODE_ON",e}(M||{}),L=function(e){return e[e.RENDER_MODE_HIDDEN=0]="RENDER_MODE_HIDDEN",e[e.RENDER_MODE_FIT=1]="RENDER_MODE_FIT",e}(L||{}),U=function(e){return e[e.STREAM_INDEX_MAIN=0]="STREAM_INDEX_MAIN",e[e.STREAM_INDEX_SCREEN=1]="STREAM_INDEX_SCREEN",e}(U||{}),V=function(e){return e[e.AUDIO=1]="AUDIO",e[e.VIDEO=2]="VIDEO",e[e.AUDIO_AND_VIDEO=3]="AUDIO_AND_VIDEO",e}(V||{}),F=function(e){return e[e.STREAM_REMOVE_REASON_UNPUBLISH=0]="STREAM_REMOVE_REASON_UNPUBLISH",e[e.STREAM_REMOVE_REASON_PUBLISH_FAILED=1]="STREAM_REMOVE_REASON_PUBLISH_FAILED",e[e.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED=2]="STREAM_REMOVE_REASON_KEEP_LIVE_FAILED",e[e.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED=3]="STREAM_REMOVE_REASON_CLIENT_DISCONNECTED",e[e.STREAM_REMOVE_REASON_REPUBLISH=4]="STREAM_REMOVE_REASON_REPUBLISH",e[e.STREAM_REMOVE_REASON_OTHER=5]="STREAM_REMOVE_REASON_OTHER",e}(F||{}),B=function(e){return e[e.CONNECTION_START=0]="CONNECTION_START",e[e.CONNECTION_STATE_DISCONNECTED=1]="CONNECTION_STATE_DISCONNECTED",e[e.CONNECTION_STATE_CONNECTING=2]="CONNECTION_STATE_CONNECTING",e[e.CONNECTION_STATE_CONNECTED=3]="CONNECTION_STATE_CONNECTED",e[e.CONNECTION_STATE_RECONNECTING=4]="CONNECTION_STATE_RECONNECTING",e[e.CONNECTION_STATE_RECONNECTED=5]="CONNECTION_STATE_RECONNECTED",e[e.CONNECTION_STATE_LOST=6]="CONNECTION_STATE_LOST",e}(B||{}),j=function(e){return e[e.MIRROR_TYPE_NONE=0]="MIRROR_TYPE_NONE",e[e.MIRROR_TYPE_RENDER=1]="MIRROR_TYPE_RENDER",e}(j||{}),G=function(e){return e[e.domestic=0]="domestic",e[e.overseas=1]="overseas",e}(G||{}),H=function(e){return e[e.OFFLINE=0]="OFFLINE",e[e.ONLINE=1]="ONLINE",e[e.UNREACHABLE=2]="UNREACHABLE",e}(H||{}),z=function(e){return e[e.AUDIO_AND_VIDEO=0]="AUDIO_AND_VIDEO",e[e.AUDIO_ONLY=1]="AUDIO_ONLY",e[e.VIDEO_ONLY=2]="VIDEO_ONLY",e}(z||{}),q=function(e){return e[e.PREV_FRAME=0]="PREV_FRAME",e[e.OTHER_FRAME=1]="OTHER_FRAME",e}(q||{}),X=function(e){return e[e.DISABLE=0]="DISABLE",e[e.VIDEO_STREAM_LOW=1]="VIDEO_STREAM_LOW",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e}(X||{}),K=function(e){return e[e.LOW=0]="LOW",e[e.MEDIUM=100]="MEDIUM",e[e.HIGH=200]="HIGH",e}(K||{}),W=function(e){return e[e.UNKNOWN=0]="UNKNOWN",e[e.EXCELLENT=1]="EXCELLENT",e[e.GOOD=2]="GOOD",e[e.POOR=3]="POOR",e[e.BAD=4]="BAD",e[e.VBAD=5]="VBAD",e}(W||{}),Y=function(e){return e[e.Unknown=-1]="Unknown",e[e.SubscribeFallbackByBandwidth=0]="SubscribeFallbackByBandwidth",e[e.SubscribeRecoverByBandwidth=2]="SubscribeRecoverByBandwidth",e}(Y||{}),J=function(e){return e[e.communication=0]="communication",e[e.chat=5]="chat",e[e.chatRoom=6]="chatRoom",e[e.coHost=9]="coHost",e[e.meeting=16]="meeting",e[e.classRoom=18]="classRoom",e}(J||{}),Q=function(e){return e[e.default=0]="default",e[e.fluent=1]="fluent",e[e.standard=2]="standard",e[e.hd=3]="hd",e[e.standardStereo=4]="standardStereo",e[e.hdMono=5]="hdMono",e}(Q||{}),Z=function(e){return e[e.AUTO_PLAY=0]="AUTO_PLAY",e[e.VIDEO_ONLY=1]="VIDEO_ONLY",e[e.PLAY_MANUALLY=2]="PLAY_MANUALLY",e}(Z||{}),$=Object.freeze(Object.defineProperty({__proto__:null,VideoSourceType:w,AudioSourceType:C,UserOfflineReason:O,ChannelProfile:x,SubscribeMode:N,SubscribeState:D,PublishState:P,MirrorMode:M,VideoRenderMode:L,StreamIndex:U,MediaType:V,StreamRemoveReason:F,ConnectionState:B,MirrorType:j,LogChannel:G,USER_ONLINE_STATUS:H,PublicStreamType:z,PublicInterpolationMode:q,SubscribeFallbackOption:X,RemoteUserPriority:K,NetworkQuality:W,FallbackOrRecoverReason:Y,RoomProfileType:J,AudioProfileType:Q,RTCAutoPlayPolicy:Z},Symbol.toStringTag,{value:"Module"})),ee=function(e){return e[e.AUTO=0]="AUTO",e[e.MODE_L=1]="MODE_L",e[e.MODE_R=2]="MODE_R",e[e.MODE_MIX=3]="MODE_MIX",e}(ee||{}),te=function(e){return e[e.PLAYOUT=0]="PLAYOUT",e[e.PUBLISH=1]="PUBLISH",e[e.PLAYOUT_AND_PUBLISH=2]="PLAYOUT_AND_PUBLISH",e}(te||{}),re=function(e){return e[e.AUDIO_MIXING_STATE_PRELOADED=0]="AUDIO_MIXING_STATE_PRELOADED",e[e.AUDIO_MIXING_STATE_PLAYING=1]="AUDIO_MIXING_STATE_PLAYING",e[e.AUDIO_MIXING_STATE_PAUSED=2]="AUDIO_MIXING_STATE_PAUSED",e[e.AUDIO_MIXING_STATE_STOPPED=3]="AUDIO_MIXING_STATE_STOPPED",e[e.AUDIO_MIXING_STATE_FAILED=4]="AUDIO_MIXING_STATE_FAILED",e[e.AUDIO_MIXING_STATE_FINISHED=5]="AUDIO_MIXING_STATE_FINISHED",e[e.AUDIO_MIXING_STATE_PCM_ENABLED=6]="AUDIO_MIXING_STATE_PCM_ENABLED",e[e.AUDIO_MIXING_STATE_PCM_DISABLED=7]="AUDIO_MIXING_STATE_PCM_DISABLED",e}(re||{}),ne=Object.freeze(Object.defineProperty({__proto__:null,AudioMixingDualMonoMode:ee,AudioMixingType:te,AudioMixingState:re},Symbol.toStringTag,{value:"Module"})),ie=function(e){return e.onTrackEnded="onTrackEnded",e.onPlayerEvent="onPlayerEvent",e.onAutoplayFailed="onAutoplayFailed",e.onUserJoined="onUserJoined",e.onUserLeave="onUserLeave",e.onConnectionStateChanged="onConnectionStateChanged",e.onUserPublishStream="onUserPublishStream",e.onUserUnpublishStream="onUserUnpublishStream",e.onUserPublishScreen="onUserPublishScreen",e.onUserUnpublishScreen="onUserUnpublishScreen",e.onRoomMessageReceived="onRoomMessageReceived",e.onRoomBinaryMessageReceived="onRoomBinaryMessageReceived",e.onUserMessageReceived="onUserMessageReceived",e.onUserBinaryMessageReceived="onUserBinaryMessageReceived",e.onVideoFirstFrameRendered="onVideoFirstFrameRendered",e.onVideoFirstFrameDecoded="onVideoFirstFrameDecoded",e.onRemoteVideoFirstFrame="onRemoteVideoFirstFrame",e.onAudioFirstFrameDecoded="onAudioFirstFrameDecoded",e.onRemoteAudioFirstFrame="onRemoteAudioFirstFrame",e.onFirstPublicStreamVideoFrameRendered="onFirstPublicStreamVideoFrameRendered",e.onFirstPublicStreamVideoFrameDecoded="onFirstPublicStreamVideoFrameDecoded",e.onFirstPublicStreamAudioFrameDecoded="onFirstPublicStreamAudioFrameDecoded",e.onVideoDeviceStateChanged="onVideoDeviceStateChanged",e.onAudioDeviceStateChanged="onAudioDeviceStateChanged",e.onRemoteStreamStats="onRemoteStreamStats",e.onPublicStreamStats="onPublicStreamStats",e.onLocalStreamStats="onLocalStreamStats",e.onAudioVolumeIndication="onAudioVolumeIndication",e.onLocalAudioPropertiesReport="onLocalAudioPropertiesReport",e.onRemoteAudioPropertiesReport="onRemoteAudioPropertiesReport",e.onActiveSpeaker="onActiveSpeaker",e.onAudioPlaybackDeviceChanged="onAudioPlaybackDeviceChanged",e.onUserStartVideoCapture="onUserStartVideoCapture",e.onUserStopVideoCapture="onUserStopVideoCapture",e.onUserStartAudioCapture="onUserStartAudioCapture",e.onUserStopAudioCapture="onUserStopAudioCapture",e.onAutoPublishResult="onAutoPublishResult",e.onAutoSubscribeResult="onAutoSubscribeResult",e.onLiveTranscodingResult="onLiveTranscodingResult",e.onStreamMixingEvent="onStreamMixingEvent",e.onAudioPlaybackDeviceTestVolume="onAudioPlaybackDeviceTestVolume",e.onSEIMessageReceived="onSEIMessageReceived",e.onError="onError",e.onAudioMixingStateChanged="onAudioMixingStateChanged",e.onUserMessageReceivedOutsideRoom="onUserMessageReceivedOutsideRoom",e.onUserBinaryMessageReceivedOutsideRoom="onUserBinaryMessageReceivedOutsideRoom",e.onTokenWillExpire="onTokenWillExpire",e.onCloudProxyConnected="onCloudProxyConnected",e.onPushPublicStreamResult="onPushPublicStreamResult",e.onPublicStreamSEIMessageReceived="onPublicStreamSEIMessageReceived",e.onNetworkQuality="onNetworkQuality",e.onSimulcastSubscribeFallback="onSimulcastSubscribeFallback",e.onRemoteVideoSizeChanged="onRemoteVideoSizeChanged",e.onVideoStreamBanned="onVideoStreamBanned",e.onAudioStreamBanned="onAudioStreamBanned",e.onLocalVideoSizeChanged="onLocalVideoSizeChanged",e.onServerParamsSetResult="onServerParamsSetResult",e}(ie||{}),oe="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ae=function(e){return e&&e.Math==Math&&e},se=ae("object"==typeof globalThis&&globalThis)||ae("object"==typeof window&&window)||ae("object"==typeof self&&self)||ae("object"==typeof oe&&oe)||function(){return this}()||Function("return this")(),ue={exports:{}},ce=se,de=Object.defineProperty,le=function(e,t){try{de(ce,e,{value:t,configurable:!0,writable:!0})}catch(r){ce[e]=t}return t},he=le,fe="__core-js_shared__",pe=se[fe]||he(fe,{}),ve=pe;(ue.exports=function(e,t){return ve[e]||(ve[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.1",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"});var _e,me,ye=function(e){try{return!!e()}catch(t){return!0}},ge=!ye((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),Se=ge,be=Function.prototype,Ee=be.call,ke=Se&&be.bind.bind(Ee,Ee),Te=Se?ke:function(e){return function(){return Ee.apply(e,arguments)}},Ie=function(e){return null==e},Re=Ie,Ae=TypeError,we=function(e){if(Re(e))throw Ae("Can't call method on "+e);return e},Ce=we,Oe=Object,xe=function(e){return Oe(Ce(e))},Ne=xe,De=Te({}.hasOwnProperty),Pe=Object.hasOwn||function(e,t){return De(Ne(e),t)},Me=Te,Le=0,Ue=Math.random(),Ve=Me(1..toString),Fe=function(e){return"Symbol("+(void 0===e?"":e)+")_"+Ve(++Le+Ue,36)},Be="object"==typeof document&&document.all,je={all:Be,IS_HTMLDDA:void 0===Be&&void 0!==Be},Ge=je.all,He=je.IS_HTMLDDA?function(e){return"function"==typeof e||e===Ge}:function(e){return"function"==typeof e},ze=se,qe=He,Xe=function(e){return qe(e)?e:void 0},Ke=function(e,t){return arguments.length<2?Xe(ze[e]):ze[e]&&ze[e][t]},We=Ke("navigator","userAgent")||"",Ye=se,Je=We,Qe=Ye.process,Ze=Ye.Deno,$e=Qe&&Qe.versions||Ze&&Ze.version,et=$e&&$e.v8;et&&(me=(_e=et.split("."))[0]>0&&_e[0]<4?1:+(_e[0]+_e[1])),!me&&Je&&(!(_e=Je.match(/Edge\/(\d+)/))||_e[1]>=74)&&(_e=Je.match(/Chrome\/(\d+)/))&&(me=+_e[1]);var tt=me,rt=tt,nt=ye,it=!!Object.getOwnPropertySymbols&&!nt((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&rt&&rt<41})),ot=it&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,at=se,st=ue.exports,ut=Pe,ct=Fe,dt=it,lt=ot,ht=st("wks"),ft=at.Symbol,pt=ft&&ft.for,vt=lt?ft:ft&&ft.withoutSetter||ct,_t=function(e){if(!ut(ht,e)||!dt&&"string"!=typeof ht[e]){var t="Symbol."+e;dt&&ut(ft,e)?ht[e]=ft[e]:ht[e]=lt&&pt?pt(t):vt(t)}return ht[e]},mt={};mt[_t("toStringTag")]="z";var yt="[object z]"===String(mt),gt={},St=!ye((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),bt=He,Et=je.all,kt=je.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:bt(e)||e===Et}:function(e){return"object"==typeof e?null!==e:bt(e)},Tt=kt,It=se.document,Rt=Tt(It)&&Tt(It.createElement),At=function(e){return Rt?It.createElement(e):{}},wt=At,Ct=!St&&!ye((function(){return 7!=Object.defineProperty(wt("div"),"a",{get:function(){return 7}}).a})),Ot=St&&ye((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xt=kt,Nt=String,Dt=TypeError,Pt=function(e){if(xt(e))return e;throw Dt(Nt(e)+" is not an object")},Mt=ge,Lt=Function.prototype.call,Ut=Mt?Lt.bind(Lt):function(){return Lt.apply(Lt,arguments)},Vt=Te({}.isPrototypeOf),Ft=Ke,Bt=He,jt=Vt,Gt=Object,Ht=ot?function(e){return"symbol"==typeof e}:function(e){var t=Ft("Symbol");return Bt(t)&&jt(t.prototype,Gt(e))},zt=String,qt=function(e){try{return zt(e)}catch(t){return"Object"}},Xt=He,Kt=qt,Wt=TypeError,Yt=function(e){if(Xt(e))return e;throw Wt(Kt(e)+" is not a function")},Jt=Yt,Qt=Ie,Zt=function(e,t){var r=e[t];return Qt(r)?void 0:Jt(r)},$t=Ut,er=He,tr=kt,rr=TypeError,nr=Ut,ir=kt,or=Ht,ar=Zt,sr=function(e,t){var r,n;if("string"===t&&er(r=e.toString)&&!tr(n=$t(r,e)))return n;if(er(r=e.valueOf)&&!tr(n=$t(r,e)))return n;if("string"!==t&&er(r=e.toString)&&!tr(n=$t(r,e)))return n;throw rr("Can't convert object to primitive value")},ur=TypeError,cr=_t("toPrimitive"),dr=function(e,t){if(!ir(e)||or(e))return e;var r,n=ar(e,cr);if(n){if(void 0===t&&(t="default"),r=nr(n,e,t),!ir(r)||or(r))return r;throw ur("Can't convert object to primitive value")}return void 0===t&&(t="number"),sr(e,t)},lr=dr,hr=Ht,fr=function(e){var t=lr(e,"string");return hr(t)?t:t+""},pr=St,vr=Ct,_r=Ot,mr=Pt,yr=fr,gr=TypeError,Sr=Object.defineProperty,br=Object.getOwnPropertyDescriptor,Er="enumerable",kr="configurable",Tr="writable";gt.f=pr?_r?function(e,t,r){if(mr(e),t=yr(t),mr(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Tr in r&&!r.writable){var n=br(e,t);n&&n.writable&&(e[t]=r.value,r={configurable:kr in r?r.configurable:n.configurable,enumerable:Er in r?r.enumerable:n.enumerable,writable:!1})}return Sr(e,t,r)}:Sr:function(e,t,r){if(mr(e),t=yr(t),mr(r),vr)try{return Sr(e,t,r)}catch(n){}if("get"in r||"set"in r)throw gr("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var Ir={exports:{}},Rr=St,Ar=Pe,wr=Function.prototype,Cr=Rr&&Object.getOwnPropertyDescriptor,Or=Ar(wr,"name"),xr={EXISTS:Or,PROPER:Or&&"something"===function(){}.name,CONFIGURABLE:Or&&(!Rr||Rr&&Cr(wr,"name").configurable)},Nr=He,Dr=pe,Pr=Te(Function.toString);Nr(Dr.inspectSource)||(Dr.inspectSource=function(e){return Pr(e)});var Mr,Lr,Ur,Vr=Dr.inspectSource,Fr=He,Br=se.WeakMap,jr=Fr(Br)&&/native code/.test(String(Br)),Gr=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},Hr=gt,zr=Gr,qr=St?function(e,t,r){return Hr.f(e,t,zr(1,r))}:function(e,t,r){return e[t]=r,e},Xr=ue.exports,Kr=Fe,Wr=Xr("keys"),Yr=function(e){return Wr[e]||(Wr[e]=Kr(e))},Jr={},Qr=jr,Zr=se,$r=kt,en=qr,tn=Pe,rn=pe,nn=Yr,on=Jr,an="Object already initialized",sn=Zr.TypeError,un=Zr.WeakMap;if(Qr||rn.state){var cn=rn.state||(rn.state=new un);cn.get=cn.get,cn.has=cn.has,cn.set=cn.set,Mr=function(e,t){if(cn.has(e))throw sn(an);return t.facade=e,cn.set(e,t),t},Lr=function(e){return cn.get(e)||{}},Ur=function(e){return cn.has(e)}}else{var dn=nn("state");on[dn]=!0,Mr=function(e,t){if(tn(e,dn))throw sn(an);return t.facade=e,en(e,dn,t),t},Lr=function(e){return tn(e,dn)?e[dn]:{}},Ur=function(e){return tn(e,dn)}}var ln={set:Mr,get:Lr,has:Ur,enforce:function(e){return Ur(e)?Lr(e):Mr(e,{})},getterFor:function(e){return function(t){var r;if(!$r(t)||(r=Lr(t)).type!==e)throw sn("Incompatible receiver, "+e+" required");return r}}},hn=ye,fn=He,pn=Pe,vn=St,_n=xr.CONFIGURABLE,mn=Vr,yn=ln.enforce,gn=ln.get,Sn=Object.defineProperty,bn=vn&&!hn((function(){return 8!==Sn((function(){}),"length",{value:8}).length})),En=String(String).split("String"),kn=Ir.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!pn(e,"name")||_n&&e.name!==t)&&(vn?Sn(e,"name",{value:t,configurable:!0}):e.name=t),bn&&r&&pn(r,"arity")&&e.length!==r.arity&&Sn(e,"length",{value:r.arity});try{r&&pn(r,"constructor")&&r.constructor?vn&&Sn(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(i){}var n=yn(e);return pn(n,"source")||(n.source=En.join("string"==typeof t?t:"")),e};Function.prototype.toString=kn((function(){return fn(this)&&gn(this).source||mn(this)}),"toString");var Tn=He,In=gt,Rn=Ir.exports,An=le,wn=function(e,t,r,n){n||(n={});var i=n.enumerable,o=void 0!==n.name?n.name:t;if(Tn(r)&&Rn(r,o,n),n.global)i?e[t]=r:An(t,r);else{try{n.unsafe?e[t]&&(i=!0):delete e[t]}catch(a){}i?e[t]=r:In.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},Cn=Te,On=Cn({}.toString),xn=Cn("".slice),Nn=function(e){return xn(On(e),8,-1)},Dn=yt,Pn=He,Mn=Nn,Ln=_t("toStringTag"),Un=Object,Vn="Arguments"==Mn(function(){return arguments}()),Fn=Dn?Mn:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(r){}}(t=Un(e),Ln))?r:Vn?Mn(t):"Object"==(n=Mn(t))&&Pn(t.callee)?"Arguments":n},Bn=Fn,jn=yt?{}.toString:function(){return"[object "+Bn(this)+"]"};yt||wn(Object.prototype,"toString",jn,{unsafe:!0});var Gn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Hn=At("span").classList,zn=Hn&&Hn.constructor&&Hn.constructor.prototype,qn=zn===Object.prototype?void 0:zn,Xn=Nn,Kn=Te,Wn=function(e){if("Function"===Xn(e))return Kn(e)},Yn=Yt,Jn=ge,Qn=Wn(Wn.bind),Zn=function(e,t){return Yn(e),void 0===t?e:Jn?Qn(e,t):function(){return e.apply(t,arguments)}},$n=ye,ei=Nn,ti=Object,ri=Te("".split),ni=$n((function(){return!ti("z").propertyIsEnumerable(0)}))?function(e){return"String"==ei(e)?ri(e,""):ti(e)}:ti,ii=Math.ceil,oi=Math.floor,ai=Math.trunc||function(e){var t=+e;return(t>0?oi:ii)(t)},si=function(e){var t=+e;return t!=t||0===t?0:ai(t)},ui=si,ci=Math.min,di=function(e){return e>0?ci(ui(e),9007199254740991):0},li=di,hi=function(e){return li(e.length)},fi=Nn,pi=Array.isArray||function(e){return"Array"==fi(e)},vi=Te,_i=ye,mi=He,yi=Fn,gi=Vr,Si=function(){},bi=[],Ei=Ke("Reflect","construct"),ki=/^\s*(?:class|function)\b/,Ti=vi(ki.exec),Ii=!ki.exec(Si),Ri=function(e){if(!mi(e))return!1;try{return Ei(Si,bi,e),!0}catch(t){return!1}},Ai=function(e){if(!mi(e))return!1;switch(yi(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ii||!!Ti(ki,gi(e))}catch(t){return!0}};Ai.sham=!0;var wi=!Ei||_i((function(){var e;return Ri(Ri.call)||!Ri(Object)||!Ri((function(){e=!0}))||e}))?Ai:Ri,Ci=pi,Oi=wi,xi=kt,Ni=_t("species"),Di=Array,Pi=function(e){var t;return Ci(e)&&(t=e.constructor,(Oi(t)&&(t===Di||Ci(t.prototype))||xi(t)&&null===(t=t[Ni]))&&(t=void 0)),void 0===t?Di:t},Mi=function(e,t){return new(Pi(e))(0===t?0:t)},Li=Zn,Ui=ni,Vi=xe,Fi=hi,Bi=Mi,ji=Te([].push),Gi=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,o=6==e,a=7==e,s=5==e||o;return function(u,c,d,l){for(var h,f,p=Vi(u),v=Ui(p),_=Li(c,d),m=Fi(v),y=0,g=l||Bi,S=t?g(u,m):r||a?g(u,0):void 0;m>y;y++)if((s||y in v)&&(f=_(h=v[y],y,p),e))if(t)S[y]=f;else if(f)switch(e){case 3:return!0;case 5:return h;case 6:return y;case 2:ji(S,h)}else switch(e){case 4:return!1;case 7:ji(S,h)}return o?-1:n||i?i:S}},Hi={forEach:Gi(0),map:Gi(1),filter:Gi(2),some:Gi(3),every:Gi(4),find:Gi(5),findIndex:Gi(6),filterReject:Gi(7)},zi=ye,qi=function(e,t){var r=[][e];return!!r&&zi((function(){r.call(null,t||function(){return 1},1)}))},Xi=Hi.forEach,Ki=qi("forEach")?[].forEach:function(e){return Xi(this,e,arguments.length>1?arguments[1]:void 0)},Wi=se,Yi=Gn,Ji=qn,Qi=Ki,Zi=qr,$i=function(e){if(e&&e.forEach!==Qi)try{Zi(e,"forEach",Qi)}catch(t){e.forEach=Qi}};for(var eo in Yi)Yi[eo]&&$i(Wi[eo]&&Wi[eo].prototype);$i(Ji);var to={},ro={},no={}.propertyIsEnumerable,io=Object.getOwnPropertyDescriptor,oo=io&&!no.call({1:2},1);ro.f=oo?function(e){var t=io(this,e);return!!t&&t.enumerable}:no;var ao=ni,so=we,uo=function(e){return ao(so(e))},co=St,lo=Ut,ho=ro,fo=Gr,po=uo,vo=fr,_o=Pe,mo=Ct,yo=Object.getOwnPropertyDescriptor;to.f=co?yo:function(e,t){if(e=po(e),t=vo(t),mo)try{return yo(e,t)}catch(r){}if(_o(e,t))return fo(!lo(ho.f,e,t),e[t])};var go={},So=si,bo=Math.max,Eo=Math.min,ko=function(e,t){var r=So(e);return r<0?bo(r+t,0):Eo(r,t)},To=uo,Io=ko,Ro=hi,Ao=function(e){return function(t,r,n){var i,o=To(t),a=Ro(o),s=Io(n,a);if(e&&r!=r){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((e||s in o)&&o[s]===r)return e||s||0;return!e&&-1}},wo={includes:Ao(!0),indexOf:Ao(!1)},Co=Pe,Oo=uo,xo=wo.indexOf,No=Jr,Do=Te([].push),Po=function(e,t){var r,n=Oo(e),i=0,o=[];for(r in n)!Co(No,r)&&Co(n,r)&&Do(o,r);for(;t.length>i;)Co(n,r=t[i++])&&(~xo(o,r)||Do(o,r));return o},Mo=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Lo=Po,Uo=Mo.concat("length","prototype");go.f=Object.getOwnPropertyNames||function(e){return Lo(e,Uo)};var Vo={};Vo.f=Object.getOwnPropertySymbols;var Fo=Ke,Bo=go,jo=Vo,Go=Pt,Ho=Te([].concat),zo=Fo("Reflect","ownKeys")||function(e){var t=Bo.f(Go(e)),r=jo.f;return r?Ho(t,r(e)):t},qo=Pe,Xo=zo,Ko=to,Wo=gt,Yo=function(e,t,r){for(var n=Xo(t),i=Wo.f,o=Ko.f,a=0;a<n.length;a++){var s=n[a];qo(e,s)||r&&qo(r,s)||i(e,s,o(t,s))}},Jo=ye,Qo=He,Zo=/#|\.prototype\./,$o=function(e,t){var r=ta[ea(e)];return r==na||r!=ra&&(Qo(t)?Jo(t):!!t)},ea=$o.normalize=function(e){return String(e).replace(Zo,".").toLowerCase()},ta=$o.data={},ra=$o.NATIVE="N",na=$o.POLYFILL="P",ia=$o,oa=se,aa=to.f,sa=qr,ua=wn,ca=le,da=Yo,la=ia,ha=function(e,t){var r,n,i,o,a,s=e.target,u=e.global,c=e.stat;if(r=u?oa:c?oa[s]||ca(s,{}):(oa[s]||{}).prototype)for(n in t){if(o=t[n],i=e.dontCallGetSet?(a=aa(r,n))&&a.value:r[n],!la(u?n:s+(c?".":"#")+n,e.forced)&&void 0!==i){if(typeof o==typeof i)continue;da(o,i)}(e.sham||i&&i.sham)&&sa(o,"sham",!0),ua(r,n,o,e)}},fa={},pa=Po,va=Mo,_a=Object.keys||function(e){return pa(e,va)},ma=St,ya=Ot,ga=gt,Sa=Pt,ba=uo,Ea=_a;fa.f=ma&&!ya?Object.defineProperties:function(e,t){Sa(e);for(var r,n=ba(t),i=Ea(t),o=i.length,a=0;o>a;)ga.f(e,r=i[a++],n[r]);return e};var ka,Ta=Ke("document","documentElement"),Ia=Pt,Ra=fa,Aa=Mo,wa=Jr,Ca=Ta,Oa=At,xa=Yr("IE_PROTO"),Na=function(){},Da=function(e){return"<script>"+e+"</"+"script>"},Pa=function(e){e.write(Da("")),e.close();var t=e.parentWindow.Object;return e=null,t},Ma=function(){try{ka=new ActiveXObject("htmlfile")}catch(n){}var e,t;Ma="undefined"!=typeof document?document.domain&&ka?Pa(ka):((t=Oa("iframe")).style.display="none",Ca.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Da("document.F=Object")),e.close(),e.F):Pa(ka);for(var r=Aa.length;r--;)delete Ma.prototype[Aa[r]];return Ma()};wa[xa]=!0;var La=Object.create||function(e,t){var r;return null!==e?(Na.prototype=Ia(e),r=new Na,Na.prototype=null,r[xa]=e):r=Ma(),void 0===t?r:Ra.f(r,t)},Ua=_t,Va=La,Fa=gt.f,Ba=Ua("unscopables"),ja=Array.prototype;null==ja[Ba]&&Fa(ja,Ba,{configurable:!0,value:Va(null)});var Ga=function(e){ja[Ba][e]=!0},Ha=wo.includes,za=Ga;ha({target:"Array",proto:!0,forced:ye((function(){return!Array(1).includes()}))},{includes:function(e){return Ha(this,e,arguments.length>1?arguments[1]:void 0)}}),za("includes");var qa=kt,Xa=Nn,Ka=_t("match"),Wa=function(e){var t;return qa(e)&&(void 0!==(t=e[Ka])?!!t:"RegExp"==Xa(e))},Ya=Wa,Ja=TypeError,Qa=function(e){if(Ya(e))throw Ja("The method doesn't accept regular expressions");return e},Za=Fn,$a=String,es=function(e){if("Symbol"===Za(e))throw TypeError("Cannot convert a Symbol value to a string");return $a(e)},ts=_t("match"),rs=function(e){var t=/./;try{"/./"[e](t)}catch(r){try{return t[ts]=!1,"/./"[e](t)}catch(n){}}return!1},ns=ha,is=Qa,os=we,as=es,ss=rs,us=Te("".indexOf);ns({target:"String",proto:!0,forced:!ss("includes")},{includes:function(e){return!!~us(as(os(this)),as(is(e)),arguments.length>1?arguments[1]:void 0)}});var cs,ds,ls=Pt,hs=function(){var e=ls(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},fs=ye,ps=se.RegExp,vs=fs((function(){var e=ps("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),_s=vs||fs((function(){return!ps("a","y").sticky})),ms=vs||fs((function(){var e=ps("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),ys={BROKEN_CARET:ms,MISSED_STICKY:_s,UNSUPPORTED_Y:vs},gs=ye,Ss=se.RegExp,bs=gs((function(){var e=Ss(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Es=ye,ks=se.RegExp,Ts=Es((function(){var e=ks("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),Is=Ut,Rs=Te,As=es,ws=hs,Cs=ys,Os=ue.exports,xs=La,Ns=ln.get,Ds=bs,Ps=Ts,Ms=Os("native-string-replace",String.prototype.replace),Ls=RegExp.prototype.exec,Us=Ls,Vs=Rs("".charAt),Fs=Rs("".indexOf),Bs=Rs("".replace),js=Rs("".slice),Gs=(ds=/b*/g,Is(Ls,cs=/a/,"a"),Is(Ls,ds,"a"),0!==cs.lastIndex||0!==ds.lastIndex),Hs=Cs.BROKEN_CARET,zs=void 0!==/()??/.exec("")[1];(Gs||zs||Hs||Ds||Ps)&&(Us=function(e){var t,r,n,i,o,a,s,u=this,c=Ns(u),d=As(e),l=c.raw;if(l)return l.lastIndex=u.lastIndex,t=Is(Us,l,d),u.lastIndex=l.lastIndex,t;var h=c.groups,f=Hs&&u.sticky,p=Is(ws,u),v=u.source,_=0,m=d;if(f&&(p=Bs(p,"y",""),-1===Fs(p,"g")&&(p+="g"),m=js(d,u.lastIndex),u.lastIndex>0&&(!u.multiline||u.multiline&&"\n"!==Vs(d,u.lastIndex-1))&&(v="(?: "+v+")",m=" "+m,_++),r=new RegExp("^(?:"+v+")",p)),zs&&(r=new RegExp("^"+v+"$(?!\\s)",p)),Gs&&(n=u.lastIndex),i=Is(Ls,f?r:u,m),f?i?(i.input=js(i.input,_),i[0]=js(i[0],_),i.index=u.lastIndex,u.lastIndex+=i[0].length):u.lastIndex=0:Gs&&i&&(u.lastIndex=u.global?i.index+i[0].length:n),zs&&i&&i.length>1&&Is(Ms,i[0],r,(function(){for(o=1;o<arguments.length-2;o++)void 0===arguments[o]&&(i[o]=void 0)})),i&&h)for(i.groups=a=xs(null),o=0;o<h.length;o++)a[(s=h[o])[0]]=i[s[1]];return i});var qs=Us;ha({target:"RegExp",proto:!0,forced:/./.exec!==qs},{exec:qs});var Xs=Wn,Ks=wn,Ws=qs,Ys=ye,Js=_t,Qs=qr,Zs=Js("species"),$s=RegExp.prototype,eu=function(e,t,r,n){var i=Js(e),o=!Ys((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=o&&!Ys((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[Zs]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!o||!a||r){var s=Xs(/./[i]),u=t(i,""[e],(function(e,t,r,n,i){var a=Xs(e),u=t.exec;return u===Ws||u===$s.exec?o&&!i?{done:!0,value:s(t,r,n)}:{done:!0,value:a(r,t,n)}:{done:!1}}));Ks(String.prototype,e,u[0]),Ks($s,i,u[1])}n&&Qs($s[i],"sham",!0)},tu=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},ru=Ut,nu=Pt,iu=He,ou=Nn,au=qs,su=TypeError,uu=function(e,t){var r=e.exec;if(iu(r)){var n=ru(r,e,t);return null!==n&&nu(n),n}if("RegExp"===ou(e))return ru(au,e,t);throw su("RegExp#exec called on incompatible receiver")},cu=Ut,du=Pt,lu=Ie,hu=we,fu=tu,pu=es,vu=Zt,_u=uu;eu("search",(function(e,t,r){return[function(t){var r=hu(this),n=lu(t)?void 0:vu(t,e);return n?cu(n,t,r):new RegExp(t)[e](pu(r))},function(e){var n=du(this),i=pu(e),o=r(t,n,i);if(o.done)return o.value;var a=n.lastIndex;fu(a,0)||(n.lastIndex=0);var s=_u(n,i);return fu(n.lastIndex,a)||(n.lastIndex=a),null===s?-1:s.index}]}));var mu=Te,yu=si,gu=es,Su=we,bu=mu("".charAt),Eu=mu("".charCodeAt),ku=mu("".slice),Tu=function(e){return function(t,r){var n,i,o=gu(Su(t)),a=yu(r),s=o.length;return a<0||a>=s?e?"":void 0:(n=Eu(o,a))<55296||n>56319||a+1===s||(i=Eu(o,a+1))<56320||i>57343?e?bu(o,a):n:e?ku(o,a,a+2):i-56320+(n-55296<<10)+65536}},Iu={codeAt:Tu(!1),charAt:Tu(!0)},Ru=Iu.charAt,Au=function(e,t,r){return t+(r?Ru(e,t).length:1)},wu=Ut,Cu=Pt,Ou=Ie,xu=di,Nu=es,Du=we,Pu=Zt,Mu=Au,Lu=uu;eu("match",(function(e,t,r){return[function(t){var r=Du(this),n=Ou(t)?void 0:Pu(t,e);return n?wu(n,t,r):new RegExp(t)[e](Nu(r))},function(e){var n=Cu(this),i=Nu(e),o=r(t,n,i);if(o.done)return o.value;if(!n.global)return Lu(n,i);var a=n.unicode;n.lastIndex=0;for(var s,u=[],c=0;null!==(s=Lu(n,i));){var d=Nu(s[0]);u[c]=d,""===d&&(n.lastIndex=Mu(i,xu(n.lastIndex),a)),c++}return 0===c?null:u}]}));var Uu="\t\n\v\f\r                　\u2028\u2029\ufeff",Vu=we,Fu=es,Bu=Te("".replace),ju="[\t\n\v\f\r                　\u2028\u2029\ufeff]",Gu=RegExp("^"+ju+ju+"*"),Hu=RegExp(ju+ju+"*$"),zu=function(e){return function(t){var r=Fu(Vu(t));return 1&e&&(r=Bu(r,Gu,"")),2&e&&(r=Bu(r,Hu,"")),r}},qu={start:zu(1),end:zu(2),trim:zu(3)},Xu=se,Ku=ye,Wu=Te,Yu=es,Ju=qu.trim,Qu=Uu,Zu=Xu.parseInt,$u=Xu.Symbol,ec=$u&&$u.iterator,tc=/^[+-]?0x/i,rc=Wu(tc.exec),nc=8!==Zu(Qu+"08")||22!==Zu(Qu+"0x16")||ec&&!Ku((function(){Zu(Object(ec))}))?function(e,t){var r=Ju(Yu(e));return Zu(r,t>>>0||(rc(tc,r)?16:10))}:Zu;ha({global:!0,forced:parseInt!=nc},{parseInt:nc});var ic,oc,ac,sc={},uc=!ye((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),cc=Pe,dc=He,lc=xe,hc=uc,fc=Yr("IE_PROTO"),pc=Object,vc=pc.prototype,_c=hc?pc.getPrototypeOf:function(e){var t=lc(e);if(cc(t,fc))return t[fc];var r=t.constructor;return dc(r)&&t instanceof r?r.prototype:t instanceof pc?vc:null},mc=ye,yc=He,gc=kt,Sc=_c,bc=wn,Ec=_t("iterator"),kc=!1;[].keys&&("next"in(ac=[].keys())?(oc=Sc(Sc(ac)))!==Object.prototype&&(ic=oc):kc=!0),(!gc(ic)||mc((function(){var e={};return ic[Ec].call(e)!==e})))&&(ic={}),yc(ic[Ec])||bc(ic,Ec,(function(){return this}));var Tc={IteratorPrototype:ic,BUGGY_SAFARI_ITERATORS:kc},Ic=gt.f,Rc=Pe,Ac=_t("toStringTag"),wc=function(e,t,r){e&&!r&&(e=e.prototype),e&&!Rc(e,Ac)&&Ic(e,Ac,{configurable:!0,value:t})},Cc=Tc.IteratorPrototype,Oc=La,xc=Gr,Nc=wc,Dc=sc,Pc=function(){return this},Mc=function(e,t,r,n){var i=t+" Iterator";return e.prototype=Oc(Cc,{next:xc(+!n,r)}),Nc(e,i,!1),Dc[i]=Pc,e},Lc=He,Uc=String,Vc=TypeError,Fc=Te,Bc=Pt,jc=function(e){if("object"==typeof e||Lc(e))return e;throw Vc("Can't set "+Uc(e)+" as a prototype")},Gc=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Fc(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(n){}return function(r,n){return Bc(r),jc(n),t?e(r,n):r.__proto__=n,r}}():void 0),Hc=ha,zc=Ut,qc=He,Xc=Mc,Kc=_c,Wc=Gc,Yc=wc,Jc=qr,Qc=wn,Zc=sc,$c=xr.PROPER,ed=xr.CONFIGURABLE,td=Tc.IteratorPrototype,rd=Tc.BUGGY_SAFARI_ITERATORS,nd=_t("iterator"),id="keys",od="values",ad="entries",sd=function(){return this},ud=function(e,t,r,n,i,o,a){Xc(r,t,n);var s,u,c,d=function(e){if(e===i&&v)return v;if(!rd&&e in f)return f[e];switch(e){case id:case od:case ad:return function(){return new r(this,e)}}return function(){return new r(this)}},l=t+" Iterator",h=!1,f=e.prototype,p=f[nd]||f["@@iterator"]||i&&f[i],v=!rd&&p||d(i),_="Array"==t&&f.entries||p;if(_&&(s=Kc(_.call(new e)))!==Object.prototype&&s.next&&(Kc(s)!==td&&(Wc?Wc(s,td):qc(s[nd])||Qc(s,nd,sd)),Yc(s,l,!0)),$c&&i==od&&p&&p.name!==od&&(ed?Jc(f,"name",od):(h=!0,v=function(){return zc(p,this)})),i)if(u={values:d(od),keys:o?v:d(id),entries:d(ad)},a)for(c in u)(rd||h||!(c in f))&&Qc(f,c,u[c]);else Hc({target:t,proto:!0,forced:rd||h},u);return f[nd]!==v&&Qc(f,nd,v,{name:i}),Zc[t]=v,u},cd=function(e,t){return{value:e,done:t}},dd=uo,ld=Ga,hd=sc,fd=ln,pd=gt.f,vd=ud,_d=cd,md=St,yd="Array Iterator",gd=fd.set,Sd=fd.getterFor(yd),bd=vd(Array,"Array",(function(e,t){gd(this,{type:yd,target:dd(e),index:0,kind:t})}),(function(){var e=Sd(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,_d(void 0,!0)):_d("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values"),Ed=hd.Arguments=hd.Array;if(ld("keys"),ld("values"),ld("entries"),md&&"values"!==Ed.name)try{pd(Ed,"name",{value:"values"})}catch(X$){}var kd={exports:{}},Td={},Id=fr,Rd=gt,Ad=Gr,wd=function(e,t,r){var n=Id(t);n in e?Rd.f(e,n,Ad(0,r)):e[n]=r},Cd=ko,Od=hi,xd=wd,Nd=Array,Dd=Math.max,Pd=function(e,t,r){for(var n=Od(e),i=Cd(t,n),o=Cd(void 0===r?n:r,n),a=Nd(Dd(o-i,0)),s=0;i<o;i++,s++)xd(a,s,e[i]);return a.length=s,a},Md=Nn,Ld=uo,Ud=go.f,Vd=Pd,Fd="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];Td.f=function(e){return Fd&&"Window"==Md(e)?function(e){try{return Ud(e)}catch(X$){return Vd(Fd)}}(e):Ud(Ld(e))};var Bd=ye((function(){if("function"==typeof ArrayBuffer){var e=new ArrayBuffer(8);Object.isExtensible(e)&&Object.defineProperty(e,"a",{value:8})}})),jd=ye,Gd=kt,Hd=Nn,zd=Bd,qd=Object.isExtensible,Xd=jd((function(){qd(1)}))||zd?function(e){return!!Gd(e)&&((!zd||"ArrayBuffer"!=Hd(e))&&(!qd||qd(e)))}:qd,Kd=!ye((function(){return Object.isExtensible(Object.preventExtensions({}))})),Wd=ha,Yd=Te,Jd=Jr,Qd=kt,Zd=Pe,$d=gt.f,el=go,tl=Td,rl=Xd,nl=Kd,il=!1,ol=Fe("meta"),al=0,sl=function(e){$d(e,ol,{value:{objectID:"O"+al++,weakData:{}}})},ul=kd.exports={enable:function(){ul.enable=function(){},il=!0;var e=el.f,t=Yd([].splice),r={};r[ol]=1,e(r).length&&(el.f=function(r){for(var n=e(r),i=0,o=n.length;i<o;i++)if(n[i]===ol){t(n,i,1);break}return n},Wd({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:tl.f}))},fastKey:function(e,t){if(!Qd(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!Zd(e,ol)){if(!rl(e))return"F";if(!t)return"E";sl(e)}return e[ol].objectID},getWeakData:function(e,t){if(!Zd(e,ol)){if(!rl(e))return!0;if(!t)return!1;sl(e)}return e[ol].weakData},onFreeze:function(e){return nl&&il&&rl(e)&&!Zd(e,ol)&&sl(e),e}};Jd[ol]=!0;var cl=sc,dl=_t("iterator"),ll=Array.prototype,hl=function(e){return void 0!==e&&(cl.Array===e||ll[dl]===e)},fl=Fn,pl=Zt,vl=Ie,_l=sc,ml=_t("iterator"),yl=function(e){if(!vl(e))return pl(e,ml)||pl(e,"@@iterator")||_l[fl(e)]},gl=Ut,Sl=Yt,bl=Pt,El=qt,kl=yl,Tl=TypeError,Il=function(e,t){var r=arguments.length<2?kl(e):t;if(Sl(r))return bl(gl(r,e));throw Tl(El(e)+" is not iterable")},Rl=Ut,Al=Pt,wl=Zt,Cl=function(e,t,r){var n,i;Al(e);try{if(!(n=wl(e,"return"))){if("throw"===t)throw r;return r}n=Rl(n,e)}catch(X$){i=!0,n=X$}if("throw"===t)throw r;if(i)throw n;return Al(n),r},Ol=Zn,xl=Ut,Nl=Pt,Dl=qt,Pl=hl,Ml=hi,Ll=Vt,Ul=Il,Vl=yl,Fl=Cl,Bl=TypeError,jl=function(e,t){this.stopped=e,this.result=t},Gl=jl.prototype,Hl=function(e,t,r){var n,i,o,a,s,u,c,d=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),f=!(!r||!r.IS_ITERATOR),p=!(!r||!r.INTERRUPTED),v=Ol(t,d),_=function(e){return n&&Fl(n,"normal",e),new jl(!0,e)},m=function(e){return l?(Nl(e),p?v(e[0],e[1],_):v(e[0],e[1])):p?v(e,_):v(e)};if(h)n=e.iterator;else if(f)n=e;else{if(!(i=Vl(e)))throw Bl(Dl(e)+" is not iterable");if(Pl(i)){for(o=0,a=Ml(e);a>o;o++)if((s=m(e[o]))&&Ll(Gl,s))return s;return new jl(!1)}n=Ul(e,i)}for(u=h?e.next:n.next;!(c=xl(u,n)).done;){try{s=m(c.value)}catch(X$){Fl(n,"throw",X$)}if("object"==typeof s&&s&&Ll(Gl,s))return s}return new jl(!1)},zl=Vt,ql=TypeError,Xl=function(e,t){if(zl(t,e))return e;throw ql("Incorrect invocation")},Kl=_t("iterator"),Wl=!1;try{var Yl=0,Jl={next:function(){return{done:!!Yl++}},return:function(){Wl=!0}};Jl[Kl]=function(){return this},Array.from(Jl,(function(){throw 2}))}catch(X$){}var Ql=function(e,t){if(!t&&!Wl)return!1;var r=!1;try{var n={};n[Kl]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(X$){}return r},Zl=He,$l=kt,eh=Gc,th=function(e,t,r){var n,i;return eh&&Zl(n=t.constructor)&&n!==r&&$l(i=n.prototype)&&i!==r.prototype&&eh(e,i),e},rh=ha,nh=se,ih=Te,oh=ia,ah=wn,sh=kd.exports,uh=Hl,ch=Xl,dh=He,lh=Ie,hh=kt,fh=ye,ph=Ql,vh=wc,_h=th,mh=function(e,t,r){var n=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),o=n?"set":"add",a=nh[e],s=a&&a.prototype,u=a,c={},d=function(e){var t=ih(s[e]);ah(s,e,"add"==e?function(e){return t(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!hh(e))&&t(this,0===e?0:e)}:"get"==e?function(e){return i&&!hh(e)?void 0:t(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!hh(e))&&t(this,0===e?0:e)}:function(e,r){return t(this,0===e?0:e,r),this})};if(oh(e,!dh(a)||!(i||s.forEach&&!fh((function(){(new a).entries().next()})))))u=r.getConstructor(t,e,n,o),sh.enable();else if(oh(e,!0)){var l=new u,h=l[o](i?{}:-0,1)!=l,f=fh((function(){l.has(1)})),p=ph((function(e){new a(e)})),v=!i&&fh((function(){for(var e=new a,t=5;t--;)e[o](t,t);return!e.has(-0)}));p||((u=t((function(e,t){ch(e,s);var r=_h(new a,e,u);return lh(t)||uh(t,r[o],{that:r,AS_ENTRIES:n}),r}))).prototype=s,s.constructor=u),(f||v)&&(d("delete"),d("has"),n&&d("get")),(v||h)&&d(o),i&&s.clear&&delete s.clear}return c[e]=u,rh({global:!0,constructor:!0,forced:u!=a},c),vh(u,e),i||r.setStrong(u,e,n),u},yh=wn,gh=function(e,t,r){for(var n in t)yh(e,n,t[n],r);return e},Sh=Ke,bh=gt,Eh=St,kh=_t("species"),Th=function(e){var t=Sh(e),r=bh.f;Eh&&t&&!t[kh]&&r(t,kh,{configurable:!0,get:function(){return this}})},Ih=gt.f,Rh=La,Ah=gh,wh=Zn,Ch=Xl,Oh=Ie,xh=Hl,Nh=ud,Dh=cd,Ph=Th,Mh=St,Lh=kd.exports.fastKey,Uh=ln.set,Vh=ln.getterFor,Fh={getConstructor:function(e,t,r,n){var i=e((function(e,i){Ch(e,o),Uh(e,{type:t,index:Rh(null),first:void 0,last:void 0,size:0}),Mh||(e.size=0),Oh(i)||xh(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=Vh(t),s=function(e,t,r){var n,i,o=a(e),s=u(e,t);return s?s.value=r:(o.last=s={index:i=Lh(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=s),n&&(n.next=s),Mh?o.size++:e.size++,"F"!==i&&(o.index[i]=s)),e},u=function(e,t){var r,n=a(e),i=Lh(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return Ah(o,{clear:function(){for(var e=a(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,Mh?e.size=0:this.size=0},delete:function(e){var t=this,r=a(t),n=u(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),Mh?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=a(this),n=wh(e,arguments.length>1?arguments[1]:void 0);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!u(this,e)}}),Ah(o,r?{get:function(e){var t=u(this,e);return t&&t.value},set:function(e,t){return s(this,0===e?0:e,t)}}:{add:function(e){return s(this,e=0===e?0:e,e)}}),Mh&&Ih(o,"size",{get:function(){return a(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=Vh(t),o=Vh(n);Nh(e,t,(function(e,t){Uh(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=o(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?Dh("keys"==t?r.key:"values"==t?r.value:[r.key,r.value],!1):(e.target=void 0,Dh(void 0,!0))}),r?"entries":"values",!r,!0),Ph(t)}};mh("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Fh);var Bh=Iu.charAt,jh=es,Gh=ln,Hh=ud,zh=cd,qh="String Iterator",Xh=Gh.set,Kh=Gh.getterFor(qh);Hh(String,"String",(function(e){Xh(this,{type:qh,string:jh(e),index:0})}),(function(){var e,t=Kh(this),r=t.string,n=t.index;return n>=r.length?zh(void 0,!0):(e=Bh(r,n),t.index+=e.length,zh(e,!1))}));var Wh=se,Yh=Gn,Jh=qn,Qh=bd,Zh=qr,$h=_t,ef=$h("iterator"),tf=$h("toStringTag"),rf=Qh.values,nf=function(e,t){if(e){if(e[ef]!==rf)try{Zh(e,ef,rf)}catch(X$){e[ef]=rf}if(e[tf]||Zh(e,tf,t),Yh[t])for(var r in Qh)if(e[r]!==Qh[r])try{Zh(e,r,Qh[r])}catch(X$){e[r]=Qh[r]}}};for(var of in Yh)nf(Wh[of]&&Wh[of].prototype,of);nf(Jh,"DOMTokenList");var af=xe,sf=_a;ha({target:"Object",stat:!0,forced:ye((function(){sf(1)}))},{keys:function(e){return sf(af(e))}});var uf=ha,cf=St,df=gt.f;uf({target:"Object",stat:!0,forced:Object.defineProperty!==df,sham:!cf},{defineProperty:df});var lf=ge,hf=Function.prototype,ff=hf.apply,pf=hf.call,vf="object"==typeof Reflect&&Reflect.apply||(lf?pf.bind(ff):function(){return pf.apply(ff,arguments)}),_f=gt.f,mf=function(e,t,r){r in e||_f(e,r,{configurable:!0,get:function(){return t[r]},set:function(e){t[r]=e}})},yf=es,gf=function(e,t){return void 0===e?arguments.length<2?"":t:yf(e)},Sf=kt,bf=qr,Ef=Error,kf=Te("".replace),Tf=String(Ef("zxcasd").stack),If=/\n\s*at [^:]*:[^\n]*/,Rf=If.test(Tf),Af=function(e,t){if(Rf&&"string"==typeof e&&!Ef.prepareStackTrace)for(;t--;)e=kf(e,If,"");return e},wf=Gr,Cf=!ye((function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",wf(1,7)),7!==e.stack)})),Of=Ke,xf=Pe,Nf=qr,Df=Vt,Pf=Gc,Mf=Yo,Lf=mf,Uf=th,Vf=gf,Ff=function(e,t){Sf(t)&&"cause"in t&&bf(e,"cause",t.cause)},Bf=Af,jf=Cf,Gf=St,Hf=ha,zf=vf,qf=function(e,t,r,n){var i="stackTraceLimit",o=n?2:1,a=e.split("."),s=a[a.length-1],u=Of.apply(null,a);if(u){var c=u.prototype;if(xf(c,"cause")&&delete c.cause,!r)return u;var d=Of("Error"),l=t((function(e,t){var r=Vf(n?t:e,void 0),i=n?new u(e):new u;return void 0!==r&&Nf(i,"message",r),jf&&Nf(i,"stack",Bf(i.stack,2)),this&&Df(c,this)&&Uf(i,this,l),arguments.length>o&&Ff(i,arguments[o]),i}));l.prototype=c,"Error"!==s?Pf?Pf(l,d):Mf(l,d,{name:!0}):Gf&&i in u&&(Lf(l,u,i),Lf(l,u,"prepareStackTrace")),Mf(l,u);try{c.name!==s&&Nf(c,"name",s),c.constructor=l}catch(X$){}return l}},Xf="WebAssembly",Kf=se.WebAssembly,Wf=7!==Error("e",{cause:7}).cause,Yf=function(e,t){var r={};r[e]=qf(e,t,Wf),Hf({global:!0,constructor:!0,arity:1,forced:Wf},r)},Jf=function(e,t){if(Kf&&Kf[e]){var r={};r[e]=qf("WebAssembly."+e,t,Wf),Hf({target:Xf,stat:!0,constructor:!0,arity:1,forced:Wf},r)}};Yf("Error",(function(e){return function(t){return zf(e,this,arguments)}})),Yf("EvalError",(function(e){return function(t){return zf(e,this,arguments)}})),Yf("RangeError",(function(e){return function(t){return zf(e,this,arguments)}})),Yf("ReferenceError",(function(e){return function(t){return zf(e,this,arguments)}})),Yf("SyntaxError",(function(e){return function(t){return zf(e,this,arguments)}})),Yf("TypeError",(function(e){return function(t){return zf(e,this,arguments)}})),Yf("URIError",(function(e){return function(t){return zf(e,this,arguments)}})),Jf("CompileError",(function(e){return function(t){return zf(e,this,arguments)}})),Jf("LinkError",(function(e){return function(t){return zf(e,this,arguments)}})),Jf("RuntimeError",(function(e){return function(t){return zf(e,this,arguments)}}));var Qf=Yt,Zf=xe,$f=ni,ep=hi,tp=TypeError,rp=function(e){return function(t,r,n,i){Qf(r);var o=Zf(t),a=$f(o),s=ep(o),u=e?s-1:0,c=e?-1:1;if(n<2)for(;;){if(u in a){i=a[u],u+=c;break}if(u+=c,e?u<0:s<=u)throw tp("Reduce of empty array with no initial value")}for(;e?u>=0:s>u;u+=c)u in a&&(i=r(i,a[u],u,o));return i}},np={left:rp(!1),right:rp(!0)},ip="process"==Nn(se.process),op=np.left,ap=tt,sp=ip;ha({target:"Array",proto:!0,forced:!qi("reduce")||!sp&&ap>79&&ap<83},{reduce:function(e){var t=arguments.length;return op(this,e,t,t>1?arguments[1]:void 0)}});var up=St,cp=Te,dp=Ut,lp=ye,hp=_a,fp=Vo,pp=ro,vp=xe,_p=ni,mp=Object.assign,yp=Object.defineProperty,gp=cp([].concat),Sp=!mp||lp((function(){if(up&&1!==mp({b:1},mp(yp({},"a",{enumerable:!0,get:function(){yp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=mp({},e)[r]||hp(mp({},t)).join("")!=n}))?function(e,t){for(var r=vp(e),n=arguments.length,i=1,o=fp.f,a=pp.f;n>i;)for(var s,u=_p(arguments[i++]),c=o?gp(hp(u),o(u)):hp(u),d=c.length,l=0;d>l;)s=c[l++],up&&!dp(a,u,s)||(r[s]=u[s]);return r}:mp,bp=Sp;ha({target:"Object",stat:!0,arity:2,forced:Object.assign!==bp},{assign:bp});var Ep,kp=ha,Tp=Wn,Ip=to.f,Rp=di,Ap=es,wp=Qa,Cp=we,Op=rs,xp=Tp("".endsWith),Np=Tp("".slice),Dp=Math.min,Pp=Op("endsWith");kp({target:"String",proto:!0,forced:!!(Pp||(Ep=Ip(String.prototype,"endsWith"),!Ep||Ep.writable))&&!Pp},{endsWith:function(e){var t=Ap(Cp(this));wp(e);var r=arguments.length>1?arguments[1]:void 0,n=t.length,i=void 0===r?n:Dp(Rp(r),n),o=Ap(e);return xp?xp(t,o,i):Np(t,i-o.length,i)===o}});var Mp=St,Lp=pi,Up=TypeError,Vp=Object.getOwnPropertyDescriptor,Fp=Mp&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(X$){return X$ instanceof TypeError}}()?function(e,t){if(Lp(e)&&!Vp(e,"length").writable)throw Up("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},Bp=TypeError,jp=function(e){if(e>9007199254740991)throw Bp("Maximum allowed index exceeded");return e},Gp=ha,Hp=xe,zp=hi,qp=Fp,Xp=jp,Kp=ye((function(){return 4294967297!==[].push.call({length:4294967296},1)})),Wp=!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(X$){return X$ instanceof TypeError}}();Gp({target:"Array",proto:!0,arity:1,forced:Kp||Wp},{push:function(e){var t=Hp(this),r=zp(t),n=arguments.length;Xp(r+n);for(var i=0;i<n;i++)t[r]=arguments[i],r++;return qp(t,r),r}});var Yp=!0,Jp=!0;function Qp(e,t,r){var n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function Zp(e,t,r){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,i=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return i.apply(this,arguments);var o=function(e){var t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,o),i.apply(this,[e,o])};var o=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(r))return o.apply(this,arguments);var n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}}function $p(e){return"boolean"!=typeof e?new Error("Argument type: "+a(e)+". Please use a boolean."):(Yp=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function ev(e){return"boolean"!=typeof e?new Error("Argument type: "+a(e)+". Please use a boolean."):(Jp=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function tv(){if("object"===("undefined"==typeof window?"undefined":a(window))){if(Yp)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function rv(e,t){Jp&&console.warn(e+" is deprecated, please use "+t+" instead.")}function nv(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=Qp(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Qp(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Qp(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function iv(e){return"[object Object]"===Object.prototype.toString.call(e)}function ov(e){return iv(e)?Object.keys(e).reduce((function(t,r){var n=iv(e[r]),i=n?ov(e[r]):e[r],o=n&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,h({},r,i))}),{}):e}function av(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?av(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((function(t){av(e,e.get(t),r)}))})))}function sv(e,t,r){var n=r?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((function(t){e.forEach((function(r){r.type===n&&r.trackId===t.id&&av(e,r,i)}))})),i}var uv=ha,cv=Hi.find,dv=Ga,lv="find",hv=!0;lv in[]&&Array(1).find((function(){hv=!1})),uv({target:"Array",proto:!0,forced:hv},{find:function(e){return cv(this,e,arguments.length>1?arguments[1]:void 0)}}),dv(lv);var fv=ye,pv=tt,vv=_t("species"),_v=function(e){return pv>=51||!fv((function(){var t=[];return(t.constructor={})[vv]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},mv=Te([].slice),yv=ha,gv=pi,Sv=wi,bv=kt,Ev=ko,kv=hi,Tv=uo,Iv=wd,Rv=_t,Av=mv,wv=_v("slice"),Cv=Rv("species"),Ov=Array,xv=Math.max;yv({target:"Array",proto:!0,forced:!wv},{slice:function(e,t){var r,n,i,o=Tv(this),a=kv(o),s=Ev(e,a),u=Ev(void 0===t?a:t,a);if(gv(o)&&(r=o.constructor,(Sv(r)&&(r===Ov||gv(r.prototype))||bv(r)&&null===(r=r[Cv]))&&(r=void 0),r===Ov||void 0===r))return Av(o,s,u);for(n=new(void 0===r?Ov:r)(xv(u-s,0)),i=0;s<u;s++,i++)s in o&&Iv(n,i,o[s]);return n.length=i,n}});var Nv=ha,Dv=wo.indexOf,Pv=qi,Mv=Wn([].indexOf),Lv=!!Mv&&1/Mv([1],1,-0)<0,Uv=Pv("indexOf");Nv({target:"Array",proto:!0,forced:Lv||!Uv},{indexOf:function(e){var t=arguments.length>1?arguments[1]:void 0;return Lv?Mv(this,e,t)||0:Dv(this,e,t)}});var Vv=qt,Fv=TypeError,Bv=function(e,t){if(!delete e[t])throw Fv("Cannot delete property "+Vv(t)+" of "+Vv(e))},jv=ha,Gv=xe,Hv=ko,zv=si,qv=hi,Xv=Fp,Kv=jp,Wv=Mi,Yv=wd,Jv=Bv,Qv=_v("splice"),Zv=Math.max,$v=Math.min;jv({target:"Array",proto:!0,forced:!Qv},{splice:function(e,t){var r,n,i,o,a,s,u=Gv(this),c=qv(u),d=Hv(e,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-d):(r=l-2,n=$v(Zv(zv(t),0),c-d)),Kv(c+r-n),i=Wv(u,n),o=0;o<n;o++)(a=d+o)in u&&Yv(i,o,u[a]);if(i.length=n,r<n){for(o=d;o<c-n;o++)s=o+r,(a=o+n)in u?u[s]=u[a]:Jv(u,s);for(o=c;o>c-n+r;o--)Jv(u,o-1)}else if(r>n)for(o=c-n;o>d;o--)s=o+r-1,(a=o+n-1)in u?u[s]=u[a]:Jv(u,s);for(o=0;o<r;o++)u[o+d]=arguments[o+2];return Xv(u,c-n+r),i}});var e_=Hi.map;ha({target:"Array",proto:!0,forced:!_v("map")},{map:function(e){return e_(this,e,arguments.length>1?arguments[1]:void 0)}});var t_,r_,n_,i_,o_=wi,a_=qt,s_=TypeError,u_=function(e){if(o_(e))return e;throw s_(a_(e)+" is not a constructor")},c_=Pt,d_=u_,l_=Ie,h_=_t("species"),f_=function(e,t){var r,n=c_(e).constructor;return void 0===n||l_(r=c_(n)[h_])?t:d_(r)},p_=TypeError,v_=function(e,t){if(e<t)throw p_("Not enough arguments");return e},__=/(?:ipad|iphone|ipod).*applewebkit/i.test(We),m_=se,y_=vf,g_=Zn,S_=He,b_=Pe,E_=ye,k_=Ta,T_=mv,I_=At,R_=v_,A_=__,w_=ip,C_=m_.setImmediate,O_=m_.clearImmediate,x_=m_.process,N_=m_.Dispatch,D_=m_.Function,P_=m_.MessageChannel,M_=m_.String,L_=0,U_={},V_="onreadystatechange";try{t_=m_.location}catch(X$){}var F_=function(e){if(b_(U_,e)){var t=U_[e];delete U_[e],t()}},B_=function(e){return function(){F_(e)}},j_=function(e){F_(e.data)},G_=function(e){m_.postMessage(M_(e),t_.protocol+"//"+t_.host)};C_&&O_||(C_=function(e){R_(arguments.length,1);var t=S_(e)?e:D_(e),r=T_(arguments,1);return U_[++L_]=function(){y_(t,void 0,r)},r_(L_),L_},O_=function(e){delete U_[e]},w_?r_=function(e){x_.nextTick(B_(e))}:N_&&N_.now?r_=function(e){N_.now(B_(e))}:P_&&!A_?(i_=(n_=new P_).port2,n_.port1.onmessage=j_,r_=g_(i_.postMessage,i_)):m_.addEventListener&&S_(m_.postMessage)&&!m_.importScripts&&t_&&"file:"!==t_.protocol&&!E_(G_)?(r_=G_,m_.addEventListener("message",j_,!1)):r_=V_ in I_("script")?function(e){k_.appendChild(I_("script")).onreadystatechange=function(){k_.removeChild(this),F_(e)}}:function(e){setTimeout(B_(e),0)});var H_,z_,q_,X_,K_,W_,Y_,J_,Q_={set:C_,clear:O_},Z_=se,$_=/ipad|iphone|ipod/i.test(We)&&void 0!==Z_.Pebble,em=/web0s(?!.*chrome)/i.test(We),tm=se,rm=Zn,nm=to.f,im=Q_.set,om=__,am=$_,sm=em,um=ip,cm=tm.MutationObserver||tm.WebKitMutationObserver,dm=tm.document,lm=tm.process,hm=tm.Promise,fm=nm(tm,"queueMicrotask"),pm=fm&&fm.value;pm||(H_=function(){var e,t;for(um&&(e=lm.domain)&&e.exit();z_;){t=z_.fn,z_=z_.next;try{t()}catch(X$){throw z_?X_():q_=void 0,X$}}q_=void 0,e&&e.enter()},om||um||sm||!cm||!dm?!am&&hm&&hm.resolve?((Y_=hm.resolve(void 0)).constructor=hm,J_=rm(Y_.then,Y_),X_=function(){J_(H_)}):um?X_=function(){lm.nextTick(H_)}:(im=rm(im,tm),X_=function(){im(H_)}):(K_=!0,W_=dm.createTextNode(""),new cm(H_).observe(W_,{characterData:!0}),X_=function(){W_.data=K_=!K_}));var vm=pm||function(e){var t={fn:e,next:void 0};q_&&(q_.next=t),z_||(z_=t,X_()),q_=t},_m=se,mm=function(e){try{return{error:!1,value:e()}}catch(X$){return{error:!0,value:X$}}},ym=function(){this.head=null,this.tail=null};ym.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var gm=ym,Sm=se.Promise,bm="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Em=!bm&&!ip&&"object"==typeof window&&"object"==typeof document,km=se,Tm=Sm,Im=He,Rm=ia,Am=Vr,wm=_t,Cm=Em,Om=bm,xm=tt;Tm&&Tm.prototype;var Nm=wm("species"),Dm=!1,Pm=Im(km.PromiseRejectionEvent),Mm={CONSTRUCTOR:Rm("Promise",(function(){var e=Am(Tm),t=e!==String(Tm);if(!t&&66===xm)return!0;if(!xm||xm<51||!/native code/.test(e)){var r=new Tm((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};if((r.constructor={})[Nm]=n,!(Dm=r.then((function(){}))instanceof n))return!0}return!t&&(Cm||Om)&&!Pm})),REJECTION_EVENT:Pm,SUBCLASSING:Dm},Lm={},Um=Yt,Vm=TypeError,Fm=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw Vm("Bad Promise constructor");t=e,r=n})),this.resolve=Um(t),this.reject=Um(r)};Lm.f=function(e){return new Fm(e)};var Bm,jm,Gm,Hm=ha,zm=ip,qm=se,Xm=Ut,Km=wn,Wm=Gc,Ym=wc,Jm=Th,Qm=Yt,Zm=He,$m=kt,ey=Xl,ty=f_,ry=Q_.set,ny=vm,iy=function(e,t){var r=_m.console;r&&r.error&&(1==arguments.length?r.error(e):r.error(e,t))},oy=mm,ay=gm,sy=ln,uy=Sm,cy=Lm,dy="Promise",ly=Mm.CONSTRUCTOR,hy=Mm.REJECTION_EVENT,fy=Mm.SUBCLASSING,py=sy.getterFor(dy),vy=sy.set,_y=uy&&uy.prototype,my=uy,yy=_y,gy=qm.TypeError,Sy=qm.document,by=qm.process,Ey=cy.f,ky=Ey,Ty=!!(Sy&&Sy.createEvent&&qm.dispatchEvent),Iy="unhandledrejection",Ry=function(e){var t;return!(!$m(e)||!Zm(t=e.then))&&t},Ay=function(e,t){var r,n,i,o=t.value,a=1==t.state,s=a?e.ok:e.fail,u=e.resolve,c=e.reject,d=e.domain;try{s?(a||(2===t.rejection&&Ny(t),t.rejection=1),!0===s?r=o:(d&&d.enter(),r=s(o),d&&(d.exit(),i=!0)),r===e.promise?c(gy("Promise-chain cycle")):(n=Ry(r))?Xm(n,r,u,c):u(r)):c(o)}catch(X$){d&&!i&&d.exit(),c(X$)}},wy=function(e,t){e.notified||(e.notified=!0,ny((function(){for(var r,n=e.reactions;r=n.get();)Ay(r,e);e.notified=!1,t&&!e.rejection&&Oy(e)})))},Cy=function(e,t,r){var n,i;Ty?((n=Sy.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),qm.dispatchEvent(n)):n={promise:t,reason:r},!hy&&(i=qm["on"+e])?i(n):e===Iy&&iy("Unhandled promise rejection",r)},Oy=function(e){Xm(ry,qm,(function(){var t,r=e.facade,n=e.value;if(xy(e)&&(t=oy((function(){zm?by.emit("unhandledRejection",n,r):Cy(Iy,r,n)})),e.rejection=zm||xy(e)?2:1,t.error))throw t.value}))},xy=function(e){return 1!==e.rejection&&!e.parent},Ny=function(e){Xm(ry,qm,(function(){var t=e.facade;zm?by.emit("rejectionHandled",t):Cy("rejectionhandled",t,e.value)}))},Dy=function(e,t,r){return function(n){e(t,n,r)}},Py=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,wy(e,!0))},My=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw gy("Promise can't be resolved itself");var n=Ry(t);n?ny((function(){var r={done:!1};try{Xm(n,t,Dy(My,r,e),Dy(Py,r,e))}catch(X$){Py(r,X$,e)}})):(e.value=t,e.state=1,wy(e,!1))}catch(X$){Py({done:!1},X$,e)}}};if(ly&&(yy=(my=function(e){ey(this,yy),Qm(e),Xm(Bm,this);var t=py(this);try{e(Dy(My,t),Dy(Py,t))}catch(X$){Py(t,X$)}}).prototype,(Bm=function(e){vy(this,{type:dy,done:!1,notified:!1,parent:!1,reactions:new ay,rejection:!1,state:0,value:void 0})}).prototype=Km(yy,"then",(function(e,t){var r=py(this),n=Ey(ty(this,my));return r.parent=!0,n.ok=!Zm(e)||e,n.fail=Zm(t)&&t,n.domain=zm?by.domain:void 0,0==r.state?r.reactions.add(n):ny((function(){Ay(n,r)})),n.promise})),jm=function(){var e=new Bm,t=py(e);this.promise=e,this.resolve=Dy(My,t),this.reject=Dy(Py,t)},cy.f=Ey=function(e){return e===my||undefined===e?new jm(e):ky(e)},Zm(uy)&&_y!==Object.prototype)){Gm=_y.then,fy||Km(_y,"then",(function(e,t){var r=this;return new my((function(e,t){Xm(Gm,r,e,t)})).then(e,t)}),{unsafe:!0});try{delete _y.constructor}catch(X$){}Wm&&Wm(_y,yy)}Hm({global:!0,constructor:!0,wrap:!0,forced:ly},{Promise:my}),Ym(my,dy,!1),Jm(dy);var Ly=Sm,Uy=Mm.CONSTRUCTOR||!Ql((function(e){Ly.all(e).then(void 0,(function(){}))})),Vy=Ut,Fy=Yt,By=Lm,jy=mm,Gy=Hl;ha({target:"Promise",stat:!0,forced:Uy},{all:function(e){var t=this,r=By.f(t),n=r.resolve,i=r.reject,o=jy((function(){var r=Fy(t.resolve),o=[],a=0,s=1;Gy(e,(function(e){var u=a++,c=!1;s++,Vy(r,t,e).then((function(e){c||(c=!0,o[u]=e,--s||n(o))}),i)})),--s||n(o)}));return o.error&&i(o.value),r.promise}});var Hy=ha,zy=Mm.CONSTRUCTOR,qy=Sm,Xy=Ke,Ky=He,Wy=wn,Yy=qy&&qy.prototype;if(Hy({target:"Promise",proto:!0,forced:zy,real:!0},{catch:function(e){return this.then(void 0,e)}}),Ky(qy)){var Jy=Xy("Promise").prototype.catch;Yy.catch!==Jy&&Wy(Yy,"catch",Jy,{unsafe:!0})}var Qy=Ut,Zy=Yt,$y=Lm,eg=mm,tg=Hl;ha({target:"Promise",stat:!0,forced:Uy},{race:function(e){var t=this,r=$y.f(t),n=r.reject,i=eg((function(){var i=Zy(t.resolve);tg(e,(function(e){Qy(i,t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var rg=Ut,ng=Lm;ha({target:"Promise",stat:!0,forced:Mm.CONSTRUCTOR},{reject:function(e){var t=ng.f(this);return rg(t.reject,void 0,e),t.promise}});var ig=Pt,og=kt,ag=Lm,sg=function(e,t){if(ig(e),og(t)&&t.constructor===e)return t;var r=ag.f(e);return(0,r.resolve)(t),r.promise},ug=ha,cg=Mm.CONSTRUCTOR,dg=sg;Ke("Promise"),ug({target:"Promise",stat:!0,forced:cg},{resolve:function(e){return dg(this,e)}});var lg=ip,hg=Ir.exports,fg=gt,pg=function(e,t,r){return r.get&&hg(r.get,t,{getter:!0}),r.set&&hg(r.set,t,{setter:!0}),fg.f(e,t,r)},vg=St,_g=ye,mg=Pt,yg=La,gg=gf,Sg=Error.prototype.toString,bg=_g((function(){if(vg){var e=yg(Object.defineProperty({},"name",{get:function(){return this===e}}));if("true"!==Sg.call(e))return!0}return"2: 1"!==Sg.call({message:1,name:2})||"Error"!==Sg.call({})}))?function(){var e=mg(this),t=gg(e.name,"Error"),r=gg(e.message);return t?r?t+": "+r:t:r}:Sg,Eg={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}},kg=ha,Tg=function(e){try{if(lg)return Function('return require("'+e+'")')()}catch(X$){}},Ig=Ke,Rg=ye,Ag=La,wg=Gr,Cg=gt.f,Og=wn,xg=pg,Ng=Pe,Dg=Xl,Pg=Pt,Mg=bg,Lg=gf,Ug=Eg,Vg=Af,Fg=ln,Bg=St,jg="DOMException",Gg="DATA_CLONE_ERR",Hg=Ig("Error"),zg=Ig(jg)||function(){try{(new(Ig("MessageChannel")||Tg("worker_threads").MessageChannel)).port1.postMessage(new WeakMap)}catch(X$){if(X$.name==Gg&&25==X$.code)return X$.constructor}}(),qg=zg&&zg.prototype,Xg=Hg.prototype,Kg=Fg.set,Wg=Fg.getterFor(jg),Yg="stack"in Hg(jg),Jg=function(e){return Ng(Ug,e)&&Ug[e].m?Ug[e].c:0},Qg=function(){Dg(this,Zg);var e=arguments.length,t=Lg(e<1?void 0:arguments[0]),r=Lg(e<2?void 0:arguments[1],"Error"),n=Jg(r);if(Kg(this,{type:jg,name:r,message:t,code:n}),Bg||(this.name=r,this.message=t,this.code=n),Yg){var i=Hg(t);i.name=jg,Cg(this,"stack",wg(1,Vg(i.stack,1)))}},Zg=Qg.prototype=Ag(Xg),$g=function(e){return{enumerable:!0,configurable:!0,get:e}},eS=function(e){return $g((function(){return Wg(this)[e]}))};Bg&&(xg(Zg,"code",eS("code")),xg(Zg,"message",eS("message")),xg(Zg,"name",eS("name"))),Cg(Zg,"constructor",wg(1,Qg));var tS=Rg((function(){return!(new zg instanceof Hg)})),rS=tS||Rg((function(){return Xg.toString!==Mg||"2: 1"!==String(new zg(1,2))})),nS=tS||Rg((function(){return 25!==new zg(1,"DataCloneError").code}));tS||25!==zg.DATA_CLONE_ERR||qg.DATA_CLONE_ERR;kg({global:!0,constructor:!0,forced:tS},{DOMException:tS?Qg:zg});var iS=Ig(jg),oS=iS.prototype;for(var aS in rS&&zg===iS&&Og(oS,"toString",Mg),nS&&Bg&&zg===iS&&xg(oS,"code",$g((function(){return Jg(Pg(this).name)}))),Ug)if(Ng(Ug,aS)){var sS=Ug[aS],uS=sS.s,cS=wg(6,sS.c);Ng(iS,uS)||Cg(iS,uS,cS),Ng(oS,uS)||Cg(oS,uS,cS)}var dS=ha,lS=se,hS=Ke,fS=Gr,pS=gt.f,vS=Pe,_S=Xl,mS=th,yS=gf,gS=Eg,SS=Af,bS=St,ES="DOMException",kS=hS("Error"),TS=hS(ES),IS=function(){_S(this,RS);var e=arguments.length,t=yS(e<1?void 0:arguments[0]),r=yS(e<2?void 0:arguments[1],"Error"),n=new TS(t,r),i=kS(t);return i.name=ES,pS(n,"stack",fS(1,SS(i.stack,1))),mS(n,this,IS),n},RS=IS.prototype=TS.prototype,AS="stack"in kS(ES),wS="stack"in new TS(1,2),CS=TS&&bS&&Object.getOwnPropertyDescriptor(lS,ES),OS=!(!CS||CS.writable&&CS.configurable),xS=AS&&!OS&&!wS;dS({global:!0,constructor:!0,forced:xS},{DOMException:xS?IS:TS});var NS=hS(ES),DS=NS.prototype;if(DS.constructor!==NS)for(var PS in pS(DS,"constructor",fS(1,NS)),gS)if(vS(gS,PS)){var MS=gS[PS],LS=MS.s;vS(NS,LS)||pS(NS,LS,fS(6,MS.c))}var US="DOMException";wc(Ke(US),US);var VS=Hi.filter;ha({target:"Array",proto:!0,forced:!_v("filter")},{filter:function(e){return VS(this,e,arguments.length>1?arguments[1]:void 0)}});var FS=ha,BS=ye,jS=pi,GS=kt,HS=xe,zS=hi,qS=jp,XS=wd,KS=Mi,WS=_v,YS=tt,JS=_t("isConcatSpreadable"),QS=YS>=51||!BS((function(){var e=[];return e[JS]=!1,e.concat()[0]!==e})),ZS=WS("concat"),$S=function(e){if(!GS(e))return!1;var t=e[JS];return void 0!==t?!!t:jS(e)};FS({target:"Array",proto:!0,arity:1,forced:!QS||!ZS},{concat:function(e){var t,r,n,i,o,a=HS(this),s=KS(a,0),u=0;for(t=-1,n=arguments.length;t<n;t++)if($S(o=-1===t?a:arguments[t]))for(i=zS(o),qS(u+i),r=0;r<i;r++,u++)r in o&&XS(s,u,o[r]);else qS(u+1),XS(s,u++,o);return s.length=u,s}});var eb=Te,tb=xe,rb=Math.floor,nb=eb("".charAt),ib=eb("".replace),ob=eb("".slice),ab=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,sb=/\$([$&'`]|\d{1,2})/g,ub=vf,cb=Ut,db=Te,lb=eu,hb=ye,fb=Pt,pb=He,vb=Ie,_b=si,mb=di,yb=es,gb=we,Sb=Au,bb=Zt,Eb=function(e,t,r,n,i,o){var a=r+e.length,s=n.length,u=sb;return void 0!==i&&(i=tb(i),u=ab),ib(o,u,(function(o,u){var c;switch(nb(u,0)){case"$":return"$";case"&":return e;case"`":return ob(t,0,r);case"'":return ob(t,a);case"<":c=i[ob(u,1,-1)];break;default:var d=+u;if(0===d)return o;if(d>s){var l=rb(d/10);return 0===l?o:l<=s?void 0===n[l-1]?nb(u,1):n[l-1]+nb(u,1):o}c=n[d-1]}return void 0===c?"":c}))},kb=uu,Tb=_t("replace"),Ib=Math.max,Rb=Math.min,Ab=db([].concat),wb=db([].push),Cb=db("".indexOf),Ob=db("".slice),xb="$0"==="a".replace(/./,"$0"),Nb=!!/./[Tb]&&""===/./[Tb]("a","$0"),Db=!hb((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}));lb("replace",(function(e,t,r){var n=Nb?"$":"$0";return[function(e,r){var n=gb(this),i=vb(e)?void 0:bb(e,Tb);return i?cb(i,e,n,r):cb(t,yb(n),e,r)},function(e,i){var o=fb(this),a=yb(e);if("string"==typeof i&&-1===Cb(i,n)&&-1===Cb(i,"$<")){var s=r(t,o,a,i);if(s.done)return s.value}var u=pb(i);u||(i=yb(i));var c=o.global;if(c){var d=o.unicode;o.lastIndex=0}for(var l=[];;){var h=kb(o,a);if(null===h)break;if(wb(l,h),!c)break;""===yb(h[0])&&(o.lastIndex=Sb(a,mb(o.lastIndex),d))}for(var f,p="",v=0,_=0;_<l.length;_++){for(var m=yb((h=l[_])[0]),y=Ib(Rb(_b(h.index),a.length),0),g=[],S=1;S<h.length;S++)wb(g,void 0===(f=h[S])?f:String(f));var b=h.groups;if(u){var E=Ab([m],g,y,a);void 0!==b&&wb(E,b);var k=yb(ub(i,void 0,E))}else k=Eb(m,a,y,g,b,i);y>=v&&(p+=Ob(a,v,y)+k,v=y+m.length)}return p+Ob(a,v)}]}),!Db||!xb||Nb);var Pb=Ut,Mb=Pe,Lb=Vt,Ub=hs,Vb=RegExp.prototype,Fb=function(e){var t=e.flags;return void 0!==t||"flags"in Vb||Mb(e,"flags")||!Lb(Vb,e)?t:Pb(Ub,e)},Bb=St,jb=se,Gb=Te,Hb=ia,zb=th,qb=qr,Xb=go.f,Kb=Vt,Wb=Wa,Yb=es,Jb=Fb,Qb=ys,Zb=mf,$b=wn,eE=ye,tE=Pe,rE=ln.enforce,nE=Th,iE=bs,oE=Ts,aE=_t("match"),sE=jb.RegExp,uE=sE.prototype,cE=jb.SyntaxError,dE=Gb(uE.exec),lE=Gb("".charAt),hE=Gb("".replace),fE=Gb("".indexOf),pE=Gb("".slice),vE=/^\?<[^\s\d!#%&*+<=>@^][^\s!#%&*+<=>@^]*>/,_E=/a/g,mE=/a/g,yE=new sE(_E)!==_E,gE=Qb.MISSED_STICKY,SE=Qb.UNSUPPORTED_Y,bE=Bb&&(!yE||gE||iE||oE||eE((function(){return mE[aE]=!1,sE(_E)!=_E||sE(mE)==mE||"/a/i"!=sE(_E,"i")})));if(Hb("RegExp",bE)){for(var EE=function(e,t){var r,n,i,o,a,s,u=Kb(uE,this),c=Wb(e),d=void 0===t,l=[],h=e;if(!u&&c&&d&&e.constructor===EE)return e;if((c||Kb(uE,e))&&(e=e.source,d&&(t=Jb(h))),e=void 0===e?"":Yb(e),t=void 0===t?"":Yb(t),h=e,iE&&"dotAll"in _E&&(n=!!t&&fE(t,"s")>-1)&&(t=hE(t,/s/g,"")),r=t,gE&&"sticky"in _E&&(i=!!t&&fE(t,"y")>-1)&&SE&&(t=hE(t,/y/g,"")),oE&&(o=function(e){for(var t,r=e.length,n=0,i="",o=[],a={},s=!1,u=!1,c=0,d="";n<=r;n++){if("\\"===(t=lE(e,n)))t+=lE(e,++n);else if("]"===t)s=!1;else if(!s)switch(!0){case"["===t:s=!0;break;case"("===t:dE(vE,pE(e,n+1))&&(n+=2,u=!0),i+=t,c++;continue;case">"===t&&u:if(""===d||tE(a,d))throw new cE("Invalid capture group name");a[d]=!0,o[o.length]=[d,c],u=!1,d="";continue}u?d+=t:i+=t}return[i,o]}(e),e=o[0],l=o[1]),a=zb(sE(e,t),u?this:uE,EE),(n||i||l.length)&&(s=rE(a),n&&(s.dotAll=!0,s.raw=EE(function(e){for(var t,r=e.length,n=0,i="",o=!1;n<=r;n++)"\\"!==(t=lE(e,n))?o||"."!==t?("["===t?o=!0:"]"===t&&(o=!1),i+=t):i+="[\\s\\S]":i+=t+lE(e,++n);return i}(e),r)),i&&(s.sticky=!0),l.length&&(s.groups=l)),e!==h)try{qb(a,"source",""===h?"(?:)":h)}catch(X$){}return a},kE=Xb(sE),TE=0;kE.length>TE;)Zb(EE,sE,kE[TE++]);uE.constructor=EE,EE.prototype=uE,$b(jb,"RegExp",EE,{constructor:!0})}nE("RegExp");var IE=St,RE=bs,AE=Nn,wE=pg,CE=ln.get,OE=RegExp.prototype,xE=TypeError;IE&&RE&&wE(OE,"dotAll",{configurable:!0,get:function(){if(this!==OE){if("RegExp"===AE(this))return!!CE(this).dotAll;throw xE("Incompatible receiver, RegExp required")}}});var NE=St,DE=ys.MISSED_STICKY,PE=Nn,ME=pg,LE=ln.get,UE=RegExp.prototype,VE=TypeError;NE&&DE&&ME(UE,"sticky",{configurable:!0,get:function(){if(this!==UE){if("RegExp"===PE(this))return!!LE(this).sticky;throw VE("Incompatible receiver, RegExp required")}}});var FE=xr.PROPER,BE=wn,jE=Pt,GE=es,HE=ye,zE=Fb,qE="toString",XE=RegExp.prototype.toString,KE=HE((function(){return"/a/b"!=XE.call({source:"a",flags:"b"})})),WE=FE&&XE.name!=qE;(KE||WE)&&BE(RegExp.prototype,qE,(function(){var e=jE(this);return"/"+GE(e.source)+"/"+GE(zE(e))}),{unsafe:!0});var YE=ha,JE=ye,QE=uo,ZE=to.f,$E=St,ek=JE((function(){ZE(1)}));YE({target:"Object",stat:!0,forced:!$E||ek,sham:!$E},{getOwnPropertyDescriptor:function(e,t){return ZE(QE(e),t)}});var tk=ha,rk=Ke,nk=vf,ik=Ut,ok=Te,ak=ye,sk=pi,uk=He,ck=kt,dk=Ht,lk=mv,hk=it,fk=rk("JSON","stringify"),pk=ok(/./.exec),vk=ok("".charAt),_k=ok("".charCodeAt),mk=ok("".replace),yk=ok(1..toString),gk=/[\uD800-\uDFFF]/g,Sk=/^[\uD800-\uDBFF]$/,bk=/^[\uDC00-\uDFFF]$/,Ek=!hk||ak((function(){var e=rk("Symbol")();return"[null]"!=fk([e])||"{}"!=fk({a:e})||"{}"!=fk(Object(e))})),kk=ak((function(){return'"\\udf06\\ud834"'!==fk("\udf06\ud834")||'"\\udead"'!==fk("\udead")})),Tk=function(e,t){var r=lk(arguments),n=t;if((ck(t)||void 0!==e)&&!dk(e))return sk(t)||(t=function(e,t){if(uk(n)&&(t=ik(n,this,e,t)),!dk(t))return t}),r[1]=t,nk(fk,null,r)},Ik=function(e,t,r){var n=vk(r,t-1),i=vk(r,t+1);return pk(Sk,e)&&!pk(bk,i)||pk(bk,e)&&!pk(Sk,n)?"\\u"+yk(_k(e,0),16):e};fk&&tk({target:"JSON",stat:!0,arity:3,forced:Ek||kk},{stringify:function(e,t,r){var n=lk(arguments),i=nk(Ek?Tk:fk,null,n);return kk&&"string"==typeof i?mk(i,gk,Ik):i}});var Rk=tv;function Ak(e,t){var r=e&&e.navigator;if(r.mediaDevices){var n=function(e){if("object"!==a(e)||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var n="object"===a(e[r])?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var o={};"number"==typeof n.ideal?(o[i("min",r)]=n.ideal,t.optional.push(o),(o={})[i("max",r)]=n.ideal,t.optional.push(o)):(o[i("",r)]=n.ideal,t.optional.push(o))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",r)]=n.exact):["min","max"].forEach((function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,r)]=n[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===a(e.audio)){var o=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===a(e.video)){var s=e.video.facingMode;s=s&&("object"===a(s)?s:{ideal:s});var u,c=t.version<66;if(s&&("user"===s.exact||"environment"===s.exact||"user"===s.ideal||"environment"===s.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||c))if(delete e.video.facingMode,"environment"===s.exact||"environment"===s.ideal?u=["back","rear"]:"user"!==s.exact&&"user"!==s.ideal||(u=["front"]),u)return r.mediaDevices.enumerateDevices().then((function(t){var r=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return u.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!r&&t.length&&u.includes("back")&&(r=t[t.length-1]),r&&(e.video.deviceId=s.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=n(e.video),Rk("chrome: "+JSON.stringify(e)),i(e)}));e.video=n(e.video)}return Rk("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){i(e,(function(e){r.webkitGetUserMedia(e,t,(function(e){n&&n(o(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){var s=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return i(e,(function(e){return s(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(o(e))}))}))}}}}function wk(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ck(e){if("object"===a(e)&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var o=new Event("track");o.track=n.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)})),t.stream.getTracks().forEach((function(n){var i;i=e.RTCPeerConnection.prototype.getReceivers?r.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var o=new Event("track");o.track=n,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],r.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Zp(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))}function Ok(e){if("object"===a(e)&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._senders=this._senders||[],i.apply(this,[e]),e.getTracks().forEach((function(e){r._senders.push(t(r,e))}))};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach((function(e){var r=t._senders.find((function(t){return t.track===e}));r&&t._senders.splice(t._senders.indexOf(r),1)}))}}else if("object"===a(e)&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var s=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function xk(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,r=Array.prototype.slice.call(arguments),n=r[0],i=r[1],o=r[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var a=function(e){var t={};return e.result().forEach((function(e){var r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){r[t]=e.stat(t)})),t[r.id]=r})),t},s=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var u=function(e){i(s(a(e)))};return t.apply(this,[u,n])}return new Promise((function(r,n){t.apply(e,[function(e){r(s(a(e)))},n])})).then(i,o)}}}function Nk(e){if("object"===a(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return sv(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),Zp(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return sv(t,e.track,!1)}))}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,r,n,o=arguments[0];return this.getSenders().forEach((function(e){e.track===o&&(t?n=!0:t=e)})),this.getReceivers().forEach((function(e){return e.track===o&&(r?n=!0:r=e),e.track===o})),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}}}function Dk(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();r.apply(this,arguments);var i=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(i)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(r){var n=t._shimmedLocalStreams[r].indexOf(e);-1!==n&&t._shimmedLocalStreams[r].splice(n,1),1===t._shimmedLocalStreams[r].length&&delete t._shimmedLocalStreams[r]})),i.apply(this,arguments)}}function Pk(e,t){if(e.RTCPeerConnection){if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Dk(e);var r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=r.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var r=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(r.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());this._streams[t.id]=i,this._reverseStreams[i.id]=t,t=i}n.apply(this,[t])};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var o=this.getSenders().find((function(e){return e.track===t}));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var a=this._streams[r.id];if(a)a.addTrack(t),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var s=new e.MediaStream([t]);this._streams[r.id]=s,this._reverseStreams[s.id]=r,this.addStream(s)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=h({},t,(function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?r.apply(this,[function(r){var n=s(e,r);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):r.apply(this,arguments).then((function(t){return s(e,t)}))}));e.RTCPeerConnection.prototype[t]=n[t]}));var o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=u(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};var a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{},Object.keys(this._streams).forEach((function(n){r._streams[n].getTracks().find((function(t){return e.track===t}))&&(t=r._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(i.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function u(e,t){var r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],i=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:r})}}function Mk(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=h({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}))}function Lk(e,t){Zp(e,"negotiationneeded",(function(e){var r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var Uk,Vk,Fk=Object.freeze(Object.defineProperty({__proto__:null,shimMediaStream:wk,shimOnTrack:Ck,shimGetSendersWithDtmf:Ok,shimGetStats:xk,shimSenderReceiverGetStats:Nk,shimAddTrackRemoveTrackWithNative:Dk,shimAddTrackRemoveTrack:Pk,shimPeerConnection:Mk,fixNegotiationNeeded:Lk,shimGetUserMedia:Ak,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((function(t){var n=r.video&&r.video.width,i=r.video&&r.video.height,o=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},n&&(r.video.mandatory.maxWidth=n),i&&(r.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},Symbol.toStringTag,{value:"Module"})),Bk=ha,jk=Ut,Gk=He,Hk=Pt,zk=es,qk=(Uk=!1,(Vk=/[ac]/).exec=function(){return Uk=!0,/./.exec.apply(this,arguments)},!0===Vk.test("abc")&&Uk),Xk=/./.test;Bk({target:"RegExp",proto:!0,forced:!qk},{test:function(e){var t=Hk(this),r=zk(e),n=t.exec;if(!Gk(n))return jk(Xk,t,r);var i=jk(n,t,r);return null!==i&&(Hk(i),!0)}});var Kk=se,Wk=ye,Yk=es,Jk=qu.trim,Qk=Te("".charAt),Zk=Kk.parseFloat,$k=Kk.Symbol,eT=$k&&$k.iterator,tT=1/Zk("\t\n\v\f\r                　\u2028\u2029\ufeff-0")!=-1/0||eT&&!Wk((function(){Zk(Object(eT))}))?function(e){var t=Jk(Yk(e)),r=Zk(t);return 0===r&&"-"==Qk(t,0)?-0:r}:Zk;ha({global:!0,forced:parseFloat!=tT},{parseFloat:tT});var rT=ha,nT=Sm,iT=ye,oT=Ke,aT=He,sT=f_,uT=sg,cT=wn,dT=nT&&nT.prototype;if(rT({target:"Promise",proto:!0,real:!0,forced:!!nT&&iT((function(){dT.finally.call({then:function(){}},(function(){}))}))},{finally:function(e){var t=sT(this,oT("Promise")),r=aT(e);return this.then(r?function(r){return uT(t,e()).then((function(){return r}))}:e,r?function(r){return uT(t,e()).then((function(){throw r}))}:e)}}),aT(nT)){var lT=oT("Promise").prototype.finally;dT.finally!==lT&&cT(dT,"finally",lT,{unsafe:!0})}function hT(e,t){var r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){rv("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var i=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},o=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===a(e)&&"object"===a(e.audio)&&(e=JSON.parse(JSON.stringify(e)),i(e.audio,"autoGainControl","mozAutoGainControl"),i(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},n&&n.prototype.getSettings){var s=n.prototype.getSettings;n.prototype.getSettings=function(){var e=s.apply(this,arguments);return i(e,"mozAutoGainControl","autoGainControl"),i(e,"mozNoiseSuppression","noiseSuppression"),e}}if(n&&n.prototype.applyConstraints){var u=n.prototype.applyConstraints;n.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===a(e)&&(e=JSON.parse(JSON.stringify(e)),i(e,"autoGainControl","mozAutoGainControl"),i(e,"noiseSuppression","mozNoiseSuppression")),u.apply(this,[e])}}}}function fT(e){"object"===a(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function pT(e,t){if("object"===a(e)&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var r=e.RTCPeerConnection.prototype[t],n=h({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}));var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),i=e[0],o=e[1],a=e[2];return n.apply(this,[i||null]).then((function(e){if(t.version<53&&!o)try{e.forEach((function(e){e.type=r[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,a)}}}function vT(e){if("object"===a(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpSender.prototype))){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}}function _T(e){if("object"===a(e)&&e.RTCPeerConnection&&e.RTCRtpSender&&(!e.RTCRtpSender||!("getStats"in e.RTCRtpReceiver.prototype))){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,r=t.apply(this,[]);return r.forEach((function(t){return t._pc=e})),r}),Zp(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}}function mT(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;rv("removeStream","removeTrack"),this.getSenders().forEach((function(r){r.track&&e.getTracks().includes(r.track)&&t.removeTrack(r)}))})}function yT(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function gT(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]);var r=(e=k(e)).length>0;r&&e.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(r){var i=n.sender,o=i.getParameters();(!("encodings"in o)||1===o.encodings.length&&0===Object.keys(o.encodings[0]).length)&&(o.encodings=e,i.sendEncodings=e,this.setParametersPromises.push(i.setParameters(o).then((function(){delete i.sendEncodings})).catch((function(){delete i.sendEncodings}))))}return n})}}function ST(e){if("object"===a(e)&&e.RTCRtpSender){var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}}function bT(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}function ET(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=arguments,r=this;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(r,e)})).finally((function(){r.setParametersPromises=[]})):t.apply(this,arguments)}}}var kT=Object.freeze(Object.defineProperty({__proto__:null,shimOnTrack:fT,shimPeerConnection:pT,shimSenderGetStats:vT,shimReceiverGetStats:_T,shimRemoveStream:mT,shimRTCDataChannel:yT,shimAddTransceiver:gT,shimGetParameters:ST,shimCreateOffer:bT,shimCreateAnswer:ET,shimGetUserMedia:hT,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}},Symbol.toStringTag,{value:"Module"}));function TT(e){if("object"===a(e)&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(r,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(r,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var r=this,n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return i&&i.forEach((function(e){r._localStreams?r._localStreams.includes(e)||r._localStreams.push(e):r._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r=this._localStreams.indexOf(e);if(-1!==r){this._localStreams.splice(r,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})}}function IT(e){if("object"===a(e)&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.dispatchEvent(r)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}}))}),t.apply(e,arguments)}}}function RT(e){if("object"===a(e)&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i};var u=function(e,t,r){var n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=u,u=function(e,t,r){var n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=u,u=function(e,t,r){var n=s.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=u}}function AT(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var r=t.mediaDevices,n=r.getUserMedia.bind(r);t.mediaDevices.getUserMedia=function(e){return n(wT(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function wT(e){return e&&void 0!==e.video?Object.assign({},e,{video:ov(e.video)}):e}function CT(e){if(e.RTCPeerConnection){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){for(var n=[],i=0;i<e.iceServers.length;i++){var o=e.iceServers[i];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(rv("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,n.push(o)):n.push(e.iceServers[i])}e.iceServers=n}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})}}function OT(e){"object"===a(e)&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}function xT(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function NT(e){"object"!==a(e)||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var DT=Object.freeze(Object.defineProperty({__proto__:null,shimLocalStreamsAPI:TT,shimRemoteStreamsAPI:IT,shimCallbacksAPI:RT,shimGetUserMedia:AT,shimConstraints:wT,shimRTCIceServerUrls:CT,shimTrackEventTransceiver:OT,shimCreateOfferLegacy:xT,shimAudioContext:NT},Symbol.toStringTag,{value:"Module"})),PT=Ut;ha({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return PT(URL.prototype.toString,this)}});var MT=Te(1..valueOf),LT=St,UT=se,VT=Te,FT=ia,BT=wn,jT=Pe,GT=th,HT=Vt,zT=Ht,qT=dr,XT=ye,KT=go.f,WT=to.f,YT=gt.f,JT=MT,QT=qu.trim,ZT="Number",$T=UT.Number,eI=$T.prototype,tI=UT.TypeError,rI=VT("".slice),nI=VT("".charCodeAt),iI=function(e){var t=qT(e,"number");return"bigint"==typeof t?t:oI(t)},oI=function(e){var t,r,n,i,o,a,s,u,c=qT(e,"number");if(zT(c))throw tI("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=QT(c),43===(t=nI(c,0))||45===t){if(88===(r=nI(c,2))||120===r)return NaN}else if(48===t){switch(nI(c,1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+c}for(a=(o=rI(c,2)).length,s=0;s<a;s++)if((u=nI(o,s))<48||u>i)return NaN;return parseInt(o,n)}return+c};if(FT(ZT,!$T(" 0o1")||!$T("0b1")||$T("+0x1"))){for(var aI,sI=function(e){var t=arguments.length<1?0:$T(iI(e)),r=this;return HT(eI,r)&&XT((function(){JT(r)}))?GT(Object(t),r,sI):t},uI=LT?KT($T):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),cI=0;uI.length>cI;cI++)jT($T,aI=uI[cI])&&!jT(sI,aI)&&YT(sI,aI,WT($T,aI));sI.prototype=eI,eI.constructor=sI,BT(UT,ZT,sI,{constructor:!0})}var dI=xr.PROPER,lI=ye,hI=Uu,fI=qu.trim;ha({target:"String",proto:!0,forced:function(e){return lI((function(){return!!hI[e]()||"​᠎"!=="​᠎"[e]()||dI&&hI[e].name!==e}))}("trim")},{trim:function(){return fI(this)}});var pI,vI,_I={exports:{}};pI=_I,(vI={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}}).localCName=vI.generateIdentifier(),vI.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},vI.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},vI.getDescription=function(e){var t=vI.splitSections(e);return t&&t[0]},vI.getMediaSections=function(e){var t=vI.splitSections(e);return t.shift(),t},vI.matchPrefix=function(e,t){return vI.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},vI.parseCandidate=function(e){for(var t,r={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},vI.writeCandidate=function(e){var t=[];t.push(e.foundation);var r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},vI.parseIceOptions=function(e){return e.substr(14).split(" ")},vI.parseRtpMap=function(e){var t=e.substr(9).split(" "),r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},vI.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},vI.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},vI.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},vI.parseFmtp=function(e){for(var t,r={},n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)r[(t=n[i].trim().split("="))[0].trim()]=t[1];return r},vI.writeFmtp=function(e){var t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},vI.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},vI.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},vI.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},vI.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},vI.getMid=function(e){var t=vI.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},vI.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},vI.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:vI.matchPrefix(e+t,"a=fingerprint:").map(vI.parseFingerprint)}},vI.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},vI.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},vI.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===a(e.keyParams)?vI.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},vI.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},vI.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},vI.getCryptoParameters=function(e,t){return vI.matchPrefix(e+t,"a=crypto:").map(vI.parseCryptoLine)},vI.getIceParameters=function(e,t){var r=vI.matchPrefix(e+t,"a=ice-ufrag:")[0],n=vI.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&n?{usernameFragment:r.substr(12),password:n.substr(10)}:null},vI.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},vI.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=vI.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],o=vI.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a=vI.parseRtpMap(o),s=vI.matchPrefix(e,"a=fmtp:"+i+" ");switch(a.parameters=s.length?vI.parseFmtp(s[0]):{},a.rtcpFeedback=vI.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(vI.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return vI.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(vI.parseExtmap(e))})),t},vI.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=t.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){r+=vI.writeRtpMap(e),r+=vI.writeFmtp(e),r+=vI.writeRtcpFb(e)}));var n=0;return t.codecs.forEach((function(e){e.maxptime>n&&(n=e.maxptime)})),n>0&&(r+="a=maxptime:"+n+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach((function(e){r+=vI.writeExtmap(e)})),r},vI.parseRtpEncodingParameters=function(e){var t,r=[],n=vI.parseRtpParameters(e),i=-1!==n.fecMechanisms.indexOf("RED"),o=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=vI.matchPrefix(e,"a=ssrc:").map((function(e){return vI.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),s=a.length>0&&a[0].ssrc,u=vI.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));u.length>0&&u[0].length>1&&u[0][0]===s&&(t=u[0][1]),n.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&t&&(n.rtx={ssrc:t}),r.push(n),i&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:s,mechanism:o?"red+ulpfec":"red"},r.push(n))}})),0===r.length&&s&&r.push({ssrc:s});var c=vI.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,r.forEach((function(e){e.maxBitrate=c}))),r},vI.parseRtcpParameters=function(e){var t={},r=vI.matchPrefix(e,"a=ssrc:").map((function(e){return vI.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);var n=vI.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=n.length>0,t.compound=0===n.length;var i=vI.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},vI.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},vI.parseMsid=function(e){var t,r=vI.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};var n=vI.matchPrefix(e,"a=ssrc:").map((function(e){return vI.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return n.length>0?{stream:(t=n[0].value.split(" "))[0],track:t[1]}:void 0},vI.parseSctpDescription=function(e){var t,r=vI.parseMLine(e),n=vI.matchPrefix(e,"a=max-message-size:");n.length>0&&(t=parseInt(n[0].substr(19),10)),isNaN(t)&&(t=65536);var i=vI.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:t};var o=vI.matchPrefix(e,"a=sctpmap:");if(o.length>0){var a=o[0].substr(10).split(" ");return{port:parseInt(a[0],10),protocol:a[1],maxMessageSize:t}}},vI.writeSctpDescription=function(e,t){var r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},vI.generateSessionId=function(){return Math.random().toString().substr(2,21)},vI.writeSessionBoilerplate=function(e,t,r){var n=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||vI.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},vI.getDirection=function(e,t){for(var r=vI.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?vI.getDirection(t):"sendrecv"},vI.getKind=function(e){return vI.splitLines(e)[0].split(" ")[0].substr(2)},vI.isRejected=function(e){return"0"===e.split(" ",2)[1]},vI.parseMLine=function(e){var t=vI.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},vI.parseOLine=function(e){var t=vI.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},vI.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=vI.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},pI.exports=vI;var mI=_I.exports,yI=e({__proto__:null,default:mI},[_I.exports]);function gI(e){if(!(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===a(e)&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),n=mI.parseCandidate(e.candidate),i=Object.assign(r,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Zp(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))}}function SI(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Zp(e,"icecandidate",(function(e){if(e.candidate){var t=mI.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function bI(e,t){if(e.RTCPeerConnection){"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=function(e){if(!e||!e.sdp)return!1;var t=mI.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=mI.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var r=parseInt(t[1],10);return r!=r?-1:r},i=function(e){var r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},o=function(e,r){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var i=mI.matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?n=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),s=e.sdpSemantics;"plan-b"===s&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){var u,c=n(arguments[0]),d=i(c),l=o(arguments[0],c);u=0===d&&0===l?Number.POSITIVE_INFINITY:0===d||0===l?Math.max(d,l):Math.min(d,l);var h={};Object.defineProperty(h,"maxMessageSize",{get:function(){return u}}),this._sctp=h}return a.apply(this,arguments)}}}function EI(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},Zp(e,"datachannel",(function(e){return r(e.channel,e.target),e}))}function r(e,t){var r=e.send;e.send=function(){var n=arguments[0],i=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}}function kI(e){if(e.RTCPeerConnection&&!("connectionState"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}}function TI(e,t){if(e.RTCPeerConnection&&!("chrome"===t.browser&&t.version>=71||"safari"===t.browser&&t.version>=605)){var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var n=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return r.apply(this,arguments)}}}function II(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}}function RI(e,t){if(e.RTCPeerConnection&&e.RTCPeerConnection.prototype){var r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this,t=arguments[0]||{};if("object"!==a(t)||t.type&&t.sdp)return r.apply(this,arguments);if(!(t={type:t.type,sdp:t.sdp}).type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":t.type="offer";break;default:t.type="answer"}if(t.sdp||"offer"!==t.type&&"answer"!==t.type)return r.apply(this,[t]);var n="offer"===t.type?this.createOffer:this.createAnswer;return n.apply(this).then((function(t){return r.apply(e,[t])}))})}}var AI=Object.freeze(Object.defineProperty({__proto__:null,shimRTCIceCandidate:gI,shimRTCIceCandidateRelayProtocol:SI,shimMaxMessageSize:bI,shimSendThrowTypeError:EI,shimConnectionState:kI,removeExtmapAllowMixed:TI,shimAddIceCandidateNullOrEmpty:II,shimParameterlessSetLocalDescription:RI},Symbol.toStringTag,{value:"Module"}));!function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},n=tv,i=nv(t),o={browserDetails:i,commonShim:AI,extractVersion:Qp,disableLog:$p,disableWarnings:ev,sdp:yI};switch(i.browser){case"chrome":if(!Fk||!Mk||!r.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(null===i.version)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=Fk,II(t,i),RI(t),Ak(t,i),wk(t),Mk(t,i),Ck(t),Pk(t,i),Ok(t),xk(t),Nk(t),Lk(t,i),gI(t),SI(t),kI(t),bI(t,i),EI(t),TI(t,i);break;case"firefox":if(!kT||!pT||!r.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=kT,II(t,i),RI(t),hT(t,i),pT(t,i),fT(t),mT(t),vT(t),_T(t),yT(t),gT(t),ST(t),bT(t),ET(t),gI(t),kI(t),bI(t,i),EI(t);break;case"safari":if(!DT||!r.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=DT,II(t,i),RI(t),CT(t),xT(t),RT(t),TT(t),IT(t),OT(t),AT(t),NT(t),gI(t),SI(t),bI(t,i),EI(t),TI(t,i);break;default:n("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});var wI=Pd,CI=Math.floor,OI=function(e,t){var r=e.length,n=CI(r/2);return r<8?xI(e,t):NI(e,OI(wI(e,0,n),t),OI(wI(e,n),t),t)},xI=function(e,t){for(var r,n,i=e.length,o=1;o<i;){for(n=o,r=e[o];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==o++&&(e[n]=r)}return e},NI=function(e,t,r,n){for(var i=t.length,o=r.length,a=0,s=0;a<i||s<o;)e[a+s]=a<i&&s<o?n(t[a],r[s])<=0?t[a++]:r[s++]:a<i?t[a++]:r[s++];return e},DI=OI,PI=We.match(/firefox\/(\d+)/i),MI=!!PI&&+PI[1],LI=/MSIE|Trident/.test(We),UI=We.match(/AppleWebKit\/(\d+)\./),VI=!!UI&&+UI[1],FI=ha,BI=Te,jI=Yt,GI=xe,HI=hi,zI=Bv,qI=es,XI=ye,KI=DI,WI=qi,YI=MI,JI=LI,QI=tt,ZI=VI,$I=[],eR=BI($I.sort),tR=BI($I.push),rR=XI((function(){$I.sort(void 0)})),nR=XI((function(){$I.sort(null)})),iR=WI("sort"),oR=!XI((function(){if(QI)return QI<70;if(!(YI&&YI>3)){if(JI)return!0;if(ZI)return ZI<603;var e,t,r,n,i="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:r=3;break;case 68:case 71:r=4;break;default:r=2}for(n=0;n<47;n++)$I.push({k:t+n,v:r})}for($I.sort((function(e,t){return t.v-e.v})),n=0;n<$I.length;n++)t=$I[n].k.charAt(0),i.charAt(i.length-1)!==t&&(i+=t);return"DGBEFHACIJK"!==i}}));FI({target:"Array",proto:!0,forced:rR||!nR||!iR||!oR},{sort:function(e){void 0!==e&&jI(e);var t=GI(this);if(oR)return void 0===e?eR(t):eR(t,e);var r,n,i=[],o=HI(t);for(n=0;n<o;n++)n in t&&tR(i,t[n]);for(KI(i,function(e){return function(t,r){return void 0===r?-1:void 0===t?1:void 0!==e?+e(t,r)||0:qI(t)>qI(r)?1:-1}}(e)),r=HI(i),n=0;n<r;)t[n]=i[n++];for(;n<o;)zI(t,n++);return t}});var aR,sR,uR,cR={exports:{}},dR="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,lR=dR,hR=St,fR=se,pR=He,vR=kt,_R=Pe,mR=Fn,yR=qt,gR=qr,SR=wn,bR=gt.f,ER=Vt,kR=_c,TR=Gc,IR=_t,RR=Fe,AR=ln.enforce,wR=ln.get,CR=fR.Int8Array,OR=CR&&CR.prototype,xR=fR.Uint8ClampedArray,NR=xR&&xR.prototype,DR=CR&&kR(CR),PR=OR&&kR(OR),MR=Object.prototype,LR=fR.TypeError,UR=IR("toStringTag"),VR=RR("TYPED_ARRAY_TAG"),FR="TypedArrayConstructor",BR=lR&&!!TR&&"Opera"!==mR(fR.opera),jR=!1,GR={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},HR={BigInt64Array:8,BigUint64Array:8},zR=function(e){var t=kR(e);if(vR(t)){var r=wR(t);return r&&_R(r,FR)?r.TypedArrayConstructor:zR(t)}},qR=function(e){if(!vR(e))return!1;var t=mR(e);return _R(GR,t)||_R(HR,t)};for(aR in GR)(uR=(sR=fR[aR])&&sR.prototype)?AR(uR).TypedArrayConstructor=sR:BR=!1;for(aR in HR)(uR=(sR=fR[aR])&&sR.prototype)&&(AR(uR).TypedArrayConstructor=sR);if((!BR||!pR(DR)||DR===Function.prototype)&&(DR=function(){throw LR("Incorrect invocation")},BR))for(aR in GR)fR[aR]&&TR(fR[aR],DR);if((!BR||!PR||PR===MR)&&(PR=DR.prototype,BR))for(aR in GR)fR[aR]&&TR(fR[aR].prototype,PR);if(BR&&kR(NR)!==PR&&TR(NR,PR),hR&&!_R(PR,UR))for(aR in jR=!0,bR(PR,UR,{get:function(){return vR(this)?this[VR]:void 0}}),GR)fR[aR]&&gR(fR[aR],VR,aR);var XR={NATIVE_ARRAY_BUFFER_VIEWS:BR,TYPED_ARRAY_TAG:jR&&VR,aTypedArray:function(e){if(qR(e))return e;throw LR("Target is not a typed array")},aTypedArrayConstructor:function(e){if(pR(e)&&(!TR||ER(DR,e)))return e;throw LR(yR(e)+" is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r,n){if(hR){if(r)for(var i in GR){var o=fR[i];if(o&&_R(o.prototype,e))try{delete o.prototype[e]}catch(X$){try{o.prototype[e]=t}catch(a){}}}PR[e]&&!r||SR(PR,e,r?t:BR&&OR[e]||t,n)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(hR){if(TR){if(r)for(n in GR)if((i=fR[n])&&_R(i,e))try{delete i[e]}catch(X$){}if(DR[e]&&!r)return;try{return SR(DR,e,r?t:BR&&DR[e]||t)}catch(X$){}}for(n in GR)!(i=fR[n])||i[e]&&!r||SR(i,e,t)}},getTypedArrayConstructor:zR,isView:function(e){if(!vR(e))return!1;var t=mR(e);return"DataView"===t||_R(GR,t)||_R(HR,t)},isTypedArray:qR,TypedArray:DR,TypedArrayPrototype:PR},KR=se,WR=ye,YR=Ql,JR=XR.NATIVE_ARRAY_BUFFER_VIEWS,QR=KR.ArrayBuffer,ZR=KR.Int8Array,$R=!JR||!WR((function(){ZR(1)}))||!WR((function(){new ZR(-1)}))||!YR((function(e){new ZR,new ZR(null),new ZR(1.5),new ZR(e)}),!0)||WR((function(){return 1!==new ZR(new QR(2),1,void 0).length})),eA=si,tA=di,rA=RangeError,nA=function(e){if(void 0===e)return 0;var t=eA(e),r=tA(t);if(t!==r)throw rA("Wrong length or index");return r},iA=Array,oA=Math.abs,aA=Math.pow,sA=Math.floor,uA=Math.log,cA=Math.LN2,dA=xe,lA=ko,hA=hi,fA=function(e){for(var t=dA(this),r=hA(t),n=arguments.length,i=lA(n>1?arguments[1]:void 0,r),o=n>2?arguments[2]:void 0,a=void 0===o?r:lA(o,r);a>i;)t[i++]=e;return t},pA=se,vA=Te,_A=St,mA=dR,yA=xr,gA=qr,SA=gh,bA=ye,EA=Xl,kA=si,TA=di,IA=nA,RA={pack:function(e,t,r){var n,i,o,a=iA(r),s=8*r-t-1,u=(1<<s)-1,c=u>>1,d=23===t?aA(2,-24)-aA(2,-77):0,l=e<0||0===e&&1/e<0?1:0,h=0;for((e=oA(e))!=e||e===1/0?(i=e!=e?1:0,n=u):(n=sA(uA(e)/cA),e*(o=aA(2,-n))<1&&(n--,o*=2),(e+=n+c>=1?d/o:d*aA(2,1-c))*o>=2&&(n++,o/=2),n+c>=u?(i=0,n=u):n+c>=1?(i=(e*o-1)*aA(2,t),n+=c):(i=e*aA(2,c-1)*aA(2,t),n=0));t>=8;)a[h++]=255&i,i/=256,t-=8;for(n=n<<t|i,s+=t;s>0;)a[h++]=255&n,n/=256,s-=8;return a[--h]|=128*l,a},unpack:function(e,t){var r,n=e.length,i=8*n-t-1,o=(1<<i)-1,a=o>>1,s=i-7,u=n-1,c=e[u--],d=127&c;for(c>>=7;s>0;)d=256*d+e[u--],s-=8;for(r=d&(1<<-s)-1,d>>=-s,s+=t;s>0;)r=256*r+e[u--],s-=8;if(0===d)d=1-a;else{if(d===o)return r?NaN:c?-1/0:1/0;r+=aA(2,t),d-=a}return(c?-1:1)*r*aA(2,d-t)}},AA=_c,wA=Gc,CA=go.f,OA=gt.f,xA=fA,NA=Pd,DA=wc,PA=yA.PROPER,MA=yA.CONFIGURABLE,LA=ln.get,UA=ln.set,VA="ArrayBuffer",FA="DataView",BA="Wrong index",jA=pA.ArrayBuffer,GA=jA,HA=GA&&GA.prototype,zA=pA.DataView,qA=zA&&zA.prototype,XA=Object.prototype,KA=pA.Array,WA=pA.RangeError,YA=vA(xA),JA=vA([].reverse),QA=RA.pack,ZA=RA.unpack,$A=function(e){return[255&e]},ew=function(e){return[255&e,e>>8&255]},tw=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},rw=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},nw=function(e){return QA(e,23,4)},iw=function(e){return QA(e,52,8)},ow=function(e,t){OA(e.prototype,t,{get:function(){return LA(this)[t]}})},aw=function(e,t,r,n){var i=IA(r),o=LA(e);if(i+t>o.byteLength)throw WA(BA);var a=LA(o.buffer).bytes,s=i+o.byteOffset,u=NA(a,s,s+t);return n?u:JA(u)},sw=function(e,t,r,n,i,o){var a=IA(r),s=LA(e);if(a+t>s.byteLength)throw WA(BA);for(var u=LA(s.buffer).bytes,c=a+s.byteOffset,d=n(+i),l=0;l<t;l++)u[c+l]=d[o?l:t-l-1]};if(mA){var uw=PA&&jA.name!==VA;if(bA((function(){jA(1)}))&&bA((function(){new jA(-1)}))&&!bA((function(){return new jA,new jA(1.5),new jA(NaN),1!=jA.length||uw&&!MA})))uw&&MA&&gA(jA,"name",VA);else{(GA=function(e){return EA(this,HA),new jA(IA(e))}).prototype=HA;for(var cw,dw=CA(jA),lw=0;dw.length>lw;)(cw=dw[lw++])in GA||gA(GA,cw,jA[cw]);HA.constructor=GA}wA&&AA(qA)!==XA&&wA(qA,XA);var hw=new zA(new GA(2)),fw=vA(qA.setInt8);hw.setInt8(0,2147483648),hw.setInt8(1,2147483649),!hw.getInt8(0)&&hw.getInt8(1)||SA(qA,{setInt8:function(e,t){fw(this,e,t<<24>>24)},setUint8:function(e,t){fw(this,e,t<<24>>24)}},{unsafe:!0})}else HA=(GA=function(e){EA(this,HA);var t=IA(e);UA(this,{bytes:YA(KA(t),0),byteLength:t}),_A||(this.byteLength=t)}).prototype,qA=(zA=function(e,t,r){EA(this,qA),EA(e,HA);var n=LA(e).byteLength,i=kA(t);if(i<0||i>n)throw WA("Wrong offset");if(i+(r=void 0===r?n-i:TA(r))>n)throw WA("Wrong length");UA(this,{buffer:e,byteLength:r,byteOffset:i}),_A||(this.buffer=e,this.byteLength=r,this.byteOffset=i)}).prototype,_A&&(ow(GA,"byteLength"),ow(zA,"buffer"),ow(zA,"byteLength"),ow(zA,"byteOffset")),SA(qA,{getInt8:function(e){return aw(this,1,e)[0]<<24>>24},getUint8:function(e){return aw(this,1,e)[0]},getInt16:function(e){var t=aw(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=aw(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return rw(aw(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return rw(aw(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return ZA(aw(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return ZA(aw(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){sw(this,1,e,$A,t)},setUint8:function(e,t){sw(this,1,e,$A,t)},setInt16:function(e,t){sw(this,2,e,ew,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){sw(this,2,e,ew,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){sw(this,4,e,tw,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){sw(this,4,e,tw,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){sw(this,4,e,nw,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){sw(this,8,e,iw,t,arguments.length>2?arguments[2]:void 0)}});DA(GA,VA),DA(zA,FA);var pw={ArrayBuffer:GA,DataView:zA},vw=kt,_w=Math.floor,mw=Number.isInteger||function(e){return!vw(e)&&isFinite(e)&&_w(e)===e},yw=si,gw=RangeError,Sw=function(e){var t=yw(e);if(t<0)throw gw("The argument can't be less than 0");return t},bw=RangeError,Ew=function(e,t){var r=Sw(e);if(r%t)throw bw("Wrong offset");return r},kw=Fn,Tw=Te("".slice),Iw=function(e){return"Big"===Tw(kw(e),0,3)},Rw=dr,Aw=TypeError,ww=function(e){var t=Rw(e,"number");if("number"==typeof t)throw Aw("Can't convert number to bigint");return BigInt(t)},Cw=Zn,Ow=Ut,xw=u_,Nw=xe,Dw=hi,Pw=Il,Mw=yl,Lw=hl,Uw=Iw,Vw=XR.aTypedArrayConstructor,Fw=ww,Bw=ha,jw=se,Gw=Ut,Hw=St,zw=$R,qw=XR,Xw=pw,Kw=Xl,Ww=Gr,Yw=qr,Jw=mw,Qw=di,Zw=nA,$w=Ew,eC=fr,tC=Pe,rC=Fn,nC=kt,iC=Ht,oC=La,aC=Vt,sC=Gc,uC=go.f,cC=function(e){var t,r,n,i,o,a,s,u,c=xw(this),d=Nw(e),l=arguments.length,h=l>1?arguments[1]:void 0,f=void 0!==h,p=Mw(d);if(p&&!Lw(p))for(u=(s=Pw(d,p)).next,d=[];!(a=Ow(u,s)).done;)d.push(a.value);for(f&&l>2&&(h=Cw(h,arguments[2])),r=Dw(d),n=new(Vw(c))(r),i=Uw(n),t=0;r>t;t++)o=f?h(d[t],t):d[t],n[t]=i?Fw(o):+o;return n},dC=Hi.forEach,lC=Th,hC=gt,fC=to,pC=th,vC=ln.get,_C=ln.set,mC=ln.enforce,yC=hC.f,gC=fC.f,SC=Math.round,bC=jw.RangeError,EC=Xw.ArrayBuffer,kC=EC.prototype,TC=Xw.DataView,IC=qw.NATIVE_ARRAY_BUFFER_VIEWS,RC=qw.TYPED_ARRAY_TAG,AC=qw.TypedArray,wC=qw.TypedArrayPrototype,CC=qw.aTypedArrayConstructor,OC=qw.isTypedArray,xC="BYTES_PER_ELEMENT",NC="Wrong length",DC=function(e,t){CC(e);for(var r=0,n=t.length,i=new e(n);n>r;)i[r]=t[r++];return i},PC=function(e,t){yC(e,t,{get:function(){return vC(this)[t]}})},MC=function(e){var t;return aC(kC,e)||"ArrayBuffer"==(t=rC(e))||"SharedArrayBuffer"==t},LC=function(e,t){return OC(e)&&!iC(t)&&t in e&&Jw(+t)&&t>=0},UC=function(e,t){return t=eC(t),LC(e,t)?Ww(2,e[t]):gC(e,t)},VC=function(e,t,r){return t=eC(t),!(LC(e,t)&&nC(r)&&tC(r,"value"))||tC(r,"get")||tC(r,"set")||r.configurable||tC(r,"writable")&&!r.writable||tC(r,"enumerable")&&!r.enumerable?yC(e,t,r):(e[t]=r.value,e)};Hw?(IC||(fC.f=UC,hC.f=VC,PC(wC,"buffer"),PC(wC,"byteOffset"),PC(wC,"byteLength"),PC(wC,"length")),Bw({target:"Object",stat:!0,forced:!IC},{getOwnPropertyDescriptor:UC,defineProperty:VC}),cR.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,i=e+(r?"Clamped":"")+"Array",o="get"+e,a="set"+e,s=jw[i],u=s,c=u&&u.prototype,d={},l=function(e,t){yC(e,t,{get:function(){return function(e,t){var r=vC(e);return r.view[o](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var o=vC(e);r&&(i=(i=SC(i))<0?0:i>255?255:255&i),o.view[a](t*n+o.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};IC?zw&&(u=t((function(e,t,r,i){return Kw(e,c),pC(nC(t)?MC(t)?void 0!==i?new s(t,$w(r,n),i):void 0!==r?new s(t,$w(r,n)):new s(t):OC(t)?DC(u,t):Gw(cC,u,t):new s(Zw(t)),e,u)})),sC&&sC(u,AC),dC(uC(s),(function(e){e in u||Yw(u,e,s[e])})),u.prototype=c):(u=t((function(e,t,r,i){Kw(e,c);var o,a,s,d=0,h=0;if(nC(t)){if(!MC(t))return OC(t)?DC(u,t):Gw(cC,u,t);o=t,h=$w(r,n);var f=t.byteLength;if(void 0===i){if(f%n)throw bC(NC);if((a=f-h)<0)throw bC(NC)}else if((a=Qw(i)*n)+h>f)throw bC(NC);s=a/n}else s=Zw(t),o=new EC(a=s*n);for(_C(e,{buffer:o,byteOffset:h,byteLength:a,length:s,view:new TC(o)});d<s;)l(e,d++)})),sC&&sC(u,AC),c=u.prototype=oC(wC)),c.constructor!==u&&Yw(c,"constructor",u),mC(c).TypedArrayConstructor=u,RC&&Yw(c,RC,i);var h=u!=s;d[i]=u,Bw({global:!0,constructor:!0,forced:h,sham:!IC},d),xC in u||Yw(u,xC,n),xC in c||Yw(c,xC,n),lC(i)}):cR.exports=function(){},(0,cR.exports)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var FC=hi,BC=si,jC=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("at",(function(e){var t=jC(this),r=FC(t),n=BC(e),i=n>=0?n:r+n;return i<0||i>=r?void 0:t[i]}));var GC=xe,HC=ko,zC=hi,qC=Bv,XC=Math.min,KC=[].copyWithin||function(e,t){var r=GC(this),n=zC(r),i=HC(e,n),o=HC(t,n),a=arguments.length>2?arguments[2]:void 0,s=XC((void 0===a?n:HC(a,n))-o,n-i),u=1;for(o<i&&i<o+s&&(u=-1,o+=s-1,i+=s-1);s-- >0;)o in r?r[i]=r[o]:qC(r,i),i+=u,o+=u;return r},WC=XR,YC=Te(KC),JC=WC.aTypedArray;(0,WC.exportTypedArrayMethod)("copyWithin",(function(e,t){return YC(JC(this),e,t,arguments.length>2?arguments[2]:void 0)}));var QC=Hi.every,ZC=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("every",(function(e){return QC(ZC(this),e,arguments.length>1?arguments[1]:void 0)}));var $C=fA,eO=ww,tO=Fn,rO=Ut,nO=ye,iO=XR.aTypedArray,oO=XR.exportTypedArrayMethod,aO=Te("".slice),sO=nO((function(){var e=0;return new Int8Array(2).fill({valueOf:function(){return e++}}),1!==e}));oO("fill",(function(e){var t=arguments.length;iO(this);var r="Big"===aO(tO(this),0,3)?eO(e):+e;return rO($C,this,r,t>1?arguments[1]:void 0,t>2?arguments[2]:void 0)}),sO);var uO=hi,cO=function(e,t){for(var r=0,n=uO(t),i=new e(n);n>r;)i[r]=t[r++];return i},dO=f_,lO=XR.aTypedArrayConstructor,hO=XR.getTypedArrayConstructor,fO=function(e){return lO(dO(e,hO(e)))},pO=cO,vO=fO,_O=Hi.filter,mO=function(e,t){return pO(vO(e),t)},yO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("filter",(function(e){var t=_O(yO(this),e,arguments.length>1?arguments[1]:void 0);return mO(this,t)}));var gO=Hi.find,SO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("find",(function(e){return gO(SO(this),e,arguments.length>1?arguments[1]:void 0)}));var bO=Hi.findIndex,EO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("findIndex",(function(e){return bO(EO(this),e,arguments.length>1?arguments[1]:void 0)}));var kO=Zn,TO=ni,IO=xe,RO=hi,AO=function(e){var t=1==e;return function(r,n,i){for(var o,a=IO(r),s=TO(a),u=kO(n,i),c=RO(s);c-- >0;)if(u(o=s[c],c,a))switch(e){case 0:return o;case 1:return c}return t?-1:void 0}},wO={findLast:AO(0),findLastIndex:AO(1)},CO=wO.findLast,OO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("findLast",(function(e){return CO(OO(this),e,arguments.length>1?arguments[1]:void 0)}));var xO=wO.findLastIndex,NO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("findLastIndex",(function(e){return xO(NO(this),e,arguments.length>1?arguments[1]:void 0)}));var DO=Hi.forEach,PO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("forEach",(function(e){DO(PO(this),e,arguments.length>1?arguments[1]:void 0)}));var MO=wo.includes,LO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("includes",(function(e){return MO(LO(this),e,arguments.length>1?arguments[1]:void 0)}));var UO=wo.indexOf,VO=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("indexOf",(function(e){return UO(VO(this),e,arguments.length>1?arguments[1]:void 0)}));var FO=se,BO=ye,jO=Te,GO=XR,HO=bd,zO=_t("iterator"),qO=FO.Uint8Array,XO=jO(HO.values),KO=jO(HO.keys),WO=jO(HO.entries),YO=GO.aTypedArray,JO=GO.exportTypedArrayMethod,QO=qO&&qO.prototype,ZO=!BO((function(){QO[zO].call([1])})),$O=!!QO&&QO.values&&QO[zO]===QO.values&&"values"===QO.values.name,ex=function(){return XO(YO(this))};JO("entries",(function(){return WO(YO(this))}),ZO),JO("keys",(function(){return KO(YO(this))}),ZO),JO("values",ex,ZO||!$O,{name:"values"}),JO(zO,ex,ZO||!$O,{name:"values"});var tx=XR.aTypedArray,rx=XR.exportTypedArrayMethod,nx=Te([].join);rx("join",(function(e){return nx(tx(this),e)}));var ix=vf,ox=uo,ax=si,sx=hi,ux=qi,cx=Math.min,dx=[].lastIndexOf,lx=!!dx&&1/[1].lastIndexOf(1,-0)<0,hx=ux("lastIndexOf"),fx=lx||!hx?function(e){if(lx)return ix(dx,this,arguments)||0;var t=ox(this),r=sx(t),n=r-1;for(arguments.length>1&&(n=cx(n,ax(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in t&&t[n]===e)return n||0;return-1}:dx,px=vf,vx=fx,_x=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("lastIndexOf",(function(e){var t=arguments.length;return px(vx,_x(this),t>1?[e,arguments[1]]:[e])}));var mx=Hi.map,yx=fO,gx=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("map",(function(e){return mx(gx(this),e,arguments.length>1?arguments[1]:void 0,(function(e,t){return new(yx(e))(t)}))}));var Sx=np.left,bx=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("reduce",(function(e){var t=arguments.length;return Sx(bx(this),e,t,t>1?arguments[1]:void 0)}));var Ex=np.right,kx=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("reduceRight",(function(e){var t=arguments.length;return Ex(kx(this),e,t,t>1?arguments[1]:void 0)}));var Tx=XR.aTypedArray,Ix=XR.exportTypedArrayMethod,Rx=Math.floor;Ix("reverse",(function(){for(var e,t=this,r=Tx(t).length,n=Rx(r/2),i=0;i<n;)e=t[i],t[i++]=t[--r],t[r]=e;return t}));var Ax=se,wx=Ut,Cx=XR,Ox=hi,xx=Ew,Nx=xe,Dx=ye,Px=Ax.RangeError,Mx=Ax.Int8Array,Lx=Mx&&Mx.prototype,Ux=Lx&&Lx.set,Vx=Cx.aTypedArray,Fx=Cx.exportTypedArrayMethod,Bx=!Dx((function(){var e=new Uint8ClampedArray(2);return wx(Ux,e,{length:1,0:3},1),3!==e[1]})),jx=Bx&&Cx.NATIVE_ARRAY_BUFFER_VIEWS&&Dx((function(){var e=new Mx(2);return e.set(1),e.set("2",1),0!==e[0]||2!==e[1]}));Fx("set",(function(e){Vx(this);var t=xx(arguments.length>1?arguments[1]:void 0,1),r=Nx(e);if(Bx)return wx(Ux,this,r,t);var n=this.length,i=Ox(r),o=0;if(i+t>n)throw Px("Wrong length");for(;o<i;)this[t+o]=r[o++]}),!Bx||jx);var Gx=fO,Hx=mv,zx=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("slice",(function(e,t){for(var r=Hx(zx(this),e,t),n=Gx(this),i=0,o=r.length,a=new n(o);o>i;)a[i]=r[i++];return a}),ye((function(){new Int8Array(1).slice()})));var qx=Hi.some,Xx=XR.aTypedArray;(0,XR.exportTypedArrayMethod)("some",(function(e){return qx(Xx(this),e,arguments.length>1?arguments[1]:void 0)}));var Kx=Wn,Wx=ye,Yx=Yt,Jx=DI,Qx=MI,Zx=LI,$x=tt,eN=VI,tN=XR.aTypedArray,rN=XR.exportTypedArrayMethod,nN=se.Uint16Array,iN=nN&&Kx(nN.prototype.sort),oN=!(!iN||Wx((function(){iN(new nN(2),null)}))&&Wx((function(){iN(new nN(2),{})}))),aN=!!iN&&!Wx((function(){if($x)return $x<74;if(Qx)return Qx<67;if(Zx)return!0;if(eN)return eN<602;var e,t,r=new nN(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(iN(r,(function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));rN("sort",(function(e){return void 0!==e&&Yx(e),aN?iN(this,e):Jx(tN(this),function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e))}),!aN||oN);var sN=vf,uN=XR,cN=ye,dN=mv,lN=se.Int8Array,hN=uN.aTypedArray,fN=uN.exportTypedArrayMethod,pN=[].toLocaleString,vN=!!lN&&cN((function(){pN.call(new lN(1))}));fN("toLocaleString",(function(){return sN(pN,vN?dN(hN(this)):hN(this),dN(arguments))}),cN((function(){return[1,2].toLocaleString()!=new lN([1,2]).toLocaleString()}))||!cN((function(){lN.prototype.toLocaleString.call([1,2])})));var _N=XR.exportTypedArrayMethod,mN=ye,yN=Te,gN=se.Uint8Array,SN=gN&&gN.prototype||{},bN=[].toString,EN=yN([].join);mN((function(){bN.call({})}))&&(bN=function(){return EN(this)});var kN=SN.toString!=bN;_N("toString",bN,kN);var TN=hi,IN=function(e,t){for(var r=TN(e),n=new t(r),i=0;i<r;i++)n[i]=e[r-i-1];return n},RN=XR.aTypedArray,AN=XR.getTypedArrayConstructor;(0,XR.exportTypedArrayMethod)("toReversed",(function(){return IN(RN(this),AN(this))}));var wN=Yt,CN=cO,ON=XR.aTypedArray,xN=XR.getTypedArrayConstructor,NN=XR.exportTypedArrayMethod,DN=Te(XR.TypedArrayPrototype.sort);NN("toSorted",(function(e){void 0!==e&&wN(e);var t=ON(this),r=CN(xN(t),t);return DN(r,e)}));var PN=hi,MN=si,LN=RangeError,UN=function(e,t,r,n){var i=PN(e),o=MN(r),a=o<0?i+o:o;if(a>=i||a<0)throw LN("Incorrect index");for(var s=new t(i),u=0;u<i;u++)s[u]=u===a?n:e[u];return s},VN=Iw,FN=si,BN=ww,jN=XR.aTypedArray,GN=XR.getTypedArrayConstructor,HN=XR.exportTypedArrayMethod,zN=!!function(){try{new Int8Array(1).with(2,{valueOf:function(){throw 8}})}catch(X$){return 8===X$}}();HN("with",{with:function(e,t){var r=jN(this),n=FN(e),i=VN(r)?BN(t):+t;return UN(r,GN(r),n,i)}}.with,!zN);var qN=ha,XN=Hi.findIndex,KN=Ga,WN="findIndex",YN=!0;WN in[]&&Array(1).findIndex((function(){YN=!1})),qN({target:"Array",proto:!0,forced:YN},{findIndex:function(e){return XN(this,e,arguments.length>1?arguments[1]:void 0)}}),KN(WN);var JN=function(e){return e.INVALID_ENGINE="INVALID_ENGINE",e.INVALID_PARAMS="INVALID_PARAMS",e.INVOKED_BEFORE_JOIN_ROOM="INVOKED_BEFORE_JOIN_ROOM",e.INVALID_TOKEN="INVALID_TOKEN",e.EXPIRED_TOKEN="EXPIRED_TOKEN",e.JOIN_ROOM_FAILED="JOIN_ROOM_FAILED",e.UPDATE_TOKEN_WITH_INVALID_TOKEN="UPDATE_TOKEN_WITH_INVALID_TOKEN",e.UPDATE_TOKEN_BEFORE_JOIN="UPDATE_TOKEN_BEFORE_JOIN",e.REPEAT_JOIN="REPEAT_JOIN",e.REPEAT_PUBLISH="REPEAT_PUBLISH",e.REPEAT_PUSH="REPEAT_PUSH",e.REPEAT_PLAY="REPEAT_PLAY",e.PUBLISH_BEFORE_JOIN="PUBLISH_BEFORE_JOIN",e.UNPUBLISH_BEFORE_JOIN="UNPUBLISH_BEFORE_JOIN",e.SUBSCRIBE_BEFORE_JOIN="SUBSCRIBE_BEFORE_JOIN",e.UNSUBSCRIBE_BEFORE_JOIN="UNSUBSCRIBE_BEFORE_JOIN",e.NO_PUBLISH_PERMISSION="NO_PUBLISH_PERMISSION",e.STREAM_NOT_EXIST="STREAM_NOT_EXIST",e.EMPTY_STREAM="EMPTY_STREAM",e.NOT_CONNECTED_YET="NOT_CONNECTED_YET",e.IM_BEFORE_JOIN="IM_BEFORE_JOIN",e.USER_NOT_EXIST="USER_NOT_EXIST",e.ALREADY_IN_ROOM="ALREADY_IN_ROOM",e.KICKED_OUT="KICKED_OUT",e.ROOM_DISMISS="ROOM_DISMISS",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.DUPLICATE_LOGIN="DUPLICATE_LOGIN",e.INVOKED_BEFORE_CAPTURE="INVOKED_BEFORE_CAPTURE",e.REPEAT_CAPTURE="REPEAT_CAPTURE",e.GET_VIDEO_TRACK_FAILED="GET_VIDEO_TRACK_FAILED",e.GET_AUDIO_TRACK_FAILED="GET_AUDIO_TRACK_FAILED",e.GET_SCREEN_TRACK_FAILED="GET_SCREEN_TRACK_FAILED",e.STREAM_TYPE_NOT_MATCH="STREAM_TYPE_NOT_MATCH",e.CANT_FIND_DOM="CANT_FIND_DOM",e.INVALID_DEVICE_ID="INVALID_DEVICE_ID",e.NO_PERMISSION="NO_PERMISSION",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INTERRUPT="INTERRUPT",e.ICE_SERVER_WRONG="ICE_SERVER_WRONG",e.ESTABLISH_DATACHANNEL_FAILED="ESTABLISH_DATACHANNEL_FAILED",e.LOAD_RESOURCES_FAILED="LOAD_RESOURCES_FAILED",e.SIGNALING_CHANNEL_NOT_OPEN="SIGNALING_CHANNEL_NOT_OPEN",e.TIME_OUT="TIME_OUT",e.REFUSE_OPERATION_IN_DISCONNECT="REFUSE_OPERATION_IN_DISCONNECT",e.ADD_TRANSCEIVER_FAILED="ADD_TRANSCEIVER_FAILED",e.UPDATE_TRACK_FAILED="UPDATE_TRACK_FAILED",e.PUBLISH_FAILED="PUBLISH_FAILED",e.UNPUBLISH_FAILED="UNPUBLISH_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.OPERATION_CANCEL="OPERATION_CANCEL",e.START_CLOUD_PROXY_AFTER_JOIN="START_CLOUD_PROXY_AFTER_JOIN",e.STOP_CLOUD_PROXY_BEFORE_LEAVE="STOP_CLOUD_PROXY_BEFORE_LEAVE",e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.REPEAT_DEVICE_TEST="REPEAT_DEVICE_TEST",e.AUDIO_DEVICE_TEST_FAILED="AUDIO_DEVICE_RECORD_FAILED",e.ALREADY_LOGIN="ALREADY_LOGIN",e.LOGIN_FAILED="LOGIN_FAILED",e.NOT_LOGIN="NOT_LOGIN",e.RTM_DUPLICATE_LOGIN="RTM_DUPLICATE_LOGIN",e.RTM_TOKEN_ERROR="RTM_TOKEN_ERROR",e.USER_MESSAGE_TIMEOUT="USER_MESSAGE_TIMEOUT",e.USER_MESSAGE_BROKEN="USER_MESSAGE_BROKEN",e.USER_MESSAGE_NO_RECEIVER="USER_MESSAGE_NO_RECEIVER",e.USER_MESSAGE_NO_RELAYPATH="USER_MESSAGE_NO_RELAYPATH",e.USER_MESSAGE_SEND_TO_SERVER_ERROR="USER_MESSAGE_SEND_TO_SERVER_ERROR",e.USER_MESSAGE_SERVER_RESPONSE_ERROR="USER_MESSAGE_SERVER_RESPONSE_ERROR",e.USER_MESSAGE_NOT_JOIN="USER_MESSAGE_NOT_JOIN",e.USER_MESSAGE_INIT="USER_MESSAGE_INIT",e.USER_MESSAGE_NO_CONNECTION="USER_MESSAGE_NO_CONNECTION",e.USER_MESSAGE_NOT_LOGIN="USER_MESSAGE_NOT_LOGIN",e.USER_MESSAGE_SERVER_PARAMS_NOTSET="USER_MESSAGE_SERVER_PARAMS_NOTSET",e.USER_MESSAGE_UNKNOWN="USER_MESSAGE_UNKNOWN",e.START_PUBLIC_STREAM_BEFORE_JOIN="START_PUBLIC_STREAM_BEFORE_JOIN",e.RECONNECT_FAILED="RECONNECT_FAILED",e}(JN||{}),QN=function(e){return e[e.AUDIO_MIXING_ERROR_OK=0]="AUDIO_MIXING_ERROR_OK",e[e.AUDIO_MIXING_ERROR_PRELOAD_FAILED=1]="AUDIO_MIXING_ERROR_PRELOAD_FAILED",e[e.AUDIO_MIXING_ERROR_START_FAILED=2]="AUDIO_MIXING_ERROR_START_FAILED",e[e.AUDIO_MIXING_ERROR_ID_NOT_FOUND=3]="AUDIO_MIXING_ERROR_ID_NOT_FOUND",e[e.AUDIO_MIXING_ERROR_SET_POSITION_FAILED=4]="AUDIO_MIXING_ERROR_SET_POSITION_FAILED",e[e.AUDIO_MIXING_ERROR_INVALID_VOLUME=5]="AUDIO_MIXING_ERROR_INVALID_VOLUME",e[e.AUDIO_MIXING_ERROR_LOAD_CONFLICT=6]="AUDIO_MIXING_ERROR_LOAD_CONFLICT",e[e.AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH=7]="AUDIO_MIXING_ERROR_ID_TYPE_NOT_MATCH",e[e.AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH=8]="AUDIO_MIXING_ERROR_ID_TYPE_INVALID_PITCH",e[e.AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK=9]="AUDIO_MIXING_ERROR_INVALID_AUDIO_TRACK",e}(QN||{}),ZN=l((function e(t,r,n){c(this,e),h(this,"code",void 0),h(this,"message",void 0),h(this,"error",void 0),this.code=t,this.message=r,this.error=n})),$N=St,eD=Te,tD=_a,rD=uo,nD=eD(ro.f),iD=eD([].push),oD=function(e){return function(t){for(var r,n=rD(t),i=tD(n),o=i.length,a=0,s=[];o>a;)r=i[a++],$N&&!nD(n,r)||iD(s,e?[r,n[r]]:n[r]);return s}},aD={entries:oD(!0),values:oD(!1)}.entries;ha({target:"Object",stat:!0},{entries:function(e){return aD(e)}});var sD=si,uD=es,cD=we,dD=RangeError,lD=Te,hD=di,fD=es,pD=function(e){var t=uD(cD(this)),r="",n=sD(e);if(n<0||n==1/0)throw dD("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(r+=t);return r},vD=we,_D=lD(pD),mD=lD("".slice),yD=Math.ceil,gD=function(e){return function(t,r,n){var i,o,a=fD(vD(t)),s=hD(r),u=a.length,c=void 0===n?" ":fD(n);return s<=u||""==c?a:((o=_D(c,yD((i=s-u)/c.length))).length>i&&(o=mD(o,0,i)),e?a+o:o+a)}},SD={start:gD(!1),end:gD(!0)},bD=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(We),ED=SD.end;ha({target:"String",proto:!0,forced:bD},{padEnd:function(e){return ED(this,e,arguments.length>1?arguments[1]:void 0)}});var kD=nc;ha({target:"Number",stat:!0,forced:Number.parseInt!=kD},{parseInt:kD});var TD=Pt,ID=Cl,RD=Zn,AD=Ut,wD=xe,CD=function(e,t,r,n){try{return n?t(TD(r)[0],r[1]):t(r)}catch(X$){ID(e,"throw",X$)}},OD=hl,xD=wi,ND=hi,DD=wd,PD=Il,MD=yl,LD=Array,UD=function(e){var t=wD(e),r=xD(this),n=arguments.length,i=n>1?arguments[1]:void 0,o=void 0!==i;o&&(i=RD(i,n>2?arguments[2]:void 0));var a,s,u,c,d,l,h=MD(t),f=0;if(!h||this===LD&&OD(h))for(a=ND(t),s=r?new this(a):LD(a);a>f;f++)l=o?i(t[f],f):t[f],DD(s,f,l);else for(d=(c=PD(t,h)).next,s=r?new this:[];!(u=AD(d,c)).done;f++)l=o?CD(c,i,[u.value,f],!0):u.value,DD(s,f,l);return s.length=f,s},VD=UD;ha({target:"Array",stat:!0,forced:!Ql((function(e){Array.from(e)}))},{from:VD});var FD=Math.log,BD=Math.LOG10E;ha({target:"Math",stat:!0},{log10:Math.log10||function(e){return FD(e)*BD}});var jD,GD=ha,HD=Wn,zD=to.f,qD=di,XD=es,KD=Qa,WD=we,YD=rs,JD=HD("".startsWith),QD=HD("".slice),ZD=Math.min,$D=YD("startsWith"),eP=!$D&&!!function(){var e=zD(String.prototype,"startsWith");return e&&!e.writable}();GD({target:"String",proto:!0,forced:!eP&&!$D},{startsWith:function(e){var t=XD(WD(this));KD(e);var r=qD(ZD(arguments.length>1?arguments[1]:void 0,t.length)),n=XD(e);return JD?JD(t,n,r):QD(t,r,r+n.length)===n}});var tP=new Uint8Array(16);function rP(){if(!jD&&!(jD="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return jD(tP)}var nP=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function iP(e){return"string"==typeof e&&nP.test(e)}for(var oP=[],aP=0;aP<256;++aP)oP.push((aP+256).toString(16).substr(1));function sP(e,t,r){var n=(e=e||{}).random||(e.rng||rP)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var i=0;i<16;++i)t[r+i]=n[i];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=(oP[e[t+0]]+oP[e[t+1]]+oP[e[t+2]]+oP[e[t+3]]+"-"+oP[e[t+4]]+oP[e[t+5]]+"-"+oP[e[t+6]]+oP[e[t+7]]+"-"+oP[e[t+8]]+oP[e[t+9]]+"-"+oP[e[t+10]]+oP[e[t+11]]+oP[e[t+12]]+oP[e[t+13]]+oP[e[t+14]]+oP[e[t+15]]).toLowerCase();if(!iP(r))throw TypeError("Stringified UUID is invalid");return r}(n)}var uP=new TextDecoder,cP=new TextEncoder,dP=function(){return sP()},lP=function(){return Date.now()};function hP(e){for(var t=0,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];for(var o=0,a=n;o<a.length;o++){var s=a[o];t+=s.length}for(var u=new e(t),c=0,d=0,l=n;d<l.length;d++){var h=l[d];u.set(h,c),c+=h.length}return u}var fP=function(){return"undefined"==typeof window},pP=function(){function e(){c(this,e)}var t,r;return l(e,null,[{key:"token2auth",value:function(t,r,n,i){return i?"Bearer ".concat(i):"Basic ".concat(e.createUnsafeToken(t,r,n))}},{key:"createUnsafeToken",value:function(e,t,r){return window.btoa([e,t,r].filter((function(e){return null!==e})).join(":"))}},{key:"merge",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0,i=Object.entries(t);n<i.length;n++){var o=E(i[n],2),s=o[0],u=o[1];null!==u&&"object"===a(u)?e.merge(t[s],r[s]):void 0!==r[s]&&(t[s]=r[s])}}},{key:"ab2str",value:function(e){return uP.decode(e)}},{key:"ab2obj",value:function(t){try{var r=e.ab2str(t);return JSON.parse(r)}catch(n){return{}}}},{key:"str2ab",value:function(e){return cP.encode(e).buffer}},{key:"ab2b64str",value:(r=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){var r=new FileReader;r.onload=function(){return e(r.result)},r.readAsDataURL(new Blob([t]))}));case 2:return r=e.sent,e.abrupt("return",r.split(",",2)[1]);case 4:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"b64str2ab",value:(t=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",fetch("data:application/octet;base64,"+t).then((function(e){return e.arrayBuffer()})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}();function vP(e){return new Promise((function(t){window.setTimeout(t,e)}))}function _P(){var e="none";return fP()||(null!==window.navigator.userAgent.match("Firefox")?e="mozilla":null!==window.navigator.userAgent.match("Chrome")?(e="chrome-stable",null!==window.navigator.userAgent.match("Electron")&&(e="electron")):(null!==window.navigator.userAgent.match("Safari")||null!==window.navigator.userAgent.match("AppleWebKit"))&&(e="safari")),e}var mP="mozilla"===_P(),yP="safari"===_P(),gP=!fP()&&navigator.userAgent.toLowerCase().includes("mobile");function SP(){for(var e=(+"".concat(Math.random()).slice(-7).padEnd(7,"0")).toString(2).padEnd(28,"1").split(""),t=[];e.length;)t.push(e.splice(0,7));return t.map((function(e,r){var n=r===t.length-1?"0":"1";return Number.parseInt(n+e.join(""),2)}))}var bP=function(){return Math.floor(65535*Math.random())};function EP(e){return"string"==typeof e&&e.indexOf("__web__rtc__rtt__")>-1}function kP(e){return e.map((function e(t){if(null!=t&&t._reportName)return t._reportName;if(t instanceof HTMLElement)return t.toString();if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)){var r=ArrayBuffer.isView(t)?t.buffer:t,n=r.byteLength,i=[];if(n>10){var o=new DataView(r),a=Array.from({length:5}).map((function(e,t){return o.getUint8(t)})),s=Array.from({length:5}).map((function(e,t){return n-1-t})).reverse().map((function(e){return o.getUint8(e)}));i=[].concat(k(a),["..."],k(s))}else i=Array.from(new Uint8Array(r));return"".concat(t.constructor.name,"(").concat(n,") [").concat(i.join(", "),"]")}if(t instanceof ImageData)return"ImageData";if(Array.isArray(t))return t.map(e);if("[object Object]"===Object.prototype.toString.call(t)){var u={};for(var c in t)u[c]=e(t[c]);return u}return t}))}var TP=function(){var e=u(o().mark((function e(){var t,r,n,i=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=i.length>0&&void 0!==i[0]&&i[0],e.prev=1,(r=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"})).createDataChannel("default"),r.addTransceiver("audio",{direction:"recvonly"}),r.addTransceiver("video",{direction:"recvonly"}),t&&(r.addTransceiver("audio",{direction:"sendonly"}),r.addTransceiver("video",{direction:"sendonly"})),e.next=9,r.createOffer();case 9:return n=e.sent,r.close(),e.abrupt("return",n.sdp);case 14:e.prev=14,e.t0=e.catch(1);case 16:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(){return e.apply(this,arguments)}}(),IP=function(e){return new Promise((function(t,r){var n=(e=Array.isArray(e)?e:[]).length,i=[];0===n?r([]):e.forEach((function(e){e.then((function(e){t(e)}),(function(e){n--,i.push(e),0===n&&r(i)}))}))}))};function RP(e){return+Math.max(-127,10*Math.log10(Math.pow(e/255,2))).toFixed(2)}function AP(e){return(e&V.AUDIO)===V.AUDIO}function wP(e){return(e&V.VIDEO)===V.VIDEO}function CP(e){var t={};return Object.keys(e).forEach((function(r){"object"===a(e[r])?t[r]=CP(e[r]):r.startsWith("_")||(t[r]=e[r])})),t}function OP(e){var t=new DataView(e.buffer);if(t.byteLength<=4||65535!==t.getUint16(0))return{seiCount:1,seis:[e]};for(var r={seiCount:0,seis:[]},n=!1,i=2;i<t.byteLength;){var o=t.getUint16(i);if(i+=2,t.byteLength-i<o){n=!0;break}var a=new Uint8Array(e.buffer,i,o);if(i+=o,t.byteLength-i>0&&t.byteLength-i<=2){n=!0;break}r.seiCount++,r.seis.push(a)}return n&&(r.seiCount=1,r.seis=[e]),r}function xP(e,t){if("boolean"!=typeof e)throw new ZN(JN.INVALID_PARAMS,"Invalid ".concat(t,": The value should be boolean type."))}function NP(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(e<r||e>n||"number"!=typeof e){var i=new ZN(JN.INVALID_PARAMS,"Invalid ".concat(t,": the value range is [").concat(r,", ").concat(n,"]. integer only"));throw i}}function DP(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Number.POSITIVE_INFINITY;if(null==e)throw new ZN(JN.INVALID_PARAMS,"".concat(t," cannot be empty"));if(!FP(e,r,n))throw new ZN(JN.INVALID_PARAMS,"Invalid ".concat(t,": The value should be string type. Length of the string: [").concat(r,",").concat(n,"]"))}function PP(e,t,r){if(!r.includes(e))throw new ZN(JN.INVALID_PARAMS,"Invalid ".concat(t,": The value can only be set as ").concat(JSON.stringify(r)))}function MP(e){if(!(e instanceof MediaStreamTrack))throw new ZN(JN.INVALID_PARAMS,"Invalid track, The value should be MediaStreamTrack type.")}function LP(e,t){if(BP(e))throw new ZN(JN.INVALID_PARAMS,"Invalid ".concat(t,", should not be empty"))}function UP(e,t){if(!(e instanceof ArrayBuffer))throw new ZN(JN.INVALID_PARAMS,"Invalid ".concat(t,", should be ArrayBuffer"))}function VP(e){try{for(var t=navigator.mediaDevices.getSupportedConstraints(),r=0,n=Object.keys(e);r<n.length;r++){var i=n[r];t[i]||delete e[i]}}catch(o){}}function FP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"string"==typeof e&&e.length<=r&&e.length>=t}function BP(e){return null==e}function jP(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new ZN(JN.INVALID_PARAMS,"The RoomId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function GP(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new ZN(JN.INVALID_PARAMS,"The userId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function HP(e){if("string"!=typeof e||!/^[a-zA-Z0-9@._\-]{1,128}$/.test(e))throw new ZN(JN.INVALID_PARAMS,"The publicStreamId must be within 128 bytes. The supported characters: a-z,A-Z,0-9,@,-,_,.")}function zP(e){LP(e,"userInfo"),GP(e.userId),BP(e.extraInfo)||DP(e.extraInfo,"userInfo.extraInfo",1,200)}function qP(e){LP(e,"roomConfig"),xP(e.isAutoPublish,"roomConfig.isAutoPublish"),xP(e.isAutoSubscribeAudio,"roomConfig.isAutoSubscribeAudio"),xP(e.isAutoSubscribeVideo,"roomConfig.isAutoSubscribeVideo")}function XP(e){LP(e,"videoPlayerOption")}function KP(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64;if(!e||0===(null==e?void 0:e.byteLength))throw new ZN(JN.INVALID_PARAMS,"The message cannot be empty");if((null===(t=e instanceof ArrayBuffer?e:pP.str2ab(JSON.stringify(e)))||void 0===t?void 0:t.byteLength)>1e3*r)throw new ZN(JN.INVALID_PARAMS,"The message length must be less than ".concat(r,"K"))}function WP(e){return![ie.onRemoteStreamStats,ie.onLocalStreamStats,ie.onAudioVolumeIndication,ie.onLocalAudioPropertiesReport,ie.onRemoteAudioPropertiesReport].includes(e)}function YP(e){if("number"!=typeof(null==e?void 0:e.width)||"number"!=typeof(null==e?void 0:e.height))throw new ZN(JN.INVALID_PARAMS,"remoteVideoConfig must contain width, height, frameRate")}var JP={},QP=_t;JP.f=QP;var ZP=se,$P=Pe,eM=JP,tM=gt.f,rM=function(e){var t=ZP.Symbol||(ZP.Symbol={});$P(t,e)||tM(t,e,{value:eM.f(e)})},nM=Ut,iM=Ke,oM=_t,aM=wn,sM=ha,uM=se,cM=Ut,dM=Te,lM=St,hM=it,fM=ye,pM=Pe,vM=Vt,_M=Pt,mM=uo,yM=fr,gM=es,SM=Gr,bM=La,EM=_a,kM=go,TM=Td,IM=Vo,RM=to,AM=gt,wM=fa,CM=ro,OM=wn,xM=ue.exports,NM=Jr,DM=Fe,PM=_t,MM=JP,LM=rM,UM=function(){var e=iM("Symbol"),t=e&&e.prototype,r=t&&t.valueOf,n=oM("toPrimitive");t&&!t[n]&&aM(t,n,(function(e){return nM(r,this)}),{arity:1})},VM=wc,FM=ln,BM=Hi.forEach,jM=Yr("hidden"),GM="Symbol",HM=FM.set,zM=FM.getterFor(GM),qM=Object.prototype,XM=uM.Symbol,KM=XM&&XM.prototype,WM=uM.TypeError,YM=uM.QObject,JM=RM.f,QM=AM.f,ZM=TM.f,$M=CM.f,eL=dM([].push),tL=xM("symbols"),rL=xM("op-symbols"),nL=xM("wks"),iL=!YM||!YM.prototype||!YM.prototype.findChild,oL=lM&&fM((function(){return 7!=bM(QM({},"a",{get:function(){return QM(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=JM(qM,t);n&&delete qM[t],QM(e,t,r),n&&e!==qM&&QM(qM,t,n)}:QM,aL=function(e,t){var r=tL[e]=bM(KM);return HM(r,{type:GM,tag:e,description:t}),lM||(r.description=t),r},sL=function(e,t,r){e===qM&&sL(rL,t,r),_M(e);var n=yM(t);return _M(r),pM(tL,n)?(r.enumerable?(pM(e,jM)&&e[jM][n]&&(e[jM][n]=!1),r=bM(r,{enumerable:SM(0,!1)})):(pM(e,jM)||QM(e,jM,SM(1,{})),e[jM][n]=!0),oL(e,n,r)):QM(e,n,r)},uL=function(e,t){_M(e);var r=mM(t),n=EM(r).concat(hL(r));return BM(n,(function(t){lM&&!cM(cL,r,t)||sL(e,t,r[t])})),e},cL=function(e){var t=yM(e),r=cM($M,this,t);return!(this===qM&&pM(tL,t)&&!pM(rL,t))&&(!(r||!pM(this,t)||!pM(tL,t)||pM(this,jM)&&this[jM][t])||r)},dL=function(e,t){var r=mM(e),n=yM(t);if(r!==qM||!pM(tL,n)||pM(rL,n)){var i=JM(r,n);return!i||!pM(tL,n)||pM(r,jM)&&r[jM][n]||(i.enumerable=!0),i}},lL=function(e){var t=ZM(mM(e)),r=[];return BM(t,(function(e){pM(tL,e)||pM(NM,e)||eL(r,e)})),r},hL=function(e){var t=e===qM,r=ZM(t?rL:mM(e)),n=[];return BM(r,(function(e){!pM(tL,e)||t&&!pM(qM,e)||eL(n,tL[e])})),n};hM||(XM=function(){if(vM(KM,this))throw WM("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?gM(arguments[0]):void 0,t=DM(e),r=function(e){this===qM&&cM(r,rL,e),pM(this,jM)&&pM(this[jM],t)&&(this[jM][t]=!1),oL(this,t,SM(1,e))};return lM&&iL&&oL(qM,t,{configurable:!0,set:r}),aL(t,e)},OM(KM=XM.prototype,"toString",(function(){return zM(this).tag})),OM(XM,"withoutSetter",(function(e){return aL(DM(e),e)})),CM.f=cL,AM.f=sL,wM.f=uL,RM.f=dL,kM.f=TM.f=lL,IM.f=hL,MM.f=function(e){return aL(PM(e),e)},lM&&(QM(KM,"description",{configurable:!0,get:function(){return zM(this).description}}),OM(qM,"propertyIsEnumerable",cL,{unsafe:!0}))),sM({global:!0,constructor:!0,wrap:!0,forced:!hM,sham:!hM},{Symbol:XM}),BM(EM(nL),(function(e){LM(e)})),sM({target:GM,stat:!0,forced:!hM},{useSetter:function(){iL=!0},useSimple:function(){iL=!1}}),sM({target:"Object",stat:!0,forced:!hM,sham:!lM},{create:function(e,t){return void 0===t?bM(e):uL(bM(e),t)},defineProperty:sL,defineProperties:uL,getOwnPropertyDescriptor:dL}),sM({target:"Object",stat:!0,forced:!hM},{getOwnPropertyNames:lL}),UM(),VM(XM,GM),NM[jM]=!0;var fL=it&&!!Symbol.for&&!!Symbol.keyFor,pL=ha,vL=Ke,_L=Pe,mL=es,yL=ue.exports,gL=fL,SL=yL("string-to-symbol-registry"),bL=yL("symbol-to-string-registry");pL({target:"Symbol",stat:!0,forced:!gL},{for:function(e){var t=mL(e);if(_L(SL,t))return SL[t];var r=vL("Symbol")(t);return SL[t]=r,bL[r]=t,r}});var EL=ha,kL=Pe,TL=Ht,IL=qt,RL=fL,AL=(0,ue.exports)("symbol-to-string-registry");EL({target:"Symbol",stat:!0,forced:!RL},{keyFor:function(e){if(!TL(e))throw TypeError(IL(e)+" is not a symbol");if(kL(AL,e))return AL[e]}});var wL=Vo,CL=xe;ha({target:"Object",stat:!0,forced:!it||ye((function(){wL.f(1)}))},{getOwnPropertySymbols:function(e){var t=wL.f;return t?t(CL(e)):[]}});var OL={exports:{}};!function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!=typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),u=r?r+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var u,c,d=this._events[s],l=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),l){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,n),!0;case 4:return d.fn.call(d.context,t,n,i),!0;case 5:return d.fn.call(d.context,t,n,i,o),!0;case 6:return d.fn.call(d.context,t,n,i,o,a),!0}for(c=1,u=new Array(l-1);c<l;c++)u[c-1]=arguments[c];d.fn.apply(d.context,u)}else{var h,f=d.length;for(c=0;c<f;c++)switch(d[c].once&&this.removeListener(e,d[c].fn,void 0,!0),l){case 1:d[c].fn.call(d[c].context);break;case 2:d[c].fn.call(d[c].context,t);break;case 3:d[c].fn.call(d[c].context,t,n);break;case 4:d[c].fn.call(d[c].context,t,n,i);break;default:if(!u)for(h=1,u=new Array(l-1);h<l;h++)u[h-1]=arguments[h];d[c].fn.apply(d[c].context,u)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var u=0,c=[],d=s.length;u<d;u++)(s[u].fn!==t||i&&!s[u].once||n&&s[u].context!==n)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s}(OL);var xL=OL.exports,NL="[VERTC]",DL=["#0050b3","#0050b3","#0050b3","#0050b3","#0050b3"],PL=!fP()&&window.location.search.includes("_rtc_debug_"),ML=function(){function e(t,r,n){c(this,e),h(this,"_indent",void 0),h(this,"_module",void 0),h(this,"_id",void 0),this._module=t,this._indent=r}return l(e,[{key:"print",value:function(e){var t;if(PL){for(var r="",n=0;n<this._indent;n++)r+="    ";for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];(t=console).log.apply(t,["%c".concat(NL).concat(r,"[").concat(this._module,".").concat(e,"] ").concat(o.shift()),"color:".concat(DL[this._indent],";")].concat(o))}}}]),e}(),LL=new ML("VERTC",0),UL=function(e){f(n,e);var t,r=g(n);function n(){return c(this,n),r.apply(this,arguments)}return l(n,[{key:"safeEmit",value:function(e){var t=this.listenerCount(e);try{for(var r,i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return(r=b(p(n.prototype),"emit",this)).call.apply(r,[this,e].concat(o))}catch(X$){return LL.print("safaEmit","safeEmit() | event listener threw an error [event:%s]:%o",e,X$),Boolean(t)}}},{key:"safeEmitAsPromise",value:(t=u(o().mark((function e(t){var r,n,i,a=this,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=s.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=s[i];return e.abrupt("return",new Promise((function(e,r){try{a.emit.apply(a,[t].concat(n,[e,r]))}catch(X$){LL.print("safeEmitAsPromise","safeEmitAsPromise() | event listener threw an error [event:%s]:%o",t,X$),r(X$)}})));case 2:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),n}(OL.exports.EventEmitter),VL=Pe,FL=function(e){return void 0!==e&&(VL(e,"value")||VL(e,"writable"))},BL=Ut,jL=kt,GL=Pt,HL=FL,zL=to,qL=_c;ha({target:"Reflect",stat:!0},{get:function e(t,r){var n,i,o=arguments.length<3?t:arguments[2];return GL(t)===o?t[r]:(n=zL.f(t,r))?HL(n)?n.value:void 0===n.get?void 0:BL(n.get,o):jL(i=qL(t))?e(i,r,o):void 0}});var XL=se,KL=wc;ha({global:!0},{Reflect:{}}),KL(XL.Reflect,"Reflect",!0);var WL=Ut,YL=Pt,JL=kt,QL=FL,ZL=gt,$L=to,eU=_c,tU=Gr;ha({target:"Reflect",stat:!0,forced:ye((function(){var e=function(){},t=ZL.f(new e,"a",{configurable:!0});return!1!==Reflect.set(e.prototype,"a",1,t)}))},{set:function e(t,r,n){var i,o,a,s=arguments.length<4?t:arguments[3],u=$L.f(YL(t),r);if(!u){if(JL(o=eU(t)))return e(o,r,n,s);u=tU(0)}if(QL(u)){if(!1===u.writable||!JL(s))return!1;if(i=$L.f(s,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=n,ZL.f(s,r,i)}else ZL.f(s,r,tU(0,n))}else{if(void 0===(a=u.set))return!1;WL(a,s,n)}return!0}});var rU=ha,nU=xe,iU=hi,oU=Fp,aU=Bv,sU=jp,uU=1!==[].unshift(0),cU=!function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(X$){return X$ instanceof TypeError}}();rU({target:"Array",proto:!0,arity:1,forced:uU||cU},{unshift:function(e){var t=nU(this),r=iU(t),n=arguments.length;if(n){sU(r+n);for(var i=r;i--;){var o=i+n;i in t?t[o]=t[i]:aU(t,o)}for(var a=0;a<n;a++)t[a]=arguments[a]}return oU(t,r+n)}}),(0,cR.exports)("Uint16",(function(e){return function(t,r,n){return e(this,t,r,n)}})),(0,cR.exports)("Int32",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var dU={};!function(e){var t="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!==a(n))throw new TypeError(n+"must be non-object");for(var i in n)r(n,i)&&(e[i]=n[i])}}return e},e.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,r,n,i){if(t.subarray&&e.subarray)e.set(t.subarray(r,r+n),i);else for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){var t,r,n,i,o,a;for(n=0,t=0,r=e.length;t<r;t++)n+=e[t].length;for(a=new Uint8Array(n),i=0,t=0,r=e.length;t<r;t++)o=e[t],a.set(o,i),i+=o.length;return a}},i={arraySet:function(e,t,r,n,i){for(var o=0;o<n;o++)e[i+o]=t[r+o]},flattenChunks:function(e){return[].concat.apply([],e)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,n)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,i))},e.setTyped(t)}(dU);var lU={},hU={},fU={},pU=dU;function vU(e){for(var t=e.length;--t>=0;)e[t]=0}var _U=256,mU=286,yU=30,gU=15,SU=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],bU=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],EU=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],kU=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],TU=new Array(576);vU(TU);var IU=new Array(60);vU(IU);var RU=new Array(512);vU(RU);var AU=new Array(256);vU(AU);var wU=new Array(29);vU(wU);var CU,OU,xU,NU=new Array(yU);function DU(e,t,r,n,i){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=e&&e.length}function PU(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function MU(e){return e<256?RU[e]:RU[256+(e>>>7)]}function LU(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function UU(e,t,r){e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,LU(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)}function VU(e,t,r){UU(e,r[2*t],r[2*t+1])}function FU(e,t){var r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1}function BU(e,t,r){var n,i,o=new Array(16),a=0;for(n=1;n<=gU;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=t;i++){var s=e[2*i+1];0!==s&&(e[2*i]=FU(o[s]++,s))}}function jU(e){var t;for(t=0;t<mU;t++)e.dyn_ltree[2*t]=0;for(t=0;t<yU;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function GU(e){e.bi_valid>8?LU(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function HU(e,t,r,n){var i=2*t,o=2*r;return e[i]<e[o]||e[i]===e[o]&&n[t]<=n[r]}function zU(e,t,r){for(var n=e.heap[r],i=r<<1;i<=e.heap_len&&(i<e.heap_len&&HU(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!HU(t,n,e.heap[i],e.depth));)e.heap[r]=e.heap[i],r=i,i<<=1;e.heap[r]=n}function qU(e,t,r){var n,i,o,a,s=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],i=e.pending_buf[e.l_buf+s],s++,0===n?VU(e,i,t):(VU(e,(o=AU[i])+_U+1,t),0!==(a=SU[o])&&UU(e,i-=wU[o],a),VU(e,o=MU(--n),r),0!==(a=bU[o])&&UU(e,n-=NU[o],a))}while(s<e.last_lit);VU(e,256,t)}function XU(e,t){var r,n,i,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,u=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,r=0;r<u;r++)0!==o[2*r]?(e.heap[++e.heap_len]=c=r,e.depth[r]=0):o[2*r+1]=0;for(;e.heap_len<2;)o[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,s&&(e.static_len-=a[2*i+1]);for(t.max_code=c,r=e.heap_len>>1;r>=1;r--)zU(e,o,r);i=u;do{r=e.heap[1],e.heap[1]=e.heap[e.heap_len--],zU(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=r,e.heap[--e.heap_max]=n,o[2*i]=o[2*r]+o[2*n],e.depth[i]=(e.depth[r]>=e.depth[n]?e.depth[r]:e.depth[n])+1,o[2*r+1]=o[2*n+1]=i,e.heap[1]=i++,zU(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var r,n,i,o,a,s,u=t.dyn_tree,c=t.max_code,d=t.stat_desc.static_tree,l=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,v=0;for(o=0;o<=gU;o++)e.bl_count[o]=0;for(u[2*e.heap[e.heap_max]+1]=0,r=e.heap_max+1;r<573;r++)(o=u[2*u[2*(n=e.heap[r])+1]+1]+1)>p&&(o=p,v++),u[2*n+1]=o,n>c||(e.bl_count[o]++,a=0,n>=f&&(a=h[n-f]),s=u[2*n],e.opt_len+=s*(o+a),l&&(e.static_len+=s*(d[2*n+1]+a)));if(0!==v){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,v-=2}while(v>0);for(o=p;0!==o;o--)for(n=e.bl_count[o];0!==n;)(i=e.heap[--r])>c||(u[2*i+1]!==o&&(e.opt_len+=(o-u[2*i+1])*u[2*i],u[2*i+1]=o),n--)}}(e,t),BU(o,c,e.bl_count)}function KU(e,t,r){var n,i,o=-1,a=t[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),t[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=t[2*(n+1)+1],++s<u&&i===a||(s<c?e.bl_tree[2*i]+=s:0!==i?(i!==o&&e.bl_tree[2*i]++,e.bl_tree[32]++):s<=10?e.bl_tree[34]++:e.bl_tree[36]++,s=0,o=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4))}function WU(e,t,r){var n,i,o=-1,a=t[1],s=0,u=7,c=4;for(0===a&&(u=138,c=3),n=0;n<=r;n++)if(i=a,a=t[2*(n+1)+1],!(++s<u&&i===a)){if(s<c)do{VU(e,i,e.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(VU(e,i,e.bl_tree),s--),VU(e,16,e.bl_tree),UU(e,s-3,2)):s<=10?(VU(e,17,e.bl_tree),UU(e,s-3,3)):(VU(e,18,e.bl_tree),UU(e,s-11,7));s=0,o=i,0===a?(u=138,c=3):i===a?(u=6,c=3):(u=7,c=4)}}vU(NU);var YU=!1;function JU(e,t,r,n){UU(e,0+(n?1:0),3),function(e,t,r,n){GU(e),n&&(LU(e,r),LU(e,~r)),pU.arraySet(e.pending_buf,e.window,t,r,e.pending),e.pending+=r}(e,t,r,!0)}fU._tr_init=function(e){YU||(!function(){var e,t,r,n,i,o=new Array(16);for(r=0,n=0;n<28;n++)for(wU[n]=r,e=0;e<1<<SU[n];e++)AU[r++]=n;for(AU[r-1]=n,i=0,n=0;n<16;n++)for(NU[n]=i,e=0;e<1<<bU[n];e++)RU[i++]=n;for(i>>=7;n<yU;n++)for(NU[n]=i<<7,e=0;e<1<<bU[n]-7;e++)RU[256+i++]=n;for(t=0;t<=gU;t++)o[t]=0;for(e=0;e<=143;)TU[2*e+1]=8,e++,o[8]++;for(;e<=255;)TU[2*e+1]=9,e++,o[9]++;for(;e<=279;)TU[2*e+1]=7,e++,o[7]++;for(;e<=287;)TU[2*e+1]=8,e++,o[8]++;for(BU(TU,287,o),e=0;e<yU;e++)IU[2*e+1]=5,IU[2*e]=FU(e,5);CU=new DU(TU,SU,257,mU,gU),OU=new DU(IU,bU,0,yU,gU),xU=new DU(new Array(0),EU,0,19,7)}(),YU=!0),e.l_desc=new PU(e.dyn_ltree,CU),e.d_desc=new PU(e.dyn_dtree,OU),e.bl_desc=new PU(e.bl_tree,xU),e.bi_buf=0,e.bi_valid=0,jU(e)},fU._tr_stored_block=JU,fU._tr_flush_block=function(e,t,r,n){var i,o,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<_U;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),XU(e,e.l_desc),XU(e,e.d_desc),a=function(e){var t;for(KU(e,e.dyn_ltree,e.l_desc.max_code),KU(e,e.dyn_dtree,e.d_desc.max_code),XU(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*kU[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=i&&(i=o)):i=o=r+5,r+4<=i&&-1!==t?JU(e,t,r,n):4===e.strategy||o===i?(UU(e,2+(n?1:0),3),qU(e,TU,IU)):(UU(e,4+(n?1:0),3),function(e,t,r,n){var i;for(UU(e,t-257,5),UU(e,r-1,5),UU(e,n-4,4),i=0;i<n;i++)UU(e,e.bl_tree[2*kU[i]+1],3);WU(e,e.dyn_ltree,t-1),WU(e,e.dyn_dtree,r-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),qU(e,e.dyn_ltree,e.dyn_dtree)),jU(e),n&&GU(e)},fU._tr_tally=function(e,t,r){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(AU[r]+_U+1)]++,e.dyn_dtree[2*MU(t)]++),e.last_lit===e.lit_bufsize-1},fU._tr_align=function(e){UU(e,2,3),VU(e,256,TU),function(e){16===e.bi_valid?(LU(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)};var QU=function(e,t,r,n){for(var i=65535&e|0,o=e>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+t[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0};var ZU=function(){for(var e,t=[],r=0;r<256;r++){e=r;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t}();var $U,eV=function(e,t,r,n){var i=ZU,o=n+r;e^=-1;for(var a=n;a<o;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},tV={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},rV=dU,nV=fU,iV=QU,oV=eV,aV=tV,sV=-2,uV=258,cV=262,dV=103,lV=113,hV=666;function fV(e,t){return e.msg=aV[t],t}function pV(e){return(e<<1)-(e>4?9:0)}function vV(e){for(var t=e.length;--t>=0;)e[t]=0}function _V(e){var t=e.state,r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(rV.arraySet(e.output,t.pending_buf,t.pending_out,r,e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))}function mV(e,t){nV._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_V(e.strm)}function yV(e,t){e.pending_buf[e.pending++]=t}function gV(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function SV(e,t){var r,n,i=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,u=e.strstart>e.w_size-cV?e.strstart-(e.w_size-cV):0,c=e.window,d=e.w_mask,l=e.prev,h=e.strstart+uV,f=c[o+a-1],p=c[o+a];e.prev_length>=e.good_match&&(i>>=2),s>e.lookahead&&(s=e.lookahead);do{if(c[(r=t)+a]===p&&c[r+a-1]===f&&c[r]===c[o]&&c[++r]===c[o+1]){o+=2,r++;do{}while(c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&c[++o]===c[++r]&&o<h);if(n=uV-(h-o),o=h-uV,n>a){if(e.match_start=t,a=n,n>=s)break;f=c[o+a-1],p=c[o+a]}}}while((t=l[t&d])>u&&0!=--i);return a<=e.lookahead?a:e.lookahead}function bV(e){var t,r,n,i,o,a,s,u,c,d,l=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=l+(l-cV)){rV.arraySet(e.window,e.window,l,l,0),e.match_start-=l,e.strstart-=l,e.block_start-=l,t=r=e.hash_size;do{n=e.head[--t],e.head[t]=n>=l?n-l:0}while(--r);t=r=l;do{n=e.prev[--t],e.prev[t]=n>=l?n-l:0}while(--r);i+=l}if(0===e.strm.avail_in)break;if(a=e.strm,s=e.window,u=e.strstart+e.lookahead,c=i,d=void 0,(d=a.avail_in)>c&&(d=c),r=0===d?0:(a.avail_in-=d,rV.arraySet(s,a.input,a.next_in,d,u),1===a.state.wrap?a.adler=iV(a.adler,s,d,u):2===a.state.wrap&&(a.adler=oV(a.adler,s,d,u)),a.next_in+=d,a.total_in+=d,d),e.lookahead+=r,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+3-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<cV&&0!==e.strm.avail_in)}function EV(e,t){for(var r,n;;){if(e.lookahead<cV){if(bV(e),e.lookahead<cV&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-cV&&(e.match_length=SV(e,r)),e.match_length>=3)if(n=nV._tr_tally(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=nV._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(mV(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(mV(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(mV(e,!1),0===e.strm.avail_out)?1:2}function kV(e,t){for(var r,n,i;;){if(e.lookahead<cV){if(bV(e),e.lookahead<cV&&0===t)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-cV&&(e.match_length=SV(e,r),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,n=nV._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,n&&(mV(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((n=nV._tr_tally(e,0,e.window[e.strstart-1]))&&mV(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=nV._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(mV(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(mV(e,!1),0===e.strm.avail_out)?1:2}function TV(e,t,r,n,i){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=n,this.func=i}function IV(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new rV.Buf16(1146),this.dyn_dtree=new rV.Buf16(122),this.bl_tree=new rV.Buf16(78),vV(this.dyn_ltree),vV(this.dyn_dtree),vV(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new rV.Buf16(16),this.heap=new rV.Buf16(573),vV(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new rV.Buf16(573),vV(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function RV(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=2,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:lV,e.adler=2===t.wrap?0:1,t.last_flush=0,nV._tr_init(t),0):fV(e,sV)}function AV(e){var t,r=RV(e);return 0===r&&((t=e.state).window_size=2*t.w_size,vV(t.head),t.max_lazy_match=$U[t.level].max_lazy,t.good_match=$U[t.level].good_length,t.nice_match=$U[t.level].nice_length,t.max_chain_length=$U[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),r}function wV(e,t,r,n,i,o){if(!e)return sV;var a=1;if(-1===t&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),i<1||i>9||8!==r||n<8||n>15||t<0||t>9||o<0||o>4)return fV(e,sV);8===n&&(n=9);var s=new IV;return e.state=s,s.strm=e,s.wrap=a,s.gzhead=null,s.w_bits=n,s.w_size=1<<s.w_bits,s.w_mask=s.w_size-1,s.hash_bits=i+7,s.hash_size=1<<s.hash_bits,s.hash_mask=s.hash_size-1,s.hash_shift=~~((s.hash_bits+3-1)/3),s.window=new rV.Buf8(2*s.w_size),s.head=new rV.Buf16(s.hash_size),s.prev=new rV.Buf16(s.w_size),s.lit_bufsize=1<<i+6,s.pending_buf_size=4*s.lit_bufsize,s.pending_buf=new rV.Buf8(s.pending_buf_size),s.d_buf=1*s.lit_bufsize,s.l_buf=3*s.lit_bufsize,s.level=t,s.strategy=o,s.method=r,AV(e)}$U=[new TV(0,0,0,0,(function(e,t){var r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(bV(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+r;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,mV(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-cV&&(mV(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(mV(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(mV(e,!1),e.strm.avail_out),1)})),new TV(4,4,8,4,EV),new TV(4,5,16,8,EV),new TV(4,6,32,32,EV),new TV(4,4,16,16,kV),new TV(8,16,32,32,kV),new TV(8,16,128,128,kV),new TV(8,32,128,256,kV),new TV(32,128,258,1024,kV),new TV(32,258,258,4096,kV)],hU.deflateInit=function(e,t){return wV(e,t,8,15,8,0)},hU.deflateInit2=wV,hU.deflateReset=AV,hU.deflateResetKeep=RV,hU.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?sV:(e.state.gzhead=t,0):sV},hU.deflate=function(e,t){var r,n,i,o;if(!e||!e.state||t>5||t<0)return e?fV(e,sV):sV;if(n=e.state,!e.output||!e.input&&0!==e.avail_in||n.status===hV&&4!==t)return fV(e,0===e.avail_out?-5:sV);if(n.strm=e,r=n.last_flush,n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,yV(n,31),yV(n,139),yV(n,8),n.gzhead?(yV(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),yV(n,255&n.gzhead.time),yV(n,n.gzhead.time>>8&255),yV(n,n.gzhead.time>>16&255),yV(n,n.gzhead.time>>24&255),yV(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),yV(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(yV(n,255&n.gzhead.extra.length),yV(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=oV(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(yV(n,0),yV(n,0),yV(n,0),yV(n,0),yV(n,0),yV(n,9===n.level?2:n.strategy>=2||n.level<2?4:0),yV(n,3),n.status=lV);else{var a=8+(n.w_bits-8<<4)<<8;a|=(n.strategy>=2||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(a|=32),a+=31-a%31,n.status=lV,gV(n,a),0!==n.strstart&&(gV(n,e.adler>>>16),gV(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(i=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>i&&(e.adler=oV(e.adler,n.pending_buf,n.pending-i,i)),_V(e),i=n.pending,n.pending!==n.pending_buf_size));)yV(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>i&&(e.adler=oV(e.adler,n.pending_buf,n.pending-i,i)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=oV(e.adler,n.pending_buf,n.pending-i,i)),_V(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,yV(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=oV(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){i=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>i&&(e.adler=oV(e.adler,n.pending_buf,n.pending-i,i)),_V(e),i=n.pending,n.pending===n.pending_buf_size)){o=1;break}o=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,yV(n,o)}while(0!==o);n.gzhead.hcrc&&n.pending>i&&(e.adler=oV(e.adler,n.pending_buf,n.pending-i,i)),0===o&&(n.status=dV)}else n.status=dV;if(n.status===dV&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&_V(e),n.pending+2<=n.pending_buf_size&&(yV(n,255&e.adler),yV(n,e.adler>>8&255),e.adler=0,n.status=lV)):n.status=lV),0!==n.pending){if(_V(e),0===e.avail_out)return n.last_flush=-1,0}else if(0===e.avail_in&&pV(t)<=pV(r)&&4!==t)return fV(e,-5);if(n.status===hV&&0!==e.avail_in)return fV(e,-5);if(0!==e.avail_in||0!==n.lookahead||0!==t&&n.status!==hV){var s=2===n.strategy?function(e,t){for(var r;;){if(0===e.lookahead&&(bV(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,r=nV._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(mV(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(mV(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(mV(e,!1),0===e.strm.avail_out)?1:2}(n,t):3===n.strategy?function(e,t){for(var r,n,i,o,a=e.window;;){if(e.lookahead<=uV){if(bV(e),e.lookahead<=uV&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=a[i=e.strstart-1])===a[++i]&&n===a[++i]&&n===a[++i]){o=e.strstart+uV;do{}while(n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&n===a[++i]&&i<o);e.match_length=uV-(o-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=nV._tr_tally(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=nV._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(mV(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(mV(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(mV(e,!1),0===e.strm.avail_out)?1:2}(n,t):$U[n.level].func(n,t);if(3!==s&&4!==s||(n.status=hV),1===s||3===s)return 0===e.avail_out&&(n.last_flush=-1),0;if(2===s&&(1===t?nV._tr_align(n):5!==t&&(nV._tr_stored_block(n,0,0,!1),3===t&&(vV(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),_V(e),0===e.avail_out))return n.last_flush=-1,0}return 4!==t?0:n.wrap<=0?1:(2===n.wrap?(yV(n,255&e.adler),yV(n,e.adler>>8&255),yV(n,e.adler>>16&255),yV(n,e.adler>>24&255),yV(n,255&e.total_in),yV(n,e.total_in>>8&255),yV(n,e.total_in>>16&255),yV(n,e.total_in>>24&255)):(gV(n,e.adler>>>16),gV(n,65535&e.adler)),_V(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?0:1)},hU.deflateEnd=function(e){var t;return e&&e.state?42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==dV&&t!==lV&&t!==hV?fV(e,sV):(e.state=null,t===lV?fV(e,-3):0):sV},hU.deflateSetDictionary=function(e,t){var r,n,i,o,a,s,u,c,d=t.length;if(!e||!e.state)return sV;if(2===(o=(r=e.state).wrap)||1===o&&42!==r.status||r.lookahead)return sV;for(1===o&&(e.adler=iV(e.adler,t,d,0)),r.wrap=0,d>=r.w_size&&(0===o&&(vV(r.head),r.strstart=0,r.block_start=0,r.insert=0),c=new rV.Buf8(r.w_size),rV.arraySet(c,t,d-r.w_size,r.w_size,0),t=c,d=r.w_size),a=e.avail_in,s=e.next_in,u=e.input,e.avail_in=d,e.next_in=0,e.input=t,bV(r);r.lookahead>=3;){n=r.strstart,i=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+3-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--i);r.strstart=n,r.lookahead=2,bV(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=s,e.input=u,e.avail_in=a,r.wrap=o,0},hU.deflateInfo="pako deflate (from Nodeca project)";var CV={},OV=dU,xV=!0,NV=!0;try{String.fromCharCode.apply(null,[0])}catch(K$){xV=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(K$){NV=!1}for(var DV=new OV.Buf8(256),PV=0;PV<256;PV++)DV[PV]=PV>=252?6:PV>=248?5:PV>=240?4:PV>=224?3:PV>=192?2:1;function MV(e,t){if(t<65534&&(e.subarray&&NV||!e.subarray&&xV))return String.fromCharCode.apply(null,OV.shrinkBuf(e,t));for(var r="",n=0;n<t;n++)r+=String.fromCharCode(e[n]);return r}DV[254]=DV[254]=1,CV.string2buf=function(e){var t,r,n,i,o,a=e.length,s=0;for(i=0;i<a;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),s+=r<128?1:r<2048?2:r<65536?3:4;for(t=new OV.Buf8(s),o=0,i=0;o<s;i++)55296==(64512&(r=e.charCodeAt(i)))&&i+1<a&&56320==(64512&(n=e.charCodeAt(i+1)))&&(r=65536+(r-55296<<10)+(n-56320),i++),r<128?t[o++]=r:r<2048?(t[o++]=192|r>>>6,t[o++]=128|63&r):r<65536?(t[o++]=224|r>>>12,t[o++]=128|r>>>6&63,t[o++]=128|63&r):(t[o++]=240|r>>>18,t[o++]=128|r>>>12&63,t[o++]=128|r>>>6&63,t[o++]=128|63&r);return t},CV.buf2binstring=function(e){return MV(e,e.length)},CV.binstring2buf=function(e){for(var t=new OV.Buf8(e.length),r=0,n=t.length;r<n;r++)t[r]=e.charCodeAt(r);return t},CV.buf2string=function(e,t){var r,n,i,o,a=t||e.length,s=new Array(2*a);for(n=0,r=0;r<a;)if((i=e[r++])<128)s[n++]=i;else if((o=DV[i])>4)s[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&r<a;)i=i<<6|63&e[r++],o--;o>1?s[n++]=65533:i<65536?s[n++]=i:(i-=65536,s[n++]=55296|i>>10&1023,s[n++]=56320|1023&i)}return MV(s,n)},CV.utf8border=function(e,t){var r;for((t=t||e.length)>e.length&&(t=e.length),r=t-1;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+DV[e[r]]>t?r:t};var LV=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},UV=hU,VV=dU,FV=CV,BV=tV,jV=LV,GV=Object.prototype.toString;function HV(e){if(!(this instanceof HV))return new HV(e);this.options=VV.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new jV,this.strm.avail_out=0;var r=UV.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(0!==r)throw new Error(BV[r]);if(t.header&&UV.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?FV.string2buf(t.dictionary):"[object ArrayBuffer]"===GV.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,0!==(r=UV.deflateSetDictionary(this.strm,n)))throw new Error(BV[r]);this._dict_set=!0}}function zV(e,t){var r=new HV(t);if(r.push(e,!0),r.err)throw r.msg||BV[r.err];return r.result}HV.prototype.push=function(e,t){var r,n,i=this.strm,o=this.options.chunkSize;if(this.ended)return!1;n=t===~~t?t:!0===t?4:0,"string"==typeof e?i.input=FV.string2buf(e):"[object ArrayBuffer]"===GV.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;do{if(0===i.avail_out&&(i.output=new VV.Buf8(o),i.next_out=0,i.avail_out=o),1!==(r=UV.deflate(i,n))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==i.avail_out&&(0!==i.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(FV.buf2binstring(VV.shrinkBuf(i.output,i.next_out))):this.onData(VV.shrinkBuf(i.output,i.next_out)))}while((i.avail_in>0||0===i.avail_out)&&1!==r);return 4===n?(r=UV.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==n||(this.onEnd(0),i.avail_out=0,!0)},HV.prototype.onData=function(e){this.chunks.push(e)},HV.prototype.onEnd=function(e){0===e&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=VV.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},lU.Deflate=HV,lU.deflate=zV,lU.deflateRaw=function(e,t){return(t=t||{}).raw=!0,zV(e,t)},lU.gzip=function(e,t){return(t=t||{}).gzip=!0,zV(e,t)};var qV={},XV=St,KV=pg,WV=hs,YV=ye,JV=se.RegExp,QV=JV.prototype;XV&&YV((function(){var e=!0;try{JV(".","d")}catch(X$){e=!1}var t={},r="",n=e?"dgimsy":"gimsy",i=function(e,n){Object.defineProperty(t,e,{get:function(){return r+=n,!0}})},o={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var a in e&&(o.hasIndices="d"),o)i(a,o[a]);return Object.getOwnPropertyDescriptor(QV,"flags").get.call(t)!==n||r!==n}))&&KV(QV,"flags",{configurable:!0,get:WV});var ZV={},$V=dU,eF=15,tF=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],rF=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],nF=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],iF=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],oF=dU,aF=QU,sF=eV,uF=function(e,t){var r,n,i,o,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E,k,T,I,R;r=e.state,n=e.next_in,I=e.input,i=n+(e.avail_in-5),o=e.next_out,R=e.output,a=o-(t-e.avail_out),s=o+(e.avail_out-257),u=r.dmax,c=r.wsize,d=r.whave,l=r.wnext,h=r.window,f=r.hold,p=r.bits,v=r.lencode,_=r.distcode,m=(1<<r.lenbits)-1,y=(1<<r.distbits)-1;e:do{p<15&&(f+=I[n++]<<p,p+=8,f+=I[n++]<<p,p+=8),g=v[f&m];t:for(;;){if(f>>>=S=g>>>24,p-=S,0===(S=g>>>16&255))R[o++]=65535&g;else{if(!(16&S)){if(0==(64&S)){g=v[(65535&g)+(f&(1<<S)-1)];continue t}if(32&S){r.mode=12;break e}e.msg="invalid literal/length code",r.mode=30;break e}b=65535&g,(S&=15)&&(p<S&&(f+=I[n++]<<p,p+=8),b+=f&(1<<S)-1,f>>>=S,p-=S),p<15&&(f+=I[n++]<<p,p+=8,f+=I[n++]<<p,p+=8),g=_[f&y];r:for(;;){if(f>>>=S=g>>>24,p-=S,!(16&(S=g>>>16&255))){if(0==(64&S)){g=_[(65535&g)+(f&(1<<S)-1)];continue r}e.msg="invalid distance code",r.mode=30;break e}if(E=65535&g,p<(S&=15)&&(f+=I[n++]<<p,(p+=8)<S&&(f+=I[n++]<<p,p+=8)),(E+=f&(1<<S)-1)>u){e.msg="invalid distance too far back",r.mode=30;break e}if(f>>>=S,p-=S,E>(S=o-a)){if((S=E-S)>d&&r.sane){e.msg="invalid distance too far back",r.mode=30;break e}if(k=0,T=h,0===l){if(k+=c-S,S<b){b-=S;do{R[o++]=h[k++]}while(--S);k=o-E,T=R}}else if(l<S){if(k+=c+l-S,(S-=l)<b){b-=S;do{R[o++]=h[k++]}while(--S);if(k=0,l<b){b-=S=l;do{R[o++]=h[k++]}while(--S);k=o-E,T=R}}}else if(k+=l-S,S<b){b-=S;do{R[o++]=h[k++]}while(--S);k=o-E,T=R}for(;b>2;)R[o++]=T[k++],R[o++]=T[k++],R[o++]=T[k++],b-=3;b&&(R[o++]=T[k++],b>1&&(R[o++]=T[k++]))}else{k=o-E;do{R[o++]=R[k++],R[o++]=R[k++],R[o++]=R[k++],b-=3}while(b>2);b&&(R[o++]=R[k++],b>1&&(R[o++]=R[k++]))}break}}break}}while(n<i&&o<s);n-=b=p>>3,f&=(1<<(p-=b<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<i?i-n+5:5-(n-i),e.avail_out=o<s?s-o+257:257-(o-s),r.hold=f,r.bits=p},cF=function(e,t,r,n,i,o,a,s){var u,c,d,l,h,f,p,v,_,m=s.bits,y=0,g=0,S=0,b=0,E=0,k=0,T=0,I=0,R=0,A=0,w=null,C=0,O=new $V.Buf16(16),x=new $V.Buf16(16),N=null,D=0;for(y=0;y<=eF;y++)O[y]=0;for(g=0;g<n;g++)O[t[r+g]]++;for(E=m,b=eF;b>=1&&0===O[b];b--);if(E>b&&(E=b),0===b)return i[o++]=20971520,i[o++]=20971520,s.bits=1,0;for(S=1;S<b&&0===O[S];S++);for(E<S&&(E=S),I=1,y=1;y<=eF;y++)if(I<<=1,(I-=O[y])<0)return-1;if(I>0&&(0===e||1!==b))return-1;for(x[1]=0,y=1;y<eF;y++)x[y+1]=x[y]+O[y];for(g=0;g<n;g++)0!==t[r+g]&&(a[x[t[r+g]]++]=g);if(0===e?(w=N=a,f=19):1===e?(w=tF,C-=257,N=rF,D-=257,f=256):(w=nF,N=iF,f=-1),A=0,g=0,y=S,h=o,k=E,T=0,d=-1,l=(R=1<<E)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){p=y-T,a[g]<f?(v=0,_=a[g]):a[g]>f?(v=N[D+a[g]],_=w[C+a[g]]):(v=96,_=0),u=1<<y-T,S=c=1<<k;do{i[h+(A>>T)+(c-=u)]=p<<24|v<<16|_|0}while(0!==c);for(u=1<<y-1;A&u;)u>>=1;if(0!==u?(A&=u-1,A+=u):A=0,g++,0==--O[y]){if(y===b)break;y=t[r+a[g]]}if(y>E&&(A&l)!==d){for(0===T&&(T=E),h+=S,I=1<<(k=y-T);k+T<b&&!((I-=O[k+T])<=0);)k++,I<<=1;if(R+=1<<k,1===e&&R>852||2===e&&R>592)return 1;i[d=A&l]=E<<24|k<<16|h-o|0}}return 0!==A&&(i[h+A]=y-T<<24|64<<16|0),s.bits=E,0},dF=-2,lF=12,hF=30;function fF(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function pF(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new oF.Buf16(320),this.work=new oF.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function vF(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new oF.Buf32(852),t.distcode=t.distdyn=new oF.Buf32(592),t.sane=1,t.back=-1,0):dF}function _F(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,vF(e)):dF}function mF(e,t){var r,n;return e&&e.state?(n=e.state,t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?dF:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=r,n.wbits=t,_F(e))):dF}function yF(e,t){var r,n;return e?(n=new pF,e.state=n,n.window=null,0!==(r=mF(e,t))&&(e.state=null),r):dF}var gF,SF,bF=!0;function EF(e){if(bF){var t;for(gF=new oF.Buf32(512),SF=new oF.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(cF(1,e.lens,0,288,gF,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;cF(2,e.lens,0,32,SF,0,e.work,{bits:5}),bF=!1}e.lencode=gF,e.lenbits=9,e.distcode=SF,e.distbits=5}function kF(e,t,r,n){var i,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new oF.Buf8(o.wsize)),n>=o.wsize?(oF.arraySet(o.window,t,r-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((i=o.wsize-o.wnext)>n&&(i=n),oF.arraySet(o.window,t,r-n,i,o.wnext),(n-=i)?(oF.arraySet(o.window,t,r-n,n,0),o.wnext=n,o.whave=o.wsize):(o.wnext+=i,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=i))),0}ZV.inflateReset=_F,ZV.inflateReset2=mF,ZV.inflateResetKeep=vF,ZV.inflateInit=function(e){return yF(e,15)},ZV.inflateInit2=yF,ZV.inflate=function(e,t){var r,n,i,o,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E,k,T,I,R=0,A=new oF.Buf8(4),w=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return dF;(r=e.state).mode===lF&&(r.mode=13),a=e.next_out,i=e.output,u=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,c=r.hold,d=r.bits,l=s,h=u,k=0;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;d<16;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(2&r.wrap&&35615===c){r.check=0,A[0]=255&c,A[1]=c>>>8&255,r.check=sF(r.check,A,2,0),c=0,d=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",r.mode=hF;break}if(8!=(15&c)){e.msg="unknown compression method",r.mode=hF;break}if(d-=4,E=8+(15&(c>>>=4)),0===r.wbits)r.wbits=E;else if(E>r.wbits){e.msg="invalid window size",r.mode=hF;break}r.dmax=1<<E,e.adler=r.check=1,r.mode=512&c?10:lF,c=0,d=0;break;case 2:for(;d<16;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(r.flags=c,8!=(255&r.flags)){e.msg="unknown compression method",r.mode=hF;break}if(57344&r.flags){e.msg="unknown header flags set",r.mode=hF;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,r.check=sF(r.check,A,2,0)),c=0,d=0,r.mode=3;case 3:for(;d<32;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}r.head&&(r.head.time=c),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,A[2]=c>>>16&255,A[3]=c>>>24&255,r.check=sF(r.check,A,4,0)),c=0,d=0,r.mode=4;case 4:for(;d<16;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,r.check=sF(r.check,A,2,0)),c=0,d=0,r.mode=5;case 5:if(1024&r.flags){for(;d<16;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&(A[0]=255&c,A[1]=c>>>8&255,r.check=sF(r.check,A,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((f=r.length)>s&&(f=s),f&&(r.head&&(E=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),oF.arraySet(r.head.extra,n,o,f,E)),512&r.flags&&(r.check=sF(r.check,n,f,o)),s-=f,o+=f,r.length-=f),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===s)break e;f=0;do{E=n[o+f++],r.head&&E&&r.length<65536&&(r.head.name+=String.fromCharCode(E))}while(E&&f<s);if(512&r.flags&&(r.check=sF(r.check,n,f,o)),s-=f,o+=f,E)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===s)break e;f=0;do{E=n[o+f++],r.head&&E&&r.length<65536&&(r.head.comment+=String.fromCharCode(E))}while(E&&f<s);if(512&r.flags&&(r.check=sF(r.check,n,f,o)),s-=f,o+=f,E)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;d<16;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(c!==(65535&r.check)){e.msg="header crc mismatch",r.mode=hF;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=lF;break;case 10:for(;d<32;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}e.adler=r.check=fF(c),c=0,d=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=a,e.avail_out=u,e.next_in=o,e.avail_in=s,r.hold=c,r.bits=d,2;e.adler=r.check=1,r.mode=lF;case lF:if(5===t||6===t)break e;case 13:if(r.last){c>>>=7&d,d-=7&d,r.mode=27;break}for(;d<3;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}switch(r.last=1&c,d-=1,3&(c>>>=1)){case 0:r.mode=14;break;case 1:if(EF(r),r.mode=20,6===t){c>>>=2,d-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg="invalid block type",r.mode=hF}c>>>=2,d-=2;break;case 14:for(c>>>=7&d,d-=7&d;d<32;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",r.mode=hF;break}if(r.length=65535&c,c=0,d=0,r.mode=15,6===t)break e;case 15:r.mode=16;case 16:if(f=r.length){if(f>s&&(f=s),f>u&&(f=u),0===f)break e;oF.arraySet(i,n,o,f,a),s-=f,o+=f,u-=f,a+=f,r.length-=f;break}r.mode=lF;break;case 17:for(;d<14;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(r.nlen=257+(31&c),c>>>=5,d-=5,r.ndist=1+(31&c),c>>>=5,d-=5,r.ncode=4+(15&c),c>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg="too many length or distance symbols",r.mode=hF;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;d<3;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}r.lens[w[r.have++]]=7&c,c>>>=3,d-=3}for(;r.have<19;)r.lens[w[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,T={bits:r.lenbits},k=cF(0,r.lens,0,19,r.lencode,0,r.work,T),r.lenbits=T.bits,k){e.msg="invalid code lengths set",r.mode=hF;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;m=(R=r.lencode[c&(1<<r.lenbits)-1])>>>16&255,y=65535&R,!((_=R>>>24)<=d);){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(y<16)c>>>=_,d-=_,r.lens[r.have++]=y;else{if(16===y){for(I=_+2;d<I;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(c>>>=_,d-=_,0===r.have){e.msg="invalid bit length repeat",r.mode=hF;break}E=r.lens[r.have-1],f=3+(3&c),c>>>=2,d-=2}else if(17===y){for(I=_+3;d<I;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}d-=_,E=0,f=3+(7&(c>>>=_)),c>>>=3,d-=3}else{for(I=_+7;d<I;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}d-=_,E=0,f=11+(127&(c>>>=_)),c>>>=7,d-=7}if(r.have+f>r.nlen+r.ndist){e.msg="invalid bit length repeat",r.mode=hF;break}for(;f--;)r.lens[r.have++]=E}}if(r.mode===hF)break;if(0===r.lens[256]){e.msg="invalid code -- missing end-of-block",r.mode=hF;break}if(r.lenbits=9,T={bits:r.lenbits},k=cF(1,r.lens,0,r.nlen,r.lencode,0,r.work,T),r.lenbits=T.bits,k){e.msg="invalid literal/lengths set",r.mode=hF;break}if(r.distbits=6,r.distcode=r.distdyn,T={bits:r.distbits},k=cF(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,T),r.distbits=T.bits,k){e.msg="invalid distances set",r.mode=hF;break}if(r.mode=20,6===t)break e;case 20:r.mode=21;case 21:if(s>=6&&u>=258){e.next_out=a,e.avail_out=u,e.next_in=o,e.avail_in=s,r.hold=c,r.bits=d,uF(e,h),a=e.next_out,i=e.output,u=e.avail_out,o=e.next_in,n=e.input,s=e.avail_in,c=r.hold,d=r.bits,r.mode===lF&&(r.back=-1);break}for(r.back=0;m=(R=r.lencode[c&(1<<r.lenbits)-1])>>>16&255,y=65535&R,!((_=R>>>24)<=d);){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(m&&0==(240&m)){for(g=_,S=m,b=y;m=(R=r.lencode[b+((c&(1<<g+S)-1)>>g)])>>>16&255,y=65535&R,!(g+(_=R>>>24)<=d);){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}c>>>=g,d-=g,r.back+=g}if(c>>>=_,d-=_,r.back+=_,r.length=y,0===m){r.mode=26;break}if(32&m){r.back=-1,r.mode=lF;break}if(64&m){e.msg="invalid literal/length code",r.mode=hF;break}r.extra=15&m,r.mode=22;case 22:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;m=(R=r.distcode[c&(1<<r.distbits)-1])>>>16&255,y=65535&R,!((_=R>>>24)<=d);){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(0==(240&m)){for(g=_,S=m,b=y;m=(R=r.distcode[b+((c&(1<<g+S)-1)>>g)])>>>16&255,y=65535&R,!(g+(_=R>>>24)<=d);){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}c>>>=g,d-=g,r.back+=g}if(c>>>=_,d-=_,r.back+=_,64&m){e.msg="invalid distance code",r.mode=hF;break}r.offset=y,r.extra=15&m,r.mode=24;case 24:if(r.extra){for(I=r.extra;d<I;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg="invalid distance too far back",r.mode=hF;break}r.mode=25;case 25:if(0===u)break e;if(f=h-u,r.offset>f){if((f=r.offset-f)>r.whave&&r.sane){e.msg="invalid distance too far back",r.mode=hF;break}f>r.wnext?(f-=r.wnext,p=r.wsize-f):p=r.wnext-f,f>r.length&&(f=r.length),v=r.window}else v=i,p=a-r.offset,f=r.length;f>u&&(f=u),u-=f,r.length-=f;do{i[a++]=v[p++]}while(--f);0===r.length&&(r.mode=21);break;case 26:if(0===u)break e;i[a++]=r.length,u--,r.mode=21;break;case 27:if(r.wrap){for(;d<32;){if(0===s)break e;s--,c|=n[o++]<<d,d+=8}if(h-=u,e.total_out+=h,r.total+=h,h&&(e.adler=r.check=r.flags?sF(r.check,i,h,a-h):aF(r.check,i,h,a-h)),h=u,(r.flags?c:fF(c))!==r.check){e.msg="incorrect data check",r.mode=hF;break}c=0,d=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;d<32;){if(0===s)break e;s--,c+=n[o++]<<d,d+=8}if(c!==(4294967295&r.total)){e.msg="incorrect length check",r.mode=hF;break}c=0,d=0}r.mode=29;case 29:k=1;break e;case hF:k=-3;break e;case 31:return-4;default:return dF}return e.next_out=a,e.avail_out=u,e.next_in=o,e.avail_in=s,r.hold=c,r.bits=d,(r.wsize||h!==e.avail_out&&r.mode<hF&&(r.mode<27||4!==t))&&kF(e,e.output,e.next_out,h-e.avail_out),l-=e.avail_in,h-=e.avail_out,e.total_in+=l,e.total_out+=h,r.total+=h,r.wrap&&h&&(e.adler=r.check=r.flags?sF(r.check,i,h,e.next_out-h):aF(r.check,i,h,e.next_out-h)),e.data_type=r.bits+(r.last?64:0)+(r.mode===lF?128:0)+(20===r.mode||15===r.mode?256:0),(0===l&&0===h||4===t)&&0===k&&(k=-5),k},ZV.inflateEnd=function(e){if(!e||!e.state)return dF;var t=e.state;return t.window&&(t.window=null),e.state=null,0},ZV.inflateGetHeader=function(e,t){var r;return e&&e.state?0==(2&(r=e.state).wrap)?dF:(r.head=t,t.done=!1,0):dF},ZV.inflateSetDictionary=function(e,t){var r,n=t.length;return e&&e.state?0!==(r=e.state).wrap&&11!==r.mode?dF:11===r.mode&&aF(1,t,n,0)!==r.check?-3:kF(e,t,n,n)?(r.mode=31,-4):(r.havedict=1,0):dF},ZV.inflateInfo="pako inflate (from Nodeca project)";var TF={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};var IF=ZV,RF=dU,AF=CV,wF=TF,CF=tV,OF=LV,xF=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},NF=Object.prototype.toString;function DF(e){if(!(this instanceof DF))return new DF(e);this.options=RF.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new OF,this.strm.avail_out=0;var r=IF.inflateInit2(this.strm,t.windowBits);if(r!==wF.Z_OK)throw new Error(CF[r]);if(this.header=new xF,IF.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=AF.string2buf(t.dictionary):"[object ArrayBuffer]"===NF.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=IF.inflateSetDictionary(this.strm,t.dictionary))!==wF.Z_OK))throw new Error(CF[r])}function PF(e,t){var r=new DF(t);if(r.push(e,!0),r.err)throw r.msg||CF[r.err];return r.result}DF.prototype.push=function(e,t){var r,n,i,o,a,s=this.strm,u=this.options.chunkSize,c=this.options.dictionary,d=!1;if(this.ended)return!1;n=t===~~t?t:!0===t?wF.Z_FINISH:wF.Z_NO_FLUSH,"string"==typeof e?s.input=AF.binstring2buf(e):"[object ArrayBuffer]"===NF.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new RF.Buf8(u),s.next_out=0,s.avail_out=u),(r=IF.inflate(s,wF.Z_NO_FLUSH))===wF.Z_NEED_DICT&&c&&(r=IF.inflateSetDictionary(this.strm,c)),r===wF.Z_BUF_ERROR&&!0===d&&(r=wF.Z_OK,d=!1),r!==wF.Z_STREAM_END&&r!==wF.Z_OK)return this.onEnd(r),this.ended=!0,!1;s.next_out&&(0!==s.avail_out&&r!==wF.Z_STREAM_END&&(0!==s.avail_in||n!==wF.Z_FINISH&&n!==wF.Z_SYNC_FLUSH)||("string"===this.options.to?(i=AF.utf8border(s.output,s.next_out),o=s.next_out-i,a=AF.buf2string(s.output,i),s.next_out=o,s.avail_out=u-o,o&&RF.arraySet(s.output,s.output,i,o,0),this.onData(a)):this.onData(RF.shrinkBuf(s.output,s.next_out)))),0===s.avail_in&&0===s.avail_out&&(d=!0)}while((s.avail_in>0||0===s.avail_out)&&r!==wF.Z_STREAM_END);return r===wF.Z_STREAM_END&&(n=wF.Z_FINISH),n===wF.Z_FINISH?(r=IF.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===wF.Z_OK):n!==wF.Z_SYNC_FLUSH||(this.onEnd(wF.Z_OK),s.avail_out=0,!0)},DF.prototype.onData=function(e){this.chunks.push(e)},DF.prototype.onEnd=function(e){e===wF.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=RF.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},qV.Inflate=DF,qV.inflate=PF,qV.inflateRaw=function(e,t){return(t=t||{}).raw=!0,PF(e,t)},qV.ungzip=PF;var MF={};(0,dU.assign)(MF,lU,qV,TF);var LF=MF,UF=function(e){return e.RTC="rtc",e}(UF||{}),VF=function(e){return e.W_5="5",e}(VF||{}),FF=function(e){return e.IOS="ios",e.ANDROID="android",e.WEB="web",e.WINDOWS="windows",e.MAC="mac",e.LINUX="linux",e}(FF||{}),BF=function(e){return e.REQUEST="request",e.RESPONSE="response",e}(BF||{}),jF=function(e){return e.WEBSOCKET_RECONNECTING="websocket reconnecting",e.PEERCONNECTION_RECONNECTING="peerconnection reconnecting",e.DISCONNECTED="DISCONNECTED",e.LAN="LAN",e.WIFI="WIFI",e.W_2="2G",e.W_3="3G",e.W_4="4G",e.W_5="5G",e.UNKNOWN="UNKNOWN",e}(jF||{}),GF=function(e){return e.WEBSOCKET="websocket",e.NETWORKCHANGED="networkChanged",e.PEERCONNECTION="peerconnection",e}(GF||{}),HF=function(e){return e.WEBSOCKET_RECONNECTED="websocket reconnected",e.PEERCONNECTION_RECONNECTED="peerconnection reconnected",e}(HF||{}),zF=function(e){return e.WEBSOCKET="websocket",e.NETWORKCHANGED="networkChanged",e.PEERCONNECTION="peerconnection",e}(zF||{}),qF=function(e){return e.REQUEST="request",e.RESPONSE="response",e.KCP_REQUEST="kcp request",e.KCP_RESPONSE="kcp response",e.QUIC_REQUEST="quic request",e.QUIC_RESPONSE="quic response",e}(qF||{}),XF=function(e){return e.NEW="NEW",e.CHECKING="CHECKING",e.CONNECTED="CONNECTED",e.COMPLETED="COMPLETED",e.FAILED="FAILED",e.DISCONNECTED="DISCONNECTED",e.CLOSED="CLOSED",e.DATACHANNEL_CONNECTING="DATACHANNEL_CONNECTING",e.DATACHANNEL_OPEN="DATACHANNEL_OPEN",e.DATACHANNEL_CLOSING="DATACHANNEL_CLOSING",e.DATACHANNEL_CLOSED="DATACHANNEL_CLOSED",e}(XF||{}),KF=function(e){return e.SUCCEED="succeed",e.MESSAGE_ID_ERROR="message id error",e.ZIP_FAILED="zip failed",e.UNZIP_FAILED="unzip failed",e.MESSAGE_KEY_EMPTY="message key empty",e.MESSAGE_KEY_PARSE_FAILED="message key parse failed",e.MESSAGE_KEY_INVALID="message key invalid",e.ENCRYPT_FAILED="encrypt failed",e.DECRYPT_FAILED="decrypt failed",e.MESSAGE_TOO_BIG="message too big",e.INVALID_DATA="invalid data",e.MESSAGE_PARSE_FAILED="message parse failed",e}(KF||{}),WF=function(e){return e.UP="up",e.DOWN="down",e.DIRECT="direct",e}(WF||{}),YF=function(e){return e.UP="up",e.DOWN="down",e.PRE="pre",e}(YF||{}),JF=function(e){return e.UP="up",e.DOWN="down",e.PRE="pre",e}(JF||{}),QF=function(e){return e.W_0="0",e.W_1="1",e}(QF||{}),ZF=function(e){return e.UP="up",e.DOWN="down",e}(ZF||{}),$F=function(e){return e.ANSWER="answer",e.INCRANSWER="incranswer",e}($F||{}),eB=function(e){return e.UP="up",e.DOWN="down",e}(eB||{}),tB=function(e){return e.SUCCESS="success",e.FAIL="fail",e}(tB||{}),rB=function(e){return e.W_0="0",e.W_1="1",e}(rB||{}),nB=function(e){return e.LEAVE_ROOM="leave room",e.ACK_FAILED="ack failed",e.SET_ANSWER_SDP_FAILED="set answer sdp failed",e.ICE_FAILED="ice failed",e.STREAM_FAILED="stream failed",e.NETWORK_RECONNECTED="network reconnected",e.JOIN_ROOM_ACK_FAILED="join room ack failed",e.UNKNOWN="unknown",e}(nB||{}),iB=function(e){return e.SUCCESS="success",e.FAIL="fail",e.IGNORE="ignore",e}(iB||{}),oB=function(e){return e.LEAVE_ROOM="leave room",e.ACK_FAILED="ack failed",e.SET_ANSWER_SDP_FAILED="set answer sdp failed",e.ICE_FAILED="ice failed",e.STREAM_FAILED="stream failed",e.NETWORK_RECONNECTED="network reconnected",e.ON_STREAM_REMOVE="on stream remove",e.PUBLISH_MUTE="publish mute",e.UNKNOWN="unknown",e.ON_STREAM_REMOVE_CLIENT_UNPUBLISHED="on stream remove:client unpublished",e.ON_STREAM_REMOVE_PUBLISH_FAILED="on stream remove:publish failed",e.ON_STREAM_REMOVE_STREAM_REMOVED="on stream remove:stream removed",e.ON_STREAM_REMOVE_CLIENT_DISCONNECTED="on stream remove:client disconnected",e.ON_STREAM_REMOVE_CLIENT_REPUBLISH="on stream remove:client republish",e}(oB||{}),aB=function(e){return e.PLAYOUT_DEVICE_SWITCH="playout_device_switch",e.RECORD_DEVICE_SWITCH="record_device_switch",e.UNKNOWN="unknown",e}(aB||{}),sB=function(e){return e.BEGIN_SEND="begin_send",e.SENT_END="sent_end",e.BEGIN_RECV="begin_recv",e.RECV_END="recv_end",e}(sB||{}),uB=function(e){return e.AUDIO="audio",e.VIDEO="video",e.SCREEN_VIDEO="screen_video",e.SCREEN_AUDIO="screen_audio",e}(uB||{}),cB=function(e){return e.LOGIN="login",e.PUBLISHER="publisher",e.UNMUTE="unmute",e.ENABLE="enable",e.PUSH="push",e.PUBLISH="publish",e.ONDEMAND="ondemand",e.SUBSCRIBE="subscribe",e.PUSH_TRACK="push_track",e.REMOTE_UNMUTE="remote_unmute",e.P2P="p2p",e}(cB||{}),dB=function(e){return e.TIMEOUT="timeout",e.AUDIENCE="audience",e.MUTE="mute",e.DISABLE="disable",e.STOP_PUSH="stop_push",e.UNPUBLISH="unpublish",e.NO_DEMAND="no_demand",e.LEAVE_ROOM="leave_room",e.UNSUBSCRIBE="unsubscribe",e.REMOVE_TRACK="remove_track",e.REMOTE_MUTE="remote_mute",e.USER_LEAVE="user_leave",e}(dB||{}),lB=function(e){return e.BEGIN="begin",e.END="end",e}(lB||{}),hB=function(e){return e.BEGIN="begin",e.END="end",e}(hB||{}),fB=function(e){return e.LEAVE_ROOM="leave_room",e.ACK_FAILED="ack_failed",e.TOKEN_ERROR="token_error",e.SIGNALING_ERROR="signaling_error",e.TIMEOUT_10="timeout_10",e.TIMEOUT_60="timeout_60",e}(fB||{}),pB=function(e){return e.P2P="p2p",e.P2P_OUTSIDE_ROOM="p2p_outside_room",e.P2SERVER="p2server",e}(pB||{}),vB=function(e){return e.START="start",e.START_CAPTURE_RESULT="start_capture_result",e.STARTED="started",e.RUNNING_FAILED="running_failed",e.STOP="stop",e.STOPPED="stopped",e}(vB||{}),_B=function(e){return e.SUCCESS="success",e.CAMERA_DEVICE_NO_PERMISSION="camera_device_no_permission",e.CAMERA_DEVICE_BUSY="camera_device_busy",e.CAMERA_DEVICE_FAILURE="camera_device_failure",e.CAMERA_DEVICE_NOT_FOUND="camera_device_not_found",e.CAMERA_DEVICE_DISCONNECTED="camera_device_disconnected",e.TIMEOUT="timeout",e.ABORT="abort",e}(_B||{}),mB=function(){function e(t){c(this,e),h(this,"_event_key",void 0),h(this,"_device_id",void 0),h(this,"_rtc_app_id",void 0),h(this,"_product_line",void 0),h(this,"_report_version",void 0),h(this,"_os",void 0),h(this,"_rtc_sdk_version",void 0),h(this,"_rtc_timestamp",void 0),h(this,"_rtc_sdk_git_commit",void 0),h(this,"_report_id",void 0),h(this,"_connection_id",void 0),h(this,"_rtc_sid",void 0),h(this,"_engine_session_id",void 0),h(this,"_rtc_business_id",void 0),h(this,"_project_key",void 0),h(this,"_network_type",void 0),h(this,"_app_version",void 0),h(this,"_aid",void 0),h(this,"_device_model",void 0),h(this,"_device_brand",void 0),h(this,"_common_extra_info",void 0),h(this,"_had_selected_p2p",void 0),h(this,"_rtc_env_type",void 0),h(this,"_room_id",void 0),h(this,"_user_id",void 0),h(this,"_rtc_session_id",void 0),h(this,"_user_agent",void 0),h(this,"_auto_play_policy",void 0),h(this,"_platform",void 0),h(this,"_product",void 0),this.monitor=t}return l(e,[{key:"setStats",value:function(e){var t=this;Object.keys(e).forEach((function(r){t["_"+r]=e[r]})),this.monitor.StartUp()}},{key:"event_key",get:function(){return this._event_key}},{key:"device_id",get:function(){return this._device_id}},{key:"rtc_app_id",get:function(){return this._rtc_app_id}},{key:"product_line",get:function(){return this._product_line}},{key:"report_version",get:function(){return this._report_version}},{key:"os",get:function(){return this._os}},{key:"rtc_sdk_version",get:function(){return this._rtc_sdk_version}},{key:"rtc_timestamp",get:function(){return this._rtc_timestamp}},{key:"rtc_sdk_git_commit",get:function(){return this._rtc_sdk_git_commit}},{key:"report_id",get:function(){return this._report_id}},{key:"connection_id",get:function(){return this._connection_id}},{key:"rtc_sid",get:function(){return this._rtc_sid}},{key:"engine_session_id",get:function(){return this._engine_session_id}},{key:"rtc_business_id",get:function(){return this._rtc_business_id}},{key:"project_key",get:function(){return this._project_key}},{key:"network_type",get:function(){return this._network_type}},{key:"app_version",get:function(){return this._app_version}},{key:"aid",get:function(){return this._aid}},{key:"device_model",get:function(){return this._device_model}},{key:"device_brand",get:function(){return this._device_brand}},{key:"common_extra_info",get:function(){return this._common_extra_info}},{key:"had_selected_p2p",get:function(){return this._had_selected_p2p}},{key:"rtc_env_type",get:function(){return this._rtc_env_type}},{key:"room_id",get:function(){return this._room_id}},{key:"user_id",get:function(){return this._user_id}},{key:"rtc_session_id",get:function(){return this._rtc_session_id}},{key:"user_agent",get:function(){return this._user_agent}},{key:"auto_play_policy",get:function(){return this._auto_play_policy}},{key:"platform",get:function(){return this._platform||"web"}},{key:"product",get:function(){return this._product||"webrtc"}}]),e}(),yB=function(e){f(r,e);var t=g(r);function r(){var e;return c(this,r),h(m(e=t.call(this)),"report_id",void 0),h(m(e),"report_common",void 0),h(m(e),"modify_ids",void 0),h(m(e),"dataBuffer",void 0),h(m(e),"posting",void 0),h(m(e),"sucSendTimer",void 0),h(m(e),"preSucTime",void 0),h(m(e),"errSendTimer",void 0),h(m(e),"errSendDelay",void 0),h(m(e),"commonStats",void 0),e.report_id=0,e.dataBuffer=[],e.posting=!1,e.report_common={},e.modify_ids={},e.preSucTime=0,e.errSendDelay=100,e.commonStats=new mB(m(e)),fP()||window.addEventListener("beforeunload",(function(){clearTimeout(e.errSendTimer),clearTimeout(e.sucSendTimer),e.send(null,!0)})),e}return l(r,[{key:"push",value:function(e,t){t?this.send(e):(this.dataBuffer.push(e),!this.posting&&!this.errSendTimer&&Date.now()-this.preSucTime>2e3&&(clearTimeout(this.sucSendTimer),this.send()))}},{key:"unshift",value:function(e){this.dataBuffer=e.concat(this.dataBuffer)}},{key:"send",value:function(e,t){var r=this;if(e||this.dataBuffer.length){var n={data:e||this.dataBuffer.splice(0,4e3),header:this.report_common,from:"web",os:"web",version:"1"},i=new XMLHttpRequest;i.timeout=1e4,i.onreadystatechange=function(){if(4===i.readyState){var o;if(e||(r.posting=!1),200===i.status||304===i.status)try{o=JSON.parse(i.responseText)}catch(X$){}o&&0===o.StatusCode?e||t||r.sucSend():e?r.send(e):(r.unshift(n.data),t?r.send():r.errSend())}};var o=GB.LOG_SERVER_URL;if(i.open("POST",o,!0),e||(this.posting=!0),!fP()&&location.search.includes("_rtc_autotest_"))this.safeEmit("report_event",n),0!==this.dataBuffer.length?this.sucSend():this.posting=!1;else if(!fP()&&location.search.includes("_rtc_debug_"))i.send(JSON.stringify(n));else{var a=LF.gzip(JSON.stringify(n));i.setRequestHeader("Content-Encoding","gzip"),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),i.send(a)}}}},{key:"sucSend",value:function(){this.errSendDelay=100,this.preSucTime=Date.now(),this.sucSendTimer=setTimeout(this.send.bind(this),2e3)}},{key:"errSend",value:function(){var e=this;this.errSendTimer=setTimeout((function(){e.send(),e.errSendTimer=null}),this.errSendDelay),this.errSendDelay*=2}},{key:"StartUp",value:function(){var e=this.report_common,t=this.commonStats,r=t.event_key,n=t.device_id,i=t.rtc_app_id,o=t.product_line,a=t.report_version,s=t.os,u=t.rtc_sdk_version,c=t.rtc_timestamp,d=t.rtc_sdk_git_commit,l=t.report_id,h=t.rtc_sid,f=t.engine_session_id,p=t.rtc_business_id,v=t.project_key,_=t.network_type,m=t.app_version,y=t.aid,g=t.device_model,S=t.device_brand,b=t.common_extra_info,E=t.had_selected_p2p,k=t.rtc_env_type,T=t.user_agent,I=t.auto_play_policy,R=t.platform,A=t.product;Object.assign(e,{event_key:r,device_id:n,rtc_app_id:i,product_line:o,report_version:a,os:s,rtc_sdk_version:u,rtc_timestamp:c,rtc_sdk_git_commit:d,report_id:l,rtc_sid:h,engine_session_id:f,rtc_business_id:p,project_key:v,network_type:_,app_version:m,aid:y,device_model:g,device_brand:S,common_extra_info:b,had_selected_p2p:E,rtc_env_type:k,user_agent:T,auto_play_policy:I,platform:R,product:A}),this.commonStats.room_id&&(this.modify_ids.room_id=this.commonStats.room_id),this.commonStats.user_id&&(this.modify_ids.user_id=this.commonStats.user_id),this.commonStats.rtc_session_id&&(this.modify_ids.rtc_session_id=this.commonStats.rtc_session_id),this.commonStats.connection_id&&(this.modify_ids.connection_id=this.commonStats.connection_id)}},{key:"rtcSdkApiCall",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_sdk_api_call",report_id:this.report_id++,rtc_timestamp:Date.now(),sdk_api_name:e,error_code:t,message:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcSdkCallback",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_sdk_callback",report_id:this.report_id++,rtc_timestamp:Date.now(),sdk_callback_name:e,error_code:t,message:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcGetConfig",value:function(e,t,r,n,o,a,s){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=i(i({event_key:"rtc_get_config",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,elapse:r,host:n,type:o,config_id:a,enable_cloud_proxy:s},this.modify_ids),{},{common_extra_info:JSON.stringify(u)});this.push(c)}},{key:"rtcReconnect",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i(i({event_key:"rtc_reconnect",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,reconnect_id:r,reconnect_type:n},this.modify_ids),{},{common_extra_info:JSON.stringify(o)});this.push(a)}},{key:"rtcReconnected",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"rtc_reconnected",report_id:this.report_id++,rtc_timestamp:Date.now(),message:e,reconnect_type:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcGetAccess",value:function(e,t,r,n,o,a){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},u=i(i({event_key:"rtc_get_access",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,elapse:r,type:n,host:o,connect_session_id:a},this.modify_ids),{},{common_extra_info:JSON.stringify(s)});this.push(u)}},{key:"rtcPreIceState",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"rtc_pre_ice_state",report_id:this.report_id++,rtc_timestamp:Date.now(),message:e,ice_state:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcNodeChange",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_node_change",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,reason:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcSignalingMsgError",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_signaling_msg_error",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,reason:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcSignaling",value:function(e,t,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=i(i({event_key:"rtc_signaling",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,signaling_event:r,signaling_type:n,direction:o},this.modify_ids),{},{common_extra_info:JSON.stringify(a)});this.push(s)}},{key:"rtcJoinRoom",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i(i({event_key:"rtc_join_room",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,deviceModel:t,deviceManufacturer:r,elapse:n},this.modify_ids),{},{common_extra_info:JSON.stringify(o)});this.push(a)}},{key:"rtcLeaveRoom",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_leave_room",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,elapse:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcBeginCreateOffer",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_begin_create_offer",report_id:this.report_id++,rtc_timestamp:Date.now(),direction:e,stream_id:t,stream_user_id:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcCreateOffer",value:function(e,t,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=i(i({event_key:"rtc_create_offer",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,direction:t,stream_id:r,stream_user_id:n,elapse:o},this.modify_ids),{},{common_extra_info:JSON.stringify(a)});this.push(s)}},{key:"rtcSetDescription",value:function(e,t,r,n,o,a,s){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=i(i({event_key:"rtc_set_description",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,message:t,is_local:r,direction:n,stream_id:o,stream_user_id:a,elapse:s},this.modify_ids),{},{common_extra_info:JSON.stringify(u)});this.push(c)}},{key:"rtcRecvAnswer",value:function(e,t,r,n,o,a,s){var u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},c=i(i({event_key:"rtc_recv_answer",report_id:this.report_id++,rtc_timestamp:Date.now(),error_code:e,answer_type:t,sequence_id:r,message:n,direction:o,stream_id:a,stream_user_id:s},this.modify_ids),{},{common_extra_info:JSON.stringify(u)});this.push(c)}},{key:"firstRemoteAudioRender",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"first_remote_audio_render",report_id:this.report_id++,rtc_timestamp:Date.now(),stream_id:e,stream_user_id:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"firstRemoteVideoRender",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"first_remote_video_render",report_id:this.report_id++,rtc_timestamp:Date.now(),stream_id:e,stream_user_id:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcPublishStat",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i(i({event_key:"rtc_publish_stat",report_id:this.report_id++,rtc_timestamp:Date.now(),result:e,is_screen:t,start:r,message:n},this.modify_ids),{},{common_extra_info:JSON.stringify(o)});this.push(a)}},{key:"rtcSubscribeStat",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i(i({event_key:"rtc_subscribe_stat",report_id:this.report_id++,rtc_timestamp:Date.now(),result:e,start:t,message:r,stream_user_id:n},this.modify_ids),{},{common_extra_info:JSON.stringify(o)});this.push(a)}},{key:"rtcAudioDevice",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_audio_device",report_id:this.report_id++,rtc_timestamp:Date.now(),audio_event:e,message:t,error_code:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcMediaStatistics",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i(i(i({event_key:"rtc_media_statistics",report_id:this.report_id++,rtc_timestamp:Date.now()},e),t),this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcMessageStatistics",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=i(i({event_key:"rtc_message_statistics",report_id:this.report_id++,rtc_timestamp:Date.now(),dc_user_message:e,dc_room_message:t,media_server_ip:r},this.modify_ids),{},{common_extra_info:JSON.stringify(n)});this.push(o)}},{key:"rtcError",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"rtc_error",report_id:this.report_id++,rtc_timestamp:Date.now(),message:e,error_code:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcInvokeStatus",value:function(e,t,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=i(i({event_key:"rtc_invoke_status",report_id:this.report_id++,rtc_timestamp:Date.now(),message:e,error_code:t,sdk_api_name:r,stream_id:n,elapse:o},this.modify_ids),{},{common_extra_info:JSON.stringify(a),direction:a.direction});this.push(s)}},{key:"rtcFirstFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i(i(i({event_key:"rtc_first_frame",report_id:this.report_id++,rtc_timestamp:Date.now()},e),this.modify_ids),{},{common_extra_info:JSON.stringify(t)});this.push(r)}},{key:"rtcMuteRemote",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"rtc_mute_remote",report_id:this.report_id++,rtc_timestamp:Date.now(),mute_info:e,media_type:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"sdkInitEngine",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"sdk_init_engine",report_id:this.report_id++,rtc_timestamp:Date.now(),start:e,type:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"joinRoom",value:function(e,t,r,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},a=i(i({event_key:"join_room",report_id:this.report_id++,rtc_timestamp:Date.now(),type:e,start:t,result:r,reason:n},this.modify_ids),{},{common_extra_info:JSON.stringify(o)});this.push(a)}},{key:"p2pConnectionStatus",value:function(e,t,r,n,o){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},s=i(i({event_key:"p2p_connection_status",report_id:this.report_id++,rtc_timestamp:Date.now(),room_id:e,user_id:t,peer_user_id:r,status:n,elapse:o},this.modify_ids),{},{common_extra_info:JSON.stringify(a)});this.push(s)}},{key:"p2pConnectClosed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i(i({event_key:"p2p_connect_closed",report_id:this.report_id++,rtc_timestamp:Date.now(),p2p_selected:e},this.modify_ids),{},{common_extra_info:JSON.stringify(t)});this.push(r)}},{key:"rtcDeviceError",value:function(e,t,r,n,o,a,s,u,c,d,l,h,f,p,v,_){var m=arguments.length>16&&void 0!==arguments[16]?arguments[16]:{},y=i(i({event_key:"rtc_device_error",report_id:this.report_id++,rtc_timestamp:Date.now(),device_type:e,device_stage:t,error_code:r,system_error_code:n,system_api:o,call_parameters:a,location:s,message:u,media_device_id:c,media_device_name:d,elapse:l,scenario:h,event_session_id:f,device_pid:p,device_vid:v,media_mode:_},this.modify_ids),{},{common_extra_info:JSON.stringify(m)});this.push(y)}},{key:"rtcVideoDevice",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i({event_key:"rtc_video_device",report_id:this.report_id++,rtc_timestamp:Date.now(),media_device_id:e,media_device_name:t},this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcVideoCaptureEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=i(i(i({event_key:"rtc_video_capture_event",report_id:this.report_id++,rtc_timestamp:Date.now()},e),this.modify_ids),{},{common_extra_info:JSON.stringify(t)});this.push(r)}},{key:"rtcEncodeFirstFrame",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i(i(i({event_key:"rtc_encode_first_frame",report_id:this.report_id++,rtc_timestamp:Date.now()},e),t),this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcFirstFrameEncoded",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i(i(i({event_key:"rtc_first_frame_encoded",report_id:this.report_id++,rtc_timestamp:Date.now()},e),t),this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcSendFirstPacket",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i(i(i({event_key:"rtc_send_first_packet",report_id:this.report_id++,rtc_timestamp:Date.now()},e),t),this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcRecvFirstPacket",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i(i(i({event_key:"rtc_recv_first_packet",report_id:this.report_id++,rtc_timestamp:Date.now()},e),t),this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcRecvFirstFrame",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i(i(i({event_key:"rtc_recv_first_frame",report_id:this.report_id++,rtc_timestamp:Date.now()},e),t),this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}},{key:"rtcDecodeFirstFrame",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i(i(i(i({event_key:"rtc_decode_first_frame",report_id:this.report_id++,rtc_timestamp:Date.now()},e),t),this.modify_ids),{},{common_extra_info:JSON.stringify(r)});this.push(n)}}]),r}(UL),gB=new yB,SB=new yB,bB=new yB,EB=gB.commonStats,kB=SB.commonStats,TB=bB.commonStats,IB={default:gB,rtm:SB,outsideRoom:bB};function RB(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"default",t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return function(t,n,i){if("function"==typeof i.value){var o=i.value;i.value=function(){for(var t=arguments.length,i=new Array(t),a=0;a<t;a++)i[a]=arguments[a];var s={};r.forEach((function(e,t){s[e]=i[t]})),"joinRoom"===n&&EB.setStats({room_id:i[1]}),IB[e].rtcSdkApiCall(n,0,JSON.stringify(kP(i)),s);var u=o.apply(this,i);return"function"==typeof(null==u?void 0:u.then)?u.then((function(t){return IB[e].rtcSdkCallback(n,0,JSON.stringify(kP([t||{}]))),t})).catch((function(t){throw IB[e].rtcSdkCallback(n,t.code,JSON.stringify(t.message)),t})):(IB[e].rtcSdkCallback(n,0,JSON.stringify(kP([u||{}]))),u)}}}}function AB(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=e===ie.onUserMessageReceivedOutsideRoom||e===ie.onUserBinaryMessageReceivedOutsideRoom;(n?SB:gB).rtcSdkCallback(e,r,JSON.stringify(t))}function wB(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(n?SB:gB).rtcInvokeStatus(JSON.stringify(t),r,e,"",0)}var CB="VolcEngine",OB="RTC_DEVICE_ID",xB="RTC_ACCESS_NODE",NB="RTC_ACCESS_URLS",DB="RTC_H264_BLACK_LIST",PB="engine_BAC",MB=function(){function e(){c(this,e)}return l(e,[{key:"get",value:function(e){var t=localStorage.getItem(e);if(!t)return null;try{var r=JSON.parse(t);return r.ttl>0&&Date.now()-r.saveTime>r.ttl?(this.delete(e),null):r.message}catch(n){return null}}},{key:"set",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n={ttl:r,saveTime:Date.now(),message:t};try{return localStorage.setItem(e,JSON.stringify(n)),!0}catch(i){return!1}}},{key:"delete",value:function(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}}]),e}(),LB=function(e){f(r,e);var t=g(r);function r(){return c(this,r),t.apply(this,arguments)}return l(r,[{key:"getDeviceId",value:function(){if(fP())return"";var e=this.get(OB);return e&&!/^[0-9a-f]{8}(-[0-9a-f]{4}){3}-[0-9a-f]{12}$/.test(e)||(e=function(e){for(var t="",r=0;r<e;r++)t+=Math.floor(10*Math.random());return t}(30)),this.setDeviceId(e),e}},{key:"setDeviceId",value:function(e){return[EB,kB,TB].forEach((function(t){return t.setStats({device_id:e})})),this.set(OB,e),e}},{key:"getAccessNode",value:function(e){return this.get("".concat(xB,"_").concat(e,"-").concat(CB))}},{key:"setAccessNode",value:function(e,t,r){return this.set("".concat(xB,"_").concat(e,"-").concat(CB),t,1e3*r)}},{key:"clearAccessNode",value:function(e){this.delete("".concat(xB,"_").concat(e,"-").concat(CB))}},{key:"getAccessUrls",value:function(){return this.get("".concat(NB,"-").concat(CB))}},{key:"setAccessUrls",value:function(e){var t=e.map((function(e){var t=e.host,r=e.path;return"https://".concat(t).concat(r)}));return this.set("".concat(NB,"-").concat(CB),t)}},{key:"clearAccessUrls",value:function(){this.delete("".concat(NB,"-").concat(CB))}},{key:"getH264BlackList",value:function(){return this.get(DB)}},{key:"setH264BlackList",value:function(e){return this.set(DB,e)}},{key:"getAudioProfile",value:function(){return this.get(PB)}},{key:"setAudioProfile",value:function(e){return this.set(PB,e)}}]),r}(MB),UB=new LB,VB="access.rtc.volcvideo.com,access2-hl.rtc.volcvideo.com,rtcg-access.volcvideos.com".split(",");function FB(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://"+e),"".concat(e,"/dispatch/v1/AccessInfo?Action=GetAccessInfo")}var BB="https://web-log-report.rtc.volcvideo.com/video/v1/webrtc_log/",jB="common.rtc.volcvideo.com,rtcg.volcvideos.com".split(","),GB={VERSION:"4.47.6",ICE_CONFIG_REQUEST_URLS_INTERNAL:VB.map(FB),ICE_CONFIG_REQUEST_URLS:[],EXPECTED_ADDR:"",LOG_SERVER_URL:BB,CONFIG_REQUEST_DOMAINS:jB,DEVICE_ID:"",OVERSEA:!1,PLATFORM:"",PRODUCT:""};function HB(e,t){if(gB.rtcSdkApiCall("setParameter",0,"key: ".concat(e,", value: ").concat(t)),"VERSION"!==e)return"ICE_CONFIG_REQUEST_URLS"===e?("string"==typeof t&&(t=[t]),void(GB.ICE_CONFIG_REQUEST_URLS=t.map(FB))):void("PLATFORM"!==e||"string"!=typeof t?"PRODUCT"!==e||"string"!=typeof t?"LOG_SERVER_URL"!==e||t!==G.overseas?"LOG_SERVER_URL"!==e||t!==G.domestic?"LOG_SERVER_URL"!==e||"string"!=typeof t?"OVERSEA"!==e?("DEVICE_ID"===e&&UB.setDeviceId(t),GB[e]=t):GB.OVERSEA=t:GB.LOG_SERVER_URL=t:GB.LOG_SERVER_URL=BB:GB.LOG_SERVER_URL="https://web-log-report.volcvideos.com/video/v1/webrtc_log//":EB.setStats({product:t}):EB.setStats({platform:t}))}function zB(e){return"DEVICE_ID"===e?UB.getDeviceId():GB[e]}function qB(e,t){var r,n,i,o,a,s,u,c,d,l,h,f,p,v,_,m,y;return{type:"transcode",action:e,transcodeMeta:{transcode:{url:t.url},control:{protocol:"2.0"},audio:{codec:(null===(r=t.audio)||void 0===r?void 0:r.codec)||WB.audio.codec,bitRate:1e3*((null===(n=t.audio)||void 0===n?void 0:n.kBitRate)||WB.audio.kBitRate),sampleRate:1e3*((null===(i=t.audio)||void 0===i?void 0:i.sampleRate)||WB.audio.sampleRate),channels:(null===(o=t.audio)||void 0===o?void 0:o.channels)||WB.audio.channels,profile:(null===(a=t.audio)||void 0===a?void 0:a.AACProfile)||WB.audio.AACProfile},video:{codec:(null===(s=t.video)||void 0===s?void 0:s.codec)||WB.video.codec,fps:(null===(u=t.video)||void 0===u?void 0:u.fps)||WB.video.fps,gop:(null===(c=t.video)||void 0===c?void 0:c.gop)||WB.video.gop,lowLatency:null!==(d=null===(l=t.video)||void 0===l?void 0:l.lowLatency)&&void 0!==d?d:WB.video.lowLatency,bitRate:1e3*((null===(h=t.video)||void 0===h?void 0:h.kBitRate)||WB.video.kBitRate),width:(null===(f=t.video)||void 0===f?void 0:f.width)||WB.video.width,height:(null===(p=t.video)||void 0===p?void 0:p.height)||WB.video.height},layout:{canvas:{bgnd:(null===(v=t.layout)||void 0===v?void 0:v.backgroundColor)||WB.layout.backgroundColor},regions:(null===(_=t.layout)||void 0===_||null===(m=_.regions)||void 0===m?void 0:m.map((function(e){return{alpha:Math.min(Math.max(+e.alpha,0),1),uid:e.userId,zorder:e.zorder,x:Math.min(Math.max(+e.x,0),1),y:Math.min(Math.max(+e.y,0),1),w:Math.min(Math.max(+e.w,0),1),h:Math.min(Math.max(+e.h,0),1),renderMode:e.renderMode||1,contentControl:e.contentControl||0,screen:e.isScreenStream,local_user:e.isLocalUser}})))||[],app_data:(null===(y=t.layout)||void 0===y?void 0:y.appData)||WB.layout.appData}}}}function XB(e,t,r){var n,i,o,a,s,u,c,d,l;return{type:"publicstream",action:t,publicStreamID:e,publicStreamMeta:{audio:{},video:{fps:(null===(n=r.video)||void 0===n?void 0:n.fps)||15,bitrate:1e3*((null===(i=r.video)||void 0===i?void 0:i.kBitRate)||40),width:(null===(o=r.video)||void 0===o?void 0:o.width)||640,height:(null===(a=r.video)||void 0===a?void 0:a.height)||360},layout:{layoutMode:2,interpolationMode:(null===(s=r.layout)||void 0===s?void 0:s.interpolationMode)||q.PREV_FRAME,canvas:{bgColor:(null===(u=r.layout)||void 0===u?void 0:u.backgroundColor)||"#000000",bgImage:(null===(c=r.layout)||void 0===c?void 0:c.backgroundImage)||""},regions:(null===(d=r.layout)||void 0===d||null===(l=d.regions)||void 0===l?void 0:l.map((function(e){return{roomId:e.roomId,userId:e.userId,alterImage:e.alertImage||"",alpha:e.alpha,x:Math.min(Math.max(+e.x,0),1),y:Math.min(Math.max(+e.y,0),1),w:Math.min(Math.max(+e.w,0),1),h:Math.min(Math.max(+e.h,0),1),zorder:e.zorder,renderMode:void 0===e.renderMode?1:e.renderMode,streamType:e.isScreenStream?1:0,mediaType:e.mediaType||0,sourceCrop:e.sourceCrop}})))||[]}}}}var KB,WB={url:"",video:{codec:"H264",width:640,height:360,fps:30,gop:60,kBitRate:600,lowLatency:!0},audio:{codec:"AAC",kBitRate:64,sampleRate:48,channels:2,AACProfile:"LC"},layout:{regions:[],appData:"",backgroundColor:"#000000"}},YB={width:640,height:360,frameRate:30,maxKbps:600},JB={width:1920,height:1080,frameRate:15,maxKbps:3e3},QB=function(e){return e.streamRemovedBySchedule308="stream removed",e.clientRePublish="client republish",e.publishStreamFaied="publish failed",e.clientUnPublish="client unpublished",e.clientDisconnected="client disconnected",e.videoMuted="video muted",e}(QB||{}),ZB=function(e){return e.PushLimitWarn="PushLimitWarn",e}(ZB||{}),$B=function(e){return e.ON_ADD_STREAM="onAddStream",e.ON_REMOVE_STREAM="onRemoveStream",e.USER_DISCONNECTION="userDisconnection",e.USER_CONNECTION="userConnection",e.ON_UPDATE_STREAM_ATTRIBUTES="onUpdateStreamAttributes",e.ON_UPDATE_ROOM_ATTRIBUTES="onUpdateRoomAttributes",e.ON_UPDATE_USER_ATTRIBUTES="onUpdateUserAttributes",e.ON_PUSH_TRACK="onPushTrack",e.ON_REMOVE_TRACK="onRemoveTrack",e.ON_CUSTOM_MESSAGE="onCustomMessage",e.NODE_CHANGE="nodeChange",e.USER_MESSAGE_RECEIVED="userMessageReceived",e.USER_BINARY_MESSAGE_RECEIVED="userBinaryMessageReceived",e.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM="userMessageReceivedOutsideRoom",e.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM="userBinaryMessageReceivedOutsideRoom",e.POST_PROCESSING_MESSAGE="postProcessingMessage",e.ON_USER_TOKEN_WILL_EXPIRE="onUserTokenWillExpire",e.STREAM_CONTROL_MESSAGE="streamControlMessage",e.ON_SCENE_CONFIG="onSceneConfig",e}($B||{}),ej=function(e){return e.RSCP="RSCP",e.RTT="RTT",e}(ej||{}),tj=function(e){return e.ON_CONNECTION_STATE_CHANGE="onConnectionStateChange",e.ABNORMAL_DISCONNECTION="normalConnection",e}(tj||{}),rj=function(e){return e.userLeave="userLeave",e.connectionLost="connectionLost",e.userDuplicateLogin="userDuplicateLogin",e.kickedByAdmin="kickedByAdmin",e.roleChanged="roleChanged",e.onUserTokenDidExpire="onUserTokenDidExpire",e}(rj||{}),nj=function(e){return e[e.roomDismissByAdmin=2]="roomDismissByAdmin",e}(nj||{}),ij=function(e){return e[e.SEND=0]="SEND",e[e.FEEDBACK=1]="FEEDBACK",e}(ij||{}),oj=function(e){return e[e.P2P=0]="P2P",e[e.SIGNAL=1]="SIGNAL",e[e.BROADCAST=2]="BROADCAST",e[e.BUSINESS_SERVER=3]="BUSINESS_SERVER",e}(oj||{}),aj=function(e){return e[e.SUCCESS=0]="SUCCESS",e[e.TIMEOUT=1]="TIMEOUT",e[e.BROKEN=2]="BROKEN",e[e.NO_RECEIVER=3]="NO_RECEIVER",e[e.NO_RELAYPATH=4]="NO_RELAYPATH",e[e.SEND_TO_SERVER_ERROR=17]="SEND_TO_SERVER_ERROR",e[e.SERVER_RESPONSE_ERROR=18]="SERVER_RESPONSE_ERROR",e[e.NOT_JOIN=100]="NOT_JOIN",e[e.INIT=101]="INIT",e[e.NO_CONNECTION=102]="NO_CONNECTION",e[e.NOT_LOGIN=105]="NOT_LOGIN",e[e.SERVER_PARAMS_NOTSET=106]="SERVER_PARAMS_NOTSET",e[e.UNKNOWN=1e3]="UNKNOWN",e}(aj||{}),sj=(h(KB={},0,[0,"success"]),h(KB,1,[JN.USER_MESSAGE_TIMEOUT,"timeout, failed to send."]),h(KB,2,[JN.USER_MESSAGE_BROKEN,"dataChannel broken, failed to send."]),h(KB,3,[JN.USER_MESSAGE_NO_RECEIVER,"cannot find the receiver."]),h(KB,4,[JN.USER_MESSAGE_NO_RELAYPATH,"cannot find relay path."]),h(KB,17,[JN.USER_MESSAGE_SEND_TO_SERVER_ERROR,"failed to send to business server."]),h(KB,18,[JN.USER_MESSAGE_SERVER_RESPONSE_ERROR,"business server response error."]),h(KB,100,[JN.USER_MESSAGE_NOT_JOIN,"not join room"]),h(KB,101,[JN.USER_MESSAGE_INIT,"not init."]),h(KB,102,[JN.USER_MESSAGE_NO_CONNECTION,"no connection."]),h(KB,105,[JN.USER_MESSAGE_NOT_LOGIN,"not login."]),h(KB,106,[JN.USER_MESSAGE_SERVER_PARAMS_NOTSET,"server param is not set."]),h(KB,1e3,[JN.USER_MESSAGE_UNKNOWN,"unknown."]),KB),uj=["msg"],cj=new ML("DataChannelSignaling",3),dj=function(e){return e[e.C2S=0]="C2S",e[e.C2C=1]="C2C",e[e.C2GW=2]="C2GW",e[e.C2CDirect=3]="C2CDirect",e[e.C2RTM=4]="C2RTM",e}(dj||{}),lj=6e4,hj=function(e){f(a,e);var t,r,n=g(a);function a(e){var t;return c(this,a),h(m(t=n.call(this)),"_singlingCache",new Map),h(m(t),"_p2pCache",new Map),h(m(t),"_rttIds",{}),h(m(t),"_p2pMessageId",0),h(m(t),"_clearDataChannelListener",void 0),t._dataChannel=e,t._clearDataChannelListener=t._handleHandler(),window.__rtc_mock_signaling__=t.emit.bind(m(t)),t}return l(a,[{key:"destroy",value:function(){this._dataChannel&&(this._clearDataChannelListener(),this._dataChannel.close()),this._singlingCache.clear(),this._p2pCache.clear(),this._p2pMessageId=0,this._rttIds={}}},{key:"sendSignaling",value:function(e,t,r){var n=this;return gB.rtcSignaling(0,JSON.stringify(t),"call-".concat(e),"Send",WF.UP),new Promise((function(i,o){var a=n._genHeader(r);a.id=SP();var s=a.id.join("-"),u=setTimeout((function(){n._singlingCache.delete(s),o(new ZN(JN.TIME_OUT,"".concat(e," message time out")))}),lj);n._singlingCache.set(s,{signalingType:e,success:function(e){clearTimeout(u),i(e)},error:function(e){clearTimeout(u),o(e)}}),cj.print("Signal",">>>>>> [".concat(e,"][").concat(s,"]"),t),n._sendMessage(e,a,t)}))}},{key:"sendPingSignaling",value:function(){return this.sendSignaling("CheckConnectivity",{ts:Date.now()},{functionType:2})}},{key:"sendP2PMessage",value:(r=u(o().mark((function e(t,r){var n,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.msg,a=_(t,uj),s=n instanceof ArrayBuffer,e.t0=this,e.t1=i,e.t2=i({ver:1,id:this._p2pMessageId++,time:Date.now(),dir:ij.SEND,type:oj.P2P,err:aj.SUCCESS},a),e.t3={},e.t4=s,!s){e.next=13;break}return e.next=10,pP.ab2b64str(n);case 10:e.t5=e.sent,e.next=14;break;case 13:e.t5=n;case 14:return e.t6=e.t5,e.t7={binary:e.t4,msg:e.t6},e.t8=(0,e.t1)(e.t2,e.t3,e.t7),e.t9=r,e.abrupt("return",e.t0._sendP2PMessage.call(e.t0,e.t8,e.t9));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"_sendP2PMessage",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return EP(e.msg)?this._rttIds[e.id]=e.id:e.dir===ij.SEND&&cj.print("_sendP2PMessage [DC Signaling p2p >>]",JSON.stringify(e)),new Promise((function(n,o){var a=t._genHeader(i(i({needAck:!0,functionType:1},r),{},{id:SP()}));if(e.dir===ij.SEND){var s=setTimeout((function(){t._p2pCache.delete(e.id),o(new ZN(JN.TIME_OUT,"P2P message timeout"))}),lj);t._p2pCache.set(e.id,{success:function(e,t){clearTimeout(s),n(t)},error:function(e){clearTimeout(s);var t=E(sj[e.err]||[JN.USER_MESSAGE_UNKNOWN,"err: ".concat(e.err,", msg: ").concat(e.msg)],2),r=t[0],n=t[1];o({code:r,message:e.msg||n})}})}t._sendMessage("p2p",a,e)}))}},{key:"_sendMessage",value:function(e,t,r){if(!this._dataChannel||"open"!==this._dataChannel.readyState)throw new ZN(JN.SIGNALING_CHANNEL_NOT_OPEN,"DataChannel not open");var n=t.version+(+t.zip<<5)+(+t.encrypt<<6),i=+t.needAck+(+t.direction<<1)+(+t.functionType<<2)+(+t.binary<<6),o=pP.str2ab(JSON.stringify([e,r])),a=hP(Uint8Array,[n,i].concat(k(t.id||[])),new Uint8Array(o));this._dataChannel.send(a.buffer)}},{key:"_dispartData",value:function(e){var t=new Uint8Array(e),r=0,n=t[r++],i=t[r++],o={version:15&n,zip:16==(16&n),encrypt:32==(32&n),needAck:1==(1&i),direction:(2&i)>>1,functionType:(60&i)>>2,binary:64==(64&i)};if(o.needAck||1===o.direction){for(;r<=6;r++)if(128!=(128&t[r])){r++;break}o.id=Array.from(t.slice(2,r))}return{header:o,data:t.slice(r)}}},{key:"_feedbackSignaling",value:function(e,t){var r=this._genHeader({needAck:!0,direction:1,id:e.split("-").map((function(e){return+e}))});cj.print("Signal",">>>>>> [".concat(t,"-res][").concat(e,"]")),this._sendMessage("".concat(t,"-res"),r,"")}},{key:"_handleMessage",value:(t=u(o().mark((function e(t){var r,n,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,k,T,I,R,A,w,C,O,x,N,D,P,M,L;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:c=this._dispartData(t),d=c.data,(l=c.header).zip&&((h=new LF.Inflate).push(d,!0),d=h.result),f=pP.ab2str(d),p=[],e.prev=6,p=JSON.parse(f),e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(6),e.t0 instanceof Error&&gB.rtcSignalingMsgError(-1,e.t0.message,KF.MESSAGE_PARSE_FAILED),e.abrupt("return");case 14:e.t1=l.functionType,e.next=0===e.t1?17:1===e.t1?34:2===e.t1?83:101;break;case 17:if(v=(null===(r=l.id)||void 0===r?void 0:r.join("-"))||"",1!==l.direction){e.next=22;break}this._handleAckMessage(v,p[0]||{},f),e.next=33;break;case 22:if(!Array.isArray(p)){e.next=33;break}if(_=p[0],p=p[1],cj.print("Signal","<<<<<< ".concat(_),p,v),this._feedbackSignaling(v,_),!p.binary||"string"!=typeof p.message){e.next=31;break}return e.next=30,pP.b64str2ab(p.message);case 30:p.message=e.sent;case 31:this.emit(_,i({},p)),gB.rtcSignaling(0,f,"on-".concat(_),"Recv",WF.DOWN);case 33:return e.abrupt("break",102);case 34:Array.isArray(p)&&(p=p[1]),m=null===(n=p)||void 0===n?void 0:n.id,this._rttIds[m]||(null===(a=p)||void 0===a?void 0:a.dir)===ij.FEEDBACK||EP(null===(s=p)||void 0===s?void 0:s.msg)?delete this._rttIds[m]:cj.print("Signal","<<<<<< p2p response",p),e.t2=p.dir,e.next=e.t2===ij.SEND?40:e.t2===ij.FEEDBACK?78:81;break;case 40:if(EP(null===(u=p)||void 0===u?void 0:u.msg)){e.next=76;break}if(g=(y=p).binary,S=y.msg,b=y.room,k=y.to,T=y.from,I=""===b?g?$B.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM:$B.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM:g?$B.USER_BINARY_MESSAGE_RECEIVED:$B.USER_MESSAGE_RECEIVED,k){e.next=60;break}if(e.t3=this,e.t4=$B.ON_CUSTOM_MESSAGE,e.t5=T,e.t6=g,!g){e.next=54;break}return e.next=51,pP.b64str2ab(S);case 51:e.t7=e.sent,e.next=55;break;case 54:e.t7=S;case 55:e.t8=e.t7,e.t9={clientId:e.t5,binary:e.t6,message:e.t8},e.t3.emit.call(e.t3,e.t4,e.t9),e.next=76;break;case 60:if(e.t10=this,e.t11=I,e.t12=i,e.t13=i({},p),e.t14={},!g){e.next=71;break}return e.next=68,pP.b64str2ab(S);case 68:e.t15=e.sent,e.next=72;break;case 71:e.t15=S;case 72:e.t16=e.t15,e.t17={msg:e.t16},e.t18=(0,e.t12)(e.t13,e.t14,e.t17),e.t10.emit.call(e.t10,e.t11,e.t18);case 76:return this._sendP2PMessage(i(i({},p),{},{dir:ij.FEEDBACK,msg:""})),e.abrupt("break",82);case 78:return(R=this._p2pCache.get(p.id))&&(this._p2pCache.delete(p.id),p.err===aj.SUCCESS?R.success(p.id,p):R.error(p)),e.abrupt("break",82);case 81:return e.abrupt("break",82);case 82:return e.abrupt("break",102);case 83:if(1!==l.direction){e.next=88;break}w=(null===(A=l.id)||void 0===A?void 0:A.join("-"))||"",this._handleAckMessage(w,p[0]||{},f),e.next=100;break;case 88:if(C=E(p,2),O=C[0],x=C[1],N=void 0===x?{}:x,"RXMediaMsg"!==O){e.next=100;break}D=N.type,P=N.data,gB.rtcSignaling(0,f,"on-".concat(D),"Recv",WF.DOWN),e.t19=D,e.next="RSCP"===e.t19?95:"RTT"===e.t19?97:99;break;case 95:try{M=JSON.parse(P),Array.isArray(M)&&this.emit(D,M)}catch(o){}return e.abrupt("break",100);case 97:try{(L=JSON.parse(P)).length&&this.emit(D,L[0])}catch(o){}return e.abrupt("break",100);case 99:return e.abrupt("break",100);case 100:case 101:return e.abrupt("break",102);case 102:case"end":return e.stop()}}),e,this,[[6,10]])}))),function(e){return t.apply(this,arguments)})},{key:"_handleHandler",value:function(){var e=this,t=function(t){cj.print("_handleHandler","dataChannel close",t),e.emit("close",t)},r=function(t){cj.print("_handleHandler","dataChannel error",t),e.emit("close",t)},n=function(t){e._handleMessage(t.data)};return this._dataChannel.addEventListener("close",t),this._dataChannel.addEventListener("error",r),this._dataChannel.addEventListener("message",n),function(){e._dataChannel.removeEventListener("close",t),e._dataChannel.removeEventListener("error",r),e._dataChannel.removeEventListener("message",n)}}},{key:"_genHeader",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i({version:2,zip:!1,encrypt:!1,needAck:!0,direction:0,functionType:0,binary:!1},e)}},{key:"_handleAckMessage",value:function(e,t,r){var n=this._singlingCache.get(e);n&&(this._singlingCache.delete(e),200===t.code?n.success(t):n.error(t),cj.print("Signal","<<<<<< [".concat(n.signalingType,"-ack]"),t)),gB.rtcSignaling(0,r,null==n?void 0:n.signalingType,"Ack",WF.DOWN)}}]),a}(OL.exports.EventEmitter),fj=function(){function e(){c(this,e),h(this,"xhr",void 0),h(this,"isSending",void 0),h(this,"timeout",void 0),this.isSending=!1}return l(e,[{key:"ajax",value:function(e){var t=this,r=e.method,n=e.url,i=e.body,o=void 0===i?{}:i,a=e.headers,s=void 0===a?{}:a,u=e.stringify,c=void 0===u||u;return new Promise((function(e,i){t.isSending=!0;var a=new XMLHttpRequest;a.open(r,n,!0);for(var u=0,d=Object.entries(s);u<d.length;u++){var l=E(d[u],2),h=l[0],f=l[1];a.setRequestHeader(h,f)}a.onreadystatechange=function(){4===a.readyState&&(t.isSending=!1,200===a.status?e(JSON.parse(a.responseText)):i({message:a.statusText,code:a.status})),0===a.status&&i({code:0,message:"Request abort"})},a.onerror=function(e){t.isSending=!1,i({code:-1,message:a.responseText||"unknown"})},t.timeout&&(a.timeout=t.timeout),c&&(o=JSON.stringify(o)),a.send(o),t.xhr=a}))}},{key:"get",value:function(e,t){return this.ajax({method:"GET",url:e,headers:t})}},{key:"post",value:function(e,t,r,n){return this.ajax({method:"POST",url:e,body:t,headers:r,stringify:n})}},{key:"abort",value:function(){var e;null===(e=this.xhr)||void 0===e||e.abort()}}]),e}(),pj=new ML("ICE Request",3),vj=function(){function e(){c(this,e),h(this,"_request",void 0),this._request=new fj}var t,r,n;return l(e,[{key:"getAccessNode",value:(n=u(o().mark((function e(t,r,n,i,a,s,u,c){var d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(d=UB.getAccessNode(t))){e.next=9;break}if(this.getAccessNodeFromServer(t,r,n,i,a,s,u,c),wB("es.R.node.cache",d),!Array.isArray(d)){e.next=8;break}return e.abrupt("return",Promise.resolve(d));case 8:return e.abrupt("return",Promise.resolve([d]));case 9:return e.abrupt("return",this.getAccessNodeFromServer(t,r,n,i,a,s,u,c));case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i,o,a,s,u){return n.apply(this,arguments)})},{key:"getAccessNodeFromServer",value:(r=u(o().mark((function e(t,r,n,i,a,s,u,c){var d,l,h,f,p=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h=UB.getAccessUrls(),f=!0,wB("es.R.req.cache.urls",h),(null===(d=h)||void 0===d?void 0:d.length)>0||(h=GB.ICE_CONFIG_REQUEST_URLS,f=!1,wB("es.R.req.external.urls",h)),(null===(l=h)||void 0===l?void 0:l.length)>0||(h=GB.ICE_CONFIG_REQUEST_URLS_INTERNAL,f=!1,wB("es.R.req.internal.urls",h)),e.abrupt("return",this.getICEConfigFromServer(h,t,r,n,i,a,s,u,c).then((function(e){var r=e.nodes;return UB.setAccessNode(t,r,e.ttl||11200),e.dispatchDomains&&UB.setAccessUrls(e.dispatchDomains),r})).catch((function(e){if(f)return wB("es.R.req.fallback",""),UB.clearAccessUrls(),p.getAccessNodeFromServer(t,r,n,i,a,s,u);throw e})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t,n,i,o,a,s,u){return r.apply(this,arguments)})},{key:"getICEConfigFromServer",value:(t=u(o().mark((function e(t,r,n,i,a,s,c,d,l){var h,f,p,v,_=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h={appID:r,userID:i,deviceID:a,connectSessionID:dP(),os:"web",sdkVersion:GB.VERSION,isOversea:GB.OVERSEA,expectedAddr:zB("EXPECTED_ADDR"),productPlatform:"VolcEngine",enableCloudProxy:d,expectedIDC:l},s&&c&&(h.feedbackInfo=[{feedbackIP:null===(f=c.publicIPs[0])||void 0===f?void 0:f.ip,feedbackReason:{type:"NODE_CHANGED",reason:s}}],delete h.expectedAddr),p=Date.now(),gB.rtcGetAccess(0,JSON.stringify(h),0,qF.REQUEST,t.join(","),h.connectSessionID),v=t.map(function(){var e=u(o().mark((function e(t,r){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,_._request.post(t,h);case 3:n=e.sent,e.next=9;break;case 6:throw e.prev=6,e.t0=e.catch(0),new ZN(JN.ICE_SERVER_WRONG,"get ICE config failed",e.t0);case 9:if(200===n.code){e.next=11;break}throw new ZN(JN.ICE_SERVER_WRONG,"get ICE config failed",{server_code:n.code,message:JSON.stringify(n)});case 11:if(i=n.nodes[0]){e.next=14;break}throw new ZN(JN.ICE_SERVER_WRONG,"ICE config server return empty nodes",{code:n.code,message:JSON.stringify(n)});case 14:return e.abrupt("return",{result:n,firstNode:i,index:r});case 15:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()),e.abrupt("return",IP(v).then((function(e){var r=e.result;e.firstNode;var n=e.index;return gB.rtcGetAccess(200,JSON.stringify(r),Date.now()-p,qF.RESPONSE,t[n],h.connectSessionID),r})).catch((function(e){var r,n,i=null===(r=e[0])||void 0===r?void 0:r.error;throw gB.rtcGetAccess(+((null==i?void 0:i.code)||(null==i?void 0:i.server_code)),null===(n=e[0])||void 0===n?void 0:n.message,Date.now()-p,qF.RESPONSE,t.join(","),h.connectSessionID,{error:JSON.stringify(i)}),e})));case 6:case"end":return e.stop()}}),e)}))),function(e,r,n,i,o,a,s,u,c){return t.apply(this,arguments)})},{key:"abort",value:function(){this._request.isSending&&(pj.print("abort","HTTP Request of [getICEConfigFromServer] abort"),this._request.abort())}}]),e}(),_j=function(){function e(){c(this,e),h(this,"_request",void 0),this._request=new fj}return l(e,[{key:"getH264BlackList",value:function(){var e=this,t={keys:["web_h264_black_list"],labelSelector:"",sdkVersion:"4.47.6",deviceType:"web"};this._request.timeout=800;var r=GB.CONFIG_REQUEST_DOMAINS.map((function(e){return"https://".concat(e,"/decision/v1/multi")}));gB.rtcGetConfig(0,JSON.stringify(t),0,r.join(","),BF.REQUEST,"",!1);var n=r.map(function(){var r=u(o().mark((function r(n,i){var a,s;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e._request.post(n,t);case 3:s=r.sent,r.next=9;break;case 6:throw r.prev=6,r.t0=r.catch(0),new ZN(JN.ICE_SERVER_WRONG,"get config failed");case 9:if(Array.isArray(null===(a=s)||void 0===a?void 0:a.web_h264_black_list)){r.next=11;break}throw new ZN(JN.ICE_SERVER_WRONG,"get config failed");case 11:return r.abrupt("return",{result:s,index:i});case 12:case"end":return r.stop()}}),r,null,[[0,6]])})));return function(e,t){return r.apply(this,arguments)}}());return new Promise((function(e){IP(n).then((function(t){var n=t.result,i=t.index;UB.setH264BlackList(n.web_h264_black_list),gB.rtcGetConfig(200,JSON.stringify(n),0,r[i],BF.RESPONSE,"",!1),e(n.web_h264_black_list)})).catch((function(t){gB.rtcGetConfig(500,t.message,0,"",BF.RESPONSE,"",!1),e(UB.getH264BlackList()||[])}))}))}},{key:"getAudioProfile",value:function(){var e=this,t={keys:["engine_BAC"],labelSelector:"",sdkVersion:"4.47.6",deviceType:"web"},r=GB.CONFIG_REQUEST_DOMAINS.map((function(e){return"https://".concat(e,"/decision/v1/multi")}));gB.rtcGetConfig(0,JSON.stringify(t),0,r.join(","),BF.REQUEST,"",!1);var n=r.map(function(){var r=u(o().mark((function r(n,i){var a,s;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e._request.post(n,t);case 3:s=r.sent,r.next=9;break;case 6:throw r.prev=6,r.t0=r.catch(0),new ZN(JN.ICE_SERVER_WRONG,"get config failed");case 9:if(Array.isArray(null===(a=s)||void 0===a?void 0:a.engine_BAC)){r.next=11;break}throw new ZN(JN.ICE_SERVER_WRONG,"get config failed");case 11:return r.abrupt("return",{result:s,index:i});case 12:case"end":return r.stop()}}),r,null,[[0,6]])})));return function(e,t){return r.apply(this,arguments)}}());return new Promise((function(e){IP(n).then((function(t){var n=t.result,i=t.index;UB.setAudioProfile(n.engine_BAC),gB.rtcGetConfig(200,JSON.stringify(n),0,r[i],BF.RESPONSE,"",!1),e(n.engine_BAC)})).catch((function(t){gB.rtcGetConfig(500,t.message,0,"",BF.RESPONSE,"",!1),e(UB.getAudioProfile()||[])}))}))}}]),e}();function mj(e,t){var r=1,n=e;(e.width>t.width||e.height>t.height)&&(r=e.width/e.height>t.width/t.height?e.width/t.width:e.height/t.height,n={width:Math.floor(e.width/r),height:Math.floor(e.height/r)});return i(i({},n),{},{scaleResolutionDownBy:r})}var yj=[{sub_index:0,video_index:0,framerate:30,height:1080,maxkbps:3e3,width:1920},{sub_index:1,video_index:0,framerate:30,height:720,maxkbps:1200,width:1280},{sub_index:2,video_index:0,framerate:30,height:630,maxkbps:1100,width:1120},{sub_index:3,video_index:0,framerate:30,height:540,maxkbps:1e3,width:960},{sub_index:4,video_index:1,framerate:30,height:450,maxkbps:800,width:800},{sub_index:5,video_index:1,framerate:30,height:360,maxkbps:600,width:640},{sub_index:6,video_index:1,framerate:30,height:270,maxkbps:400,width:480},{sub_index:7,video_index:2,framerate:15,height:180,maxkbps:300,width:320},{sub_index:8,video_index:2,framerate:15,height:144,maxkbps:200,width:256},{sub_index:9,video_index:3,framerate:15,height:90,maxkbps:100,width:160}],gj=[{width:1920,height:1080,maxLayers:3,totalPixels:2073600},{width:1280,height:720,maxLayers:3,totalPixels:921600},{width:960,height:540,maxLayers:3,totalPixels:518400},{width:640,height:360,maxLayers:2,totalPixels:230400},{width:480,height:270,maxLayers:2,totalPixels:129600},{width:320,height:180,maxLayers:1,totalPixels:57600},{width:0,height:0,maxLayers:1,totalPixels:0}];var Sj={width:160,height:90,frameRate:15,maxkbps:100},bj={width:480,height:270,frameRate:15,maxkbps:400};var Ej,kj,Tj="chrome-stable"===_P(),Ij=function(){function e(t){c(this,e),h(this,"peer",void 0),h(this,"stats",void 0),this.peer=t,this.stats=[]}var t,r;return l(e,[{key:"handleCodec",value:function(e){return e}},{key:"handleInboundRtp",value:function(e){return e}},{key:"handleOutboundRtp",value:function(e){var t=e.ssrc;return t&&(e.rtxSsrc=t),e}},{key:"handleRemoteInboundRtp",value:function(e){return e}},{key:"handleRemoteOutboundRtp",value:function(e){return e}},{key:"handleMediaSource",value:function(e){return e}},{key:"handleCsrc",value:function(e){return e}},{key:"handlePeerConnection",value:function(e){return e}},{key:"handleDataChannel",value:function(e){return e}},{key:"handleStream",value:function(e){return e}},{key:"handleTrack",value:function(e){return e}},{key:"handleTransceiver",value:function(e){return e}},{key:"handleSender",value:function(e){return e}},{key:"handleReceiver",value:function(e){return e}},{key:"handleTransport",value:function(e){return e}},{key:"handleSctpTransport",value:function(e){return e}},{key:"handleCandidatePair",value:function(e){return e}},{key:"handleLocalCandidate",value:function(e){return e}},{key:"handleRemoteCandidate",value:function(e){return e}},{key:"handleCertificate",value:function(e){return e}},{key:"handleIceServer",value:function(e){return e}},{key:"processStats",value:function(e){var t=this;e.forEach((function(e){var r;switch(e.type){case"candidate-pair":r=t.handleCandidatePair;break;case"certificate":r=t.handleCertificate;break;case"remote-candidate":r=t.handleRemoteCandidate;break;case"remote-inbound-rtp":case"inbound-rtp":r=t.handleInboundRtp;break;case"remote-outbound-rtp":case"outbound-rtp":r=t.handleOutboundRtp;break;case"sctp-transport":r=t.handleSctpTransport;break;case"sender":r=t.handleSender;break;case"stream":r=t.handleStream;break;case"track":r=t.handleTrack;break;case"transceiver":r=t.handleTransceiver;break;case"transport":r=t.handleTransport;break;case"codec":r=t.handleCodec;break;case"csrc":r=t.handleCsrc;break;case"data-channel":r=t.handleDataChannel;break;case"ice-server":r=t.handleIceServer;break;case"media-source":r=t.handleMediaSource;break;case"peer-connection":r=t.handlePeerConnection;break;case"receiver":r=t.handleReceiver;break;case"local-candidate":r=t.handleLocalCandidate;break;default:r=function(e){return e}}r=r.bind(t),t.stats.push(r(e))}))}},{key:"getExtraStats",value:(r=u(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){if(!Tj||void 0!==window.InstallTrigger)return e(r.stats);try{r.peer.getStats((function(n){n.result().forEach((function(e){if(!Rj.includes(e.type)){var n={};e.names().forEach((function(t){n[t]=e.stat(t)})),n.id=e.id,n.type=e.type,n.timestamp=e.timestamp,"ssrc"===n.type&&null!=t&&t.id?t.id===n.googTrackId&&r.stats.push(n):r.stats.push(n)}})),e(r.stats)}))}catch(X$){n(X$)}})));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"getStats",value:(t=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.peer.getStats(t);case 3:if(n=e.sent,this.processStats(n),e.prev=5,r){e.next=9;break}return e.next=9,this.getExtraStats(t);case 9:e.next=13;break;case 11:e.prev=11,e.t0=e.catch(5);case 13:e.next=17;break;case 15:e.prev=15,e.t1=e.catch(0);case 17:return e.abrupt("return",this.stats);case 18:case"end":return e.stop()}}),e,this,[[0,15],[5,11]])}))),function(e,r){return t.apply(this,arguments)})}]),e}(),Rj=["codec","inbound-rtp","outbound-rtp","remote-inbound-rtp","remote-outbound-rtp","media-source","csrc","peer-connection","data-channel","stream","track","transceiver","sender","receiver","transport","sctp-transport","candidate-pair","local-candidate","remote-candidate","certificate","ice-server"],Aj=function(){var e=u(o().mark((function e(t,r,n){var i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],t instanceof RTCPeerConnection){e.next=3;break}return e.abrupt("return",i);case 3:return a=new Ij(t),e.next=6,a.getStats(r,n);case 6:return i=e.sent,e.abrupt("return",i);case 8:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),wj=function(){var e=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!fP()&&window.RTCPeerConnection&&window.RTCPeerConnection.prototype.addTransceiver&&window.RTCPeerConnection.prototype.createDataChannel){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,Cj();case 5:return t=e.sent,e.abrupt("return",(null==t?void 0:t.includes("H264"))||(null==t?void 0:t.includes("vp8")));case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),Cj=function(){var e=u(o().mark((function e(){var t,r,n,i,a,s,u,c,d,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ej){e.next=2;break}return e.abrupt("return",Ej);case 2:return t=[],e.prev=3,e.next=6,TP();case 6:if(r=e.sent){e.next=9;break}return e.abrupt("return",t);case 9:if(!(null!=r&&r.includes("level-asymmetry-allowed=1;packetization-mode=1;profile-level-id=42e01f")||null!=r&&r.includes("profile-level-id=42e01f;level-asymmetry-allowed=1;packetization-mode=1")||null!=r&&r.includes("packetization-mode=1;profile-level-id=42e01f;level-asymmetry-allowed=1"))){e.next=20;break}return n=navigator.userAgent.toLowerCase(),i=!1,a=["heytapbrowser","mqqbrowser","miuibrowser"],s=new _j,e.next=16,s.getH264BlackList();case 16:for(u=e.sent,a.push.apply(a,k(u)),c=0,d=a;c<d.length;c++)l=d[c],n.includes(l)&&(i=!0);!i&&t.push("H264");case 20:return null!=r&&r.includes("VP8")&&t.push("vp8"),Ej=t,e.abrupt("return",t);case 25:return e.prev=25,e.t0=e.catch(3),e.abrupt("return",t);case 28:case"end":return e.stop()}}),e,null,[[3,25]])})));return function(){return e.apply(this,arguments)}}(),Oj=function(){var e=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cj();case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return e.toUpperCase()})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),xj=function(){return"undefined"!=typeof TransformStream&&"undefined"!=typeof RTCRtpSender&&"undefined"!=typeof RTCRtpReceiver&&void 0!==RTCRtpSender.prototype.createEncodedStreams&&void 0!==RTCRtpReceiver.prototype.createEncodedStreams},Nj=new ML("BasicHandler",3),Dj={iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",encodedInsertableStreams:!!xj()||void 0};function Pj(e){if(void 0===kj){var t=navigator.userAgent.toLowerCase();kj=t.includes("chrome")&&t.includes("mobile")}return kj?Math.ceil(e):e}var Mj=function(e){f(d,e);var t,r,n,a,s=g(d);function d(e,t){var r;return c(this,d),h(m(r=s.call(this)),"_peerConnection",void 0),h(m(r),"_dataChannel",void 0),h(m(r),"_context",void 0),h(m(r),"monitor",void 0),h(m(r),"_offerIce",{}),h(m(r),"_answerIce",{}),h(m(r),"_initSctpEvents",!1),r.monitor=e,r._peerConnection=new RTCPeerConnection(Dj),r._dataChannel=r._peerConnection.createDataChannel("signaling",{negotiated:!0,id:100}),r._context=t,r._dataChannel.binaryType="arraybuffer",r._peerConnection.ontrack=function(e){var t,n;Nj.print("constructor","pc.ontrack ".concat(e.track.kind," ").concat(e.track.id," ").concat(null===(t=e.streams)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.id)),r.emit("ontrack",e)},r._peerConnection.onconnectionstatechange=function(e){Nj.print("constructor","onconnectionstatechange ".concat(r._peerConnection.iceConnectionState," -> ").concat(r._peerConnection.connectionState)),"failed"!==r._peerConnection.iceConnectionState&&"closed"!==r._peerConnection.iceConnectionState&&"failed"!==r._peerConnection.connectionState||r.emit("disconnect")},r._peerConnection.oniceconnectionstatechange=function(){var t=r._peerConnection.iceConnectionState;e.rtcPreIceState(t,XF["".concat(t.toUpperCase())])},r}return l(d,[{key:"disconnect",value:function(){this._peerConnection.close(),this._dataChannel.close(),this._peerConnection.ontrack=null}},{key:"destroy",value:function(){Nj.print("destroy"),this.disconnect(),this._context=void 0}},{key:"_simulcast",value:function(e,t,r,n,o){var a=[],s=function(e){for(var t=0,r=e.width*e.height,n=0;n<gj.length;n++)if(r>=gj[n].totalPixels){t=n;break}if(0===t)return gj[t].maxLayers;var i=gj[t-1].totalPixels;return(i-r)/(i-gj[t].totalPixels)<.1?gj[t-1].maxLayers:gj[t].maxLayers}(t);Nj.print("simulcast() ","maxLayers: %o",s),1===e.videoEncodeConfig.length?(a=function(e,t){var r=[];if(t<=1)return r;var n=1,i=1;return e.width/e.height>16/9?(n=e.width/Sj.width,i=e.width/bj.width):(n=e.height/Sj.height,i=e.height/bj.height),r.push({maxkbps:Sj.maxkbps,scaleResolutionDownBy:n,frameRate:Sj.frameRate,width:Math.floor(e.width/n),height:Math.floor(e.height/n)}),t<=2||n>2&&r.unshift({maxkbps:bj.maxkbps,scaleResolutionDownBy:i,frameRate:bj.frameRate,width:Math.floor(e.width/i),height:Math.floor(e.height/i)}),r}(r,s),Nj.print("simulcast() ","simulcastLayers: %o",a)):(a=e.videoEncodeConfig.slice(1).slice(1-s).map((function(e){return i({frameRate:e.frameRate||15,maxkbps:e.maxKbps||600},mj(r,e))})),Nj.print("simulcast() ","simulcastLayers2: %o",a)),a.forEach((function(e,t){var r,i={maxBitrate:1e3*e.maxkbps,scaleResolutionDownBy:Pj(e.scaleResolutionDownBy),rid:"".concat(t+1),maxFramerate:e.frameRate};null===(r=n.sendEncodings)||void 0===r||r.unshift(i),o.push({width:e.width,height:e.height,framerate:e.frameRate,maxkbps:e.maxkbps,rid:"".concat(t+1)})}))}},{key:"internalPublish",value:function(e){var t=e.stream,r=e.videoTrack,n=e.audioTrack,o=e.enableSimulcast,a=e.pubAudio,s=e.pubVideo,u={direction:"sendonly",streams:[t]},c={direction:"sendonly",streams:[t]},d=[],l=[];if(Array.isArray(null==e?void 0:e.videoEncodeConfig)&&e.videoEncodeConfig.length){var h=null==r?void 0:r.getTrack(),f={width:640,height:360,frameRate:30};if(h){var p=null==h?void 0:h.getSettings();f={width:Math.floor(p.width),height:Math.floor(p.height),frameRate:Math.floor(p.frameRate)}}var v=null==e?void 0:e.videoEncodeConfig[0],_=mj(f,v);e.prevScaleResolutionDownBy=_.scaleResolutionDownBy,e.videoInputConfig=f;var m,y,g={maxBitrate:1e3*v.maxKbps,scaleResolutionDownBy:Pj(_.scaleResolutionDownBy),rid:"0",maxFramerate:v.frameRate||15};if(c.sendEncodings=[g],d.push({width:_.width,height:_.height,framerate:v.frameRate,maxkbps:v.maxKbps,rid:"0"}),o)this._simulcast(e,_,f,c,d),null!==(m=this._context)&&void 0!==m&&null!==(y=m.serverConfig)&&void 0!==y&&y.simulcastOnDemand&&(l=function(e){if(!e.length)return[];var t=e.shift(),r=t.width/t.height,n=0,o=0,a=i(i({},t),{},{video_index:o,sub_index:n++});delete a.rid;for(var s=[a],u=0,c=0;c<yj.length;c++)if(yj[c].height<t.height){u=c;break}for(var d=e.shift(),l=u;l<yj.length;l++){var h,f=yj[l];if(d&&f.height<=(null===(h=d)||void 0===h?void 0:h.height)){var p,v=f.height===(null===(p=d)||void 0===p?void 0:p.height),_=i(i({},d),{},{video_index:++o,sub_index:n++});if(delete _.rid,s.push(_),d=e.shift(),v)continue}s.push(i(i({},f),{},{width:Math.floor(f.height*r),video_index:o,sub_index:n++}))}return s}([].concat(d))),Nj.print("subVideoDesc","desc: %o ",l)}Nj.print("publish videoTransceiverInit videoDescriptions","",c,d);var S=null==n?void 0:n.getTrack("preprocessing");(null==n?void 0:n.mixType)!==te.PLAYOUT&&null!=n&&n.mixedAudioTrack&&(S=null==n?void 0:n.mixedAudioTrack),S=a&&S?S:"audio";var b=null==r?void 0:r.getTrack("preprocessing");return{semantics:"unified-plan",videoDescriptions:d,subVideoDescriptions:l,transceiverInit:{aTrack:S,vTrack:b=s&&b?b:"video",audioTransceiverInit:u,videoTransceiverInit:c}}}},{key:"updateScaleResolutionDownBy",value:(a=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Nj.print("updateScaleResolutionDownBy()"),i=null===(r=t.videoTrack)||void 0===r?void 0:r.getTrack(),a=t.videoTransceiver,i&&t.pubVideo&&a){e.next=6;break}return Nj.print("updateScaleResolutionDownBy()","no pub"),e.abrupt("return");case 6:s=null==i?void 0:i.getSettings(),u={width:Math.floor(s.width),height:Math.floor(s.height),frameRate:Math.floor(s.frameRate)},(c=mj(u,t.videoEncodeConfig[0])).scaleResolutionDownBy===t.prevScaleResolutionDownBy&&Nj.print("updateScaleResolutionDownBy()","no change %o",t.prevScaleResolutionDownBy),(d=null===(n=a.sender)||void 0===n?void 0:n.getParameters())&&(h=c.scaleResolutionDownBy/t.prevScaleResolutionDownBy,d.encodings=null==d||null===(l=d.encodings)||void 0===l?void 0:l.map((function(e){var r,n;Math.max(e.scaleResolutionDownBy=(e.scaleResolutionDownBy||1)*h,1);var i=+e.rid||0;e.maxFramerate=(null===(r=t.videoEncodeConfig[i])||void 0===r?void 0:r.frameRate)||e.maxFramerate;var o=null===(n=t.videoEncodeConfig[i])||void 0===n?void 0:n.maxKbps;return"number"==typeof o&&(e.maxBitrate=1e3*o),e})),t.prevScaleResolutionDownBy=c.scaleResolutionDownBy,t.videoInputConfig=u,null==a||a.sender.setParameters(d));case 12:case"end":return e.stop()}}),e)}))),function(e){return a.apply(this,arguments)})},{key:"getStats",value:function(e,t){return Aj(this._peerConnection,e,t)}},{key:"setLocalDescription",value:(n=u(o().mark((function e(t,r){var n,i,a,s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=lP(),e.prev=1,e.next=4,this._peerConnection.setLocalDescription(new RTCSessionDescription({type:"offer",sdp:t}));case 4:this.monitor.rtcSetDescription(0,t,QF.W_1,"local"===(null==r?void 0:r.streamUserId)?ZF.UP:ZF.DOWN,(null==r?void 0:r.streamId)||"",(null==r?void 0:r.streamUserId)||"",lP()-n,{type:"offer"}),this._initSctpEvents||(this._initSctpEvents=!0,(a=null===(i=this._peerConnection)||void 0===i?void 0:i.sctp)&&(a.onstatechange=function(){s.monitor.rtcInvokeStatus("sctp state change TO: ".concat(a.state),0,"sctp","",0)},a.transport&&(a.transport.onstatechange=function(){var e;s.monitor.rtcInvokeStatus("dtls state change TO: ".concat(null==a||null===(e=a.transport)||void 0===e?void 0:e.state),0,"dtls","",0)}))),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(1),console.error("setLocal",e.t0),this.monitor.rtcSetDescription(-1,e.t0.message+t,QF.W_1,"local"===(null==r?void 0:r.streamUserId)?ZF.UP:ZF.DOWN,"","",lP()-n,{type:"offer"});case 12:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e,t){return n.apply(this,arguments)})},{key:"setRemoteDescription",value:(r=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=lP(),e.prev=1,e.next=4,this._peerConnection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t}));case 4:this.monitor.rtcSetDescription(0,t,QF.W_0,"local"===(null==r?void 0:r.streamUserId)?ZF.UP:ZF.DOWN,(null==r?void 0:r.streamId)||"",(null==r?void 0:r.streamUserId)||"",lP()-n,{type:"answer"}),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.error("setRemote",e.t0),this.monitor.rtcSetDescription(-1,e.t0.message+t,QF.W_1,"local"===(null==r?void 0:r.streamUserId)?ZF.UP:ZF.DOWN,(null==r?void 0:r.streamId)||"",(null==r?void 0:r.streamUserId)||"",lP()-n,{type:"answer"});case 11:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e,t){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"pc",get:function(){return this._peerConnection}},{key:"addBitrateLimit",value:function(e,t){null==e||e.rtp.forEach((function(r){var n=r.codec,i=r.payload;if(["vp8","h264"].includes(n.toLocaleLowerCase())){var o=e.fmtp.find((function(e){return e.payload===i}));o&&(o.config=[].concat(k(o.config.split(";")),["x-google-min-bitrate=100","x-google-start-bitrate=".concat(t)]).join(";"))}}))}}]),d}(OL.exports.EventEmitter),Lj={},Uj=vf,Vj=Ut,Fj=Te,Bj=eu,jj=Pt,Gj=Ie,Hj=Wa,zj=we,qj=f_,Xj=Au,Kj=di,Wj=es,Yj=Zt,Jj=Pd,Qj=uu,Zj=qs,$j=ye,eG=ys.UNSUPPORTED_Y,tG=4294967295,rG=Math.min,nG=[].push,iG=Fj(/./.exec),oG=Fj(nG),aG=Fj("".slice),sG=!$j((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));Bj("split",(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=Wj(zj(this)),i=void 0===r?tG:r>>>0;if(0===i)return[];if(void 0===e)return[n];if(!Hj(e))return Vj(t,n,e,i);for(var o,a,s,u=[],c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),d=0,l=new RegExp(e.source,c+"g");(o=Vj(Zj,l,n))&&!((a=l.lastIndex)>d&&(oG(u,aG(n,d,o.index)),o.length>1&&o.index<n.length&&Uj(nG,u,Jj(o,1)),s=o[0].length,d=a,u.length>=i));)l.lastIndex===o.index&&l.lastIndex++;return d===n.length?!s&&iG(l,"")||oG(u,""):oG(u,aG(n,d)),u.length>i?Jj(u,0,i):u}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:Vj(t,this,e,r)}:t,[function(t,r){var i=zj(this),o=Gj(t)?void 0:Yj(t,e);return o?Vj(o,t,i,r):Vj(n,Wj(i),t,r)},function(e,i){var o=jj(this),a=Wj(e),s=r(n,o,a,i,n!==t);if(s.done)return s.value;var u=qj(o,RegExp),c=o.unicode,d=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(eG?"g":"y"),l=new u(eG?"^(?:"+o.source+")":o,d),h=void 0===i?tG:i>>>0;if(0===h)return[];if(0===a.length)return null===Qj(l,a)?[a]:[];for(var f=0,p=0,v=[];p<a.length;){l.lastIndex=eG?0:p;var _,m=Qj(l,eG?aG(a,p):a);if(null===m||(_=rG(Kj(l.lastIndex+(eG?p:0)),a.length))===f)p=Xj(a,p,c);else{if(oG(v,aG(a,f,p)),v.length===h)return v;for(var y=1;y<=m.length-1;y++)if(oG(v,m[y]),v.length===h)return v;p=f=_}}return oG(v,aG(a,f)),v}]}),!sG,eG);var uG={},cG={exports:{}},dG=cG.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return t+=null!=e.id?"id=%s %s":"%v%s",t+=null!=e.mediaClockValue?"=%s":"",t+=null!=e.rateNumerator?" rate=%s":"",t+=null!=e.rateDenominator?"/%s":""}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]};Object.keys(dG).forEach((function(e){dG[e].forEach((function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")}))})),function(e){var t=function(e){return String(Number(e))===e?Number(e):e},r=function(e,r,n){var i=e.name&&e.names;e.push&&!r[e.push]?r[e.push]=[]:i&&!r[e.name]&&(r[e.name]={});var o=e.push?{}:i?r[e.name]:r;!function(e,r,n,i){if(i&&!n)r[i]=t(e[1]);else for(var o=0;o<n.length;o+=1)null!=e[o+1]&&(r[n[o]]=t(e[o+1]))}(n.match(e.reg),o,e.names,e.name),e.push&&r[e.push].push(o)},n=cG.exports,i=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],a=t;return e.split(/(\r\n|\r|\n)/).filter(i).forEach((function(e){var t=e[0],i=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),a=o[o.length-1]);for(var s=0;s<(n[t]||[]).length;s+=1){var u=n[t][s];if(u.reg.test(i))return r(u,a,i)}})),t.media=o,t};var o=function(e,r){var n=r.split(/=(.+)/,2);return 2===n.length?e[n[0]]=t(n[1]):1===n.length&&r.length>1&&(e[n[0]]=void 0),e};e.parseParams=function(e){return e.split(/;\s?/).reduce(o,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var r=[],n=e.split(" ").map(t),i=0;i<n.length;i+=3)r.push({component:n[i],ip:n[i+1],port:n[i+2]});return r},e.parseImageAttributes=function(e){return e.split(" ").map((function(e){return e.substring(1,e.length-1).split(",").reduce(o,{})}))},e.parseSimulcastStreamList=function(e){return e.split(";").map((function(e){return e.split(",").map((function(e){var r,n=!1;return"~"!==e[0]?r=t(e):(r=t(e.substring(1,e.length)),n=!0),{scid:r,paused:n}}))}))}}(uG);var lG=cG.exports,hG=/%[sdv%]/g,fG=function(e){var t=1,r=arguments,n=r.length;return e.replace(hG,(function(e){if(t>=n)return e;var i=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(i);case"%d":return Number(i);case"%v":return""}}))},pG=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?n.push(r[t.name][o]):n.push(r[t.names[i]])}else n.push(r[t.name]);return fG.apply(null,n)},vG=["v","o","s","i","u","e","p","c","b","t","r","z","a"],_G=["i","c","b","a"],mG=uG,yG=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach((function(e){null==e.payloads&&(e.payloads="")}));var r=t.outerOrder||vG,n=t.innerOrder||_G,i=[];return r.forEach((function(t){lG[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(pG(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(pG(t,r,e))}))}))})),e.media.forEach((function(e){i.push(pG("m",lG.m[0],e)),n.forEach((function(t){lG[t].forEach((function(r){r.name in e&&null!=e[r.name]?i.push(pG(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach((function(e){i.push(pG(t,r,e))}))}))}))})),i.join("\r\n")+"\r\n"};Lj.write=yG,Lj.parse=mG.parse,Lj.parseParams=mG.parseParams,Lj.parseFmtpConfig=mG.parseFmtpConfig,Lj.parsePayloads=mG.parsePayloads,Lj.parseRemoteCandidates=mG.parseRemoteCandidates,Lj.parseImageAttributes=mG.parseImageAttributes,Lj.parseSimulcastStreamList=mG.parseSimulcastStreamList;var gG=Math.pow(2,32),SG=function(){return Math.floor(Math.random()*gG+1e3)},bG=function(e,t,r){return r||(r=SG()),[{id:r,attribute:"cname",value:"kp34Za0H+aVf862l"},{id:r,attribute:"msid",value:"".concat(e.id," ").concat(e.id,"-").concat(t)},{id:r,attribute:"mslabel",value:"".concat(e.id)},{id:r,attribute:"label",value:"".concat(e.id,"-").concat(t)}]},EG=function(e,t){var r=SG(),n=SG();return{ssrcs:[r,n].reduce((function(r,n){return r.concat(bG(e,t,n))}),[]),ssrcGroups:[{semantics:"FID",ssrcs:"".concat(r," ").concat(n)}]}};function kG(e){return e.direction="inactive",e.port=0,delete e.ext,delete e.ssrcs,delete e.ssrcGroups,delete e.simulcast,delete e.simulcast_03,delete e.rids,delete e.extmapAllowMixed,delete e.bundleOnly,e}var TG=function(e,t,r){var n=i(i({},e),{},{invalid:[{value:"realx-exts:rscp"}],media:[t,r]});return delete n.groups,delete n.msidSemantic,Lj.write(n)};function IG(e){return RG.apply(this,arguments)}function RG(){return(RG=u(o().mark((function e(t){var r,n,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={},n=t.publicIPs,i=t.certFingerprint,a=t.iceParams,r.fingerprint={type:"sha-256",hash:i},r.icePwd=a.serverIcePwd,e.next=6,wG(a.serverIceUfrag);case 6:return r.iceUfrag=e.sent,EB.setStats({connection_id:r.iceUfrag}),r.candidates=AG(n),r.setup="active",r.iceOptions="renomination",e.abrupt("return",r);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function AG(e){if(!Array.isArray(e))return[];var t=0,r=2130706431,n=[];return e.forEach((function(e){var o={component:1,ip:e.ip,type:"host",generation:e.generation};e.udpPorts&&e.udpPorts.forEach((function(e){n.push(i(i({},o),{},{foundation:t++,transport:"udp",port:e,priority:r}))})),e.tcpPorts&&e.tcpPorts.forEach((function(e){n.push(i(i({},o),{},{foundation:t++,transport:"tcp",port:e,tcptype:"passive",priority:2130705431}))}))})),n}var wG=function(){var e=u(o().mark((function e(t){var r,n,i,a,s,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new TextEncoder,n=r.encode("PREC"),e.t0=Uint8Array,e.next=5,pP.b64str2ab(t);case 5:return e.t1=e.sent,i=new e.t0(e.t1),a=r.encode(Date.now().toString()).slice(-4),(s=new Uint8Array(2))[0]=0,s[1]=1,u=hP(Uint8Array,n,i,a,s),e.next=14,pP.ab2b64str(u.buffer);case 14:return c=e.sent,e.abrupt("return",c);case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),CG=function(e,t){var r=0;if(Array.isArray(e.fmtp)&&Array.isArray(e.rtp)){var n,i=R(e.fmtp);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.config.includes("level-asymmetry-allowed=1")&&o.config.includes("packetization-mode=1")&&o.config.includes("profile-level-id=42e01f")){r=o.payload;break}}}catch(c){i.e(c)}finally{i.f()}for(var a=0;a<e.rtp.length;a++){var s=e.rtp[a];if("H264"===t){if(s.payload===r){e.rtp.unshift(e.rtp.splice(a,1)[0]);break}}else if(s.codec===t){e.rtp.unshift(e.rtp.splice(a,1)[0]);break}}var u=[];e.rtp.forEach((function(e){return u.push(e.payload)})),e.payloads=u.join(" ")}},OG=Te,xG=gh,NG=kd.exports.getWeakData,DG=Xl,PG=Pt,MG=Ie,LG=kt,UG=Hl,VG=Pe,FG=ln.set,BG=ln.getterFor,jG=Hi.find,GG=Hi.findIndex,HG=OG([].splice),zG=0,qG=function(e){return e.frozen||(e.frozen=new XG)},XG=function(){this.entries=[]},KG=function(e,t){return jG(e.entries,(function(e){return e[0]===t}))};XG.prototype={get:function(e){var t=KG(this,e);if(t)return t[1]},has:function(e){return!!KG(this,e)},set:function(e,t){var r=KG(this,e);r?r[1]=t:this.entries.push([e,t])},delete:function(e){var t=GG(this.entries,(function(t){return t[0]===e}));return~t&&HG(this.entries,t,1),!!~t}};var WG,YG={getConstructor:function(e,t,r,n){var i=e((function(e,i){DG(e,o),FG(e,{type:t,id:zG++,frozen:void 0}),MG(i)||UG(i,e[n],{that:e,AS_ENTRIES:r})})),o=i.prototype,a=BG(t),s=function(e,t,r){var n=a(e),i=NG(PG(t),!0);return!0===i?qG(n).set(t,r):i[n.id]=r,e};return xG(o,{delete:function(e){var t=a(this);if(!LG(e))return!1;var r=NG(e);return!0===r?qG(t).delete(e):r&&VG(r,t.id)&&delete r[t.id]},has:function(e){var t=a(this);if(!LG(e))return!1;var r=NG(e);return!0===r?qG(t).has(e):r&&VG(r,t.id)}}),xG(o,r?{get:function(e){var t=a(this);if(LG(e)){var r=NG(e);return!0===r?qG(t).get(e):r?r[t.id]:void 0}},set:function(e,t){return s(this,e,t)}}:{add:function(e){return s(this,e,!0)}}),i}},JG=se,QG=Te,ZG=gh,$G=kd.exports,eH=mh,tH=YG,rH=kt,nH=Xd,iH=ln.enforce,oH=jr,aH=!JG.ActiveXObject&&"ActiveXObject"in JG,sH=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},uH=eH("WeakMap",sH,tH);if(oH&&aH){WG=tH.getConstructor(sH,"WeakMap",!0),$G.enable();var cH=uH.prototype,dH=QG(cH.delete),lH=QG(cH.has),hH=QG(cH.get),fH=QG(cH.set);ZG(cH,{delete:function(e){if(rH(e)&&!nH(e)){var t=iH(this);return t.frozen||(t.frozen=new WG),dH(this,e)||t.frozen.delete(e)}return dH(this,e)},has:function(e){if(rH(e)&&!nH(e)){var t=iH(this);return t.frozen||(t.frozen=new WG),lH(this,e)||t.frozen.has(e)}return lH(this,e)},get:function(e){if(rH(e)&&!nH(e)){var t=iH(this);return t.frozen||(t.frozen=new WG),lH(this,e)?hH(this,e):t.frozen.get(e)}return hH(this,e)},set:function(e,t){if(rH(e)&&!nH(e)){var r=iH(this);r.frozen||(r.frozen=new WG),lH(this,e)?fH(this,e,t):r.frozen.set(e,t)}else fH(this,e,t);return this}})}var pH=function(e){f(T,e);var t,r,n,i,a,s,d,p,v,_,y,S,b,E=g(T);function T(){var e;return c(this,T),h(m(e=E.call(this)),"inited",!1),h(m(e),"deviceMap",{audioinput:new Map,audiooutput:new Map,videoinput:new Map}),e._handleDeviceChange=e._handleDeviceChange.bind(m(e)),!fP()&&e.refreshDevices(),e}return l(T,[{key:"refreshDevices",value:(b=u(o().mark((function e(){var t,r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(navigator.mediaDevices){e.next=2;break}return e.abrupt("return");case 2:if(t=void 0,!mP){e.next=7;break}return e.next=6,navigator.mediaDevices.getUserMedia({audio:!0});case 6:t=e.sent;case 7:return e.next=9,navigator.mediaDevices.enumerateDevices();case 9:r=e.sent,t&&t.getTracks().forEach((function(e){return e.stop()})),r.forEach((function(e){var t;e.deviceId&&(null===(t=n.deviceMap[e.kind])||void 0===t||t.set(e.deviceId,e))})),this.inited||this.initListener(),this.inited=!0;case 14:case"end":return e.stop()}}),e,this)}))),function(){return b.apply(this,arguments)})},{key:"initListener",value:(S=u(o().mark((function e(){var t,r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"function"==typeof(null===(t=navigator.mediaDevices)||void 0===t?void 0:t.addEventListener)&&navigator.mediaDevices.addEventListener("devicechange",(function(){r._handleDeviceChange(),setTimeout((function(){r._handleDeviceChange()}),300)}));case 1:case"end":return e.stop()}}),e)}))),function(){return S.apply(this,arguments)})},{key:"_handleDeviceChange",value:(y=u(o().mark((function e(){var t,r,n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=void 0,!mP){e.next=5;break}return e.next=4,navigator.mediaDevices.getUserMedia({audio:!0});case 4:t=e.sent;case 5:return e.next=7,navigator.mediaDevices.enumerateDevices();case 7:r=e.sent,t&&t.getTracks().forEach((function(e){return e.stop()})),n=Array.from([].concat(k(this.deviceMap.audioinput.values()),k(this.deviceMap.videoinput.values()),k(this.deviceMap.audiooutput.values()))),r.forEach((function(e){var t=i.deviceMap[e.kind].get(e.deviceId);i.deviceMap[e.kind].set(e.deviceId,e),t||(e.kind.includes("video")?i.emit(ie.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}):e.kind.includes("audio")&&i.emit(ie.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"active"}))})),n.forEach((function(e){r.find((function(t){return t.deviceId===e.deviceId&&t.kind===e.kind}))||(i.deviceMap[e.kind].delete(e.deviceId),e.kind.includes("video")?i.emit(ie.onVideoDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}):e.kind.includes("audio")&&i.emit(ie.onAudioDeviceStateChanged,{mediaDeviceInfo:e,deviceState:"inactive"}))}));case 12:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getVideoPermission",value:(_=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._getVideoPermission(),e.next=3,this.refreshDevices();case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"_getVideoPermission",value:(v=u(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getNavigatorPermission("camera");case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",!0);case 4:if(r=!1,null===(t=navigator.mediaDevices)||void 0===t||!t.getUserMedia){e.next=8;break}return e.next=8,navigator.mediaDevices.getUserMedia({audio:!1,video:!0}).then((function(e){e&&(e.getTracks().forEach((function(e){return e.stop()})),r=!0)})).catch((function(){}));case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})},{key:"getAudioPermission",value:(p=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this._getAudioPermission(),e.next=3,this.refreshDevices();case 3:return e.abrupt("return",t);case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"_getAudioPermission",value:(d=u(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getNavigatorPermission("microphone");case 2:if(!e.sent){e.next=4;break}return e.abrupt("return",!0);case 4:if(r=!1,null===(t=navigator.mediaDevices)||void 0===t||!t.getUserMedia){e.next=8;break}return e.next=8,navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){e&&(e.getTracks().forEach((function(e){return e.stop()})),r=!0)})).catch((function(){}));case 8:return e.abrupt("return",r);case 9:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"enumerateDevices",value:(s=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getVideoPermission();case 2:return e.next=4,this._getAudioPermission();case 4:return e.abrupt("return",Array.from([].concat(k(this.deviceMap.audioinput.values()),k(this.deviceMap.videoinput.values()),k(this.deviceMap.audiooutput.values()))));case 5:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"enumerateAudioCaptureDevices",value:(a=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getAudioPermission();case 2:return e.abrupt("return",Array.from(this.deviceMap.audioinput.values()));case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"enumerateVideoCaptureDevices",value:(i=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getVideoPermission();case 2:return e.abrupt("return",Array.from(this.deviceMap.videoinput.values()));case 3:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"enumerateAudioPlaybackDevices",value:(n=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._getAudioPermission();case 2:return e.abrupt("return",Array.from(this.deviceMap.audiooutput.values()));case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getDeviceById",value:(r=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.enumerateDevices();case 2:return r=e.sent,e.abrupt("return",r.find((function(e){return e.deviceId===t})));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_getNavigatorPermission",value:(t=u(o().mark((function e(t){var r,n,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!1,null===(r=navigator.permissions)||void 0===r||!r.query){e.next=12;break}return e.prev=2,e.next=5,navigator.permissions.query({name:t});case 5:i=e.sent,a=i.state,n="granted"===a,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(2);case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,null,[[2,10]])}))),function(e){return t.apply(this,arguments)})}]),T}(UL),vH=new pH,_H=function(){function e(){c(this,e),h(this,"_audioContextInstance",void 0)}return l(e,[{key:"getAudioContextInstance",value:function(){if(!this._audioContextInstance){var e=window.AudioContext||window.webkitAudioContext;this._audioContextInstance=new e}return this._audioContextInstance}}]),e}(),mH=function(){function e(t){c(this,e),h(this,"_ctx",void 0),h(this,"_analyserNode",void 0),h(this,"_audioSource",void 0);var r=yH.getAudioContextInstance();if(t instanceof MediaStreamTrack){var n=new MediaStream;n.addTrack(t),this._audioSource=r.createMediaStreamSource(n)}else t instanceof AudioNode?this._audioSource=t:(this._audioSource=r.createMediaElementSource(t),this._audioSource.connect(r.destination));var i=r.createAnalyser();this._audioSource.connect(i),this._analyserNode=i,this._ctx=r}return l(e,[{key:"getAudioLevel",value:function(){var e;"suspended"===(null===(e=this._ctx)||void 0===e?void 0:e.state)&&this._ctx.resume();var t=new Uint8Array(2048);this._analyserNode.getByteTimeDomainData(t);var r=0;return t.forEach((function(e){return r=Math.max(r,Math.abs(e-128))})),r/128*255}},{key:"destroy",value:function(){this._audioSource.disconnect(),this._analyserNode.disconnect()}}]),e}(),yH=new _H,gH=function(e){return e[e.CAPTURE=0]="CAPTURE",e[e.PRE_PROCESSING=1]="PRE_PROCESSING",e[e.ENCODE=2]="ENCODE",e[e.TRANSFER=3]="TRANSFER",e[e.POST_PROCESSING=4]="POST_PROCESSING",e[e.DECODE=5]="DECODE",e[e.RENDERING=6]="RENDERING",e}(gH||{}),SH=function(){function e(){c(this,e),h(this,"_plugins",new Map),h(this,"_monitor",void 0)}var t;return l(e,[{key:"setMinotor",value:function(e){this._monitor=e}},{key:"register",value:function(e){e.monitor=this._monitor;var t=this._plugins.get(e.type)||[];if(t.findIndex((function(t){return t.name===e.name}))>-1)throw new Error("Failed to register ".concat(e.name,": name is repeated."));t.push(e),this._plugins.set(e.type,t)}},{key:"getPluginsByType",value:function(e){return this._plugins.get(e)||[]}},{key:"getPluginByName",value:function(e,t){return(this._plugins.get(e)||[]).find((function(e){return e.name===t}))}},{key:"getPreProcessingTrack",value:(t=u(o().mark((function e(t){var r,n,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=this._plugins.get(1)||[],n=t.getTrack(),i=R(r),e.prev=3,i.s();case 5:if((a=i.n()).done){e.next=12;break}return s=a.value,e.next=9,s.effect(t,n);case 9:n=e.sent;case 10:e.next=5;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),i.e(e.t0);case 17:return e.prev=17,i.f(),e.finish(17);case 20:return e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this,[[3,14,17,20]])}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){this._plugins.forEach((function(e){e.forEach((function(e){return e.destroy()}))})),this._plugins.clear()}}]),e}(),bH=new ML("VERTC",0),EH=new WeakMap,kH=function(e){f(r,e);var t=g(r);function r(e,n){var i;return c(this,r),h(m(i=t.call(this)),"sourceType",1),h(m(i),"mediaType",void 0),h(m(i),"_trackId",void 0),i._trackId=e,i.mediaType=n,i}return l(r,[{key:"getId",value:function(){return this._trackId}}]),r}(UL),TH=function(e){f(n,e);var t,r=g(n);function n(e,t,i){var o;return c(this,n),h(m(o=r.call(this,t,i)),"_mediaTrack",void 0),h(m(o),"_preProcessingTrack",void 0),o._mediaTrack=e,o._initListeners(),o}return l(n,[{key:"getTrack",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"origin";return"origin"===e?this._mediaTrack:this._preProcessingTrack||this._mediaTrack}},{key:"setTrack",value:function(e,t){this._mediaTrack=e,t&&this.generatePreProcessingTrack(t)}},{key:"generatePreProcessingTrack",value:(t=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getPreProcessingTrack(this);case 3:(r=e.sent)instanceof MediaStreamTrack&&(this._preProcessingTrack=r),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(e){return t.apply(this,arguments)})},{key:"close",value:function(){var e,t;return this._mediaTrack.onended=null,this._mediaTrack.onmute=null,this._mediaTrack.onunmute=null,null===(e=this._preProcessingTrack)||void 0===e||e.stop(),null===(t=this._mediaTrack)||void 0===t?void 0:t.stop()}},{key:"_initListeners",value:function(){var e=this;this._mediaTrack instanceof MediaStreamTrack&&this._mediaTrack.addEventListener("ended",(function(){gB.rtcError("track-ended mediaType: ".concat(e._mediaTrack.kind),-1001),e.emit("track-ended",e)}))}}]),n}(kH),IH=function(e){f(r,e);var t=g(r);function r(e,n,i){var o;return c(this,r),h(m(o=t.call(this,n,i)),"_mediaTrack",void 0),o._mediaTrack=e,o}return l(r,[{key:"getTrack",value:function(){return this._mediaTrack}}]),r}(kH),RH=function(e){f(n,e);var t,r=g(n);function n(e,t){var i;return c(this,n),h(m(i=r.call(this,e,t,"video")),"resolution",void 0),h(m(i),"videoCaptureConfig",void 0),h(m(i),"dummy",!1),i.resolution={width:0,height:0},i}return l(n,[{key:"updateVideoCaptureConfig",value:(t=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.videoCaptureConfig&&this.getTrack()){e.next=2;break}return e.abrupt("return");case 2:return bH.print("updateVideoEncoderConfig","update localVideoTrack: ",this.videoCaptureConfig),delete i({},this.videoCaptureConfig).contentHint,e.next=7,this.getTrack().applyConstraints(this.videoCaptureConfig);case 7:((t=this.getTrack().getSettings()).width&&t.width!==this.resolution.width||t.height&&t.height!==this.resolution.height)&&(this.resolution={width:t.width,height:t.height},this.emit("resolution-change",this.resolution));case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"replaceTrack",value:function(e){this.setTrack(e)}},{key:"setContentHint",value:function(e){this._mediaTrack&&"contentHint"in this._mediaTrack&&["text","motion","detail"].includes(e)&&(this._mediaTrack.contentHint=e)}}]),n}(TH),AH=function(e){f(n,e);var t,r=g(n);function n(e,t){var i;return c(this,n),h(m(i=r.call(this,e,t,"audio")),"audioCaptureConfig",void 0),h(m(i),"_audioLevelFetcher",void 0),h(m(i),"mixedAudioTrack",void 0),h(m(i),"mixType",te.PLAYOUT_AND_PUBLISH),i}return l(n,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new mH(this.getTrack("preprocessing"))),this._audioLevelFetcher.getAudioLevel()}},{key:"updateAudioCaptureConfig",value:(t=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.audioCaptureConfig){e.next=2;break}return e.abrupt("return");case 2:return bH.print("updateAudioCaptureConfig","update localAudioTrack: ",this.audioCaptureConfig),e.next=5,null===(t=this.getTrack())||void 0===t?void 0:t.applyConstraints(this.audioCaptureConfig);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),n}(TH),wH=function(e){f(r,e);var t=g(r);function r(e,n){return c(this,r),t.call(this,e,n,"video")}return l(r)}(IH),CH=function(e){f(r,e);var t=g(r);function r(e,n){var i;return c(this,r),h(m(i=t.call(this,e,n,"audio")),"_audioLevelFetcher",void 0),i}return l(r,[{key:"getAudioLevel",value:function(){return this._audioLevelFetcher||(this._audioLevelFetcher=new mH(this.getTrack())),this._audioLevelFetcher.getAudioLevel()}}]),r}(IH),OH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_MAIN),e}return l(r)}(AH),xH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_MAIN),e}return l(r)}(RH),NH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_MAIN),h(m(e),"sourceType",0),e}return l(r)}(RH),DH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_MAIN),h(m(e),"sourceType",0),e}return l(r)}(AH),PH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_SCREEN),e}return l(r)}(RH),MH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_SCREEN),e}return l(r)}(AH),LH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_SCREEN),h(m(e),"sourceType",0),e}return l(r)}(RH),UH=function(e){f(r,e);var t=g(r);function r(){var e;c(this,r);for(var n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return h(m(e=t.call.apply(t,[this].concat(i))),"streamIndex",U.STREAM_INDEX_SCREEN),h(m(e),"sourceType",0),e}return l(r)}(AH);function VH(e,t){return FH.apply(this,arguments)}function FH(){return(FH=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new xH(t,dP())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function BH(e,t){return jH.apply(this,arguments)}function jH(){return(jH=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=new PH(t,dP())).dummy=!0,e.next=4,n.generatePreProcessingTrack(r);case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function GH(e,t){return HH.apply(this,arguments)}function HH(){return(HH=u(o().mark((function e(t,r){var n,i,a,s,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(null==t||null===(n=t.deviceId)||void 0===n?void 0:n.exact)||"default",e.prev=1,bH.print("createCameraVideoTrack","constraints:",t),gB.rtcVideoCaptureEvent({event_type:vB.START,media_device_id:a}),s=lP(),e.next=7,navigator.mediaDevices.getUserMedia({video:t});case 7:i=e.sent,gB.rtcVideoCaptureEvent({event_type:vB.START_CAPTURE_RESULT,media_device_id:a,reason:_B.SUCCESS,elapse:lP()-s}),vH.refreshDevices(),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(1),gB.rtcVideoCaptureEvent({event_type:vB.RUNNING_FAILED,media_device_id:a,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new ZN(JN.GET_VIDEO_TRACK_FAILED,"throw error from getUserMedia",e.t0);case 16:return u=i.getVideoTracks()[0],EH.set(u,i),(c=new xH(u,dP())).videoCaptureConfig=t,e.next=22,c.generatePreProcessingTrack(r);case 22:return e.abrupt("return",c);case 23:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function zH(e,t,r){return qH.apply(this,arguments)}function qH(){return(qH=u(o().mark((function e(t,r,n){var i,a,s,u,c,d,l,h,f,p,v,_;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return bH.print("createCameraVideoTrack","constraints:",t),s=(null==t||null===(i=t.deviceId)||void 0===i?void 0:i.exact)||"default",u=(null==n?void 0:n.config)||{},c=u.sampleRate,d=u.channel,l=u.agc,h=u.ans,f=u.aec,void 0===t.sampleRate&&(t.sampleRate=c),void 0===t.channelCount&&(t.channelCount=d),void 0===t.autoGainControl&&(t.autoGainControl=l),void 0===t.noiseSuppression&&(t.noiseSuppression=h),void 0===t.echoCancellation&&(t.echoCancellation=f),e.prev=8,gB.rtcVideoCaptureEvent({event_type:vB.START,media_device_id:s}),p=lP(),r.getPluginByName(gH.PRE_PROCESSING,"RTCAIAnsExtension")&&(t.autoGainControl=!0,t.noiseSuppression=!1),e.next=14,navigator.mediaDevices.getUserMedia({audio:t});case 14:a=e.sent,gB.rtcVideoCaptureEvent({event_type:vB.START_CAPTURE_RESULT,media_device_id:s,reason:_B.SUCCESS,elapse:lP()-p}),vH.refreshDevices(),e.next=23;break;case 19:throw e.prev=19,e.t0=e.catch(8),gB.rtcVideoCaptureEvent({event_type:vB.RUNNING_FAILED,media_device_id:s,error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new ZN(JN.GET_AUDIO_TRACK_FAILED,"throw error from getUserMedia",e.t0);case 23:return v=a.getAudioTracks()[0],EH.set(v,a),_=new OH(v,dP()),e.next=28,_.generatePreProcessingTrack(r);case 28:return e.abrupt("return",_);case 29:case"end":return e.stop()}}),e,null,[[8,19]])})))).apply(this,arguments)}function XH(){return KH.apply(this,arguments)}function KH(){return KH=u(o().mark((function e(){var t,r,n,i,a,s,u,c,d,l=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]&&l[0],r=l.length>1?l[1]:void 0,n=l.length>2?l[2]:void 0,bH.print("createScreenTracks","withAudio: %o, constraints: %o",t,n),e.prev=4,gB.rtcVideoCaptureEvent({event_type:vB.START,media_device_id:"screen"}),a=lP(),e.next=9,navigator.mediaDevices.getDisplayMedia({video:!(n&&!yP)||n,audio:!!t&&{channelCount:2,noiseSuppression:!1,echoCancellation:!1,autoGainControl:!1}});case 9:i=e.sent,gB.rtcVideoCaptureEvent({event_type:vB.START_CAPTURE_RESULT,media_device_id:"screen",reason:_B.SUCCESS,elapse:lP()-a}),e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(4),gB.rtcVideoCaptureEvent({event_type:vB.RUNNING_FAILED,media_device_id:"screen",error_code:e.t0.code,reason:e.t0.name+e.t0.message}),new ZN(JN.GET_SCREEN_TRACK_FAILED,"throw error from getDisplayMedia",e.t0);case 17:return s=i.getVideoTracks()[0],u=new PH(s,dP()),e.next=21,u.generatePreProcessingTrack(r);case 21:if(!(c=i.getAudioTracks()[0])){e.next=27;break}return d=new MH(c,dP()),e.next=26,d.generatePreProcessingTrack(r);case 26:return e.abrupt("return",[u,d]);case 27:return e.abrupt("return",[u,void 0]);case 28:case"end":return e.stop()}}),e,null,[[4,13]])}))),KH.apply(this,arguments)}function WH(e,t){return YH.apply(this,arguments)}function YH(){return(YH=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new NH(t,dP()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function JH(e,t){return QH.apply(this,arguments)}function QH(){return(QH=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new DH(t,dP()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ZH(e,t){return $H.apply(this,arguments)}function $H(){return($H=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new LH(t,dP()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ez(e,t){return tz.apply(this,arguments)}function tz(){return(tz=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new UH(t,dP()),e.next=3,n.generatePreProcessingTrack(r);case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var rz=AH,nz=function(e){return e[e.NONE=0]="NONE",e}(nz||{}),iz=function(){function e(){c(this,e)}return l(e,null,[{key:"getNalunits",value:function(t){if(t.length-t.position<4)return[];var r=t.position;return 1===t.getInt32(r)||0===t.getInt16(r)&&1===t.getInt8(r+2)?e.getAnnexbNals(t):e.getAvccNals(t)}},{key:"getAnnexbNals",value:function(t){for(var r=[],n=e.getHeaderPositionAnnexB(t),i=n.pos,o=i;i<t.length-4;){var a=new Uint8Array(t.buffer.slice(i,i+n.headerLength));n.pos===t.position&&t.skip(n.headerLength),o=(n=e.getHeaderPositionAnnexB(t)).pos;var s={header:a,body:new Uint8Array(t.buffer.slice(i+a.byteLength,o)),type:-1};e.analyseNal(s),s.type<=9&&0!==s.type&&r.push(s),t.skip(o-t.position),i=o}return r}},{key:"getAvccNals",value:function(t){for(var r=[];t.position<t.length-4;){var n=t.getInt32(t.position);if(!(t.length-t.position>=n))break;var i=new Uint8Array(t.buffer.slice(t.position,t.position+4));t.skip(4);var o=new Uint8Array(t.buffer.slice(t.position,t.position+n));t.skip(n);var a={header:i,body:o,type:-1};e.analyseNal(a),a.type<=9&&0!==a.type&&r.push(a)}return r}},{key:"analyseNal",value:function(e){var t=31&e.body[0];switch(e.type=t,t){case 1:e.ndr=!0;break;case 5:e.idr=!0;break;case 6:e.sei=!0;break;case 7:e.sps=!0;break;case 8:e.pps=!0}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,r=0,n=e.length;3!==r&&4!==r&&t<n-4;)0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:1===e.getInt8(t+2)?r=3:t++:t++;return t===n-4&&(0===e.getInt16(t)?1===e.getInt16(t+2)?r=4:t=n:(t++,0===e.getInt16(t)&&1===e.getInt8(t)?r=3:t=n)),{pos:t,headerLength:r}}}]),e}(),oz=function(){function e(t){c(this,e),h(this,"_position",0),h(this,"_dataview",void 0),this._dataview=new DataView(t)}return l(e,[{key:"length",get:function(){return this.buffer.byteLength}},{key:"buffer",get:function(){return this._dataview.buffer}},{key:"position",get:function(){return this._position},set:function(e){this._position=e}},{key:"back",value:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this._dataview.getUint8(e)}},{key:"getInt8",value:function(e){return this._dataview.getInt8(e)}},{key:"getInt16",value:function(e){return this._dataview.getInt16(e)}},{key:"getUint16",value:function(e){return this._dataview.getUint16(e)}},{key:"getUint32",value:function(e){return this._dataview.getUint32(e)}},{key:"getInt32",value:function(e){return this._dataview.getInt32(e)}},{key:"skip",value:function(t){for(var r=Math.floor(t/4),n=t%4,i=0;i<r;i++)e.readByte(this,4);n>0&&e.readByte(this,n)}},{key:"readUint8",value:function(){return e.readByte(this,1)}},{key:"readUint16",value:function(){return e.readByte(this,2)}},{key:"readUint24",value:function(){return e.readByte(this,3)}},{key:"readUint32",value:function(){return e.readByte(this,4)}},{key:"readUint64",value:function(){return e.readByte(this,8)}},{key:"readInt8",value:function(){return e.readByte(this,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}],[{key:"readByte",value:function(e,t,r){var n;switch(t){case 1:n=r?e.getInt8(e.position):e.getUint8(e.position);break;case 2:n=r?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(r)throw new Error("not supported for readByte 3");n=e.getUint8(e.position)<<16,n|=e.getUint8(e.position+1)<<8,n|=e.getUint8(e.position+2);break;case 4:n=r?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(r)throw new Error("not supported for readBody 8");n=e.getUint32(e.position)<<32,n|=e.getUint32(e.position+4);break;default:n=""}return e.position+=t,n}}]),e}(),az=function(e){return e[e.internal=0]="internal",e[e.external=1]="external",e[e.bypass=2]="bypass",e}(az||{}),sz=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,85]),uz=new Uint8Array([109,167,53,190,103,90,72,1,170,89,63,164,194,199,19,84]),cz=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]&&t.push(3),t.push(e[r]);return new Uint8Array(t)};function dz(e){for(var t=[];e>=255;)e-=255,t.push(255);return t.push(e),new Uint8Array(t)}function lz(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=0;255===e[t]&&t<e.byteLength;)t++,r+=255;return t<e.byteLength&&(r+=e[t++]),[r,t]}var hz=function(){function e(){c(this,e)}return l(e,null,[{key:"generateSEI",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=new Uint8Array([0,0,0,1]),n=new Uint8Array([6]),i=new Uint8Array([5]),o=t?sz:uz,a=dz(e.byteLength+o.byteLength),s=cz(e);return new Uint8Array([].concat(k(r),k(n),k(i),k(a),k(o),k(s),[128]))}},{key:"decodeSeiBody",value:function(e){var t=function(e){for(var t=[],r=0;r<e.length;r++)e[r]<=3&&0===e[r-1]&&0===e[r-2]||t.push(e[r]);return new Uint8Array(t)}(e=e.slice(0,e.length-1));if(!(t.byteLength<2)){var r=0;if(5===t[1]||100===t[1]){var n=E(lz(t,r+=2),2),i=n[0],o=2,a=(r=n[1])+i;return t.byteLength>=uz.byteLength&&i>=uz.byteLength&&t.slice(r,r+uz.byteLength).toString()===uz.toString()?(r+=uz.byteLength,o=1):t.byteLength>=uz.byteLength&&i>=uz.byteLength&&t.slice(r,r+sz.byteLength).toString()===sz.toString()&&(r+=sz.byteLength,o=0),{type:o,payload:t.slice(r,a)}}}}},{key:"parseInternalSEI",value:function(e){var t=new Map,r=0;if(0===e.type){for(;e.payload.byteLength-r>=2;){var n=E(lz(e.payload,r),2),i=n[0];r=n[1];var o=E(lz(e.payload,r),2),a=o[0];if(r=o[1],t.get(i)||!(a<=e.payload.byteLength-r))break;t.set(i,e.payload.slice(r,r+a)),r+=a}return t}}},{key:"makeInternalSei",value:function(e){var t,r=[],n=R(e);try{for(n.s();!(t=n.n()).done;){var i=E(t.value,2),o=i[0],a=i[1],s=dz(o),u=dz(a.byteLength);r.push(s,u,a)}}catch(l){n.e(l)}finally{n.f()}var c=r.reduce((function(e,t){return e+t.byteLength}),0),d=new Uint8Array(c);return r.reduce((function(e,t){return d.set(t,e),e+t.byteLength}),0),d}}]),e}(),fz=function(){function e(t){c(this,e),h(this,"_stream",void 0),h(this,"_timer",void 0),h(this,"client",void 0),h(this,"handler",void 0),h(this,"monitor",void 0),this._stream=t}return l(e,[{key:"setVar",value:function(e,t,r){this.client=e,this.handler=t,this.monitor=r}},{key:"delStatsEvtInterval",value:function(){clearTimeout(this._timer),this._timer=void 0}},{key:"filterIllegal",value:function(e){var t={};return Object.keys(e).forEach((function(r){null===e[r]||void 0===e[r]||Number.isNaN(e[r])||(t[r]=e[r])})),t}},{key:"destroy",value:function(){this.delStatsEvtInterval()}}]),e}(),pz=function(e){f(i,e);var t,r,n=g(i);function i(e){var t;return c(this,i),(t=n.call(this,e))._stream=e,t}return l(i,[{key:"setLocalStreamStatsEvtInterval",value:function(e,t,r){var n,i,a,s=this;if(!this._timer){this.setVar(e,t,r),e.once(tj.ABNORMAL_DISCONNECTION,(function(){s.destroy()}));var c={audio:{},video:{}},d=this._stream,l=null===(n=d.audioTrack)||void 0===n?void 0:n.getTrack("preprocessing"),h=null===(i=d.videoTrack)||void 0===i?void 0:i.getTrack("preprocessing");this.getAudioStats(l,c,null===(a=d.audioTrack)||void 0===a?void 0:a.getAudioLevel()),this.getVideoStats(h,c),this.delStatsEvtInterval();var f=function(){var e=u(o().mark((function e(){var t,r,n,i,a,u,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=null===(t=d.audioTrack)||void 0===t?void 0:t.getTrack("preprocessing"),a=null===(r=d.videoTrack)||void 0===r?void 0:r.getTrack("preprocessing"),e.next=4,s.getAudioStats(i,c,null===(n=d.audioTrack)||void 0===n?void 0:n.getAudioLevel());case 4:return u=e.sent,e.next=7,s.getVideoStats(a,c);case 7:return l=e.sent,e.abrupt("return",{audioStats:u,videoStats:l,isScreen:d.isScreen});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=u(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:r=e.sent,null===(t=s.client)||void 0===t||t.emit("onLocalStreamStats",r),s._timer=setTimeout(p,2e3);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();this._timer=setTimeout(p,2e3)}}},{key:"unpublish",value:function(){this.delStatsEvtInterval()}},{key:"getAudioStats",value:(r=u(o().mark((function e(t,r,n){var i,a,s,u,c,d,l,h,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i={},a={timestamp:Date.now()},s=this._stream,u=s.streamId,c=s.audioMid,d=s.isScreen,l=s.pubAttributes,h={media_type:"audio",is_screen:!!d,direction:"up",stream_id:u,vid:c,connection_status:navigator.onLine,capture_state:l.localaudio?"capture_state_on":"capture_state_off"},t&&this.handler){e.next=6;break}return e.abrupt("return",i);case 6:return e.next=8,this.handler.getStats(t);case 8:if((f=e.sent).length){e.next=11;break}return e.abrupt("return",i);case 11:if(f.forEach((function(e){var t=e.type,r=e.packetsSent,n=e.packetsLost,o=e.bytesSent,s=e.clockRate,u=e.roundTripTime,c=e.channels,d=e.audioLevel;e.googRtt;var l=e.mimeType,f=e.availableIncomingBitrate,p=e.availableOutgoingBitrate,v=e.bytesReceived,_=e.nominated,m=e.id,y=e.currentRoundTripTime,g=e.state,S=e.writable,b=e.requestsReceived,E=e.responsesReceived,k=e.requestsSent,T=e.consentRequestsSent,I=e.responsesSent,R=e.jitter,A=e.candidateType,w=e.ip,C=e.address,O=e.networkType,x=e.port,N=e.protocol,D=e.nackCount,P=e.retransmittedBytesSent,M=e.retransmittedPacketsSent,L=e.audioInputLevel,U=e.ssrc,V=e.totalAudioEnergy,F=e.totalSamplesDuration,B=e.mediaType,j=e.fractionLost;"outbound-rtp"===t?(a.packetsSent=r,a.bytesSent=o,h.bytes=o,h.packetsSent=r,h.nackCount=D,h.ssrc=U,h.retransmitted_bytes_sent=P,h.retransmitted_packets_sent=M,a.retransmittedBytesSent=P,a.retransmittedPacketsSent=M):"remote-inbound-rtp"===t?(a.packetsLost=n,h.packetsLost=n,h.net_jitter=1e3*R,i.rtt=1e3*u,h.rtt=i.rtt,i._fractionLost=j||0):"codec"===t?(i.recordSampleRate=s,i.numChannels=c,h.codecName=l):"media-source"===t&&void 0!==d?(h.audio_level=d?-10*Math.log10(Math.pow(d,2)):d,h.volume=255*d,h.total_audio_energy=V,h.totalInputDuration=F):"ssrc"===t&&"audio"===B?h.send_level=L:"candidate-pair"===t?(h.ice_available_incoming_bitrate=f,h.ice_available_outgoing_bitrate=p,h.ice_bytes_received=v,h.ice_bytes_sent=o,h.ice_nominated=+_,h.ice_pair_id=m,h.ice_pair_rtt=y,h.ice_pair_state=g,h.ice_pair_writable=S,h.recv_ping_requests=b,h.recv_ping_responses=E,h.sent_ping_requests_before_first_response=k,h.sent_ping_requests_total=k+(T||0),h.sent_ping_responses=I):"local-candidate"===t?(h.local_candidate_type=A,h.local_ip=w||C,h.local_network_type=O,h.local_port=x,h.protocol=N):"remote-candidate"===t&&(h.remote_candidate_type=A,h.remote_ip=w||C,h.remote_port=x)})),void 0===h.volume&&void 0!==n&&(h.volume=n,h.audio_level=n?-10*Math.log10(Math.pow(n/255,2)):n),(p=r.audio).timestamp){e.next=17;break}return r.audio=a,e.abrupt("return",this.filterIllegal(i));case 17:return void 0!==a.packetsLost&&(i.audioLossRate=(a.packetsLost-p.packetsLost)/(a.packetsSent-p.packetsSent),i.audioLossRate=Number.isNaN(i.audioLossRate)?0:i.audioLossRate,h.fraction_lost=i.audioLossRate),i.statsInterval=a.timestamp-p.timestamp,h.stats_interval=i.statsInterval,i.sendKBitrate=(a.bytesSent-p.bytesSent||0)/i.statsInterval*8,h.mediaBitratebps=Math.round(1e3*i.sendKBitrate),h.bandwidth=Math.round(h.mediaBitratebps/1024),void 0!==a.retransmittedBytesSent&&(h.retransmitBitratebps=(a.retransmittedBytesSent-p.retransmittedBytesSent||0)/i.statsInterval),r.audio=a,this.monitor.rtcMediaStatistics(h,{}),i._retransmittedRate=(a.retransmittedPacketsSent-p.retransmittedPacketsSent)/(a.packetsSent-p.packetsSent),i._fractionLost=Math.max(i._fractionLost,i.audioLossRate),e.abrupt("return",this.filterIllegal(i));case 29:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"getVideoStats",value:(t=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h,f,p,v,_,m;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},i={timestamp:Date.now(),simulcast:{}},a=this._stream,s=a.streamId,u=a.videoMid,c=a.isScreen,d=a.pubAttributes,l=a.enableSimulcast,h={media_type:"video",is_screen:!!c,direction:"up",stream_id:s,vid:u,connection_status:navigator.onLine,capture_state:d.localvideo?"capture_state_on":"capture_state_off"},t&&this.handler){e.next=6;break}return e.abrupt("return",n);case 6:return n.isScreen=c,e.next=9,this.handler.getStats(t);case 9:if((f=e.sent).length){e.next=12;break}return e.abrupt("return",n);case 12:if(p=0,f.forEach((function(e){var t=e.type,r=e.framesEncoded,o=e.packetsLost,a=e.bytesSent,s=e.framesSent,u=e.roundTripTime,c=e.mimeType,d=e.frameWidth,f=e.frameHeight,v=e.packetsSent,_=e.googActualEncBitrate,m=e.googAvailableReceiveBandwidth,y=e.googAvailableSendBandwidth,g=e.googAvgEncodeMs,S=e.googBucketDelay,b=e.googEncodeUsagePercent,E=e.googFrameRateInput,k=e.availableIncomingBitrate,T=e.availableOutgoingBitrate,I=e.bytesReceived,R=e.nominated,A=e.id,w=e.currentRoundTripTime,C=e.state,O=e.writable,x=e.candidateType,N=e.ip,D=e.address,P=e.networkType,M=e.port,L=e.nackCount,U=e.pliCount,V=e.protocol,F=e.qpSum,B=e.requestsReceived,j=e.responsesReceived,G=e.googRetransmitBitrate,H=e.requestsSent,z=e.consentRequestsSent,q=e.responsesSent,X=e.ssrc,K=e.googTargetEncBitrate,W=e.googTransmitBitrate,Y=e.retransmittedPacketsSent,J=e.encoderImplementation,Q=e.jitter,Z=e.rid,$=e.fractionLost,ee=e.googAdaptationChanges,te=e.googBandwidthLimitedResolution,re=e.googCpuLimitedResolution,ne=e.googFirsReceived,ie=e.googFrameRateSent;"outbound-rtp"===t?(l&&(Z?i.simulcast[Z]=e:i.simulcast[p]=e,p++),i.framesEncoded=r,i.bytesSent=a,i.framesSent=s,h.bytes=a,i.packetsSent=v,h.packetsSent=v,h.nackCount=L,h.pli_count=U,h.qp_sum=F,h.ssrc=X,h.retransmitted_packets_sent=Y,i.retransmittedPacketsSent=Y,h.encoder_implementation=J,void 0!==d&&(n.encodedFrameWidth=d,n.encodedFrameHeight=f,h.frame_size_height=f,h.frame_size_width=d)):"track"===t?(n.encodedFrameWidth=d,n.encodedFrameHeight=f,h.frame_size_height=f,h.frame_size_width=d):"remote-inbound-rtp"===t?(i.packetsLost=o,n.rtt=1e3*u,h.rtt=n.rtt,h.jitter=Q,h.packetsLost=o,n._fractionLost=$||0):"codec"===t?(n.codecType=c,h.codecName=c):"candidate-pair"===t?(h.ice_available_incoming_bitrate=k,h.ice_available_outgoing_bitrate=T,h.ice_bytes_received=I,h.ice_bytes_sent=a,h.ice_nominated=+R,h.ice_pair_id=A,h.ice_pair_rtt=w,h.ice_pair_state=C,h.ice_pair_writable=O,h.recv_ping_requests=B,h.recv_ping_responses=j,h.sent_ping_requests_before_first_response=H,h.sent_ping_requests_total=H+z,h.sent_ping_responses=q):"local-candidate"===t?(h.local_candidate_type=x,h.local_ip=N||D,h.local_network_type=P,h.local_port=M,h.protocol=V):"remote-candidate"===t?(h.remote_candidate_type=x,h.remote_ip=N||D,h.remote_port=M):"VideoBwe"===t?(h.encBitratebps=_,h.available_receive_bandwidth=m,h.available_send_bandwidth=y,h.bucket_delay=S,h.retransmitBitratebps=G,h.targetEncBitratebps=K,h.transmit_bitrate=W,n._sendBandWidth=+y):"ssrc"===t&&(h.avg_encode_ms=g,h.encodeUsage=b,h.frame_rate_input=E,h.orignal_input_Framerate=+E,h.ddaptationChanges=ee,h.qualityLimitationReason=te,h.qualityLimitationDurations=re,h.firsReceived=ne,h.frameRateSent=ie)})),(v=r.video).timestamp){e.next=18;break}return r.video=i,e.abrupt("return",this.filterIllegal(n));case 18:return n.statsInterval=i.timestamp-v.timestamp,h.stats_interval=n.statsInterval,_=Object.keys(i.simulcast),l?(h.sim_enc_width=[],h.sim_enc_height=[],h.sim_enc_bps=[],h.sim_enc_framerate=[],h.sim_rids=[],h.sim_enc_bandwidth=[],h.sim_sent_framerate=[],h.sim_fraction_lost=[],h.sim_keyencoded=[],h.active_sim_streams=[],h.sim_retransmittedRate=[],m=!1,_.sort((function(e,t){return+e-+t})).forEach((function(e){var t=i.simulcast[e],r=t.frameWidth,o=t.frameHeight,a=t.bytesSent,s=t.framesEncoded,u=t.framesSent,c=t.packetsLost,d=t.packetsSent,l=t.qualityLimitationReason,f=t.qualityLimitationDurations,p=t.qualityLimitationResolutionChanges,_=t.retransmittedPacketsSent,y=t.pliCount;void 0!==l&&(h.sim_qualityLimitationReason||(h.sim_qualityLimitationReason=[],h.sim_qualityLimitationDurations=[],h.sim_qualityLimitationResolutionChanges=[]),h.sim_qualityLimitationReason.push(l),h.sim_qualityLimitationDurations.push(f),h.sim_qualityLimitationResolutionChanges.push(p));var g=v.simulcast[e];if(h.sim_enc_width.push(r||0),h.sim_enc_height.push(o||0),g){var S=(a-g.bytesSent||0)/n.statsInterval;h.sim_enc_bps.push(Math.round(8e3*S)),h.sim_enc_bandwidth.push(Math.round(8e3*S/1024));var b=1e3*(s-g.framesEncoded)/n.statsInterval;h.sim_enc_framerate.push(Math.round(b)),h.sim_rids.push(e);var E=void 0!==u?u-g.framesSent:s-g.framesEncoded,k=1e3*E/n.statsInterval;h.sim_sent_framerate.push(Math.round(k));var T=(c-g.packetsLost)/(d-g.packetsSent);n._retransmittedRate=(_-g.retransmittedPacketsSent)/(d-g.packetsSent),T=Number.isNaN(T)?0:T,h.sim_fraction_lost.push(T),h.sim_keyencoded.push(y-g.pliCount>0),h.active_sim_streams.push(S>=0),h.sim_retransmittedRate.push(n._retransmittedRate),r>0&&!m&&(n.sentKBitrate=8*S,n.encoderOutputFrameRate=b,n.encodedFrameCount=E,n.sentFrameRate=k,n.videoLossRate=T,m=!0)}})),this.monitor.rtcMediaStatistics(h,{})):(n.encodedFrameCount=void 0!==i.framesSent?i.framesSent-v.framesSent:i.framesEncoded-v.framesEncoded,n.sentKBitrate=(i.bytesSent-v.bytesSent||0)/n.statsInterval*8,h.bitrate=Math.round(1e3*n.sentKBitrate),h.bandwidth=Math.round(h.bitrate/1024),n.encoderOutputFrameRate=1e3*(i.framesEncoded-v.framesEncoded)/n.statsInterval,h.frame_rate_encoded=Math.round(n.encoderOutputFrameRate),n.sentFrameRate=1e3*n.encodedFrameCount/n.statsInterval,h.frame_rate_sent=Math.round(n.sentFrameRate),n.videoLossRate=(i.packetsLost-v.packetsLost)/(i.packetsSent-v.packetsSent),n.videoLossRate=Number.isNaN(n.videoLossRate)?0:n.videoLossRate,h.fraction_lost=n.videoLossRate,n._retransmittedRate=(i.retransmittedPacketsSent-v.retransmittedPacketsSent)/(i.packetsSent-v.packetsSent),this.monitor.rtcMediaStatistics(h,{})),r.video=i,n._fractionLost=Math.max(n._fractionLost,n.videoLossRate),e.abrupt("return",this.filterIllegal(n));case 25:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})}]),i}(fz),vz=function(e){f(a,e);var t,r,n,i=g(a);function a(e){var t;return c(this,a),h(m(t=i.call(this,e)),"_audioStallCount",void 0),h(m(t),"_setAudioStallCount",void 0),h(m(t),"_audioStallTimer",void 0),h(m(t),"_audioStallInterval",void 0),h(m(t),"_audioStallRatio",void 0),h(m(t),"_videoInWaiting",void 0),h(m(t),"_context",void 0),t._videoInWaiting=!1,t}return l(a,[{key:"setRemoteStreamStatsEvtInterval",value:(n=u(o().mark((function e(t,r,n,i){var s,c,d,l,h,f,p,v,_,m,y,g,S,b,E=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._timer){e.next=2;break}return e.abrupt("return");case 2:return this.setVar(t,r,n),this._context=i,t.once(tj.ABNORMAL_DISCONNECTION,(function(){E.destroy()})),this._audioStallInterval=a.audioStallInterval||100,this._audioStallRatio=a.audioStallRatio||.6,d={audio:{},video:{}},l=this._stream,h=null===(s=l.audioTrack)||void 0===s?void 0:s.getTrack(),f=null===(c=l.videoTrack)||void 0===c?void 0:c.getTrack(),this.getRemoteVideoStats(f,d),e.next=14,this.getRemoteAudioStats(h,d);case 14:this.delStatsEvtInterval(),p=0,v=0,m=[],y=0,g=lP(),this._setAudioStallCount=function(){if(E._audioStallInterval>0&&void 0!==d.audio.concealedSamples){var e=d.audio.concealedSamples,t=d.audio.totalSamplesReceived;g=lP();var r={isStall:!1,counted:!1,diff:0},n=.5*E._audioStallInterval;E._audioStallCount=u(o().mark((function i(){var a,s,u,c,d,h,f,_,S,b,k,T,I,R,A;return o().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=l.hasAudio,u=l.subAudio,s&&u){i.next=7;break}return r.isStall=!1,r.counted=!1,m.push({reason:"hasAudio: ".concat(s,", subAudio: ").concat(u)}),g=lP(),i.abrupt("return",{stall_count:p,stall_duration:v,stall_list:m,stats_count:y});case 7:return c=null===(a=l.audioTrack)||void 0===a?void 0:a.getTrack(),d=Date.now(),i.next=11,E.handler.getStats(c,!0);case 11:if(h=i.sent,f=Date.now(),_=lP(),!((S=_-g)<n)){i.next=18;break}return m.push({diff:S,start:g,end:_,get_stats_cost:f-d,get_stats_start:d,get_stats_end:f,reason:"diff(".concat(S,") < minInterval(").concat(n,")")}),i.abrupt("return",{stall_count:p,stall_duration:v,stall_list:m,stats_count:y});case 18:if(b=h.length,k=h.find((function(e){return"inbound-rtp"===e.type}))){i.next=23;break}return m.push({diff:S,start:g,end:_,get_stats_cost:f-d,get_stats_start:d,get_stats_end:f,reason:b?"no inbound-rtp":"no report"}),i.abrupt("return",{stall_count:p,stall_duration:v,stall_list:m,stats_count:y});case 23:return T=k.concealedSamples,I=k.totalSamplesReceived,A=I-t,(R=T-e)>=0&&A>=0&&R>=E._audioStallRatio*A?(m.push({concealed:R,received:A,diff:S,start:g,end:_,get_stats_cost:f-d,get_stats_start:d,get_stats_end:f,is_stall:!0}),r.isStall?(r.counted?v+=S:(v=v+r.diff+S,p++),r.counted=!0):S>=200?(v+=S,p++,r.counted=!0):(r.counted=!1,r.diff=S),r.isStall=!0):(m.push({concealed:R,received:A,diff:S,start:g,end:_,get_stats_cost:f-d,get_stats_start:d,get_stats_end:f}),r.isStall=!1,r.counted=!1),e=T,t=I,g=_,y++,i.abrupt("return",{stall_count:p,stall_duration:v,stall_list:m,stats_count:y});case 32:case"end":return i.stop()}}),i)}))),_=function(){var e=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!E._audioStallCount&&E._setAudioStallCount&&E._setAudioStallCount(),!E._audioStallCount){e.next=5;break}return e.next=4,E._audioStallCount();case 4:E._audioStallTimer=setTimeout(_,E._audioStallInterval);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),clearTimeout(E._audioStallTimer),E._audioStallTimer=setTimeout(_,E._audioStallInterval)}},this._setAudioStallCount(),S=function(){var e=u(o().mark((function e(){var t,r,n,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null===(t=l.audioTrack)||void 0===t?void 0:t.getTrack(),i=null===(r=l.videoTrack)||void 0===r?void 0:r.getTrack(),e.next=4,E.getRemoteAudioStats(n,d);case 4:return a=e.sent,p=0,v=0,m=[],y=0,e.next=11,E.getRemoteVideoStats(i,d);case 11:return s=e.sent,e.abrupt("return",{audioStats:a,videoStats:s,isScreen:l.isScreen,userId:l.userId});case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=u(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S();case 2:r=e.sent,null===(t=E.client)||void 0===t||t.emit("onRemoteStreamStats",r),_&&(g=lP(),clearTimeout(E._audioStallTimer),E._audioStallTimer=setTimeout(_,E._audioStallInterval)),E._timer=setTimeout(b,2e3);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),this._timer=setTimeout(b,2e3);case 25:case"end":return e.stop()}}),e,this)}))),function(e,t,r,i){return n.apply(this,arguments)})},{key:"delStatsEvtInterval",value:function(){b(p(a.prototype),"delStatsEvtInterval",this).call(this),clearTimeout(this._audioStallTimer),this._audioStallCount=void 0,this._setAudioStallCount=void 0}},{key:"unsubscribe",value:function(){this.delStatsEvtInterval(),this._videoInWaiting=!1}},{key:"getRemoteAudioStats",value:(r=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},i={},a=this._stream,s=a.streamId,u=a.userId,c=a.isScreen,d=a.audioMid,l=a.subMediaType,h=a._attributes,f={media_type:"audio",is_screen:!!c,direction:"down",stream_id:s,stream_user_id:u,vid:d,connection_status:navigator.onLine,mute_state:AP(l)?"mute_state_off":"mute_state_on",remote_user_capture_state:h.localaudio?"capture_state_on":"capture_state_off",remote_user_mute_state:h.localaudio&&h.audiostream?"mute_state_off":"mute_state_on"},t&&this.handler){e.next=6;break}return e.abrupt("return",n);case 6:return e.next=8,this.handler.getStats(t);case 8:if((p=e.sent).length){e.next=11;break}return e.abrupt("return",n);case 11:if(p.forEach((function(e){var t=e.type,r=e.packetsLost,o=e.packetsReceived,a=e.bytesReceived,u=e.jitterBufferDelay,c=e.jitterBufferEmittedCount,d=e.clockRate,l=e.channels,h=e.totalSamplesReceived,p=e.concealedSamples,v=e.silentConcealedSamples,_=e.concealmentEvents,m=e.totalRoundTripTime,y=e.packetsDiscarded,g=e.state,S=e.currentRoundTripTime,b=e.audioLevel,k=e.totalAudioEnergy,T=e.totalSamplesDuration,I=e.mimeType,R=e.googDecodingNormal,A=e.availableIncomingBitrate,w=e.availableOutgoingBitrate,C=e.bytesSent,O=e.nominated,x=e.id,N=e.writable,D=e.jitter,P=e.candidateType,M=e.ip,L=e.address,U=e.networkType,V=e.port,F=e.protocol,B=e.audioOutputLevel,j=e.requestsReceived,G=e.responsesReceived,H=e.requestsSent,z=e.consentRequestsSent,q=e.responsesSent,X=e.ssrc;e.kind;var K=e.nackCount,W=e.lastPacketReceivedTimestamp,Y=e.concealmentevents,J=e.fecPacketsReceived;if("inbound-rtp"===t)i.packetsLost=r,i.packetsReceived=o,f.packetsReceived=o,f.packetsDiscarded=y,f.nackCount=K,f.lastPacketReceivedTimestamp=W,f.concealmentevents=Y,i.bytesReceived=a,void 0!==u&&(n.jitterBufferDelay=u/c*1e3,f.average_jitter_buffer_delay_ms=n.jitterBufferDelay),void 0!==h&&(i.totalSamplesReceived=h,n.concealedSamples=p,i.concealedSamples=p,i.silentConcealedSamples=v,f.concealedSamples=p,n.concealmentEvents=_,f.totalSamplesReceived=h),void 0!==J&&(f.fec_packets_received=J,i.fecPacketsReceived=J),f.jitter=1e3*D,f.ssrc=X;else if("codec"===t)n.recordSampleRate=d,l&&(n.numChannels=l),f.codecName=I;else if("candidate-pair"===t){var Q,Z,$;f.ice_available_incoming_bitrate=A,f.ice_available_outgoing_bitrate=w,f.ice_bytes_received=a,f.ice_bytes_sent=C,f.ice_nominated=+O,f.ice_pair_id=x,f.ice_pair_rtt=S,f.rtt=1e3*S,f.rtt&&null!==(Q=E._context)&&void 0!==Q&&null!==(Z=Q.streamRTT)&&void 0!==Z&&null!==($=Z[s])&&void 0!==$&&$.audio&&(f.total_rtt_ms=f.rtt+E._context.streamRTT[s].audio),f.ice_pair_state=g,f.ice_pair_writable=N,f.recv_ping_requests=j,f.recv_ping_responses=G,f.sent_ping_requests_before_first_response=H,f.sent_ping_requests_total=H+(z||0),f.sent_ping_responses=q,"succeeded"===g&&(n.rtt=1e3*S,n.total_rtt=1e3*m)}else"track"===t&&void 0!==b?(f.audio_level=b?-10*Math.log10(Math.pow(b,2)):b,f.volume=255*b,f.total_audio_energy=k,f.totalAudioDuration=T):"ssrc"===t?(f.decodingNormal=R,f.recvAudioLevel=B):"local-candidate"===t?(f.local_candidate_type=P,f.local_ip=M||L,f.local_network_type=U,f.local_port=V,f.protocol=F):"remote-candidate"===t&&(f.remote_candidate_type=P,f.remote_ip=M||L,f.remote_port=V)})),(v=r.audio).timestamp){e.next=17;break}return i.timestamp=Date.now(),r.audio=i,e.abrupt("return",this.filterIllegal(n));case 17:if(_={},void 0!==i.concealedSamples&&(f.interval_concealed_samples=i.concealedSamples-v.concealedSamples,f.interval_samples_received=i.totalSamplesReceived-v.totalSamplesReceived,f.interval_silent_concealed_samples=i.silentConcealedSamples-v.silentConcealedSamples),!(this._audioStallInterval>0&&void 0!==v.concealedSamples)){e.next=35;break}if(!this._audioStallCount&&this._setAudioStallCount&&this._setAudioStallCount(),clearTimeout(this._audioStallTimer),!this._audioStallCount){e.next=35;break}return e.next=25,this._audioStallCount();case 25:m=e.sent,y=m.stall_count,g=m.stall_duration,S=m.stall_list,b=m.stats_count,_.stall_list=S,_.stats_count=b,f.concealedSamples===f.interval_concealed_samples&&f.totalSamplesReceived===f.interval_samples_received?(f.stall_count=0,f.stall_duration=0):(f.stall_count=y,f.stall_duration=g),n.stallCount=f.stall_count,n.stallDuration=f.stall_duration;case 35:return i.timestamp=Date.now(),n.audioLossRate=(i.packetsLost-v.packetsLost)/(i.packetsReceived-v.packetsReceived+(i.packetsLost-v.packetsLost)),n.audioLossRate=Number.isNaN(n.audioLossRate)?0:n.audioLossRate,f.packetsLost=Math.round(i.packetsLost-v.packetsLost),f.fraction_lost=n.audioLossRate,n.statsInterval=i.timestamp-v.timestamp,f.stats_interval=n.statsInterval,n.receivedKBitrate=(i.bytesReceived-v.bytesReceived||0)/n.statsInterval*8,f.bandwidth=Math.round(1e3*n.receivedKBitrate/1024),void 0!==i.concealedSamples&&(n.receivedSampleRate=1e3*f.interval_samples_received/n.statsInterval),void 0!==i.fecPacketsReceived&&(f.fecBitratebps=(i.fecPacketsReceived-v.fecPacketsReceived||0)/n.statsInterval),r.audio=i,this.monitor.rtcMediaStatistics(f,{},_),e.abrupt("return",this.filterIllegal(n));case 49:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"getRemoteVideoStats",value:(t=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h,f,p,v=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},i={timestamp:Date.now()},a=this._stream,s=a.streamId,u=a.userId,c=a.isScreen,d=a.subMediaType,l=a._attributes,h={media_type:"video",is_screen:!!c,direction:"down",stream_id:s,stream_user_id:u,vid:this._stream.videoMid,connection_status:navigator.onLine,mute_state:wP(d)?"mute_state_off":"mute_state_on",remote_user_capture_state:l.localvideo?"capture_state_on":"capture_state_off",remote_user_mute_state:l.localvideo&&l.videostream?"mute_state_off":"mute_state_on"},t&&this.handler){e.next=6;break}return e.abrupt("return",n);case 6:return n.isScreen=c,e.next=9,this.handler.getStats(t);case 9:if((f=e.sent).length){e.next=12;break}return e.abrupt("return",n);case 12:if(f.forEach((function(e){var t=e.type,r=e.frameHeight,o=e.frameWidth,a=e.packetsLost,u=e.packetsReceived,c=e.bytesReceived,d=e.framesDecoded,l=e.jitterBufferDelay,f=e.jitterBufferEmittedCount,p=e.mimeType,_=e.firCount,m=e.availableIncomingBitrate,y=e.availableOutgoingBitrate,g=e.bytesSent,S=e.nominated,b=e.id,E=e.currentRoundTripTime,k=e.state,T=e.writable,I=e.candidateType,R=e.ip,A=e.address,w=e.networkType,C=e.port,O=e.nackCount,x=e.pliCount,N=e.protocol,D=e.requestsReceived,P=e.responsesReceived,M=e.requestsSent,L=e.consentRequestsSent,U=e.responsesSent,V=e.ssrc,F=e.jitter,B=e.framesReceived,j=e.keyFramesDecoded,G=e.decoderImplementation,H=e.lastPacketReceivedTimestamp;if("inbound-rtp"===t)i.packetsLost=a,h.packetsLost=a,i.packetsReceived=u,h.packetsReceived=u,i.bytesReceived=c,h.bytes=c,i.framesDecoded=d,void 0!==l&&(i.jitterBufferDelay=l/f*1e3,h.average_jitter_buffer_delay_ms=i.jitterBufferDelay),h.fir_count=_,h.nackCount=O,i.nackCount=O,h.pli_count=x,h.ssrc=V,h.jitter=F,h.framesReceived=B,i.framesReceived=B,h.framesDecoded=d,h.key_frames_decoded=j,h.decoder_name=G,h.last_packet_received_timestamp=H,void 0!==o&&(n.width=o,h.frame_size_width=o,n.height=r,h.frame_size_height=r);else if("track"===t&&void 0!==o)n.width=o,h.frame_size_width=o,n.height=r,h.frame_size_height=r,void 0!==B&&(h.framesReceived=B,i.framesReceived=B);else if("codec"===t)h.codecName=p;else if("candidate-pair"===t){var z,q,X;h.ice_available_incoming_bitrate=m,h.ice_available_outgoing_bitrate=y,h.ice_bytes_received=c,h.ice_bytes_sent=g,h.ice_nominated=+S,h.ice_pair_id=b,h.ice_pair_rtt=E,h.rtt=1e3*E,h.rtt&&null!==(z=v._context)&&void 0!==z&&null!==(q=z.streamRTT)&&void 0!==q&&null!==(X=q[s])&&void 0!==X&&X.video&&(h.total_rtt_ms=h.rtt+v._context.streamRTT[s].video),n.rtt=h.rtt,h.ice_pair_state=k,h.ice_pair_writable=T,h.recv_ping_requests=D,h.recv_ping_responses=P,h.sent_ping_requests_before_first_response=M,h.sent_ping_requests_total=M+(L||0),h.sent_ping_responses=U}else"local-candidate"===t?(h.local_candidate_type=I,h.local_ip=R||A,h.local_network_type=w,h.local_port=C,h.protocol=N):"remote-candidate"===t&&(h.remote_candidate_type=I,h.remote_ip=R||A,h.remote_port=C)})),(p=r.video).timestamp){e.next=17;break}return r.video=i,e.abrupt("return",this.filterIllegal(n));case 17:return n.videoLossRate=(i.packetsLost-p.packetsLost)/(i.packetsReceived-p.packetsReceived+(i.packetsLost-p.packetsLost)),n._retransmittedRate=(i.nackCount-p.nackCount)/(i.packetsReceived-p.packetsReceived+(i.packetsLost-p.packetsLost)),n.videoLossRate=Number.isNaN(n.videoLossRate)?0:n.videoLossRate,h.fraction_lost=n.videoLossRate,n.statsInterval=i.timestamp-p.timestamp,h.stats_interval=n.statsInterval,n.receivedKBitrate=(i.bytesReceived-p.bytesReceived||0)/n.statsInterval*8,h.bitrate=Math.round(1e3*n.receivedKBitrate),h.bandwidth=Math.round(h.bitrate/1024),n.decoderOutputFrameRate=1e3*(i.framesDecoded-p.framesDecoded)/n.statsInterval,n.receivedFrameRate=1e3*(i.framesReceived-p.framesReceived)/n.statsInterval,h.frame_rate_decoded=Math.round(n.decoderOutputFrameRate),h.frame_rate_received=h.frame_rate_decoded,r.video=i,this.processStall(this._stream,h,n,c),this.monitor.rtcMediaStatistics(h,{}),e.abrupt("return",this.filterIllegal(n));case 34:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"processStall",value:function(e,t,r,n){var i=0,o=0,a=0;if(e.recordedVideoFrames){e.recordedVideoFrames.forEach((function(e){e.isStall&&(i+=e.stallCount,o+=e.stallDuration),a=e.playTime})),e.recordedVideoFrames.length||(o=2e3,i=this._videoInWaiting?0:1,this._videoInWaiting=!0);var s=e.recordedVideoFrames.pop();s&&(s.isStall?this._videoInWaiting=!0:this._videoInWaiting=!1),e.recordedVideoFrames=[]}t.stall_count=i,n?(t.stuck_length=o,t.stall_duration=void 0):(t.stall_duration=o,t.stuck_length=void 0),t.play_time=a,r.stallCount=i,r.stallDuration=o}},{key:"destroy",value:function(){b(p(a.prototype),"destroy",this).call(this),this.delStatsEvtInterval(),this._videoInWaiting=!1}}],[{key:"audioStallConfig",set:function(e){a.audioStallInterval=((null==e?void 0:e.audio_stall_interval)||200)/2,a.audioStallRatio=null==e?void 0:e.audio_stall_ratio}}]),a}(fz);h(vz,"audioStallInterval",void 0),h(vz,"audioStallRatio",void 0);var _z,mz,yz,gz=function(e){return e.RESUBSCRIBE="resubscribe",e.STREAM_FAILED="stream_failed",e.SUBSCRIBE_PUSH_TRACK="subscribe_push_track",e.REMOVE_PUSH_TRACK="remove_push_track",e.VIDEO_FIRST_FRAME="video_first_frame",e.ON_USER_PUBLISH_STATE_CHANGE="on_user_publish_state_change",e.ON_USER_START_AUDIO_CAPTURE="on_user_start_audio_capture",e.ON_USER_STOP_AUDIO_CAPTURE="on_user_stop_audio_capture",e.ON_USER_START_VIDEO_CAPTURE="on_user_start_video_capture",e.ON_USER_STOP_VIDEO_CAPTURE="on_user_stop_video_capture",e.ON_SEI_MESSAGED_RECEIVED="on_sei_messaged_received",e.ON_PUBLISH_RESULT="on_publish_result",e.ON_UPDATE_TOKEN_SUCCESS="on_update_token_success",e.ON_REMOTE_STREAM_STATS="ON_REMOTE_STREAM_STATS",e.ON_LOCAL_STREAM_STATS="ON_LOCAL_STREAM_STATS",e.ON_USER_LEAVE="on_user_leave",e.ON_ROOM_ERROR="on_room_error",e.ON_NETWORK_QUALITY="on_network_quality",e.ON_SIMULCAST_SUBSCRIBE_FALLBACK="on_simulcast_subscribe_fallback",e.ON_REMOTE_VIDEO_SIZE_CHANGED="on_remote_video_size_changed",e.RECONNECT_FAILED="reconnect_failed",e.ON_VIDEO_STREAM_BANNED="ON_VIDEO_STREAM_BANNED",e.ON_AUDIO_STREAM_BANNED="ON_AUDIO_STREAM_BANNED",e}(gz||{}),Sz=function(e){return e[e.START=1]="START",e[e.START_SUCCESS=2]="START_SUCCESS",e[e.START_FAILED=3]="START_FAILED",e[e.UPDATE=4]="UPDATE",e[e.UPDATE_SUCCESS=5]="UPDATE_SUCCESS",e[e.UPDATE_FAILED=6]="UPDATE_FAILED",e[e.STOP=7]="STOP",e[e.STOP_SUCCESS=8]="STOP_SUCCESS",e[e.STOP_FAILED=9]="STOP_FAILED",e}(Sz||{}),bz=function(e){return e[e.PUB=0]="PUB",e[e.UNPUB=1]="UNPUB",e}(bz||{}),Ez=function(e){return e[e.SUB=0]="SUB",e[e.UNSUB=1]="UNSUB",e}(Ez||{}),kz=new ML("Stream",0),Tz=function(e){return e[e.INIT=0]="INIT",e[e.SUB_ING=1]="SUB_ING",e[e.SUB_ED=2]="SUB_ED",e}(Tz||{}),Iz=function(){function e(){c(this,e),h(this,"isScreen",!1),h(this,"stream",void 0),h(this,"streamId",void 0),h(this,"audioMid",void 0),h(this,"videoMid",void 0),h(this,"seiList",[]),h(this,"videoTrack",void 0),h(this,"audioTrack",void 0),h(this,"videoTransceiver",void 0),h(this,"audioTransceiver",void 0),h(this,"videoInputConfig",void 0),h(this,"videoEncodeConfig",[YB]),h(this,"subVideoDescriptions",[]),h(this,"enableSimulcast",!1),h(this,"observer",void 0),h(this,"statsReport",void 0),h(this,"prevScaleResolutionDownBy",1),h(this,"pubAudio",!1),h(this,"pubVideo",!1),h(this,"pubAttributes",void 0),this.stream=new MediaStream,this.videoInputConfig={width:640,height:360,frameRate:30},this.pubAttributes={localaudio:!1,localvideo:!1,videostream:!1,audiostream:!1,extvideo:!1,extaudio:!1},this.statsReport=new pz(this)}return l(e,[{key:"hasPublished",get:function(){return this.videoTransceiver&&this.audioTransceiver}},{key:"isEmptyStream",get:function(){return!this.audioTrack&&!this.videoTrack}},{key:"initStreamId",get:function(){return this.stream.id}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.sender){var t=this.videoTransceiver.sender;if(xj()){var r=t.createEncodedStreams(),n=r.readable,i=r.writable,o=new TransformStream({transform:function(t,r){var n=e.seiList[0];if(n){var i=hz.generateSEI(n.content),o=new Uint8Array(i.byteLength+t.data.byteLength);0===n.repeatCount&&e.seiList.splice(0,1),n.repeatCount--,o.set(new Uint8Array(t.data)),o.set(i,t.data.byteLength),t.data=o.buffer,r.enqueue(t)}else r.enqueue(t)}});n.pipeThrough(o).pipeTo(i)}}else kz.print("no sender found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.sender){var e=this.audioTransceiver.sender.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else kz.print("no sender found when trying to bind encodedTransform")}},{key:"clean",value:function(){var e;this.audioMid=void 0,this.videoMid=void 0,this.videoTransceiver=void 0,this.audioTransceiver=void 0,null===(e=this.observer)||void 0===e||e.reset(),this.statsReport.destroy(),this.prevScaleResolutionDownBy=1,this.subVideoDescriptions=[]}},{key:"switchTrackEnableState",value:function(e,t){var r,n;"audio"===e?n=this.audioTrack:"video"===e&&(n=this.videoTrack);var i=null===(r=n)||void 0===r?void 0:r.getTrack();return!(!i||(null==i?void 0:i.enabled)===t)&&(i.enabled=t,!0)}}]),e}(),Rz=function(e){f(r,e);var t=g(r);function r(e,n,i,o){var a,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:K.LOW;return c(this,r),h(m(a=t.call(this)),"streamId",void 0),h(m(a),"userId",void 0),h(m(a),"isScreen",void 0),h(m(a),"hasVideo",void 0),h(m(a),"hasAudio",void 0),h(m(a),"_attributes",void 0),h(m(a),"streamState",void 0),h(m(a),"observer",void 0),h(m(a),"statsReport",void 0),h(m(a),"subVideo",void 0),h(m(a),"subAudio",void 0),h(m(a),"subMediaType",void 0),h(m(a),"subLayer",void 0),h(m(a),"audioMid",void 0),h(m(a),"videoMid",void 0),h(m(a),"autosubAudioMid",void 0),h(m(a),"autosubVideoMid",void 0),h(m(a),"_sequenceId",void 0),h(m(a),"stream",void 0),h(m(a),"videoTrack",void 0),h(m(a),"audioTrack",void 0),h(m(a),"videoTransceiver",void 0),h(m(a),"audioTransceiver",void 0),h(m(a),"recordedVideoFrames",void 0),h(m(a),"stillExist",void 0),h(m(a),"_workaround_1_",void 0),h(m(a),"paused",void 0),h(m(a),"originalMediaType",void 0),h(m(a),"originalStreamIndex",0),a.userPriority=s,a.userId=e,a.isScreen=i,a.streamId=n,a.hasAudio=o.audiostream&&o.localaudio,a.hasVideo=o.videostream&&o.localvideo,a._attributes=o,a.subVideo=!1,a.subAudio=!1,a._sequenceId=0,a.subMediaType=nz.NONE,a.subLayer={spatialLayer:0,spatialSubLayer:-1},a.streamState=0,a.statsReport=new vz(m(a)),a}return l(r,[{key:"sequenceId",get:function(){return this._sequenceId||-1},set:function(e){"number"==typeof e&&(this._sequenceId=e)}},{key:"hasSubscribed",get:function(){return 2===this.streamState}},{key:"attributes",get:function(){return this._attributes},set:function(e){this.hasVideo=e.localvideo&&e.videostream,this.hasAudio=e.localaudio&&e.audiostream,this._attributes=e}},{key:"initVideoEncodedTransform",value:function(){var e=this;if(this.videoTransceiver&&this.videoTransceiver.receiver){var t=this.videoTransceiver.receiver.createEncodedStreams(),r=t.readable,n=t.writable;r.pipeThrough(new TransformStream({transform:function(t,r){iz.getNalunits(new oz(t.data)).forEach((function(t){if(t.sei){var r=hz.decodeSeiBody(t.body);r&&r.type!==az.internal&&e.safeEmit("onSEIMessage",r.payload)}})),r.enqueue(t)}})).pipeTo(n)}else kz.print("no receiver found when trying to bind encodedTransform")}},{key:"initAudioEncodedTransform",value:function(){if(this.audioTransceiver&&this.audioTransceiver.receiver){var e=this.audioTransceiver.receiver.createEncodedStreams(),t=e.readable,r=e.writable;t.pipeThrough(new TransformStream({transform:function(e,t){t.enqueue(e)}})).pipeTo(r)}else kz.print("no receiver found when trying to bind encodedTransform")}},{key:"ontrack",value:function(e){var t,r;if((null===(t=e.streams)||void 0===t||null===(r=t[0])||void 0===r?void 0:r.id)===this.streamId){var n,i=e.track;"video"===(null==i?void 0:i.kind)?this._setVideoTrack(i):"audio"===(null===(n=e.track)||void 0===n?void 0:n.kind)&&this._setAudioTrack(i),this._setStream(e.streams[0])}this.safeEmit("ontrack",e)}},{key:"clean",value:function(){var e;kz.print("clean","exec stream.clean ".concat(this.streamId," ").concat(this.userId)),this.subAudio=!1,this.subVideo=!1,this.audioMid=void 0,this.videoMid=void 0,this.sequenceId=0,this.videoTrack=void 0,this.audioTrack=void 0,this.stream=void 0,this.videoTransceiver=void 0,this.audioTransceiver=void 0,this.recordedVideoFrames=void 0,this.paused=!1,this._workaround_1_=!1,null===(e=this.observer)||void 0===e||e.reset(),this.statsReport.destroy()}},{key:"resetHasSubscribed",value:function(){this.streamState=0}},{key:"setRemoteUserPriority",value:function(e){this.userPriority=e}},{key:"getStreamPriority",value:function(){var e=this.isScreen?20:this.hasAudio||this.hasVideo?this.attributes.videoDescriptions.length>1?10-this.subLayer.spatialLayer:9:0;return 1e4*this.userPriority+100*e}},{key:"getSubscribeFallbackParams",value:function(e){if(e!==X.DISABLE&&this.subVideo){if(this.attributes.videoDescriptions.length-1>this.subLayer.spatialLayer)return[this.originalMediaType,Ez.SUB,this._getSubLayerBySpatialLayer(this.subLayer.spatialLayer+1)];if(e===X.AUDIO_ONLY)return[V.VIDEO,Ez.UNSUB]}return null}},{key:"getSubscribeRecoverParams",value:function(){if(this.originalMediaType&&wP(this.originalMediaType)){if(!1===this.subVideo)return[this.originalMediaType,Ez.SUB,this.subLayer];if("number"==typeof this.originalStreamIndex&&this.subLayer.spatialLayer>this.originalStreamIndex)return[this.originalMediaType,Ez.SUB,this._getSubLayerBySpatialLayer(this.subLayer.spatialLayer-1)]}return null}},{key:"_setStream",value:function(e){var t=this;this.stream=e,e.onaddtrack=function(e){"video"===e.track.kind?t._setVideoTrack(e.track):"audio"===e.track.kind&&t._setAudioTrack(e.track)}}},{key:"_setAudioTrack",value:function(e){var t,r;(null===(t=this.audioTrack)||void 0===t||null===(r=t.getTrack())||void 0===r?void 0:r.id)!==(null==e?void 0:e.id)&&(this.audioTrack=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dP();return new CH(e,t)}(e),this.emit("ontrack",this.audioTrack))}},{key:"_setVideoTrack",value:function(e){var t,r;(null===(t=this.videoTrack)||void 0===t||null===(r=t.getTrack())||void 0===r?void 0:r.id)!==(null==e?void 0:e.id)&&(this.videoTrack=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dP();return new wH(e,t)}(e),this.emit("ontrack",this.videoTrack))}},{key:"_getSubLayerBySpatialLayer",value:function(e){var t=this._attributes,r=t.videoDescriptions,n=t.subVideoDescriptions,i=void 0===n?[]:n,o=r[e],a=o.width,s=o.height,u=i.find((function(e){return e.width===a&&e.height===s}));return{spatialLayer:e,spatialSubLayer:(null==u?void 0:u.sub_index)||-1}}}]),r}(UL),Az=new ML("queue",4),wz=function(e){return e[e.ADD=0]="ADD",e[e.CLOSE=1]="CLOSE",e}(wz||{}),Cz=function(e){return e.publish="publish",e.unpublish="unpublish",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.pushtrack="pushtrack",e.removetrack="removetrack",e}(Cz||{}),Oz=(h(_z={},"publish","unpublish"),h(_z,"subscribe","unsubscribe"),h(_z,"pushtrack","removetrack"),_z),xz=(h(mz={},"publish",0),h(mz,"subscribe",0),h(mz,"pushtrack",0),h(mz,"unpublish",1),h(mz,"unsubscribe",1),h(mz,"removetrack",1),mz),Nz=function(e){f(r,e);var t=g(r);function r(){var e;return c(this,r),h(m(e=t.call(this)),"_queue",void 0),e._queue=[],e}return l(r,[{key:"queue",get:function(){return this._queue}},{key:"enqueue",value:function(e){var t=this._queue.length,r="";return this._queue=this._queue.filter((function(t){return t.streamId!==e.streamId||e.action!==Oz[t.action]||(r=t.streamId,Az.print("offsetStreamId",r),!1)})),this._queue.length===t&&this._queue.push(e),this.emit("start"),r}},{key:"dequeue",value:function(){if(!this._queue.length)return null;for(var e=xz[this._queue[0].action],t=1;t<this._queue.length;t++)if(xz[this._queue[t].action]!==e)return{sdpStrategy:e,items:this._queue.splice(0,t)};return{sdpStrategy:e,items:this._queue.splice(0,this._queue.length)}}}]),r}(xL),Dz=new ML("ChromeHandler",3),Pz=xj(),Mz=function(e){f(k,e);var r,n,a,s,d,v,_,y,S=g(k);function k(e,t){var r;return c(this,k),h(m(r=S.call(this,e,t)),"name","chrome"),h(m(r),"_queueBusy",!1),h(m(r),"_sdpQueue",void 0),h(m(r),"_aSendonlyOfferTpl",void 0),h(m(r),"_vSendonlyOfferTpl",void 0),h(m(r),"_aRecvonlyOfferTpl",void 0),h(m(r),"_vRecvonlyOfferTpl",void 0),h(m(r),"_mid",0),h(m(r),"_offerSession",void 0),h(m(r),"_answerSession",void 0),h(m(r),"_offerMlines",[]),h(m(r),"_answerMlines",[]),h(m(r),"_inactiveMlineIndex",[]),h(m(r),"_msidIndexMap",{}),h(m(r),"_mlinesCache",{}),r._sdpQueue=new Nz,r._sdpQueue.on("start",(function(){r._queueBusy||"stable"!==r._peerConnection.signalingState||(Dz.print("dequeue start"),r.dequeue())})),r}return l(k,[{key:"connect",value:(y=u(o().mark((function e(t){var r,n,a,s,u,c,d,l=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Dz.print("connect","invoke connect"),this._offerIce={iceUfrag:null===(r=t.iceParams)||void 0===r?void 0:r.clientIceUfrag,icePwd:null===(n=t.iceParams)||void 0===n?void 0:n.clientIcePwd,iceOptions:"renomination"},e.next=4,IG(t);case 4:return this._answerIce=e.sent,e.next=7,this._peerConnection.createOffer();case 7:return a=e.sent,s=Lj.parse(a.sdp),u=E(s.media,1),c=u[0],this._offerIce.fingerprint=s.fingerprint||c.fingerprint,delete s.media,this._offerSession=i({},s),this._answerSession=i({},s),this._answerSession.fingerprint&&(this._answerSession.fingerprint=this._answerIce.fingerprint),d=this._mid++,this._offerMlines=[i(i(i({},c),this._offerIce),{},{mid:"".concat(d)})],this._answerMlines=[i(i(i({},c),this._answerIce),{},{sctpmap:{sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144},mid:"".concat(d)})],this.setDescription(),e.next=21,new Promise((function(e,t){l._dataChannel.onopen=function(){Dz.print("connect","dataChannel open"),wB("es.dc.open",""),e("")},l._dataChannel.onerror=function(e){gB.rtcSignalingMsgError(e.error.sdpLineNumber,e.error.errorDetail,KF.INVALID_DATA),wB("es.dc.error",""),t(e)},l._dataChannel.onclose=function(e){wB("es.dc.close",""),t(e)},l._peerConnection.addEventListener("connectionstatechange",(function(e){"failed"!==l._peerConnection.iceConnectionState&&"closed"!==l._peerConnection.iceConnectionState&&"failed"!==l._peerConnection.connectionState||t(e)}))}));case 21:return Dz.print("connect","dataChannel establish success"),e.abrupt("return",this._dataChannel);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"disconnect",value:function(){this._peerConnection.close(),this._dataChannel.close(),this._peerConnection.ontrack=null}},{key:"destroy",value:function(){b(p(k.prototype),"destroy",this).call(this),this._mlinesCache={}}},{key:"publish",value:(_=u(o().mark((function e(t){var r,n,a,s,u,c,d,l,h,f,v,_,m,y,g,S,T,I,R,A,w,C,O,x,N,D,P;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.stream,c=t.enableSimulcast,d=b(p(k.prototype),"internalPublish",this).call(this,t),l=d.videoDescriptions,h=d.subVideoDescriptions,f=d.transceiverInit,v="".concat(this._mid++),_="".concat(this._mid++),m=i(i(i({},this._aSendonlyOfferTpl),this._offerIce),{},{mid:v,msid:"".concat(u.id," ").concat(u.id,"-audio"),ssrcs:bG(u,"audio")}),y=i(i(i({},this._vSendonlyOfferTpl),this._offerIce),{},{mid:_,msid:"".concat(u.id," ").concat(u.id,"-video")}),c?(Dz.print("subVideoDesc","desc: %o ",h),delete y.ssrcGroups,delete y.ssrcs,g=[],y.rids=l.map((function(e){var t=e.rid;return g.unshift(t),{id:t,direction:"send"}})),y.simulcast={dir1:"send",list1:g.join(";")}):(S=EG(u,"video"),T=S.ssrcs,I=S.ssrcGroups,y.ssrcs=T,y.ssrcGroups=I),yP&&gP&&Array.isArray(y.ext)&&(y.ext=y.ext.filter((function(e){var t;return!(null!=e&&null!==(t=e.uri)&&void 0!==t&&t.includes("video-orientation"))}))),null!==(r=this._context)&&void 0!==r&&null!==(n=r.serverConfig)&&void 0!==n&&n.audioRed&&Array.isArray(m.rtp)&&-1!==(R=m.rtp.findIndex((function(e){return"red"===e.codec})))&&(A=m.rtp.splice(R,1),w=E(A,1),C=w[0],m.rtp.unshift(C)),null!==(a=this._context)&&void 0!==a&&null!==(s=a.serverConfig)&&void 0!==s&&s.videoCodec&&CG(y,null===(O=this._context)||void 0===O||null===(x=O.serverConfig)||void 0===x?void 0:x.videoCodec),(N=null==m?void 0:m.rtp.find((function(e){return"opus"===e.codec})))&&m.fmtp&&(P=m.fmtp.find((function(e){return e.payload===N.payload})))&&null!==(D=this._context)&&void 0!==D&&D.audioProfileManager&&(P.config+=this._context.audioProfileManager.getOpusConfigStr()),this.addBitrateLimit(y,t.videoEncodeConfig[0].maxKbps),this._mlinesCache[t.stream.id]=[m,y],e.abrupt("return",{partialSdp:TG(this._offerSession,m,y),audioMid:v,videoMid:_,type:"incroffer",semantics:"unified-plan",videoDescriptions:l,subVideoDescriptions:h,transceiverInit:f});case 15:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"subscribe",value:(v=u(o().mark((function e(t,r){var n,a,s,u,c,d,l,h,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Dz.print("subscribe","mids: ",r),n="incroffer",a="unified-plan",this._aRecvonlyOfferTpl&&this._vRecvonlyOfferTpl){e.next=11;break}return e.next=6,TP(!0);case 6:if(s=e.sent){e.next=9;break}throw new ZN(JN.NOT_SUPPORTED,"Get offer Error");case 9:return e.next=11,this.createAVMlineOfferTpl(s);case 11:if(!this._mlinesCache[t.streamId]){e.next=16;break}return u=E(this._mlinesCache[t.streamId],2),c=u[0],d=u[1],c.mid=t.audioMid,d.mid=t.videoMid,e.abrupt("return",{partialSdp:TG(this._offerSession,c,d),audioMid:c.mid,videoMid:d.mid,type:n,semantics:a});case 16:return l="".concat(this._mid++),h="".concat(this._mid++),f=i(i(i({},this._aRecvonlyOfferTpl),this._offerIce),{},{mid:l}),p=i(i(i({},this._vRecvonlyOfferTpl),this._offerIce),{},{mid:h}),this._mlinesCache[t.streamId]=[f,p],e.abrupt("return",{partialSdp:TG(this._offerSession,f,p),audioMid:l,videoMid:h,type:n,semantics:a,transceiverInit:{aTrack:"audio",vTrack:"video",audioTransceiverInit:{direction:"recvonly"},videoTransceiverInit:{direction:"recvonly"}}});case 22:case"end":return e.stop()}}),e,this)}))),function(e,t){return v.apply(this,arguments)})},{key:"handleAck",value:(d=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Dz.print("handleAck()","item: %o",t),e.abrupt("return",this._sdpQueue.enqueue(t));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"dequeue",value:(s=u(o().mark((function e(){var r,n,a,s,u,c,d,l,h,f,p,v=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._queueBusy=!0,r=this._sdpQueue.dequeue(),Dz.print("dequeue()","ret: %o",r),r){e.next=6;break}return this._queueBusy=!1,e.abrupt("return");case 6:if(e.prev=6,n=r.items,a=r.sdpStrategy,s=[],u=[],a!==wz.ADD){e.next=14;break}return e.delegateYield(o().mark((function e(){var r,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete(r=i({},v._answerIce)).candidates,c=!1,d=!1,e.prev=4,h=t(n);case 6:return e.next=8,h.next();case 8:if(!(c=!(f=e.sent).done)){e.next=17;break}return a=f.value,e.delegateYield(o().mark((function e(){var t,n,c,d,l,h,f,p,_,m,y,g,S,b,k,T,I,R,A,w,C;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.action,n=a.transceiverInit,c=a.signalingAck,d=a.stream,!((l=d instanceof Rz)&&(null==c?void 0:c.sequenceId)<d.sequenceId)){e.next=4;break}return e.abrupt("return","break");case 4:if(h={},f={},p=Lj.parse(c.sdp),Array.isArray(p.media)&&(_="",p.media.sort((function(e,t){var r;return null==e||null===(r=e.type)||void 0===r?void 0:r.localeCompare(null==t?void 0:t.type)})).forEach((function(e){"audio"===(e=i(i({},e),r)).type?(h=e,Dz.print("audioMsid",e.msid),e.msid&&(_=e.msid.replace("audio","video"))):(f=e,Dz.print("videoMsid",_),_&&(f.msid=_,_=""))}))),m=d.streamId,t===Cz.publish&&(m=null===(y=d.stream)||void 0===y?void 0:y.id),v._mlinesCache[m]){e.next=12;break}return e.abrupt("return","break");case 12:if(g=E(v._mlinesCache[m],2),S=g[0],b=g[1],!n){e.next=30;break}d.audioTransceiver=v._peerConnection.addTransceiver(n.aTrack,n.audioTransceiverInit),d.videoTransceiver=v._peerConnection.addTransceiver(n.vTrack,n.videoTransceiverInit),(k=v._inactiveMlineIndex.shift())||(k=v._offerMlines.length),v._offerMlines[k]=i(i({},S),{},{mid:h.mid}),v._answerMlines[k]=h,(T=v._inactiveMlineIndex.shift())||(T=v._offerMlines.length),v._offerMlines[T]=i(i({},b),{},{mid:f.mid}),v._answerMlines[T]=f,v._msidIndexMap[d.streamId]=[k,T],Pz&&(d.initAudioEncodedTransform(),d.initVideoEncodedTransform()),s.push(d.streamId||""),u.push(l?d.userId:"local"),e.next=48;break;case 30:if(!l){e.next=48;break}if(I=v._msidIndexMap[d.streamId]||[],R=E(I,2),A=R[0],w=R[1],!A||!w){e.next=47;break}if((null===(C=v._offerMlines[A])||void 0===C?void 0:C.mid)===h.mid){e.next=43;break}return v._offerMlines[A]=kG(v._offerMlines[A]),v._offerMlines[w]=kG(v._offerMlines[w]),v._answerMlines[A]=kG(v._answerMlines[A]),v._answerMlines[w]=kG(v._answerMlines[w]),e.next=40,v.setDescription();case 40:v._offerMlines[A]=i(i({},v._aRecvonlyOfferTpl),{},{mid:h.mid}),v._offerMlines[w]=i(i({},v._vRecvonlyOfferTpl),{},{mid:f.mid}),Dz.print("enqueue","hack: %o",d.streamId);case 43:v._answerMlines[A]=h,v._answerMlines[w]=f,e.next=48;break;case 47:Dz.print("dequeue","pushtrack before subscribe: %o",d.userId);case 48:l&&(d.sequenceId=null==c?void 0:c.sequenceId);case 49:case"end":return e.stop()}}),e)}))(),"t0",11);case 11:if("break"!==e.t0){e.next=14;break}return e.abrupt("break",17);case 14:c=!1,e.next=6;break;case 17:e.next=23;break;case 19:e.prev=19,e.t1=e.catch(4),d=!0,l=e.t1;case 23:if(e.prev=23,e.prev=24,!c||null==h.return){e.next=28;break}return e.next=28,h.return();case 28:if(e.prev=28,!d){e.next=31;break}throw l;case 31:return e.finish(28);case 32:return e.finish(23);case 33:case"end":return e.stop()}}),e,null,[[4,19,23,33],[24,,28,32]])}))(),"t0",12);case 12:e.next=19;break;case 14:p={},n.forEach((function(e){var t,r,n=e.audioMid,i=e.videoMid,o=e.stream;p[n]=n,p[i]=i,delete v._msidIndexMap[null===(t=e.stream)||void 0===t?void 0:t.streamId],o instanceof Iz?delete v._mlinesCache[null==o||null===(r=o.stream)||void 0===r?void 0:r.id]:delete v._mlinesCache[null==o?void 0:o.streamId]})),this._offerMlines=this._offerMlines.map((function(e,t){return p[e.mid]&&(e=kG(e),v._inactiveMlineIndex.push(t)),e})),this._inactiveMlineIndex.sort((function(e,t){return e-t})),this._answerMlines=this._answerMlines.map((function(e){return p[e.mid]&&(e=kG(e)),e}));case 19:return e.next=21,this.setDescription(s.length?{streamId:s.join(","),streamUserId:u.join(",")}:void 0);case 21:Dz.print("dequeue","loop"),e.next=27;break;case 24:e.prev=24,e.t1=e.catch(6),Dz.print("dequeue","unknown error: %o",e.t1);case 27:return e.prev=27,this.dequeue(),e.finish(27);case 30:case"end":return e.stop()}}),e,this,[[6,24,27,30]])}))),function(){return s.apply(this,arguments)})},{key:"setDescription",value:(a=u(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Dz.print("setDescription","_offerMlines: %o, _answerMlines: %o",this._offerMlines,this._answerMlines),this._offerSession.media=this._offerMlines,this._answerSession.media=this._answerMlines,r=[],this._offerMlines.forEach((function(e){"inactive"!==e.direction&&r.push(e.mid)})),this._offerSession.groups&&this._answerSession.groups&&(this._offerSession.groups[0].mids=r.join(" "),this._answerSession.groups[0].mids=r.join(" ")),n=lP(),t&&gB.rtcBeginCreateOffer("local"===t.streamUserId?YF.UP:YF.DOWN,t.streamId,t.streamUserId),e.next=10,this._peerConnection.createOffer();case 10:return t&&gB.rtcCreateOffer(0,"local"===t.streamUserId?JF.UP:JF.DOWN,t.streamId,t.streamUserId,lP()-n),e.next=13,this.setLocalDescription(Lj.write(this._offerSession),t);case 13:return e.next=15,this.setRemoteDescription(Lj.write(this._answerSession),t);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"getDefaultSdp",value:(n=u(o().mark((function e(){var t,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,TP(!0);case 2:if(t=e.sent){e.next=5;break}throw new ZN(JN.NOT_SUPPORTED,"Get offer Error");case 5:return this.createAVMlineOfferTpl(t),r=Lj.parse(t),n=[],r.media=r.media.filter((function(e){return"recvonly"===e.direction&&(n.push(e.mid+""),!0)})),r.groups=[{mids:n.join(" "),type:"BUNDLE"}],e.abrupt("return",{sdp:Lj.write(r),semantics:"unified-plan",type:"offer"});case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rollback",value:(r=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:delete this._mlinesCache[t];case 1:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"createAVMlineOfferTpl",value:function(e){var t=this;Lj.parse(e).media.forEach((function(e){"audio"===e.type?"sendonly"===e.direction?t._aSendonlyOfferTpl=e:t._aRecvonlyOfferTpl=e:"video"===e.type&&("sendonly"===e.direction?t._vSendonlyOfferTpl=e:t._vRecvonlyOfferTpl=e)}))}}]),k}(Mj),Lz=new ML("FirefoxHandler",3),Uz=function(e){f(S,e);var t,r,n,a,s,d,v,_,y=g(S);function S(){var e;c(this,S);for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return h(m(e=y.call.apply(y,[this].concat(r))),"name","firefox"),e}return l(S,[{key:"connect",value:(_=u(o().mark((function e(t){var r,n,a,s,u,c,d,l=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Lz.print("connect","invoke connect"),this._offerIce={iceUfrag:null===(r=t.iceParams)||void 0===r?void 0:r.clientIceUfrag,icePwd:null===(n=t.iceParams)||void 0===n?void 0:n.clientIcePwd,iceOptions:"renomination"},e.next=4,IG(t);case 4:return this._answerIce=e.sent,this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),this._peerConnection.addTransceiver("video",{direction:"recvonly"}),e.next=9,this._peerConnection.createOffer();case 9:return a=e.sent,s=Lj.parse(a.sdp),u=E(s.media,1),c=u[0],this._offerIce.fingerprint=s.fingerprint||c.fingerprint,s.media=s.media.map((function(e){return i(i({},e),l._offerIce)})),(d=i({},s)).fingerprint=this._answerIce.fingerprint,d.media=d.media.map((function(e){return delete(e=i(i({},e),l._answerIce)).bundleOnly,e.port=9,"application"===e.type?e.sctpmap={sctpmapNumber:5e3,app:"webrtc-datachannel",maxMessageSize:262144}:e.direction="sendonly",e})),e.next=19,this.setLocalDescription(Lj.write(s));case 19:return e.next=21,this.setRemoteDescription(Lj.write(d));case 21:return e.next=23,new Promise((function(e,t){l._dataChannel.onopen=function(){Lz.print("connect","dataChannel open"),wB("es.dc.open",""),e("")},l._dataChannel.onerror=function(e){gB.rtcSignalingMsgError(e.error.sdpLineNumber,e.error.errorDetail,KF.INVALID_DATA),wB("es.dc.error",""),t(e)},l._dataChannel.onclose=function(e){wB("es.dc.close",""),t(e)},l._peerConnection.addEventListener("connectionstatechange",(function(e){"failed"!==l._peerConnection.iceConnectionState&&"closed"!==l._peerConnection.iceConnectionState&&"failed"!==l._peerConnection.connectionState||t(e)}))}));case 23:return Lz.print("connect","dataChannel establish success"),e.abrupt("return",this._dataChannel);case 25:case"end":return e.stop()}}),e,this)}))),function(e){return _.apply(this,arguments)})},{key:"publish",value:(v=u(o().mark((function e(t){var r,n,a,s,u,c,d,l,h,f,v,_,m,y=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=b(p(S.prototype),"internalPublish",this).call(this,t),s=a.videoDescriptions,u=a.subVideoDescriptions,c=a.transceiverInit,t.audioTransceiver=this._peerConnection.addTransceiver(c.aTrack,c.audioTransceiverInit),t.videoTransceiver=this._peerConnection.addTransceiver(c.vTrack,c.videoTransceiverInit),d=lP(),gB.rtcBeginCreateOffer(YF.UP,"",""),e.next=7,this._peerConnection.createOffer();case 7:return l=e.sent,gB.rtcCreateOffer(0,JF.UP,"","",lP()-d),(h=Lj.parse(l.sdp)).media=null===(r=h.media)||void 0===r?void 0:r.map((function(e){return i(i({},e),y._offerIce)})),e.next=13,this.setLocalDescription(Lj.write(h));case 13:return f=t.audioTransceiver.mid,v=t.videoTransceiver.mid,_=null,m=null,h.media=null===(n=h.media)||void 0===n?void 0:n.map((function(e){if("".concat(e.mid)===f){var t,r=null===(t=_=e)||void 0===t?void 0:t.rtp.find((function(e){return"opus"===e.codec}));if(r&&_.fmtp){var n,i=_.fmtp.find((function(e){return e.payload===r.payload}));i&&null!==(n=y._context)&&void 0!==n&&n.audioProfileManager&&(i.config+=y._context.audioProfileManager.getOpusConfigStr())}}else if("".concat(e.mid)===v){var o,a,s,u;null!==(o=y._context)&&void 0!==o&&null!==(a=o.serverConfig)&&void 0!==a&&a.videoCodec&&CG(e,null===(s=y._context)||void 0===s||null===(u=s.serverConfig)||void 0===u?void 0:u.videoCodec),m=e}return e})),this.addBitrateLimit(m,t.videoEncodeConfig[0].maxKbps),e.next=21,this.setLocalDescription(Lj.write(h));case 21:return e.abrupt("return",{partialSdp:TG(h,_,m),audioMid:f,videoMid:v,type:"incroffer",semantics:"unified-plan",videoDescriptions:s,subVideoDescriptions:u,transceiverInit:c});case 22:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"subscribe",value:(d=u(o().mark((function e(t){var r,n,a,s,u,c,d,l,h,f,p,v,_,m,y=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Lz.print("subscribe()"),!t.audioMid||!t.videoMid){e.next=11;break}return u=Lj.parse(null===(a=this._peerConnection.localDescription)||void 0===a?void 0:a.sdp),c=null,d=null,u.media.forEach((function(e){"".concat(e.mid)===t.audioMid?(c=e,t.autosubAudioMid&&(c.mid=t.autosubAudioMid)):"".concat(e.mid)===t.videoMid&&(d=e,t.autosubVideoMid&&(d.mid=t.autosubVideoMid))})),e.next=8,this._peerConnection.createOffer();case 8:return e.next=10,this.setLocalDescription(null===(s=this._peerConnection.localDescription)||void 0===s?void 0:s.sdp,{streamId:t.streamId||"",streamUserId:t.userId});case 10:return e.abrupt("return",{partialSdp:TG(u,c,d),audioMid:t.audioMid,videoMid:t.videoMid,autosubAudioMid:t.autosubAudioMid,autosubVideoMid:t.autosubVideoMid,type:"incroffer",semantics:"unified-plan"});case 11:return t.audioTransceiver=this._peerConnection.addTransceiver("audio",{direction:"recvonly"}),t.videoTransceiver=this._peerConnection.addTransceiver("video",{direction:"recvonly"}),l=lP(),gB.rtcBeginCreateOffer(YF.UP,t.streamId,t.userId),e.next=17,this._peerConnection.createOffer();case 17:return h=e.sent,gB.rtcCreateOffer(0,JF.UP,t.streamId,t.userId,lP()-l),(f=Lj.parse(h.sdp)).media=null===(r=f.media)||void 0===r?void 0:r.map((function(e){return i(i({},e),y._offerIce)})),e.next=23,this.setLocalDescription(Lj.write(f),{streamId:t.streamId||"",streamUserId:t.userId});case 23:return p=t.audioTransceiver.mid,v=t.videoTransceiver.mid,_=null,m=null,null===(n=f.media)||void 0===n||n.forEach((function(e){"".concat(e.mid)===p?_=e:"".concat(e.mid)===v&&(m=e)})),e.abrupt("return",{partialSdp:TG(f,_,m),audioMid:p,videoMid:v,type:"incroffer",semantics:"unified-plan"});case 29:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"handleAck",value:(s=u(o().mark((function e(t){var r,n,a,s,u,c,d,l,h,f=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.signalingAck,s=t.stream,(u=t.action)!==Cz.unpublish&&u!==Cz.unsubscribe&&u!==Cz.removetrack){e.next=5;break}return e.next=4,this.close(s);case 4:return e.abrupt("return",s.streamId||"");case 5:return c={},(d=Lj.parse(null===(r=this._peerConnection.remoteDescription)||void 0===r?void 0:r.sdp)).media.forEach((function(e){void 0!==e.mid&&(c[e.mid]=e)})),Lj.parse(null==a?void 0:a.sdp).media.forEach((function(e){"audio"===(e=i(i({},e),f._answerIce)).type&&(s.audioMid?(e.mid=s.audioMid,c[s.audioMid]=e):c[e.mid]=e),"video"===e.type&&(s.videoMid?(e.mid=s.videoMid,c[s.videoMid]=e):c[e.mid]=e)})),l=Lj.parse(null===(n=this._peerConnection.localDescription)||void 0===n?void 0:n.sdp),h=l.media.map((function(e){var t=c[e.mid];return"inactive"===e.direction?e:t})),d.groups=l.groups,d.media=h,this.setRemoteDescription(Lj.write(d)),e.abrupt("return","");case 16:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getDefaultSdp",value:(a=u(o().mark((function e(){var t,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Lj.parse(null===(t=this._peerConnection.localDescription)||void 0===t?void 0:t.sdp),n=[],r.media=r.media.filter((function(e){return"recvonly"===e.direction&&(n.push(e.mid+""),!0)})),r.groups=[{mids:n.join(" "),type:"BUNDLE"}],e.abrupt("return",{sdp:Lj.write(r),semantics:"unified-plan",type:"offer"});case 5:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"rollback",value:(n=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.close(r));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"close",value:(r=u(o().mark((function e(t){var r,n,a,s,u,c,d=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Lz.print("close()"),!t.audioTransceiver||!t.videoTransceiver){e.next=19;break}return t.audioTransceiver.stop(),t.videoTransceiver.stop(),n=[],e.next=7,this._peerConnection.createOffer();case 7:return a=e.sent,(s=Lj.parse(null==a?void 0:a.sdp)).media=s.media.map((function(e){return"".concat(e.mid)!==t.audioMid&&"".concat(e.mid)!==t.videoMid||(e=kG(e)),"inactive"!==e.direction&&n.push(e.mid),i(i({},e),d._offerIce)})),u=Lj.parse(null===(r=this._peerConnection.remoteDescription)||void 0===r?void 0:r.sdp),c={},u.media.forEach((function(e){c[e.mid]=e})),u.media=s.media.map((function(e){return"inactive"===e.direction?e:c[e.mid]})),s.groups&&u.groups&&(s.groups[0].mids=n.join(" "),u.groups[0].mids=n.join(" ")),e.next=17,this.setLocalDescription(Lj.write(s));case 17:return e.next=19,this.setRemoteDescription(Lj.write(u));case 19:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"setCurrentDescription",value:(t=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._peerConnection.createOffer();case 2:if(!this._peerConnection.localDescription||!this._peerConnection.remoteDescription){e.next=7;break}return e.next=5,this._peerConnection.setLocalDescription(this._peerConnection.localDescription);case 5:return e.next=7,this._peerConnection.setRemoteDescription(this._peerConnection.remoteDescription);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),S}(Mj),Vz=function(e,t){return mP?new Uz(e,t):new Mz(e,t)},Fz=new ML("Locker",2),Bz=1,jz=function(){function e(t){c(this,e),h(this,"lockingPromise",Promise.resolve()),h(this,"locks",0),h(this,"name",""),h(this,"lockId",void 0),this.lockId=Bz++,t&&(this.name=t),Fz.print("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}return l(e,[{key:"isLocked",get:function(){return this.locks>0}},{key:"lock",value:function(){var e,t=this;this.locks+=1,Fz.print("[lock-".concat(this.name,"-").concat(this.lockId,"] locked, current queue ").concat(this.locks,"."));var r=new Promise((function(r){e=function(){t.locks-=1,Fz.print("[lock-".concat(t.name,"-").concat(t.lockId,"] unlocked, current queue ").concat(t.locks,".")),r()}})),n=this.lockingPromise.then((function(){return e}));return this.lockingPromise=this.lockingPromise.then((function(){return r})),n}}]),e}(),Gz=(h(yz={},J.communication,[0]),h(yz,J.chat,[0]),h(yz,J.chatRoom,[1,"IES_chatroom"]),h(yz,J.coHost,[1,"IES_PK"]),h(yz,J.meeting,[16]),h(yz,J.classRoom,[0]),yz),Hz=Object.defineProperty,zz=Object.getOwnPropertyDescriptor,qz=function(e,t,r,n){for(var i,o=n>1?void 0:n?zz(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&Hz(t,r,o),o},Xz=new ML("MediaServerClient",2),Kz=6e4,Wz=function(e){return e.DISCONNECTED="disconnected",e.DISCONNECTING="disconnecting",e.CONNECTED="connected",e.CONNECTING="connecting",e}(Wz||{}),Yz=function(e,t){Xz.print(e,"userId: %o, subAudio: %o, subVideo: %o, paused: %o, audioMid: %o, videoMid: %o, workaround_1_: %o, sequenceId: %o",t.userId,t.subAudio,t.subVideo,t.paused,t.audioMid,t.videoMid,t._workaround_1_,t.sequenceId)},Jz=function(e){f(O,e);var t,r,n,a,s,d,p,v,_,y,S,b,k,T,I,R,A,w,C=g(O);function O(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:gB;return c(this,O),h(m(t=C.call(this)),"_token",void 0),h(m(t),"_appId",void 0),h(m(t),"_roomId",void 0),h(m(t),"_roomAttributes",void 0),h(m(t),"_clientId",void 0),h(m(t),"_businessId",void 0),h(m(t),"_userInfo",void 0),h(m(t),"_useCloudProxy",void 0),h(m(t),"_expectedIDC",void 0),h(m(t),"_authorization",void 0),h(m(t),"_sessionId",void 0),h(m(t),"_iceConfigRequestManager",void 0),h(m(t),"_ontrackCallbackMap",new Map),h(m(t),"_subResolves",{}),h(m(t),"supportConcurrent",!1),h(m(t),"_handler",void 0),h(m(t),"_pubSubLock",void 0),h(m(t),"_joinLeaveLock",void 0),h(m(t),"_state",void 0),h(m(t),"_dataChannelSignal",void 0),h(m(t),"_subConfig",{}),h(m(t),"monitor",void 0),h(m(t),"_roomProfile",J.communication),h(m(t),"_context",void 0),h(m(t),"_subStreamQueue",{}),t.monitor=r,t._pubSubLock=new jz("pubSubLock"),t._joinLeaveLock=new jz("joinLeaveLock"),t._state="disconnected",t._roomAttributes={multiChatMode:!1,bigRoomMode:!1},t._context=e,t.on("SUB_END",(function(e){return t._handleSubStreamQueue(e)})),t}return l(O,[{key:"_addHandlerEvents",value:function(){var e,t=this;null===(e=this._handler)||void 0===e||e.once("disconnect",(function(){Xz.print("emit ABNORMAL_DISCONNECTION ice"),t.safeEmit(tj.ABNORMAL_DISCONNECTION)}))}},{key:"_addSignalEventHandler",value:function(){var e,t=this;[$B.ON_ADD_STREAM,$B.ON_REMOVE_STREAM,$B.USER_CONNECTION,$B.USER_DISCONNECTION,$B.ON_UPDATE_STREAM_ATTRIBUTES,$B.ON_UPDATE_ROOM_ATTRIBUTES,$B.ON_PUSH_TRACK,$B.ON_REMOVE_TRACK,$B.NODE_CHANGE,$B.ON_CUSTOM_MESSAGE,$B.USER_MESSAGE_RECEIVED,$B.USER_BINARY_MESSAGE_RECEIVED,$B.POST_PROCESSING_MESSAGE,$B.ON_USER_TOKEN_WILL_EXPIRE,$B.STREAM_CONTROL_MESSAGE,$B.ON_SCENE_CONFIG,$B.ON_UPDATE_USER_ATTRIBUTES,ej.RSCP,ej.RTT].forEach((function(e){var r;null===(r=t._dataChannelSignal)||void 0===r||r.on(e,(function(r){t.safeEmit(e,r)}))})),null===(e=this._dataChannelSignal)||void 0===e||e.once("close",(function(){Xz.print("emit ABNORMAL_DISCONNECTION datachannel"),t.safeEmit(tj.ABNORMAL_DISCONNECTION)}))}},{key:"_removeSignalEventHandler",value:function(){var e,t;null===(e=this._dataChannelSignal)||void 0===e||e.removeAllListeners(),null===(t=this._handler)||void 0===t||t.removeAllListeners()}},{key:"connectionState",get:function(){return this._state},set:function(e){this._state!==e&&(this.safeEmit(tj.ON_CONNECTION_STATE_CHANGE,{prev:this._state,next:e}),this._state=e)}},{key:"connect",value:(w=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l=this,h=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>1&&void 0!==h[1]?h[1]:"",n=h.length>2&&void 0!==h[2]?h[2]:"",i=h.length>3&&void 0!==h[3]?h[3]:{},this.connectionState="connecting",this._appId=t,this._handler&&(this._removeSignalEventHandler(),this._handler.destroy()),!i.node){e.next=11;break}a=[i.node],wB("es.join.nodeChange",i),e.next=20;break;case 11:return Promise.resolve().then((function(){return l.emit("onGetIceConfigHook")})),this._iceConfigRequestManager=new vj,e.next=15,null===(s=this._iceConfigRequestManager)||void 0===s?void 0:s.getAccessNode(t,r,n,UB.getDeviceId(),null==i?void 0:i.reason,null==i?void 0:i.feedbackNode,this._useCloudProxy,this._expectedIDC);case 15:if(a=e.sent){e.next=19;break}throw wB("es.join.getNodeFailed",""),new ZN(JN.ICE_SERVER_WRONG,"get ICE config failed");case 19:wB("es.join.getNodeSuccess",a);case 20:return this._addHandlerEvents(),Promise.resolve().then((function(){return l.emit("onEstablishConnectionHook")})),e.prev=22,c=!1,d=a.map((function(e){var t=Vz(l.monitor,l._context);return t.connect(e).then((function(r){c?t.destroy():(c=!0,u=r,l.safeEmit("prevIceNode",e),l._handler=t,l.supportConcurrent="chrome"===t.name,l._addHandlerEvents())})).catch((function(){t.destroy()}))})),e.next=27,IP(d);case 27:Xz.print("join","establish peerConnection success"),e.next=34;break;case 30:throw e.prev=30,e.t0=e.catch(22),this.connectionState="disconnected",new ZN(JN.ESTABLISH_DATACHANNEL_FAILED,"establish dataChannel failed",e.t0);case 34:if(!u){e.next=40;break}this._dataChannelSignal=new hj(u),this._addSignalEventHandler(),this._dataChannelSignal.sendPingSignaling(),e.next=42;break;case 40:throw this.connectionState="disconnected",new ZN(JN.ESTABLISH_DATACHANNEL_FAILED,"establish dataChannel failed");case 42:case"end":return e.stop()}}),e,this,[[22,30]])}))),function(e){return w.apply(this,arguments)})},{key:"join",value:(A=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E,k,T,I=this,R=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=R.length>1&&void 0!==R[1]?R[1]:{},i=R.length>2&&void 0!==R[2]&&R[2],a=R.length>3?R[3]:void 0,Xz.print("join()","info: %o, params: %o, reconnect: %o, controlMessage: %o",t,n,i,a),this._appId=t.appId,this._token=t.token,this._roomId=t.roomId,this._clientId=t.userInfo.userId,this._businessId=t.userInfo.businessId,this._userInfo=t.userInfo,this._useCloudProxy=t.useCloudProxy,this._expectedIDC=t.expectedIDC,this._roomProfile=t.roomProfile,this._sessionId=n.sessionId,e.next=16,this.connect(this._appId,this._roomId,this._clientId,n);case 16:return e.t0=pP.token2auth(this._appId,this._roomId,this._clientId,this._token),e.t1=this._sessionId||"",e.t2=Date.now(),e.t3=a,e.t4={extra_info:this._userInfo.extraInfo,role:this._userInfo.role},e.next=23,null===(r=this._handler)||void 0===r?void 0:r.getDefaultSdp();case 23:return e.t5=e.sent,e.next=26,Cj();case 26:return e.t6=e.sent,e.t7=window.navigator.userAgent,e.t8=GB.VERSION,e.t9=UB.getDeviceId(),e.t10=this._appId,e.t11=this._roomId,e.t12=this._clientId,e.t13=this._businessId,e.t14=this._useCloudProxy,e.t15=Gz[this._roomProfile]?Gz[this._roomProfile][0]+"":"0",e.t16={supportedCodecs:e.t6,deviceType:"web",userAgent:e.t7,sdkVersion:e.t8,deviceId:e.t9,appId:e.t10,roomId:e.t11,userId:e.t12,businessId:e.t13,enable_cloud_proxy:e.t14,channelProfile:e.t15},e.t17={supportTokenExpireCallBack:!0,enableSceneConfigV2:!0,enableUnBundleMode:!0},s={Authorization:e.t0,sessionId:e.t1,timestamp:e.t2,controlMessage:e.t3,userAttributes:e.t4,sdpInfo:e.t5,params:e.t16,options:e.t17},Promise.resolve().then((function(){return I.emit("onSendingJoinMessageHook")})),e.prev=40,v=i?"reconnected":"joinRoom",e.next=44,this._dataChannelSignal.sendSignaling(v,s);case 44:return _=e.sent,Xz.print("join","send join message success"),this._authorization=s.Authorization,this.connectionState="connected",this._context&&(this._context.serverConfig={videoCodec:null===(m=_.config)||void 0===m||null===(y=m.engine_WEB)||void 0===y?void 0:y.video_codec,audioRed:!(null===(g=_.config)||void 0===g||null===(S=g.engine_WEB)||void 0===S||!S.pub_audio_red),muteReplaceUnsub:!(null===(b=_.config)||void 0===b||!b.mute_replace_unsub),simulcastOnDemand:!(!1===(null===(E=_.config)||void 0===E||null===(k=E.engine_VPM)||void 0===k||null===(T=k.ondemand)||void 0===T?void 0:T.enable))}),vz.audioStallConfig=null===(u=_.config)||void 0===u?void 0:u.engine_WEB,null===(c=this._context)||void 0===c||null===(d=c.audioProfileManager)||void 0===d||d.updateEngineBAC(null===(l=_.config)||void 0===l?void 0:l.engine_BAC),null===(h=this._context)||void 0===h||null===(f=h.audioProfileManager)||void 0===f||f.updateEngineANM(null===(p=_.config)||void 0===p?void 0:p.engine_ANM),e.abrupt("return",_);case 55:if(e.prev=55,e.t18=e.catch(40),this.connectionState="disconnected",!((null===e.t18||void 0===e.t18?void 0:e.t18.code)>=700&&(null===e.t18||void 0===e.t18?void 0:e.t18.code)<800)){e.next=60;break}throw new ZN(JN.INVALID_TOKEN,(null===e.t18||void 0===e.t18?void 0:e.t18.message)||"Invalid token");case 60:if(200===(null===e.t18||void 0===e.t18?void 0:e.t18.code)){e.next=62;break}throw new ZN(JN.JOIN_ROOM_FAILED,(null===e.t18||void 0===e.t18?void 0:e.t18.message)||"Join room failed");case 62:case"end":return e.stop()}}),e,this,[[40,55]])}))),function(e){return A.apply(this,arguments)})},{key:"publish",value:(R=u(o().mark((function e(t){var r,n,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E,k;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xz.print("publish()","localStream: %o",t),r=t.videoTrack,n=t.audioTrack,a=lP(),s="",u="",e.prev=6,e.next=9,null===(c=this._handler)||void 0===c?void 0:c.publish(t);case 9:if(S=e.sent){e.next=12;break}throw new ZN(JN.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 12:return s=S.audioMid,u=S.videoMid,t.pubAttributes={localaudio:!!n,localvideo:!!r,videostream:t.pubVideo,audiostream:t.pubAudio,extvideo:!!(r instanceof NH),extaudio:!!(n instanceof DH)},b={attributes:i({videoDescriptions:S.videoDescriptions},t.pubAttributes),audio:!0,video:!0,screen:t.isScreen,audioMid:s,videoMid:u,sdpInfo:{msid:t.stream.id,type:S.type,sdp:S.partialSdp,semantics:S.semantics}},t.enableSimulcast&&null!==(d=this._context)&&void 0!==d&&null!==(l=d.serverConfig)&&void 0!==l&&l.simulcastOnDemand&&(b.attributes.subVideoDescriptions=S.subVideoDescriptions),e.next=19,null===(h=this._dataChannelSignal)||void 0===h?void 0:h.sendSignaling("publish",b);case 19:if(200===(null==(E=e.sent)?void 0:E.code)){e.next=22;break}throw new ZN(JN.PUBLISH_FAILED,(null==E?void 0:E.message)||"publish failed");case 22:return gB.rtcRecvAnswer(0,$F.INCRANSWER,(null==E||null===(f=E.relayMessage)||void 0===f?void 0:f.sequenceId)||0,null==E||null===(p=E.relayMessage)||void 0===p?void 0:p.sdp,eB.UP,"",""),e.next=25,null===(v=this._handler)||void 0===v?void 0:v.handleAck({action:Cz.publish,streamId:E.streamId,audioMid:s,videoMid:u,transceiverInit:S.transceiverInit,signalingAck:{audioMid:null==E||null===(_=E.relayMessage)||void 0===_?void 0:_.audioMid,videoMid:null==E||null===(m=E.relayMessage)||void 0===m?void 0:m.videoMid,sdp:null==E||null===(y=E.relayMessage)||void 0===y?void 0:y.sdp,sequenceId:null==E||null===(g=E.relayMessage)||void 0===g?void 0:g.sequenceId},stream:t});case 25:return t.streamId=E.streamId,t.videoMid=u,t.audioMid=s,t.subVideoDescriptions=S.subVideoDescriptions,this.monitor.rtcPublishStat(tB.SUCCESS,rB.W_0,a,nB.UNKNOWN),t.statsReport.setLocalStreamStatsEvtInterval(this,this._handler,this.monitor),e.abrupt("return");case 34:return e.prev=34,e.t0=e.catch(6),e.t0 instanceof Error&&this.monitor.rtcPublishStat(tB.FAIL,rB.W_0,a,e.t0.message),e.next=39,null===(k=this._handler)||void 0===k?void 0:k.rollback(t.stream.id,t);case 39:throw e.t0;case 40:case"end":return e.stop()}}),e,this,[[6,34]])}))),function(e){return R.apply(this,arguments)})},{key:"updatePubTrack",value:(I=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,k,T,I,R,A,w,C,O,x,N,D,P;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(Xz.print("updatePubTrack()","localStream: %o",t),i=t.videoTrack,a=t.audioTrack,s=t.pubAudio,u=t.pubVideo,c=null==a?void 0:a.getTrack("preprocessing"),d=null==i?void 0:i.getTrack("preprocessing"),u&&d?null===(l=t.videoTransceiver)||void 0===l||l.sender.replaceTrack(d):null===(h=t.videoTransceiver)||void 0===h||h.sender.replaceTrack(null),null===(r=this._handler)||void 0===r||r.updateScaleResolutionDownBy(t),s&&c?(p=a.mixType,(v=a.mixedAudioTrack)&&p!==te.PLAYOUT&&!0===c.enabled&&(c=v),null===(f=t.audioTransceiver)||void 0===f||f.sender.replaceTrack(c)):null===(_=t.audioTransceiver)||void 0===_||_.sender.replaceTrack(null),m={localaudio:!!a,localvideo:!!i,videostream:u,audiostream:s,extvideo:!!(i instanceof NH),extaudio:!!(a instanceof DH)},y={},g=0,S=Object.entries(m);g<S.length;g++)b=E(S[g],2),k=b[0],(T=b[1])!==Reflect.get(t.pubAttributes,k)&&Reflect.set(y,k,T);if(Object.keys(y).length){e.next=12;break}return e.abrupt("return");case 12:return t.observer&&(I=t.observer,R=y.audiostream,A=y.videostream,w=y.localaudio,C=y.localvideo,O=y.extaudio,x=y.extvideo,void 0!==C?void 0!==x?I.setPushVideo(x):I.setEnableVideo(C):void 0!==A&&I.setUnmuteVideo(A),void 0!==w?void 0!==O?I.setPushAudio(O):I.setEnableAudio(w):void 0!==R&&I.setUnmuteAudio(R)),t.pubAttributes=m,N={roomId:this._roomId,streamId:t.streamId,attributes:y},e.next=17,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("updateStreamAttributes",N);case 17:if(200===(null==(D=e.sent)?void 0:D.code)){e.next=20;break}throw new ZN(JN.UPDATE_TRACK_FAILED,(null==D?void 0:D.message)||"update track failed");case 20:if(!mP){e.next=23;break}return e.next=23,null===(P=this._handler)||void 0===P?void 0:P.setCurrentDescription();case 23:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"updateToken",value:(T=u(o().mark((function e(t){var r,n,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xz.print("updateToken()","newToken: %o",t),this._token=t,this._appId&&null!==(r=this._userInfo)&&void 0!==r&&r.userId&&this._roomId){e.next=4;break}return e.abrupt("return");case 4:return i={roomId:this._roomId,userId:null===(n=this._userInfo)||void 0===n?void 0:n.userId,appId:this._appId,token:"Bearer ".concat(t)},e.prev=5,e.next=8,null===(a=this._dataChannelSignal)||void 0===a?void 0:a.sendSignaling("updateToken",i);case 8:if(200===(null==(s=e.sent)?void 0:s.code)){e.next=11;break}throw new ZN(JN.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 11:e.next=16;break;case 13:throw e.prev=13,e.t0=e.catch(5),new ZN(JN.UPDATE_TOKEN_WITH_INVALID_TOKEN,"invoke updateToken with an invalid token");case 16:case"end":return e.stop()}}),e,this,[[5,13]])}))),function(e){return T.apply(this,arguments)})},{key:"unpublish",value:(k=u(o().mark((function e(t){var r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xz.print("unpublish()","localStream: %o",t),i={roomId:this._roomId,initStreamId:t.initStreamId,streamId:t.streamId},null===(r=this._dataChannelSignal)||void 0===r||r.sendSignaling("unpublish",i),e.next=5,null===(n=this._handler)||void 0===n?void 0:n.handleAck({action:Cz.unpublish,audioMid:t.audioMid,videoMid:t.videoMid,stream:t,streamId:t.streamId});case 5:t.statsReport.unpublish();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"subscribe",value:(b=u(o().mark((function e(t,r,n){var i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(){var e=u(o().mark((function e(a,s){var u,c,d,l,f,p,v,_,m,y,g,S,b,E,k,T,I,R,A,w,C,O,x,N,D,P,M,L,U,V,F,B,j,G,H,z,q,X;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.streamState!==Tz.SUB_ED){e.next=2;break}return e.abrupt("return",i._updateSubTrack(t,r,Ez.SUB,n).then(a,s));case 2:if(t.streamState!==Tz.SUB_ING){e.next=7;break}return i._subStreamQueue[t.streamId]||(i._subStreamQueue[t.streamId]=[]),Xz.print("_subStreamQueue","streamId: %o, enqueue",t.streamId),i._subStreamQueue[t.streamId].push({fn:i.subscribe,args:[t,r,n],resolve:a,reject:s}),e.abrupt("return");case 7:if(Xz.print("subscribe()","mediaType: %o",r),Yz("subscribe()",t),t.streamState=Tz.SUB_ING,u=!1,c=!1,AP(r)&&(c=!0),wP(r)&&(u=!0),u||!i._multiChatMode()){e.next=17;break}return t.streamState=Tz.INIT,i.emit("SUB_END",t.streamId),e.abrupt("return",a(null));case 17:if(d=lP(),l=t.audioMid,f=t.videoMid,v=t.paused,_=t.subVideo,e.prev=22,!l||!f){e.next=29;break}return e.next=26,null===(D=i._handler)||void 0===D?void 0:D.subscribe(t,{audioMid:l,videoMid:f});case 26:p=e.sent,e.next=36;break;case 29:return e.next=31,null===(P=i._handler)||void 0===P?void 0:P.subscribe(t);case 31:if(p=e.sent){e.next=34;break}throw new ZN(JN.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 34:l=p.audioMid,f=p.videoMid;case 36:return t.paused=!u,t.subVideo=u,M={spatialLayer:(null==n?void 0:n.spatialLayer)||0,temporalLayer:0,spatialSubLayer:(null==n?void 0:n.spatialSubLayer)||-1},L={audio:!i._multiChatMode(),video:!0,data:!0,screen:t.isScreen,browser:"chrome-stable",videoMid:(null===(m=p)||void 0===m?void 0:m.autosubVideoMid)||f,audioMid:(null===(y=p)||void 0===y?void 0:y.autosubAudioMid)||l,sdpInfo:{sdp:null===(g=p)||void 0===g?void 0:g.partialSdp,semantics:null===(S=p)||void 0===S?void 0:S.semantics,type:null===(b=p)||void 0===b?void 0:b.type},streamUserId:t.userId,streamId:t.streamId,config:{enableMediaType:{audio:!!i._multiChatMode()||c,video:u},qualityLayer:M},extra:{enableSendRTT:!0}},e.next=42,null===(E=i._dataChannelSignal)||void 0===E?void 0:E.sendSignaling("subscribe",L);case 42:if(200===(null==(U=e.sent)?void 0:U.code)){e.next=45;break}throw new ZN(JN.SUBSCRIBE_FAILED,(null==U?void 0:U.message)||"subscribe failed");case 45:return V=[],F=!i._multiChatMode(),B=!t.videoTrack,i._subResolves[t.streamId]||(i._subResolves[t.streamId]=[]),B&&V.push(new Promise((function(e,r){i._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new ZN(JN.TIME_OUT,"wait video timeout for userId: ".concat(t.userId)))}),Kz);t.on("ontrack",(function r(i){"video"===i.mediaType&&(Xz.print("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),F&&V.push(new Promise((function(e,r){i._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new ZN(JN.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),Kz);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(Xz.print("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),j=function(e){t.ontrack(e)},null===(k=i._handler)||void 0===k||k.on("ontrack",j),i._ontrackCallbackMap.set(t,j),G=null==U?void 0:U.relayMessage,H=G.audioMid,z=G.videoMid,h(T={},l,H),h(T,f,z),q=T,Xz.print("sub midmap",t.userId,q),mP?(t.videoMid=f,t.audioMid=l):(t.videoMid=z,t.audioMid=H),t._workaround_1_=!1,t.subMediaType=r,t.streamState=Tz.SUB_ED,t.subLayer=M,gB.rtcRecvAnswer(0,$F.INCRANSWER,(null==U||null===(I=U.relayMessage)||void 0===I?void 0:I.sequenceId)||0,null==U||null===(R=U.relayMessage)||void 0===R?void 0:R.sdp,eB.DOWN,t.streamId,t.userId),e.next=65,null===(A=i._handler)||void 0===A?void 0:A.handleAck({action:Cz.subscribe,streamId:t.streamId,audioMid:l,videoMid:f,transceiverInit:null===(w=p)||void 0===w?void 0:w.transceiverInit,signalingAck:{audioMid:null==U||null===(C=U.relayMessage)||void 0===C?void 0:C.audioMid,videoMid:null==U||null===(O=U.relayMessage)||void 0===O?void 0:O.videoMid,sdp:null==U||null===(x=U.relayMessage)||void 0===x?void 0:x.sdp,sequenceId:null==U||null===(N=U.relayMessage)||void 0===N?void 0:N.sequenceId},stream:t});case 65:return e.next=67,Promise.all(V);case 67:i._multiChatMode()||(t.subAudio=c),i.monitor.rtcSubscribeStat(iB.SUCCESS,d,oB.UNKNOWN,t.userId),i._context&&t.statsReport.setRemoteStreamStatsEvtInterval(i,i._handler,i.monitor,i._context),a(null),i.emit("SUB_END",t.streamId),e.next=84;break;case 74:return e.prev=74,e.t0=e.catch(22),e.t0 instanceof Error&&i.monitor.rtcSubscribeStat(iB.FAIL,d,e.t0.message,t.userId),t.paused=v,t.subVideo=_,t.streamState=Tz.INIT,e.next=82,null===(X=i._handler)||void 0===X?void 0:X.rollback(t.streamId,t);case 82:s(e.t0),i.emit("SUB_END",t.streamId);case 84:case"end":return e.stop()}}),e,null,[[22,74]])})));return function(t,r){return e.apply(this,arguments)}}()));case 1:case"end":return e.stop()}}),e)}))),function(e,t,r){return b.apply(this,arguments)})},{key:"_handleSubStreamQueue",value:function(e){var t,r=this;if(null!==(t=this._subStreamQueue[e])&&void 0!==t&&t.length){Xz.print("_subStreamQueue","streamId: %o, exec",e);var n=this._subStreamQueue[e].shift(),i=n.fn,o=n.args,a=n.resolve,s=n.reject;i.apply(this,o).then(a,s).finally((function(){return r._handleSubStreamQueue(e)}))}else Xz.print("_subStreamQueue","streamId: %o, END",e)}},{key:"controlMessage",value:(S=u(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xz.print("controlMessage()","params: %o",t),n=t,"transcode"===t.type&&(n.roomId=this._roomId),e.next=5,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("controlMessage",n);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"updateUserAttributes",value:(y=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xz.print("updateUserAttributes()","attributes: %o",t),e.next=3,null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendSignaling("updateUserAttributes",{roomId:this._roomId,sessionId:this._sessionId,attributes:t});case 3:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"updateSubTrack",value:(_=u(o().mark((function e(t,r,n,i){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._updateSubTrack(t,r,n,i||t.subLayer));case 1:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return _.apply(this,arguments)})},{key:"_updateSubTrack",value:(v=u(o().mark((function e(t,r,n,i){var a,s,u,c,d,l,h,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Xz.print("updateSubTrack()","mediaType: %o, subLayer: %o",r,i),Yz("updateSubTrack()",t),u=0,u=n===Ez.SUB?t.subMediaType|r:t.subMediaType-(t.subMediaType&r),Xz.print("updateSubTrack","prev: %o, direction: %o, mediaType: %o, newMediaType: %o",t.subMediaType,n,r,u),t.subMediaType===u&&Xz.print("updateSubTrack","mediaType no change"),c=!1,d=!1,AP(u)&&(d=!0),wP(u)&&(c=!0),l=i||t.subLayer,h={roomId:this._roomId,streamList:[t.streamId],config:{enableMediaType:{video:c,audio:!!this._multiChatMode()||d},qualityLayer:l}},e.next=13,null===(a=this._dataChannelSignal)||void 0===a?void 0:a.sendSignaling("updateSubscribe",h);case 13:if(200===(null==(f=e.sent)?void 0:f.code)){e.next=16;break}throw new ZN(JN.UPDATE_TRACK_FAILED,(null==f?void 0:f.message)||"update track failed");case 16:return t.paused=!c,this._multiChatMode()||(null===(p=t.observer)||void 0===p||p.setUnmuteAudio(d),t.subAudio=d),null===(s=t.observer)||void 0===s||s.setUnmuteVideo(c),t.subVideo=c,t.subMediaType=u,t.subLayer=l,e.abrupt("return",t);case 23:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return v.apply(this,arguments)})},{key:"subscribe4pushTrack",value:(p=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,f,p,v,_,m,y,g,S,b,E=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xz.print("subscribe4pushTrack()","streamInfo: %o",r),Yz("subscribe4pushTrack()",t),c=null==r?void 0:r.message,d=c.audioMid,l=c.videoMid,f=c.sequenceId,t.subAudio=!0,!(f<t.sequenceId)){e.next=7;break}return Xz.print("subscribe4pushTrack","sequenceId return",f,t.sequenceId),e.abrupt("return");case 7:if(p=t.audioMid,v=t.videoMid,null===(n=t.observer)||void 0===n||n.setPushTrack(!0),!p||!v){e.next=16;break}return e.next=13,null===(m=this._handler)||void 0===m?void 0:m.subscribe(t,{audioMid:p,videoMid:v});case 13:_=e.sent,e.next=23;break;case 16:return e.next=18,null===(y=this._handler)||void 0===y?void 0:y.subscribe(t);case 18:if(_=e.sent){e.next=21;break}throw new ZN(JN.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 21:p=_.audioMid,v=_.videoMid;case 23:return h(i={},p,d),h(i,v,l),g=i,Xz.print("onpushtrack midmap",t.userId,g),mP?(t.audioMid=p,t.videoMid=v):(t.audioMid=d,t.videoMid=l),t.autosubAudioMid=d,t.autosubVideoMid=l,t.sequenceId=f,this._subResolves[t.streamId]||(this._subResolves[t.streamId]=[]),S=[],t.audioTrack||S.push(new Promise((function(e,r){E._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new ZN(JN.TIME_OUT,"wait audio timeout for userId: ".concat(t.userId)))}),Kz);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(Xz.print("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),b=function(e){t.ontrack(e)},null===(a=this._handler)||void 0===a||a.on("ontrack",b),this._ontrackCallbackMap.set(t,b),e.next=37,null===(s=this._handler)||void 0===s?void 0:s.handleAck({action:Cz.pushtrack,streamId:t.streamId,audioMid:p,videoMid:v,stream:t,transceiverInit:null===(u=_)||void 0===u?void 0:u.transceiverInit,signalingAck:null==r?void 0:r.message});case 37:return e.next=39,Promise.all(S);case 39:this._context&&t.statsReport.setRemoteStreamStatsEvtInterval(this,this._handler,this.monitor,this._context);case 40:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"unsubscribe4removeTrack",value:(d=u(o().mark((function e(t,r){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Yz("unsubscribe4removeTrack()",t),Xz.print("unsubscribe4removeTrack()","sequenceId: ",r.sequenceId),!(r.sequenceId<t.sequenceId)){e.next=5;break}return Xz.print("unsubscribe4removeTrack()","sequenceId return"),e.abrupt("return");case 5:if(t.subAudio=!1,!t.subVideo&&!t.paused){e.next=10;break}return t.sequenceId=r.sequenceId,Xz.print("unsubscribe4removeTrack()","foo %o",t.userId),e.abrupt("return");case 10:return null===(n=t.observer)||void 0===n||n.setPushTrack(!1),e.next=13,null===(i=this._handler)||void 0===i?void 0:i.handleAck({action:Cz.removetrack,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 13:this._subResolves[t.streamId]&&this._subResolves[t.streamId].forEach((function(e){return e(0)})),Xz.print("clean unsubscribe4removeTrack"),t.clean(),t.resetHasSubscribed(),t.statsReport.unsubscribe();case 18:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"unsubscribe",value:(s=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>2&&void 0!==h[2]&&h[2],Yz("unsubscribe()",t),s=t.subMediaType-(t.subMediaType&r),a||!this._subConfig.muteReplaceUnsub&&s===nz.NONE){e.next=5;break}return e.abrupt("return",this._updateSubTrack(t,r,Ez.UNSUB));case 5:if(u={roomId:this._roomId,streamId:t.streamId,userId:t.userId},null===(n=this._dataChannelSignal)||void 0===n||n.sendSignaling("unsubscribe",u).catch((function(){})),t.streamState=Tz.INIT,this._subStreamQueue[t.streamId]&&(this._subStreamQueue[t.streamId].forEach((function(e){return(0,e.resolve)(null)})),delete this._subStreamQueue[t.streamId]),t.subVideo=!1,t.paused=!1,t._workaround_1_||(t.subAudio=!1),null===(i=t.observer)||void 0===i||i.setSubscribeVideo(!1),t.subAudio){e.next=23;break}return null===(c=t.observer)||void 0===c||c.setSubscribeAudio(!1),e.next=17,null===(d=this._handler)||void 0===d?void 0:d.handleAck({action:Cz.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 17:l=e.sent,this._subResolves[l]&&this._subResolves[l].forEach((function(e){return e(0)})),Xz.print("unsubscribe","clean unsub ".concat(t.userId)),t.clean(),this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 23:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"removeOnTrackListener",value:function(e){var t,r=this._ontrackCallbackMap.get(e);r&&(null===(t=this._handler)||void 0===t||t.off("ontrack",r),this._ontrackCallbackMap.delete(e))}},{key:"handleRemoveStream",value:(a=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Yz("handleRemoveStream()",t),t.subVideo=!1,r.message&&r.message!==QB.videoMuted?t._workaround_1_=!1:t._workaround_1_=!0,t.hasSubscribed){e.next=5;break}return e.abrupt("return");case 5:this.unsubscribe(t,V.AUDIO_AND_VIDEO,!0);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return a.apply(this,arguments)})},{key:"leave",value:(n=u(o().mark((function e(){var t,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Xz.print("leave()"),"connected"!==this.connectionState){e.next=22;break}return this.connectionState="disconnecting",t={Authorization:this._authorization,roomId:this._roomId,sessionId:this._sessionId},e.next=6,this._joinLeaveLock.lock();case 6:return r=e.sent,e.prev=7,e.next=10,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("leaveRoom",t);case 10:this.connectionState="disconnected",e.next=17;break;case 13:throw e.prev=13,e.t0=e.catch(7),this.connectionState="connected",e.t0;case 17:return e.prev=17,r(),e.finish(17);case 20:e.next=23;break;case 22:return e.abrupt("return",Promise.reject(new ZN(JN.NOT_CONNECTED_YET,"server not connected")));case 23:case"end":return e.stop()}}),e,this,[[7,13,17,20]])}))),function(){return n.apply(this,arguments)})},{key:"subscribePublicStream",value:(r=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=this._handler)||void 0===r?void 0:r.subscribe(t);case 2:if(s=e.sent){e.next=5;break}throw new ZN(JN.ADD_TRANSCEIVER_FAILED,"add transceiver failed");case 5:return u=lP(),c=s.audioMid,d=s.videoMid,l={appId:this._appId,streamId:t.streamId,audio:!0,video:!0,data:!0,audioMid:c,videoMid:d,sdpInfo:{sdp:null==s?void 0:s.partialSdp,semantics:null==s?void 0:s.semantics,type:null==s?void 0:s.type},config:{enableMediaType:{audio:!0,video:!0},qualityLayer:{spatialLayer:0,temporalLayer:0}}},e.next=11,null===(n=this._dataChannelSignal)||void 0===n?void 0:n.sendSignaling("startPullStream",l);case 11:return h=e.sent,f=[],this._subResolves[t.streamId]=[],f.push(new Promise((function(e,r){S._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new ZN(JN.TIME_OUT,"wait video timeout for streamId: ".concat(t.streamId)))}),Kz);t.on("ontrack",(function r(i){"video"===i.mediaType&&(Xz.print("remoteStream ".concat(t.userId," received video track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),f.push(new Promise((function(e,r){S._subResolves[t.streamId].push(e);var n=setTimeout((function(){return r(new ZN(JN.TIME_OUT,"wait audio timeout for streamId: ".concat(t.streamId)))}),Kz);t.on("ontrack",(function r(i){"audio"===i.mediaType&&(Xz.print("remoteStream ".concat(t.userId," received audio track")),t.off("ontrack",r),clearTimeout(n),e(0))}))}))),p=function(e){t.ontrack(e)},null===(i=this._handler)||void 0===i||i.on("ontrack",p),this._ontrackCallbackMap.set(t,p),v=null==h?void 0:h.relayMessage,_=v.audioMid,m=v.videoMid,y=v.sequenceId,g=v.sdp,t.videoMid=m,t.audioMid=_,t.sequenceId=y,t._workaround_1_=!1,t.paused=!1,t.streamState=Tz.SUB_ED,t.subAudio=!0,t.subVideo=!0,e.next=30,null===(a=this._handler)||void 0===a?void 0:a.handleAck({action:Cz.subscribe,streamId:t.streamId,audioMid:c,videoMid:d,transceiverInit:null==s?void 0:s.transceiverInit,signalingAck:{audioMid:_,videoMid:m,sdp:g,sequenceId:y},stream:t});case 30:return e.next=32,Promise.all(f);case 32:this.monitor.rtcSubscribeStat(iB.SUCCESS,u,oB.UNKNOWN,t.userId),this._context&&t.statsReport.setRemoteStreamStatsEvtInterval(this,this._handler,this.monitor,this._context);case 34:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"unsubscribePublicStream",value:(t=u(o().mark((function e(t){var r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Yz("unsubscribePublicStream()",t),n={appId:this._appId,streamId:t.streamId},e.prev=2,e.next=5,null===(i=this._dataChannelSignal)||void 0===i?void 0:i.sendSignaling("stopPullStream",n);case 5:e.next=9;break;case 7:e.prev=7,e.t0=e.catch(2);case 9:return t.streamState=Tz.INIT,t.subVideo=!1,t.subAudio=!1,e.next=14,null===(r=this._handler)||void 0===r?void 0:r.handleAck({action:Cz.unsubscribe,streamId:t.streamId,audioMid:t.audioMid,videoMid:t.videoMid,stream:t});case 14:t.clean(),this.removeOnTrackListener(t),t.statsReport.unsubscribe();case 17:case"end":return e.stop()}}),e,this,[[2,7]])}))),function(e){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;Xz.print("destroy()"),this._token=void 0,this._appId=void 0,this._roomId=void 0,this._clientId=void 0,this._authorization=void 0,this._sessionId=void 0,this._context=void 0,null===(e=this._handler)||void 0===e||e.destroy(),null===(t=this._dataChannelSignal)||void 0===t||t.destroy(),null===(r=this._iceConfigRequestManager)||void 0===r||r.abort(),this._handler=void 0,this._dataChannelSignal=void 0,this._iceConfigRequestManager=void 0,this._removeSignalEventHandler(),this.connectionState="disconnected",this.emit("INTERRUPT")}},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._dataChannelSignal)||void 0===r?void 0:r.sendP2PMessage({to:e,from:this._userInfo.userId,room:this._roomId,app:this._appId,msg:t})}},{key:"sendRoomMessage",value:function(e){var t;return null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("customMessage",e)}},{key:"_multiChatMode",value:function(){var e;return null===(e=this._roomAttributes)||void 0===e?void 0:e.multiChatMode}},{key:"handler",get:function(){return this._handler}},{key:"roomAttributes",get:function(){return this._roomAttributes},set:function(e){this._roomAttributes=e}}]),O}(UL);function Qz(e,t,r){var n=r.value;return r.value=u(o().mark((function e(){var r,i,a,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._handler||"connected"!==this._state){e.next=6;break}for(r=s.length,i=new Array(r),a=0;a<r;a++)i[a]=s[a];return e.next=4,n.apply(this,i);case 4:e.next=7;break;case 6:throw new ZN(JN.NOT_CONNECTED_YET,"error in ".concat(t,": try again after joined"));case 7:case"end":return e.stop()}}),e,this)}))),r}function Zz(e,t,r){var n=r.value;return r.value=u(o().mark((function e(){var t,r,i,a,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._pubSubLock.lock();case 2:for(t=e.sent,this.supportConcurrent&&t(),e.prev=4,r=s.length,i=new Array(r),a=0;a<r;a++)i[a]=s[a];return e.next=8,n.apply(this,i);case 8:return e.abrupt("return",e.sent);case 9:return e.prev=9,this.supportConcurrent||t(),e.finish(9);case 12:case"end":return e.stop()}}),e,this,[[4,,9,12]])}))),r}qz([function(e,t,r){var n=r.value;return r.value=u(o().mark((function e(){var t,r,i,a,s=this,c=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=c.length,r=new Array(t),i=0;i<t;i++)r[i]=c[i];return a=!1,e.abrupt("return",new Promise(function(){var e=u(o().mark((function e(t,i){var u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s.on("INTERRUPT",(function(){a=!0,i(new ZN(JN.OPERATION_CANCEL,"operation not finish when leave"))})),e.prev=1,e.next=4,n.apply(s,r);case 4:u=e.sent,t(u),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),a||i(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t,r){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}),e)}))),r}],Jz.prototype,"join",1),qz([Zz,Qz],Jz.prototype,"publish",1),qz([Zz,Qz],Jz.prototype,"updatePubTrack",1),qz([Zz,Qz],Jz.prototype,"unpublish",1),qz([Zz,Qz],Jz.prototype,"subscribe",1),qz([Qz],Jz.prototype,"controlMessage",1),qz([Qz],Jz.prototype,"updateUserAttributes",1),qz([Qz],Jz.prototype,"updateSubTrack",1),qz([Zz,Qz],Jz.prototype,"subscribe4pushTrack",1),qz([Zz,Qz],Jz.prototype,"unsubscribe4removeTrack",1),qz([Zz,Qz],Jz.prototype,"unsubscribe",1),qz([Qz],Jz.prototype,"handleRemoveStream",1),qz([Zz],Jz.prototype,"subscribePublicStream",1),qz([Zz],Jz.prototype,"unsubscribePublicStream",1);var $z=ha,eq=St,tq=se,rq=Te,nq=Pe,iq=He,oq=Vt,aq=es,sq=gt.f,uq=Yo,cq=tq.Symbol,dq=cq&&cq.prototype;if(eq&&iq(cq)&&(!("description"in dq)||void 0!==cq().description)){var lq={},hq=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:aq(arguments[0]),t=oq(dq,this)?new cq(e):void 0===e?cq():cq(e);return""===e&&(lq[t]=!0),t};uq(hq,cq),hq.prototype=dq,dq.constructor=hq;var fq="Symbol(test)"==String(cq("test")),pq=rq(dq.valueOf),vq=rq(dq.toString),_q=/^Symbol\((.*)\)[^)]+$/,mq=rq("".replace),yq=rq("".slice);sq(dq,"description",{configurable:!0,get:function(){var e=pq(this);if(nq(lq,e))return"";var t=vq(e),r=fq?yq(t,7,-1):mq(t,_q,"$1");return""===r?void 0:r}}),$z({global:!0,constructor:!0,forced:!0},{Symbol:hq})}rM("iterator");var gq=np.right,Sq=tt,bq=ip;ha({target:"Array",proto:!0,forced:!qi("reduceRight")||!bq&&Sq>79&&Sq<83},{reduceRight:function(e){return gq(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}});var Eq={};Object.defineProperty(Eq,"__esModule",{value:!0});var kq=function(){return(kq=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Tq(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function Iq(e){return"object"==a(e)&&null!==e}function Rq(e){return"function"==typeof e}function Aq(){if("object"==("undefined"==typeof window?"undefined":a(window))&&Iq(window))return window}function wq(){if("object"==("undefined"==typeof document?"undefined":a(document))&&Iq(document))return document}var Cq=function(e){if(e)return e.__SLARDAR_REGISTRY__||(e.__SLARDAR_REGISTRY__={Slardar:{plugins:[],errors:[],subject:{}}}),e.__SLARDAR_REGISTRY__.Slardar},Oq=function(e,t,r,n){void 0===t&&(t={}),void 0===n&&(n=[]);try{var i=e.apply(void 0,function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}([],Tq(n),!1));return i&&i(t,r)||[]}catch(o){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Cq(Aq());r&&(r.errors||(r.errors=[]),r.errors.push(e))}(o),[]}},xq=function(e){return e.requestIdleCallback||function(t){return e.setTimeout(t,1)}},Nq=function(){return Date.now()};var Dq=function(e,t){return Iq(e)?kq(kq({},t),e):!!e&&t};var Pq=["SCRIPT","STYLE","META","HEAD"],Mq=["js_error","http","resource_error"],Lq=["performance","performance_longtask","performance_timing","custom"],Uq=function e(t,r,n,i,o){if(void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=1.5),void 0===o&&(o=Pq),!t||-1<o.indexOf(t.tagName)||i<=n||4<r)return n;var a=function(){if(!r)return 0;var e=(n=t.getBoundingClientRect()).top,n=n.height;return e>innerHeight||n<=0?0:1/Math.pow(2,r-1)}();return[].reduceRight.call(t.children,(function(t,n){return e(n,r+1,t,i,o)}),n+a)},Vq=function(e,t,r,n){if(function(){if(Aq()&&"Promise"in window)return Promise}()&&r&&n){if(r.html2canvas)return o();var i=n.createElement("script");i.src=t,null!==(t=n.head)&&void 0!==t&&t.appendChild(i),i.onload=o}function o(){xq(r)((function(){r.html2canvas&&r.html2canvas(n.body,{scale:360/r.innerWidth}).then((function(t){e(t.toDataURL("image/jpeg",.1))}))}))}},Fq=function(e,t,r,n,i){if(void 0===e&&(e=Aq()),void 0===t&&(t=wq()),void 0===r&&(r=function(){if(Aq()&&Rq(window.PerformanceObserver))return window.PerformanceObserver}()),void 0===n&&(n=function(){if(Aq()&&Rq(window.MutationObserver))return window.MutationObserver}()),void 0===i&&(i=function(){if(Aq()&&Iq(window.performance))return window.performance}()),t&&e)return function(o,a){var s,u,c,d,l,h,f=o.threshold,p=o.screenshot,v=o.rootSelector,_=o.autoDetect,m=o.ssUrl,y=xq(e),g=Tq(function(e){var t=e&&e.timing||void 0;return[t,function(){return e&&e.now?e.now():(Date.now?Date.now():+new Date)-(t&&t.navigationStart||0)},function(t){var r=(e||{}).getEntriesByType;return Rq(r)&&r.call(e,t)||[]},function(){var t=(e||{}).clearResourceTimings;Rq(t)&&t.call(e)},function(t){var r=(e||{}).getEntriesByName;return Rq(r)&&r.call(e,t)||[]}]}(i),2)[1],S=0,b=!1,E=function(e){s&&a&&a({ev_type:"blank_screen",payload:{timestamp:s[0],score:s[1],screenshot:e,error:u}})},k=(d=function(){s&&!b&&(b=!0,I(),p?Vq(E,m,e,t):E())},function(){l||(h=Nq(),l=e.setTimeout((function(){l=0,h<S||d()}),g()>1e4?2e3:8e3))});function T(){c&&clearTimeout(c),c=e.setTimeout((function(){y((function(){e.requestAnimationFrame((function(){var e=v?t.querySelector(v):t.body;e&&((e=Uq(e,0,0,f))<f?(s=[Nq(),e],k()):s=void 0)}))}))}),1e3)}!function(e){var t=Tq(function(e){var t=!1;return[function(r){t||(t=!0,e&&e(r))}]}(e),1)[0];["unload","beforeunload","pagehide"].forEach((function(e){addEventListener(e,t)}))}((function(){!b&&u&&E()}));var I=function(){clearTimeout(c),A&&A(),C&&C()},R=(o=Tq(function(e,t){var r=e&&new e(t);return[function(e,t){r&&e&&r.observe(e,t)},function(){return r&&r.disconnect()}]}(n,T),2),o[0]),A=o[1],w=(o=Tq(function(e,t,r,n){var i=e&&new e((function(e,i){e.getEntries?e.getEntries().forEach((function(e,r,n){return t(e,r,n,i)})):n&&n(),r&&i.disconnect()}));return[function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(!e||!i)return n&&n();try{t.forEach((function(t){-1<e.supportedEntryTypes.indexOf(t)&&i.observe({type:t,buffered:!1})}))}catch(o){try{i.observe({entryTypes:t})}catch(a){return n&&n()}}},function(){return i&&i.disconnect()}]}(r,(function(e,t,r){return c&&1<r.length&&T()})),2),o[0]),C=o[1];return _&&function(e){var t=Aq(),r=wq();t&&r&&("loading"!==r.readyState?e():t.addEventListener("DOMContentLoaded",(function(){setTimeout((function(){e()}),0)}),!1))}((function(){var e;R(null===(e=wq())||void 0===e?void 0:e.body,{subtree:!0,childList:!0}),w("longtask","resource"),T()})),[I,function(e){b||function(e){return~Lq.indexOf(e.ev_type)}(e)||(S=Nq(),u&&S-u.timestamp>1e4&&(u=void 0),u=function(e,t){if(-1===Mq.indexOf(t.ev_type))return e;if("http"===t.ev_type&&t.payload.response.status<400)return e;if(e&&Mq.indexOf(e.type)<Mq.indexOf(t.ev_type))return e;var r="";switch(t.ev_type){case"js_error":r=t.payload.error.message;break;case"http":r=t.payload.request.url;break;case"resource_error":r=t.payload.url}return{type:t.ev_type,message:r,timestamp:Nq()}}(u,e))},T]}},Bq="blankScreen";function jq(e,t,r){e.on("init",(function(){var n,i,o,a=function(e,t,r){return t=null===(e=e.config())||void 0===e?void 0:e.plugins[t],Dq(t,r)}(e,Bq,t)||Dq(r,t);a&&(a=Tq(Oq(Fq,a,e.report.bind(e)),3),n=a[0],i=a[1],a=a[2],e.on("report",o=function(e){return i(e),e}),e.on("beforeDestroy",(function(){n(),e.off("report",o)})),e.provide("detectBlankScreen",a))}))}var Gq={autoDetect:!0,threshold:1.5,screenshot:!0,ssUrl:"https://apm.volccdn.com/mars-web/apmplus/web/html2canvas.min.js"};var Hq=Eq.blankScreenPlugin=function(e){return{name:Bq,setup:function(t){!function(e,t){jq(e,Gq,t)}(t,e)}}},zq=xe,qq=_c,Xq=uc;ha({target:"Object",stat:!0,forced:ye((function(){qq(1)})),sham:!Xq},{getPrototypeOf:function(e){return qq(zq(e))}});var Kq=SD.start;ha({target:"String",proto:!0,forced:bD},{padStart:function(e){return Kq(this,e,arguments.length>1?arguments[1]:void 0)}});var Wq,Yq={};Object.defineProperty(Yq,"__esModule",{value:!0});var Jq=function(){return(Jq=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Qq(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function Zq(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var $q=function(e){return JSON.stringify({ev_type:"batch",list:e})};var eX=["init","start","config","beforeDestroy","provide","beforeReport","report","beforeBuild","build","beforeSend","send","beforeConfig"],tX=function(){return{}};function rX(e){return"object"==a(e)&&null!==e}var nX=Object.prototype;function iX(e){return!!rX(e)&&("function"!=typeof Object.getPrototypeOf?"[object Object]"===nX.toString.call(e):(e=Object.getPrototypeOf(e))===nX||null===e)}function oX(e){return"[object Array]"===nX.toString.call(e)}function aX(e){return"function"==typeof e}function sX(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function uX(e,t){var r,n=Jq({},e);for(r in t)sX(t,r)&&void 0!==t[r]&&(rX(t[r])&&iX(t[r])?n[r]=uX(rX(e[r])?e[r]:{},t[r]):oX(t[r])&&oX(e[r])?n[r]=cX(e[r],t[r]):n[r]=t[r]);return n}function cX(e,t){return e=oX(e)?e:[],t=oX(t)?t:[],Array.prototype.concat.call(e,t).map((function(e){return e instanceof RegExp?e:rX(e)&&iX(e)?uX({},e):oX(e)?cX([],e):e}))}function dX(e,t){if(!oX(e))return!1;if(0===e.length)return!1;for(var r=0;r<e.length;){if(e[r]===t)return!0;r++}return!1}var lX=function(e,t){if(!oX(e))return e;var r=e.indexOf(t);return 0<=r?((t=e.slice()).splice(r,1),t):e},hX=function(e,t,r){return function(e,t,r){for(var n,i=(t=Qq(t.split(".")))[0],o=t.slice(1);e&&0<o.length;)e=e[i],i=(n=Qq(o))[0],o=n.slice(1);if(e)return r(e,i)}(e,t,(function(e,t){if(e&&t in e&&aX(e[t]))try{return e[t].apply(e,r)}catch(n){return}}))};function fX(e){try{return function(e){return"string"==typeof e}(e)?e:JSON.stringify(e)}catch(t){return"[FAILED_TO_STRINGIFY]:"+String(t)}}var pX=0,vX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.error.apply(console,Zq(["[SDK]",Date.now(),(""+pX++).padStart(8," ")],Qq(e),!1))},_X=0,mX=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];console.warn.apply(console,Zq(["[SDK]",Date.now(),(""+_X++).padStart(8," ")],Qq(e),!1))},yX=function(e){return function(t){for(var r=t,n=0;n<e.length&&r;n++)try{r=e[n](r)}catch(i){vX(i)}return r}};function gX(){var e=function(){for(var e=new Array(16),t=0,r=0;r<16;r++)0==(3&r)&&(t=4294967296*Math.random()),e[r]=t>>>((3&r)<<3)&255;return e}();return e[6]=15&e[6]|64,e[8]=63&e[8]|128,function(e){for(var t=[],r=0;r<256;++r)t[r]=(r+256).toString(16).substr(1);var n=0,i=t;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[14]],i[e[15]]].join("")}(e)}var SX=function e(t,r){var n=r.reduce((function(e,r){try{var n=r(t);"function"==typeof n&&e.push(n)}catch(i){}return e}),[]);return function(t){return e(t,n)}},bX=function(e){function t(e){n=lX(n,e),o||a()}var r,n=[],i=[],o=!1,a=function(e,t,r){var n=0;return function(){if(e())return n&&clearTimeout(n),void(n=0);0===n&&(n=setTimeout(t,r))}}((function(){return!!n.length}),(function(){o=!0,r&&r[0](),i.forEach((function(e){return e()})),i.length=0,r=void 0}),e=void 0===e?3e5:e);return{next:function(e){return SX(e,n)},complete:function(e){i.push(e)},attach:function(e,t){r=[e,t]},subscribe:function(e){if(o)throw new Error("Observer is closed");return n.push(e),r&&r[1]&&r[1](e),a(),function(){return t(e)}},unsubscribe:t}};var EX=function(e){var t,r,n,i=(t={},r={},n={set:function(e,i){return t[e]=i,r[e]=fX(i),n},merge:function(e){return t=Jq(Jq({},t),e),Object.keys(e).forEach((function(t){r[t]=fX(e[t])})),n},delete:function(e){return delete t[e],delete r[e],n},clear:function(){return t={},r={},n},get:function(e){return r[e]},toString:function(){return Jq({},r)}},n);e.provide("context",i),e.on("report",(function(e){return e.extra||(e.extra={}),e.extra.context=i.toString(),e}))},kX=function(e,t,r){function n(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(u=r[0]){var a=u.split(".")[0];if(a in n)return hX(n,u,[].slice.call(r,1));var s=o[a]||[],u=null!==(u=null==t?void 0:t(e))&&void 0!==u?u:{};s.push(Zq([u],Qq(r),!1)),o[a]=s}}var i,o={};for(i in function(e,t,r,n){return void 0===n&&(n=!0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];if(!e)return tX;var a=e[t],s=r.apply(void 0,Zq([a],Qq(i),!1)),u=s;return aX(u)&&n&&(u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return s.apply(this,e)}catch(r){return aX(a)&&a.apply(this,e)}}),e[t]=u,function(r){r||(u===e[t]?e[t]=a:s=a)}}}(e,"provide",(function(t){return function(r,i){n[r]=i,t.call(e,r,i)}}))(),e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return e.on("provide",(function(t){o[t]&&(o[t].forEach((function(t){t=(n=Qq(t))[0];var n=n.slice(1);null!=r&&r(e,t,n)})),o[t]=null)})),n};function TX(e,t){var r=t||{};e.provide("initSubject",(function(e){var t=(e=Qq(e,2))[0];e=e[1];return r[t]||(r[t]=function(t,r){var n=bX();try{t(n.next,n.attach),r&&n.complete(r)}catch(e){}return[n.subscribe,n.unsubscribe]}(e,(function(){r[t]=void 0}))),r[t]})),e.provide("getSubject",(function(e){return r[e]}))}function IX(){if("object"==("undefined"==typeof window?"undefined":a(window))&&rX(window))return window}function RX(){var e=function(){if(IX()&&"navigator"in window)return window.navigator}();if(e)return e.connection||e.mozConnection||e.webkitConnection}function AX(){var e=IX()&&IX()&&window.location;return null==e?void 0:e.href}var wX=function(e){var t={url:AX(),timestamp:Date.now()},r=e.config();return null!=r&&r.pid&&(t.pid=r.pid),null!=e&&e.context&&(t.context=e.context.toString()),t};function CX(e){return(null==e?void 0:e.effectiveType)||(null==e?void 0:e.type)||""}var OX=function(e,t,r){var n,i=t.url,o=t.data,a=void 0===(n=t.success)?tX:n,s=void 0===(n=t.fail)?tX:n,u=void 0===(n=t.getResponseText)?tX:n;t=void 0!==(t=t.withCredentials)&&t;(r=new r).withCredentials=t,r.open(e,i,!0),r.setRequestHeader("Content-Type","application/json"),r.onload=function(){null!=u&&u(this.responseText);try{var e;this.responseText?(e=JSON.parse(this.responseText),a(e)):a({})}catch(t){s(t)}},r.onerror=function(){s(new Error("Network request failed"))},r.onabort=function(){s(new Error("Network request aborted"))},r.send(o)},xX=function(){var e=function(){if("function"==typeof XMLHttpRequest&&aX(XMLHttpRequest))return XMLHttpRequest}();return e?{get:function(t){OX("GET",t,e)},post:function(t){OX("POST",t,e)}}:{get:tX,post:tX}};function NX(e){function t(e){n.post(r.getEndpoint(),$q([e]))}var r=function(e){var t=e.transport,r=e.endpoint,n=e.size,i=void 0===n?10:n,o=void 0===(e=e.wait)?1e3:e,a=[],s=0;function u(){a.length&&(t.post({url:r,data:this.getBatchData()}),a=[])}return{getSize:function(){return i},getWait:function(){return o},setSize:function(e){i=e},setWait:function(e){o=e},getEndpoint:function(){return r},setEndpoint:function(e){r=e},send:function(e){a.push(e),a.length>=i&&u.call(this),clearTimeout(s),s=setTimeout(u.bind(this),o)},flush:function(){clearTimeout(s),u.call(this)},getBatchData:function(){return a.length?$q(a):""},clear:function(){clearTimeout(s),a=[]}}}(e),n=function(){var e=IX();return e&&e.navigator.sendBeacon?{get:function(){},post:function(t,r){e.navigator.sendBeacon(t,r)}}:{get:tX,post:tX}}();return function(e){var t=Qq(function(e){var t=!1;return[function(r){t||(t=!0,e&&e(r))}]}(e),1)[0];["unload","beforeunload","pagehide"].forEach((function(e){addEventListener(e,t)}))}((function(){var e=r.getBatchData();e&&(n.post(r.getEndpoint(),e),r.clear()),r.send=t})),r}var DX={build:function(e){return{ev_type:e.ev_type,payload:e.payload,common:Jq(Jq({},e.extra||{}),e.overrides||{})}}};function PX(e){var t,r=e.plugins||{};for(t in r)r[t]&&!rX(r[t])&&(r[t]={});return Jq(Jq({},e),{plugins:r})}function MX(e){return rX(e)&&"aid"in e}function LX(e){return Jq({},e)}var UX="/settings/get/webpro",VX="/monitor_web/collect",FX=[VX,UX,"/monitor_browser/collect"],BX={sample_rate:1,include_users:[],sample_granularity:"session",rules:{}},jX=function(e,t){return void 0===t&&(t=VX),(e&&0<=e.indexOf("//")?"":"https://")+e+t},GX=function(e,t){return void 0===t&&(t=UX),(e&&0<=e.indexOf("//")?"":"https://")+e+t},HX=function(e){return e+"_"+Date.now()},zX=function(e){return"APMPLUS"+e},qX=function(e){return function(e){try{var t=localStorage.getItem(e),r=t;return t&&"string"==typeof t?JSON.parse(t):r}catch(n){return}}(e=zX(e))||{userId:gX(),deviceId:gX(),r:Math.random()}},XX=function(e){var t=e.aid,r=e.userId,n=e.deviceId;e=e.sample;!function(e,t){try{var r="string"==typeof t?t:JSON.stringify(t);localStorage.setItem(e,r)}catch(n){}}(t=zX(t),{userId:r,deviceId:n,r:e.r})},KX=function(e){var t,r,n,i=e,o={},a=tX,s=tX;return{getConfig:function(){return i},setConfig:function(e){return o=Jq(Jq({},o),e||{}),u(),t||(t=e,i.useLocalConfig?(n={},a()):r?c():function(e,t,r,n){e.get({withCredentials:!0,url:GX(t)+"?aid="+r,success:function(e){n(e.data||{})},fail:function(){n()}})}(i.transport,i.domain,i.aid,(function(e){r=e,c()}))),i},onChange:function(e){s=e},onReady:function(t){a=function(){e.userId!==i.userId&&(e.sample.r=Math.random(),u()),XX(i),t()},n&&a()}};function u(){var t=Jq(Jq(Jq({},e),n||{}),o);t.plugins=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var r={},n=0;n<e.length;)r=uX(r,e[n++]);return r}(e.plugins,(null==n?void 0:n.plugins)||{},o.plugins||{}),t.sample=WX(WX(e.sample,null==n?void 0:n.sample),o.sample),i=t,s()}function c(){n=function(e){if(!e)return{};var t=e.sample,r=e.timestamp,n=e.status;if(!t)return{};var i=t.sample_rate;return e=t.sample_granularity,{sample:{include_users:t.include_users,sample_rate:n&&4===n?0:i,sample_granularity:e,rules:t.rules.reduce((function(e,t){var r=t.name,n=t.enable,i=t.sample_rate;return t=t.conditional_sample_rules,e[r]={enable:n,sample_rate:i,conditional_sample_rules:t},e}),{})},serverTimestamp:r}}(r),u(),a()}};function WX(e,t){if(!e||!t)return e||t;var r=Jq(Jq({},e),t);return r.include_users=Zq(Zq([],Qq(e.include_users||[]),!1),Qq(t.include_users||[]),!1),r.rules=Zq(Zq([],Qq(Object.keys(e.rules||{})),!1),Qq(Object.keys(t.rules||{})),!1).reduce((function(r,n){var i;return n in r||(n in(e.rules||{})&&n in(t.rules||{})?(r[n]=Jq(Jq({},e.rules[n]),t.rules[n]),r[n].conditional_sample_rules=Zq(Zq([],Qq(e.rules[n].conditional_sample_rules||[]),!1),Qq(t.rules[n].conditional_sample_rules||[]),!1)):r[n]=(null===(i=e.rules)||void 0===i?void 0:i[n])||(null===(i=t.rules)||void 0===i?void 0:i[n])),r}),{}),r}var YX=function(e){e.on("report",(function(e){return function(e){var t={url:AX(),timestamp:Date.now()};return Jq(Jq({},e),{extra:Jq(Jq({},t),e.extra||{})})}(e)}))},JX=function(e){e.on("beforeBuild",(function(t){return function(e,t){var r={};return r.aid=t.aid,r.pid=t.pid,r.view_id=t.viewId,r.user_id=t.userId,Jq(Jq({},e),{extra:Jq(Jq({},r),e.extra||{})})}(t,e.config())}))},QX=function(e){e.on("start",(function(){var t,r={did:(t=e.config()).deviceId,sid:t.sessionId,release:t.release,env:t.env,sname:"APM_PLUS_WEB",sversion:"1.7.0",soffset:t.offset||0,biz_id:r=t.aid,x_auth_token:t=t.token};(t=e.getSender()).setEndpoint(t.getEndpoint()+function(e){return rX(e)?Object.keys(e).reduce((function(t,r){return t+"&"+r+"="+e[r]}),"").replace("&","?"):""}(r))}))},ZX=function(e){return e=qX(e.aid),{aid:0,pid:"",token:"",viewId:HX("_"),userId:e.userId,deviceId:e.deviceId,sessionId:gX(),domain:"apmplus.volces.com",plugins:{ajax:{ignoreUrls:FX},fetch:{ignoreUrls:FX},breadcrumb:{},pageview:{},jsError:{},resource:{},resourceError:{},performance:{},tti:{},fmp:{},blankScreen:!1},release:"",env:"production",sample:Jq(Jq({},BX),{r:e.r}),transport:xX()}};Wq=Yq.createMinimalBrowserClient=function(e){var t=(r=void 0===e?{}:e).createSender,r=(e=r.builder,r.createDefaultConfig),n=function(e){var t,r,n=e.builder,i=e.createSender,o=e.createDefaultConfig,a=e.createConfigManager,s=e.userConfigNormalizer,u=e.initConfigNormalizer,c=e.validateInitConfig,d={};eX.forEach((function(e){return d[e]=[]}));var l=!1,h=!1,f=!1,p=[],v=[],_={getBuilder:function(){return n},getSender:function(){return t},getPreStartQueue:function(){return p},init:function(e){if(l)mX("already inited");else{if(!(e&&rX(e)&&c(e)))throw new Error("invalid InitConfig, init failed");var n=o(e);if(!n)throw new Error("defaultConfig missing");if(e=u(e),(r=a(n)).setConfig(e),r.onChange((function(){m("config")})),!(t=i(r.getConfig())))throw new Error("sender missing");m("init",l=!0)}},set:function(e){l&&e&&rX(e)&&(m("beforeConfig",!1,e),null!=r&&r.setConfig(e))},config:function(e){if(l)return e&&rX(e)&&(m("beforeConfig",!1,e),null!=r&&r.setConfig(s(e))),null==r?void 0:r.getConfig()},provide:function(e,t){dX(v,e)?mX("cannot provide "+e+", reserved"):(_[e]=t,m("provide",!1,e))},start:function(){var e=this;l&&(h||null!=r&&r.onReady((function(){m("start",h=!0),p.forEach((function(t){return e.build(t)})),p=[]})))},report:function(e){e&&(!(e=yX(d.beforeReport)(e))||(e=yX(d.report)(e))&&(h?this.build(e):p.push(e)))},build:function(e){!h||(e=yX(d.beforeBuild)(e))&&(!(e=n.build(e))||(e=yX(d.build)(e))&&this.send(e))},send:function(e){!h||(e=yX(d.beforeSend)(e))&&(t.send(e),m("send",!1,e))},destroy:function(){m("beforeDestroy",f=!0)},on:function(e,t){"init"===e&&l||"start"===e&&h||"beforeDestroy"===e&&f?t():d[e]&&d[e].push(t)},off:function(e,t){d[e]&&(d[e]=lX(d[e],t))}};return v=Object.keys(_),_;function m(e,t){void 0===t&&(t=!1);for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];d[e].forEach((function(e){try{e.apply(void 0,Zq([],Qq(r),!1))}catch(t){}})),t&&(d[e].length=0)}}({validateInitConfig:MX,initConfigNormalizer:PX,userConfigNormalizer:LX,createSender:void 0===t?function(e){return NX({size:20,endpoint:jX(e.domain),transport:e.transport})}:t,builder:void 0===e?DX:e,createDefaultConfig:void 0===r?ZX:r,createConfigManager:KX});return EX(n),r=function(e){if(e)return e.__SLARDAR_REGISTRY__||(e.__SLARDAR_REGISTRY__={Slardar:{plugins:[],errors:[],subject:{}}}),e.__SLARDAR_REGISTRY__.Slardar}(IX()),TX(n,r&&r.subject),function(e){var t,r=!1;e.on("init",(function(){t=(new Date).getTime(),e.on("config",(function(){var n,i=null===(n=e.config())||void 0===n?void 0:n.serverTimestamp;isNaN(i)||Number(i)<=0||r||(r=!0,(n=(new Date).getTime())-t<700&&i&&(n=i-(n+t)/2,!isNaN(n)&&(0<n||n<-6e5)&&e.set({offset:n})))}))}))}(n),JX(n),YX(n),function(e){var t=RX(),r=CX(t);t&&(t.onchange=function(){r=CX(t)}),e.on("report",(function(e){return Jq(Jq({},e),{extra:Jq(Jq({},e.extra||{}),{network_type:r})})}))}(n),QX(n),r=kX(n,wX,(function(e,t,r){return function(e,t){return function(r){function n(e){return e.overrides=t,e}e.on("report",n),r(),e.off("report",n)}}(e,t)((function(){var e=(t=Qq(r))[0],t=t.slice(1);n[e].apply(n,Zq([],Qq(t),!1))}))})),function(e){e.on("init",(function(){var t=[],r=e.config();r&&r.integrations&&r.integrations.forEach((function(r){dX(t,r.name)||(t.push(r.name),r.setup(e),r.tearDown&&e.on("beforeDestroy",r.tearDown))}))}))}(r),r},Yq.getDefaultConfig=ZX;var $X={};Object.defineProperty($X,"__esModule",{value:!0});var eK=function(){return(eK=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function tK(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function rK(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var nK=function(){return{}};function iK(e){return"object"==a(e)&&null!==e}var oK=Object.prototype;function aK(e){return"function"==typeof e}function sK(e){return"string"==typeof e}function uK(e){return function(e){return"[object Array]"===oK.toString.call(e)}(e)&&e.length?function(e){for(var t=[],r=e.length,n=0;n<r;n++){var i=e[n];sK(i)?t.push(i.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")):i&&i.source&&t.push(i.source)}return new RegExp(t.join("|"),"i")}(e):null}function cK(e){try{return sK(e)?e:JSON.stringify(e)}catch(t){return"[FAILED_TO_STRINGIFY]:"+String(t)}}var dK=function(e,t,r,n){return void 0===n&&(n=!0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];if(!e)return nK;var a=e[t],s=r.apply(void 0,rK([a],tK(i),!1)),u=s;return aK(u)&&n&&(u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return s.apply(this,e)}catch(r){return aK(a)&&a.apply(this,e)}}),e[t]=u,function(r){r||(u===e[t]?e[t]=a:s=a)}}};function lK(){if("object"==("undefined"==typeof window?"undefined":a(window))&&iK(window))return window}var hK=function(e){if(e)return e.__SLARDAR_REGISTRY__||(e.__SLARDAR_REGISTRY__={Slardar:{plugins:[],errors:[],subject:{}}}),e.__SLARDAR_REGISTRY__.Slardar},fK=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=hK(lK());r&&(r.errors||(r.errors=[]),r.errors.push(e))};function pK(e,t,r){return function(e,t){return iK(e)?eK(eK({},t),e):!!e&&t}(t=null===(e=e.config())||void 0===e?void 0:e.plugins[t],r)}var vK=["name","message","stack","filename","lineno","colno"],_K=function(e){var t;return function(e){switch(Object.prototype.toString.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMError]":case"[object DOMException]":return!0;default:return e instanceof Error}}(e)?t=function(e,t){return e&&iK(e)?t.reduce((function(t,r){return t[r]=e[r],t}),{}):e}(e,vK):(function(e){return!!iK(e)&&("function"!=typeof Object.getPrototypeOf?"[object Object]"===oK.toString.call(e):(e=Object.getPrototypeOf(e))===oK||null===e)}(e)||function(e){return"undefined"!=typeof Event&&function(e,t){try{return e instanceof t}catch(r){return!1}}(e,Event)}(e)||sK(e))&&(t={message:cK(e)}),t},mK=function(e){return _K(e.error)},yK=function(e){var t;try{var r=void 0;if("reason"in e?r=e.reason:"detail"in e&&"reason"in e.detail&&(r=e.detail.reason),r){var n=_K(r);return eK(eK({},n),{name:null!==(t=n&&n.name)&&void 0!==t?t:"UnhandledRejection"})}}catch(i){}},gK=function(e){return(function(e){return"[object ErrorEvent]"===Object.prototype.toString.call(e)}(e)?mK:function(e){return"[object PromiseRejectionEvent]"===Object.prototype.toString.call(e)}(e)?yK:_K)(e)},SK=["EventTarget","Window","Node","ApplicationCache","ChannelMergerNode","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","MessagePort","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],bK=["setTimeout","setInterval","requestAnimationFrame","requestIdleCallback"],EK=["onload","onerror","onprogress","onreadystatechange"],kK="addEventListener",TK=function(e,t,r){function n(t,r){if(!aK(t))return t;var i={type:"capture-global",data:eK({},r)},o=t._w_||(t._w_=function(){try{return(t.handleEvent&&aK(t.handleEvent)?t.handleEvent:t).apply(this,[].map.call(arguments,(function(e){return n(e,r)})))}catch(a){var o=_K(a);throw o&&e({error:o,source:i}),a}});return o._hook_=!0,o}void 0===t&&(t=lK()),void 0===r&&(r=function(){if("function"==typeof XMLHttpRequest&&aK(XMLHttpRequest))return XMLHttpRequest}());var i=[];return t&&i.push.apply(i,rK([],tK(bK.filter((function(e){return t[e]})).map((function(e){return dK(t,e,(function(t){return function(r){for(var i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];return t&&t.call.apply(t,rK([this,n(r,{function:e})],tK(i),!1))}}),!1)()}))),!1)),r&&r.prototype&&i.push(dK(r.prototype,"send",(function(e){return function(){for(var t=this,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return i.push.apply(i,rK([],tK(EK.filter((function(e){return t[e]&&!t[e]._hook_})).map((function(e){var r=dK(t,e,(function(t){return n(t,{function:e})}),!1)();return function(){r(),t[e]._hook_=void 0}}))),!1)),e.apply(this,r)}}),!1)()),SK.forEach((function(e){var r=t[e]&&t[e].prototype;r&&r.addEventListener&&(i.push(dK(r,kK,(function(t){return function(r,i,o){try{var a=i.handleEvent;aK(a)&&(i.handleEvent=n(a,{function:"handleEvent",target:e}))}catch(s){}return t&&t.call(this,r,n(i,{function:kK,target:e}),o)}}),!1)()),i.push(dK(r,"removeEventListener",(function(e){return function(t,r,n){return null!=r&&r._w_&&e.call(this,t,r._w_,n),e.call(this,t,r,n)}}),!1)()))})),i},IK=function(e,t){return e&&t&&e===t},RK=function(){var e;return function(t){try{if(function(e,t){return!!(e&&t&&IK(e.message,t.message)&&IK(e.stack,t.stack))}(t,e))return void(e=t)}catch(r){fK(r)}return e=t}},AK=function(e){if(e=void 0===e?lK():e)return function(t,r){var n,i,o=t.ignoreErrors,a=t.onerror,s=t.onunhandledrejection,u=t.dedupe,c=(t=t.captureGlobalAsync,uK(o)),d=[],l=RK(),h=function(e){var t=e.error,n=e.extra,i=e.react;e=e.source,t=u?l(t):t;r&&t&&(c&&c.test(t.message)||r({ev_type:"js_error",payload:{error:t,breadcrumbs:[],extra:n,react:i,source:e}}))};return a&&(e.addEventListener("error",n=function(e){return h({error:mK(e),source:{type:"onerror"}})}),d.push((function(){return e.removeEventListener("error",n)}))),s&&(e.addEventListener("unhandledrejection",i=function(e){return h({error:yK(e),source:{type:"onunhandledrejection"}})}),d.push((function(){return e.removeEventListener("unhandledrejection",i)}))),t&&d.push.apply(d,rK([],tK(TK(h)),!1)),[function(e,t,r){return h({error:gK(e),extra:t,react:r,source:{type:"manual"}})},function(){d.forEach((function(e){return e()}))}]}},wK="jsError",CK={ignoreErrors:[],onerror:!0,onunhandledrejection:!0,captureGlobalAsync:!1,dedupe:!0};function OK(e){e.on("init",(function(){window.removeEventListener("error",e.pcErr,!0),window.removeEventListener("unhandledrejection",e.pcRej,!0);var t,r=pK(e,wK,CK);r&&(r=(t=tK(function(e,t,r,n){void 0===t&&(t={}),void 0===n&&(n=[]);try{var i=e.apply(void 0,rK([],tK(n),!1));return i&&i(t,r)||[]}catch(o){return fK(o),[]}}(AK,r,(function(t){e.getBreadcrumbs&&(t.payload.breadcrumbs=e.getBreadcrumbs()),e.report(t)})),2))[0],t=t[1],e.on("beforeDestroy",t),e.provide("captureException",r))}))}var xK=$X.jsErrorPlugin=function(){return{name:wK,setup:function(e){OK(e)}}},NK={};Object.defineProperty(NK,"__esModule",{value:!0});var DK=function(){return(DK=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function PK(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=o.next()).done;)a.push(n.value)}catch(s){i={error:s}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function MK(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||((n=n||Array.prototype.slice.call(t,0,i))[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}var LK=function(){return{}};function UK(e){return"object"==a(e)&&null!==e}function VK(e){return"function"==typeof e}var FK=function(e,t,r,n){return void 0===n&&(n=!0),function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];if(!e)return LK;var a=e[t],s=r.apply(void 0,MK([a],PK(i),!1)),u=s;return VK(u)&&n&&(u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return s.apply(this,e)}catch(r){return VK(a)&&a.apply(this,e)}}),e[t]=u,function(r){r||(u===e[t]?e[t]=a:s=a)}}};function BK(){if("object"==("undefined"==typeof window?"undefined":a(window))&&UK(window))return window}var jK=function(e){if(e)return e.__SLARDAR_REGISTRY__||(e.__SLARDAR_REGISTRY__={Slardar:{plugins:[],errors:[],subject:{}}}),e.__SLARDAR_REGISTRY__.Slardar},GK=function(e,t,r,n){void 0===t&&(t={}),void 0===n&&(n=[]);try{var i=e.apply(void 0,MK([],PK(n),!1));return i&&i(t,r)||[]}catch(o){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=jK(BK());r&&(r.errors||(r.errors=[]),r.errors.push(e))}(o),[]}};function HK(e){var t=function(){if("object"==("undefined"==typeof document?"undefined":a(document))&&UK(document))return document}();return t&&e?((t=t.createElement("a")).href=e,"/"!==(e=t.pathname||"/")[0]&&(e="/"+e),{url:t.href,protocol:t.protocol.slice(0,-1),domain:t.hostname,query:t.search.substring(1),path:e,hash:t.hash}):{url:e,protocol:"",domain:"",query:"",path:"",hash:""}}function zK(e,t,r){return function(e,t){return UK(e)?DK(DK({},t),e):!!e&&t}(t=null===(e=e.config())||void 0===e?void 0:e.plugins[t],r)}var qK=["hash_0",function(e,t){var r,n=BK();n&&(n.addEventListener("hashchange",r=function(){return e(location.href)},!0),t((function(){return n.removeEventListener("hashchange",r,!0)})))}],XK=["history_0",function(e,t){var r,n,i,o=BK()&&window.history;o&&(n=function(){return e(location.href)},(r=[]).push(FK(o,"pushState",i=function(e){return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];try{e.apply(o,t)}finally{n()}}})(),FK(o,"replaceState",i)()),window.addEventListener("popstate",n,!0),r.push((function(){return window.removeEventListener("popstate",n,!0)})),t((function(){r.forEach((function(e){return e()}))})))}],KK=function(e,t){if(void 0===e&&(e=BK()),void 0===t&&(t=BK()&&window.location),e&&t)return function(e,r){var n,i,o,a=e.sendInit,s=e.initPid,u=e.routeMode,c=e.extractPid,d=e.onPidUpdate,l=(e=e.createObserver,[]),h="manual"===u?function(){return""}:function(e){return function(t){var r;return"hash"===e?(null===(r=HK(t).hash)||void 0===r?void 0:r.replace(/^#/,""))||"/":HK(t).path}}(u),f=c||function(){},p=(s=PK(function(e,t,r,n){var i=r,o=t;return n&&n(t),[function(t,r,a){"user_set"!==t&&r!==i?(i=r,o=null!=a?a:i,n&&n(o),e(t,o)):"user_set"===t&&r!==o&&(o=r,n&&n(o),e(t,o))},function(){t&&e("init",t)}]}((function(e,t){r&&r({ev_type:"pageview",payload:{pid:t,source:e}})}),s||(n=t.href,null!==(i=f(n))&&void 0!==i?i:h(n)),h(t.href),d),2),s[0]);d=s[1],s=p.bind(null,"user_set");return"manual"!==u&&(o=PK(function(e,t){var r=t;return[function(t,n){n!==r&&e(t,r=n)}]}((function(e,t){return p(e,h(t),f(t))}),""),1)[0],e=PK(e(u),1)[0],l.push(e((function(e){return o(u,e)})))),a&&d(),[s,function(){l.forEach((function(e){return e()}))}]}},WK="pageview",YK={sendInit:!0,routeMode:"history"};var JK,QK=NK.pageviewPlugin=function(){return{name:WK,setup:function(e){var t;(t=e).on("init",(function(){var e,r=zK(t,WK,YK);r&&(r=PK(GK(KK,DK(DK({},r),{initPid:null===(r=t.config())||void 0===r?void 0:r.pid,onPidUpdate:function(e){t.set({pid:e,viewId:e+"_"+Date.now(),actionId:void 0})},createObserver:function(e){return t.initSubject("hash"===e?qK:XK)}}),t.report.bind(t)),2),e=r[0],r=r[1],t.on("config",(function(){e(t.config().pid)})),t.on("beforeDestroy",r),t.provide("sendPageview",e))}))}}};fP()||window.__rtc_slardar__||((JK=Wq())("init",{aid:432410,token:"d7271e1eac254529abcffc63e36b02c3",integrations:[QK(),xK(),Hq({screenshot:!1})]}),JK("start"),window.__rtc_slardar__=JK);var ZK,$K=new(function(){function e(){c(this,e)}return l(e,[{key:"setStats",value:function(e){!fP()&&JK&&Object.keys(e).forEach((function(t){JK("context.set",t,e[t])}))}}]),e}()),eW=function(){function e(t,r){c(this,e),h(this,"_audioEventSessionId",bP()),h(this,"_videoEventSessionId",bP()),h(this,"_handler",void 0),h(this,"_stream",void 0),h(this,"_firstAudioFrameTimer",void 0),h(this,"_firstVideoFrameTimer",void 0),h(this,"_transportDelayInterval",void 0),h(this,"_transportDelay",void 0),h(this,"_firstVideoFrameInterval",void 0),h(this,"_firstAudioFrameInterval",void 0),h(this,"_isScreen",!1),h(this,"_audioFirstFrameState",0),h(this,"_videoFirstFrameState",0),h(this,"_timeout",1e4),h(this,"_currentAudioRecv",{startTime:0,eventSessionId:0,type:cB.LOGIN}),h(this,"_currentVideoRecv",{startTime:0,eventSessionId:0,type:cB.LOGIN}),h(this,"_login",!1),h(this,"_unMuteAudio",!1),h(this,"_enableAudio",!1),h(this,"_unMuteVideo",!1),h(this,"_enableVideo",!1),h(this,"_remoteUnmuteAudio",!1),h(this,"_remoteUnmuteVideo",!1),h(this,"_audioExternal",!1),h(this,"_pushAudio",!1),h(this,"_videoExternal",!1),h(this,"_pushVideo",!1),h(this,"_autoSubscribeVideo",!1),h(this,"_autoSubscribeAudio",!1),h(this,"_autoSubscribe",!1),h(this,"_publishVideo",!1),h(this,"_publishAudio",!1),h(this,"_subscribeAudio",!1),h(this,"_subscribeVideo",!1),h(this,"_subscribe",!1),h(this,"_pushTrack",!1),h(this,"_multiChatMode",!1),this._stream=t,this._handler=r,this.getTransportDelay()}var t,r,n,i;return l(e,[{key:"beginRecvFrame",value:(i=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h,f,p,v,_,m=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:n=this._transportDelay,i=!0,a=cB.LOGIN,s=cB.UNMUTE,u=cB.SUBSCRIBE,c=cB.PUSH_TRACK,[a,s,u,c].indexOf(r)>=0&&(n=0,i=!1),t===uB.AUDIO?(i||this._audioEventSessionId++,this._currentAudioRecv={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:r},h={media_type:t,event_type:sB.BEGIN_RECV,type:r,start:null===(d=this._currentAudioRecv)||void 0===d?void 0:d.startTime,event_session_id:this._audioEventSessionId,stream_user_id:null===(l=this._stream)||void 0===l?void 0:l.userId,transport_delay:n},this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){m.stopRecvFrame(uB.AUDIO,dB.TIMEOUT),m._firstAudioFrameInterval&&window.clearInterval(m._firstAudioFrameInterval)}),this._timeout),gB.rtcFirstFrame(h),this._watchForFirstAudioFrameRecv(),this._audioFirstFrameState=1,this._login=!0,this._unMuteAudio=!0,this._enableAudio=!0,this._remoteUnmuteAudio=!0):t===uB.VIDEO&&(i||this._videoEventSessionId++,this._currentVideoRecv={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:r},_={media_type:null!==(f=this._stream)&&void 0!==f&&f.isScreen?uB.SCREEN_VIDEO:t,event_type:sB.BEGIN_RECV,type:r,start:null===(p=this._currentVideoRecv)||void 0===p?void 0:p.startTime,event_session_id:this._videoEventSessionId,stream_user_id:null===(v=this._stream)||void 0===v?void 0:v.userId,transport_delay:n},this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){m.stopRecvFrame(uB.VIDEO,dB.TIMEOUT),m._firstVideoFrameInterval&&window.clearInterval(m._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameRecv(),gB.rtcFirstFrame(_),this._videoFirstFrameState=1,this._login=!0,this._unMuteVideo=!0,this._enableVideo=!0,this._remoteUnmuteVideo=!0);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"stopRecvFrame",value:function(e,t){if(e===uB.AUDIO){var r,n,i;if(1!==this._audioFirstFrameState)return;var o={event_type:sB.RECV_END,media_type:e,start:null===(r=this._currentAudioRecv)||void 0===r?void 0:r.startTime,reason:t,result:!1,stream_user_id:null===(n=this._stream)||void 0===n?void 0:n.userId,event_session_id:this._audioEventSessionId,type:null===(i=this._currentAudioRecv)||void 0===i?void 0:i.type};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioRecv,gB.rtcFirstFrame(o),this._audioFirstFrameState=2}else if(e===uB.VIDEO){var a,s,u,c;if(1!==this._videoFirstFrameState)return;var d={event_type:sB.RECV_END,media_type:null!==(a=this._stream)&&void 0!==a&&a.isScreen?uB.SCREEN_VIDEO:e,start:null===(s=this._currentVideoRecv)||void 0===s?void 0:s.startTime,reason:t,result:!1,stream_user_id:null===(u=this._stream)||void 0===u?void 0:u.userId,event_session_id:this._videoEventSessionId,type:null===(c=this._currentVideoRecv)||void 0===c?void 0:c.type};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoRecv,gB.rtcFirstFrame(d),this._videoFirstFrameState=2}}},{key:"recvFrameFinish",value:(n=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l,h,f,p,v,_,m,y;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelay();case 2:if(r=this._transportDelay,n=cB.LOGIN,i=cB.UNMUTE,a=cB.SUBSCRIBE,s=cB.PUSH_TRACK,t!==uB.AUDIO){e.next=18;break}if(1===this._audioFirstFrameState){e.next=7;break}return e.abrupt("return");case 7:if(this._currentAudioRecv){e.next=9;break}return e.abrupt("return");case 9:c=this._currentAudioRecv,d=c.type,l=c.startTime,[n,i,a,s].indexOf(d)>=0&&(r=0),h={event_type:sB.RECV_END,media_type:t,start:l,result:!0,stream_user_id:null===(u=this._stream)||void 0===u?void 0:u.userId,event_session_id:this._audioEventSessionId,type:d,transport_delay:r},delete this._currentAudioRecv,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),gB.rtcFirstFrame(h),this._audioFirstFrameState=3,e.next=30;break;case 18:if(t!==uB.VIDEO){e.next=30;break}if(1===this._videoFirstFrameState){e.next=21;break}return e.abrupt("return");case 21:if(this._currentVideoRecv){e.next=23;break}return e.abrupt("return");case 23:v=this._currentVideoRecv,_=v.type,m=v.startTime,[n,i,a,s].indexOf(_)>=0&&(r=0),y={event_type:sB.RECV_END,media_type:null!==(f=this._stream)&&void 0!==f&&f.isScreen?uB.SCREEN_VIDEO:t,start:m,result:!0,stream_user_id:null===(p=this._stream)||void 0===p?void 0:p.userId,event_session_id:this._videoEventSessionId,type:_,transport_delay:r},delete this._currentVideoRecv,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),gB.rtcFirstFrame(y),this._videoFirstFrameState=3;case 30:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"setLogin",value:function(e){var t,r,n,i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{audio:!0,video:!0};this._login!==e&&(this._login=e,e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&o.audio&&this.beginRecvFrame(uB.AUDIO,cB.LOGIN),e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&o.video&&this.beginRecvFrame(uB.VIDEO,cB.LOGIN),!e&&null!==(n=this._stream)&&void 0!==n&&n.hasAudio&&this.stopRecvFrame(uB.AUDIO,dB.LEAVE_ROOM),!e&&null!==(i=this._stream)&&void 0!==i&&i.hasVideo&&this.stopRecvFrame(uB.VIDEO,dB.LEAVE_ROOM))}},{key:"setUnmuteAudio",value:function(e){var t;this._unMuteAudio!==e&&(this._unMuteAudio=e,this._unMuteAudio?this.beginRecvFrame(uB.AUDIO,cB.UNMUTE):null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame(uB.AUDIO,dB.MUTE))}},{key:"setRemoteUnmuteAudio",value:function(e){var t;this._remoteUnmuteAudio!==e&&(this._remoteUnmuteAudio=e,this._remoteUnmuteAudio?this.beginRecvFrame(uB.AUDIO,cB.REMOTE_UNMUTE):null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame(uB.AUDIO,dB.REMOTE_MUTE))}},{key:"setEnableAudio",value:function(e){var t;this._enableAudio!==e&&(this._enableAudio=e,this._enableAudio?this.beginRecvFrame(uB.AUDIO,cB.ENABLE):null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame(uB.AUDIO,dB.DISABLE))}},{key:"setUnmuteVideo",value:function(e){var t;this._unMuteVideo!==e&&(this._unMuteVideo=e,this._unMuteVideo?this.beginRecvFrame(uB.VIDEO,cB.UNMUTE):null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame(uB.VIDEO,dB.MUTE))}},{key:"setRemoteUnmuteVideo",value:function(e){var t;this._remoteUnmuteVideo!==e&&(this._remoteUnmuteVideo=e,this._remoteUnmuteVideo?this.beginRecvFrame(uB.VIDEO,cB.REMOTE_UNMUTE):null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame(uB.VIDEO,dB.REMOTE_MUTE))}},{key:"setEnableVideo",value:function(e){this._enableVideo!==e&&(this._enableVideo=e,this._enableVideo?this.beginRecvFrame(uB.VIDEO,cB.ENABLE):this.stopRecvFrame(uB.VIDEO,dB.DISABLE))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal=e}},{key:"setPushAudio",value:function(e){var t;this._audioExternal&&this._pushAudio!==e&&(this._pushAudio=e),this._pushAudio&&this.beginRecvFrame(uB.AUDIO,cB.PUSH),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.beginRecvFrame(uB.AUDIO,cB.PUSH)}},{key:"setExternalVideoSource",value:function(e){this._videoExternal=e}},{key:"setPushVideo",value:function(e){var t;this._videoExternal&&this._pushVideo!==e&&(this._pushVideo=e),this._pushVideo&&this.beginRecvFrame(uB.VIDEO,cB.PUSH),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.beginRecvFrame(uB.VIDEO,cB.PUSH)}},{key:"setPublishVideo",value:function(e){var t;this._publishVideo!==e&&(this._publishVideo=e),this._publishVideo&&this.beginRecvFrame(uB.VIDEO,cB.PUBLISH),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame(uB.VIDEO,dB.UNPUBLISH)}},{key:"setPublishAudio",value:function(e){var t;this._publishAudio!==e&&(this._publishAudio=e),this._publishAudio&&this.beginRecvFrame(uB.AUDIO,cB.PUBLISH),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame(uB.AUDIO,dB.UNPUBLISH)}},{key:"setAutoSubscribe",value:function(e){this._autoSubscribe=e}},{key:"setAutoSubscribeVideo",value:function(e){this._autoSubscribeVideo=e}},{key:"setAutoSubscribeAudio",value:function(e){this._autoSubscribeAudio=e}},{key:"setSubscribeAudio",value:function(e){var t,r;this._autoSubscribeAudio||this._subscribeAudio===e||(this._subscribe=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasAudio&&this.beginRecvFrame(uB.AUDIO,cB.SUBSCRIBE));!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame(uB.AUDIO,dB.UNSUBSCRIBE)}},{key:"setSubscribeVideo",value:function(e){var t,r;this._autoSubscribeVideo||this._subscribeVideo===e||(this._subscribeVideo=e,e&&null!==(r=this._stream)&&void 0!==r&&r.hasVideo&&this.beginRecvFrame(uB.VIDEO,cB.SUBSCRIBE));!e&&null!==(t=this._stream)&&void 0!==t&&t.hasVideo&&this.stopRecvFrame(uB.VIDEO,dB.UNSUBSCRIBE)}},{key:"setPushTrack",value:function(e){var t;this._pushTrack!==e&&(e&&!this._isScreen&&this.beginRecvFrame(uB.AUDIO,cB.PUSH_TRACK),!e&&null!==(t=this._stream)&&void 0!==t&&t.hasAudio&&this.stopRecvFrame(uB.AUDIO,dB.REMOVE_TRACK))}},{key:"setMultiChatMode",value:function(e){this._multiChatMode=e}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"_watchForFirstVideoFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval=window.setInterval(u(o().mark((function n(){var i,a,s,u,c,d,l,h;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(a=e._stream)||void 0===a||null===(s=a.videoTrack)||void 0===s||!s.getTrack()){n.next=12;break}return n.next=3,Aj(null===(u=e._handler)||void 0===u?void 0:u.pc,null===(c=e._stream)||void 0===c||null===(d=c.videoTrack)||void 0===d?void 0:d.getTrack());case 3:if(l=n.sent,!(h=l.find((function(e){return"inbound-rtp"===e.type})))||!(h.framesReceived>t||h.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=h.framesReceived,r=h.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish(uB.VIDEO),window.clearInterval(e._firstVideoFrameInterval);case 12:case"end":return n.stop()}}),n)}))),200)}},{key:"_watchForFirstAudioFrameRecv",value:function(){var e=this,t=-1,r=-1;this._firstAudioFrameInterval=window.setInterval(u(o().mark((function n(){var i,a,s,u,c,d,l,h;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null===(i=e._handler)||void 0===i||!i.pc||null===(a=e._stream)||void 0===a||null===(s=a.audioTrack)||void 0===s||!s.getTrack()){n.next=12;break}return n.next=3,Aj(null===(u=e._handler)||void 0===u?void 0:u.pc,null===(c=e._stream)||void 0===c||null===(d=c.audioTrack)||void 0===d?void 0:d.getTrack());case 3:if(l=n.sent,!(h=l.find((function(e){return"inbound-rtp"===e.type})))||!(h.totalSamplesReceived>t||h.packetsReceived>r)){n.next=12;break}if(-1!==t||-1!==r){n.next=10;break}return t=h.totalSamplesReceived,r=h.packetsReceived,n.abrupt("return");case 10:e.recvFrameFinish(uB.AUDIO),window.clearInterval(e._firstAudioFrameInterval);case 12:case"end":return n.stop()}}),n)}))),200)}},{key:"getTransportDelay",value:(r=u(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getTransportDelayIntl();case 2:window.clearInterval(this._transportDelayInterval),this._transportDelayInterval=window.setInterval(u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getTransportDelayIntl();case 2:case"end":return e.stop()}}),e)}))),2e3);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"getTransportDelayIntl",value:(t=u(o().mark((function e(){var t,r,n,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc){e.next=7;break}return e.next=3,Aj(null===(r=this._handler)||void 0===r?void 0:r.pc);case 3:n=e.sent,i=n.find((function(e){return"transport"===e.type&&"connected"===e.dtlsState})),(a=n.find((function(e){return"candidate-pair"===e.type&&"succeeded"===e.state&&e.id===(null==i?void 0:i.selectedCandidatePairId)})))&&(this._transportDelay=Math.round(1e3*a.currentRoundTripTime/2));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"reset",value:function(){this._currentAudioRecv={startTime:0,eventSessionId:0,type:cB.LOGIN},this._currentVideoRecv={startTime:0,eventSessionId:0,type:cB.LOGIN},this._login=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._remoteUnmuteAudio=!1,this._remoteUnmuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoSubscribeVideo=!1,this._autoSubscribeAudio=!1,this._autoSubscribe=!1,this._subscribeAudio=!1,this._subscribeVideo=!1,this._subscribe=!1,this._pushTrack=!1,this._multiChatMode=!1,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstAudioFrameInterval&&window.clearInterval(this._firstAudioFrameInterval),this._firstVideoFrameInterval&&window.clearInterval(this._firstVideoFrameInterval),this._transportDelayInterval&&window.clearInterval(this._transportDelayInterval)}}]),e}(),tW=function(){function e(t,r){c(this,e),h(this,"_audioEventSessionId",bP()),h(this,"_videoEventSessionId",bP()),h(this,"_pcSessionId",void 0),h(this,"_handler",void 0),h(this,"_firstAudioFrameTimer",void 0),h(this,"_firstVideoFrameTimer",void 0),h(this,"_stream",void 0),h(this,"_firstVideoFrameInterval",void 0),h(this,"_firstAudioFrameInterval",void 0),h(this,"_currentAudioSend",{startTime:0,eventSessionId:0,type:cB.LOGIN}),h(this,"_currentVideoSend",{startTime:0,eventSessionId:0,type:cB.LOGIN}),h(this,"_login",!1),h(this,"_publisher",!1),h(this,"_unMuteAudio",!1),h(this,"_enableAudio",!1),h(this,"_unMuteVideo",!1),h(this,"_enableVideo",!1),h(this,"_audioExternal",!1),h(this,"_pushAudio",!1),h(this,"_videoExternal",!1),h(this,"_pushVideo",!1),h(this,"_autoPublish",!1),h(this,"_publish",!1),h(this,"_timeout",1e4),h(this,"_audioFirstFrameState",0),h(this,"_videoFirstFrameState",0),this._stream=t,this._handler=r}var t,r;return l(e,[{key:"beginSendFrame",value:function(e,t){var r=this;if(e===uB.AUDIO){var n;this._audioEventSessionId++,this._currentAudioSend={startTime:Date.now(),eventSessionId:this._audioEventSessionId,type:t};var i={media_type:e,event_type:sB.BEGIN_SEND,type:t,start:null===(n=this._currentAudioSend)||void 0===n?void 0:n.startTime,event_session_id:this._audioEventSessionId};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),this._firstAudioFrameTimer=window.setTimeout((function(){r.stopSendFrame(uB.AUDIO,dB.TIMEOUT),r._firstAudioFrameInterval&&window.clearInterval(r._firstAudioFrameInterval)}),this._timeout),gB.rtcFirstFrame(i),this._watchForFirstAudioFrameSend(),this._audioFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteAudio=!0,this._pushAudio||(this._enableAudio=!0)}else if(e===uB.VIDEO){var o,a;this._videoEventSessionId++,this._currentVideoSend={startTime:Date.now(),eventSessionId:this._videoEventSessionId,type:t};var s={media_type:null!==(o=this._stream)&&void 0!==o&&o.isScreen?uB.SCREEN_VIDEO:e,event_type:sB.BEGIN_SEND,type:t,start:null===(a=this._currentVideoSend)||void 0===a?void 0:a.startTime,event_session_id:this._videoEventSessionId};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),this._firstVideoFrameTimer=window.setTimeout((function(){r.stopSendFrame(uB.VIDEO,dB.TIMEOUT),r._firstVideoFrameInterval&&window.clearInterval(r._firstVideoFrameInterval)}),this._timeout),this._watchForFirstVideoFrameSend(),gB.rtcFirstFrame(s),this._videoFirstFrameState=1,this._login=!0,this._publisher=!0,this._publish=!0,this._unMuteVideo=!0,this._pushVideo||(this._enableVideo=!0)}}},{key:"stopSendFrame",value:function(e,t){if(e===uB.AUDIO){var r,n;if(1!==this._audioFirstFrameState)return;var i={event_type:sB.SENT_END,media_type:e,start:null===(r=this._currentAudioSend)||void 0===r?void 0:r.startTime,reason:t,result:!1,event_session_id:this._audioEventSessionId,type:null===(n=this._currentAudioSend)||void 0===n?void 0:n.type};this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),delete this._currentAudioSend,gB.rtcFirstFrame(i),this._audioFirstFrameState=2}else if(e===uB.VIDEO){var o,a,s;if(1!==this._videoFirstFrameState)return;var u={event_type:sB.SENT_END,media_type:null!==(o=this._stream)&&void 0!==o&&o.isScreen?uB.SCREEN_VIDEO:e,start:null===(a=this._currentVideoSend)||void 0===a?void 0:a.startTime,reason:t,result:!1,event_session_id:this._videoEventSessionId,type:null===(s=this._currentVideoSend)||void 0===s?void 0:s.type};this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),delete this._currentVideoSend,gB.rtcFirstFrame(u),this._videoFirstFrameState=2}}},{key:"sendFrameFinish",value:function(e){if(e===uB.AUDIO){if(1!==this._audioFirstFrameState)return;if(!this._currentAudioSend)return;var t=this._currentAudioSend,r=t.type,n=t.startTime,i={event_type:sB.SENT_END,media_type:e,start:n,result:!0,event_session_id:this._audioEventSessionId,type:r};delete this._currentAudioSend,this._firstAudioFrameTimer&&window.clearTimeout(this._firstAudioFrameTimer),gB.rtcFirstFrame(i),this._audioFirstFrameState=3}else if(e===uB.VIDEO){var o;if(1!==this._videoFirstFrameState)return;if(!this._currentVideoSend)return;var a=this._currentVideoSend,s=a.type,u=a.startTime,c={event_type:sB.SENT_END,media_type:null!==(o=this._stream)&&void 0!==o&&o.isScreen?uB.SCREEN_VIDEO:e,start:u,result:!0,event_session_id:this._videoEventSessionId,type:s};delete this._currentVideoSend,this._firstVideoFrameTimer&&window.clearTimeout(this._firstVideoFrameTimer),gB.rtcFirstFrame(c),this._videoFirstFrameState=3}}},{key:"setLogin",value:function(e){if(this._login!==e){var t,r;if(this._login=e,e)null!==(t=this._stream)&&void 0!==t&&t.videoTrack&&this.beginSendFrame(uB.VIDEO,cB.LOGIN),null!==(r=this._stream)&&void 0!==r&&r.audioTrack&&this.beginSendFrame(uB.AUDIO,cB.LOGIN);!e&&this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.LEAVE_ROOM),!e&&this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.LEAVE_ROOM)}}},{key:"setPublish",value:function(e){if(this._publish!==e){var t,r;if(this._publish=e,e)(null===(t=this._stream)||void 0===t?void 0:t.videoTrack)&&this.beginSendFrame(uB.VIDEO,cB.PUBLISH),(null===(r=this._stream)||void 0===r?void 0:r.audioTrack)&&this.beginSendFrame(uB.AUDIO,cB.PUBLISH);!e&&this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.UNPUBLISH),!e&&this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.UNPUBLISH)}}},{key:"setUnmuteAudio",value:function(e){this._unMuteAudio!==e&&(this._unMuteAudio=e,e&&this.beginSendFrame(uB.AUDIO,cB.UNMUTE),!e&&this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.MUTE))}},{key:"setEnableAudio",value:function(e){this._enableAudio!==e&&(this._enableAudio=e,e&&this.beginSendFrame(uB.AUDIO,cB.ENABLE),!e&&this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.DISABLE))}},{key:"setUnmuteVideo",value:function(e){this._unMuteVideo!==e&&(this._unMuteVideo=e,e&&this.beginSendFrame(uB.VIDEO,cB.UNMUTE),!e&&this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.MUTE))}},{key:"setEnableVideo",value:function(e){this._enableVideo!==e&&(this._enableVideo=e,e&&this.beginSendFrame(uB.VIDEO,cB.ENABLE),!e&&this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.DISABLE))}},{key:"setExternalAudioSource",value:function(e){this._audioExternal!==e&&(this._audioExternal=e,e&&(this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.DISABLE),this._enableAudio=!1),e||(this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.STOP_PUSH),this._pushAudio=!1))}},{key:"setPushAudio",value:function(e){this._pushAudio!==e&&(this._pushAudio=e,e&&this.beginSendFrame(uB.AUDIO,cB.PUSH),!e&&this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.STOP_PUSH))}},{key:"setExternalVideoSource",value:function(e){this._videoExternal!==e&&(this._videoExternal=e,e&&(this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.DISABLE),this._enableVideo=!1),e||(this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.STOP_PUSH),this._pushVideo=!1))}},{key:"setPushVideo",value:function(e){this._pushVideo!==e&&(this._pushVideo=e,e&&this.beginSendFrame(uB.VIDEO,cB.PUSH),!e&&this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.STOP_PUSH))}},{key:"setAutoPublish",value:function(e){this._autoPublish=e}},{key:"setPublisher",value:function(e){this._publisher!==e&&(this._publisher=e,!e&&this._audioSending&&this.stopSendFrame(uB.AUDIO,dB.AUDIENCE),!e&&this._videoSending&&this.stopSendFrame(uB.VIDEO,dB.AUDIENCE))}},{key:"setTimeout",value:function(e){this._timeout=e}},{key:"setPCSessionId",value:function(e){this._pcSessionId=e}},{key:"setHandler",value:function(e){this._handler=e}},{key:"_getFirstVideoFrameStats",value:(r=u(o().mark((function e(){var t,r,n,i,a,s,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.videoTrack)||void 0===n||!n.getTrack("preprocessing")){e.next=6;break}return e.next=3,Aj(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(a=this._stream)||void 0===a||null===(s=a.videoTrack)||void 0===s?void 0:s.getTrack("preprocessing"));case 3:return u=e.sent,c=u.find((function(e){return"outbound-rtp"===e.type})),e.abrupt("return",c);case 6:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"_getFirstAudioFrameStats",value:(t=u(o().mark((function e(){var t,r,n,i,a,s,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(t=this._handler)||void 0===t||!t.pc||null===(r=this._stream)||void 0===r||null===(n=r.audioTrack)||void 0===n||!n.getTrack("preprocessing")){e.next=6;break}return e.next=3,Aj(null===(i=this._handler)||void 0===i?void 0:i.pc,null===(a=this._stream)||void 0===a||null===(s=a.audioTrack)||void 0===s?void 0:s.getTrack("preprocessing"));case 3:return u=e.sent,c=u.find((function(e){return"outbound-rtp"===e.type})),e.abrupt("return",c);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_watchForFirstVideoFrameSend",value:function(){var e=this,t=-1,r=-1;this._firstVideoFrameInterval=window.setInterval(u(o().mark((function n(){var i;return o().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e._getFirstVideoFrameStats();case 2:if(!(i=n.sent)||!(i.framesSent>t||i.packetsSent>r)){n.next=10;break}if(-1!==t||-1!==r){n.next=8;break}return t=i.framesSent,r=i.packetsSent,n.abrupt("return");case 8:e.sendFrameFinish(uB.VIDEO),window.clearInterval(e._firstVideoFrameInterval);case 10:case"end":return n.stop()}}),n)}))),100)}},{key:"_watchForFirstAudioFrameSend",value:function(){var e=this,t=-1;this._firstAudioFrameInterval=window.setInterval(u(o().mark((function r(){var n;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e._getFirstAudioFrameStats();case 2:if(!((n=r.sent)&&n.packetsSent>t)){r.next=9;break}if(-1!==t){r.next=7;break}return t=n.packetsSent,r.abrupt("return");case 7:e.sendFrameFinish(uB.AUDIO),window.clearInterval(e._firstAudioFrameInterval);case 9:case"end":return r.stop()}}),r)}))),100)}},{key:"reset",value:function(){this._login=!1,this._publisher=!1,this._unMuteAudio=!1,this._enableAudio=!1,this._unMuteVideo=!1,this._enableVideo=!1,this._audioExternal=!1,this._pushAudio=!1,this._videoExternal=!1,this._pushVideo=!1,this._autoPublish=!1,this._publish=!1,this._audioFirstFrameState=0,this._videoFirstFrameState=0,this._currentAudioSend={startTime:0,eventSessionId:0,type:cB.LOGIN},this._currentVideoSend={startTime:0,eventSessionId:0,type:cB.LOGIN},window.clearTimeout(this._firstAudioFrameTimer),window.clearTimeout(this._firstVideoFrameTimer),window.clearInterval(this._firstAudioFrameInterval),window.clearInterval(this._firstVideoFrameInterval)}},{key:"destroy",value:function(){this.reset(),delete this._stream,delete this._handler}},{key:"_audioSending",get:function(){return 1===this._audioFirstFrameState}},{key:"_videoSending",get:function(){return 1===this._videoFirstFrameState}}]),e}(),rW=(h(ZK={},"audio",{delay:1200,stallRadio:.3}),h(ZK,"video",{delay:1200,stallRadio:.6}),h(ZK,"screen_audio",{delay:1600,stallRadio:.8}),h(ZK,"screen_video",{delay:1600,stallRadio:.8}),ZK),nW=function(){function e(){c(this,e),h(this,"_preUplinkStats",new Map),h(this,"_preDownlinkStats",new Map),h(this,"_timer",void 0),h(this,"_delayTimer",void 0),h(this,"_connectionState",Wz.CONNECTED),h(this,"reportor",void 0)}return l(e,[{key:"updateUplinkStats",value:function(e){var t=e.audioStats,r=e.videoStats,n=e.isScreen;if(t.sendKBitrate>0&&t.rtt){var i=n?"screen_audio":"audio",o=t.rtt,a=t._fractionLost,s=t._retransmittedRate,u=this._getQosLevel(o,a||0,s||0),c=this._preUplinkStats.get(i)||[u];this._preUplinkStats.set(i,[].concat(k(c),[u]).slice(-2))}if(r.sentKBitrate>0&&r.rtt){var d=n?"screen_video":"video",l=r._fractionLost,h=r.rtt,f=r._sendBandWidth,p=r._retransmittedRate;0===f&&(l=Math.max(.65,l));var v=this._getQosLevel(h,l||0,p||0),_=this._preUplinkStats.get(d)||[v];this._preUplinkStats.set(d,[].concat(k(_),[v]).slice(-2))}this._startNetworkQualityReport()}},{key:"updateDownlinkStats",value:function(e,t){if(t){var r,n,i=this._getStreamActiveState(t),o=i.audioActive,a=i.videoActive,s=e.audioStats,u=e.videoStats,c=e.isScreen,d=e.userId;if(o)if(0===s.receivedKBitrate)r=W.VBAD;else{var l=s.rtt,h=s.audioLossRate,f=s.stallDuration,p=s.statsInterval,v=s.e2eDelay,_=f/p,m=c?"screen_audio":"audio",y=this._getQosLevel(l,h||0,u._retransmittedRate||0),g=this._getDownlinkQoE(m,_,v);r=this._getNetworkQuality(y,g)}if(a)if(0===u.receivedKBitrate||0===u.rtt)n=W.VBAD;else{var S=u.rtt,b=u.videoLossRate,E=u.stallDuration,T=u.statsInterval,I=u.e2eDelay,R=u._retransmittedRate,A=E/T,w=c?"screen_video":"video",C=this._getQosLevel(S,b||0,R||0),O=this._getDownlinkQoE(w,A,I);n=this._getNetworkQuality(C,O)}var x=r&&n?Math.ceil((r+n)/2):r||n;if(x){var N="".concat(d).concat(c?"_screen":""),D=this._preDownlinkStats.get(N)||[x];this._preDownlinkStats.set(N,[].concat(k(D),[x]).slice(-2)),this._startNetworkQualityReport()}}}},{key:"setConnectionState",value:function(e){this._connectionState=e}},{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._delayTimer&&(window.clearTimeout(this._delayTimer),delete this._delayTimer),this._preUplinkStats.clear(),this._preDownlinkStats.clear()}},{key:"_startNetworkQualityReport",value:function(){var e=this;this._delayTimer||this._timer||(this._preUplinkStats.size>0||this._preDownlinkStats.size>0)&&(this._delayTimer=window.setTimeout((function(){delete e._delayTimer,e._reportNetworkQuality(),e._timer=window.setInterval((function(){e._reportNetworkQuality()}),2e3)}),300))}},{key:"_reportNetworkQuality",value:function(){var e,t,r=this;if(this._connectionState!==Wz.CONNECTED)e=t=W.VBAD;else{var n=this._getBetterQualityAndRemoveOldest("audio","up"),i=this._getBetterQualityAndRemoveOldest("video","up");e=n&&i?Math.ceil((n+i)/2):n||i||this._getBetterQualityAndRemoveOldest("screen_video","up")||this._getBetterQualityAndRemoveOldest("screen_audio","up")||W.UNKNOWN;var o=Array.from(this._preDownlinkStats.keys()).map((function(e){return r._getBetterQualityAndRemoveOldest(e,"down")})).filter((function(e){return e}));t=Math.ceil(o.reduce((function(e,t){return t+e}),0)/o.length)||W.UNKNOWN}"function"==typeof this.reportor&&this.reportor(e,t)}},{key:"_getNetworkQuality",value:function(e,t){return 1===t?Math.max(e-2,1):2===t?e:Math.min(e+1,5)}},{key:"_getQosLevel",value:function(e,t,r){var n;return n=(!e||e<=250)&&t<=.15?1:(!e||e<=500)&&t<=.3?2:(!e||e<=750)&&t<=.45?3:(!e||e<=1e3)&&t<=.6?4:5,r>.5?n=Math.max(n,4):r>.35?n=Math.max(n,3):r>.15&&(n=Math.max(n,2)),n}},{key:"_getUplinkQoE",value:function(e,t){var r=0;switch(e){case"audio":case"video":r=t<.05?1:t<.1?2:3;break;case"screen_video":case"screen_audio":r=t<.04?1:t<.08?2:3}return r}},{key:"_getDownlinkQoE",value:function(e,t,r){var n=rW[e];return t>n.stallRadio||r>n.delay||t>n.stallRadio/2&&r>n.delay/2?3:(t>n.stallRadio/2||n.delay,2)}},{key:"_getBetterQualityAndRemoveOldest",value:function(e,t){var r=W.UNKNOWN,n="up"===t?this._preUplinkStats:this._preDownlinkStats,i=n.get(e);if(i){var o=i.filter((function(e){return e}));o.length>0&&(r=Math.min.apply(Math,k(o))),i.shift(),0===i.length&&n.delete(e)}return r}},{key:"_getStreamActiveState",value:function(e){var t=e.subMediaType,r=e._attributes,n=e.subVideo;return{audioActive:e.subAudio&&AP(t)&&r.localaudio&&r.audiostream,videoActive:n&&wP(t)&&r.localvideo&&r.videostream}}}]),e}(),iW=function(){function e(t){c(this,e),h(this,"_timer",void 0),h(this,"_remoteVideoSizeCache",{}),h(this,"_remoteScreenSizeCache",{}),h(this,"onchange",void 0),this._room=t,this._start()}return l(e,[{key:"destroy",value:function(){this._timer&&(window.clearInterval(this._timer),delete this._timer),this._remoteVideoSizeCache={},this._remoteScreenSizeCache={}}},{key:"_start",value:function(){var e=this;this._timer||(this._timer=window.setInterval((function(){var t={},r={};e._room.remoteStreams.forEach((function(n,i){n.forEach((function(n){var o,a=null===(o=n.videoTrack)||void 0===o?void 0:o.getTrack();if(a){var s=n.isScreen?e._remoteScreenSizeCache:e._remoteVideoSizeCache,u=s[i]||{},c=u.width,d=void 0===c?0:c,l=u.height,h=void 0===l?0:l,f=a.getSettings(),p=f.width,v=void 0===p?0:p,_=f.height,m=void 0===_?0:_;h===m&&d===v||"function"==typeof e.onchange&&e.onchange(i,n.isScreen,v,m),delete s[i],(n.isScreen?r:t)[i]={width:v,height:m}}}))})),Object.keys(e._remoteVideoSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!1,0,0)})),Object.keys(e._remoteScreenSizeCache).forEach((function(t){"function"==typeof e.onchange&&e.onchange(t,!0,0,0)})),e._remoteVideoSizeCache=t,e._remoteScreenSizeCache=r}),1e3))}}]),e}(),oW=new ML("SubscribeFallbackManager",2),aW=1e4,sW=function(){function e(t){c(this,e),h(this,"_preDownlinkNetworkQuality",[]),h(this,"_isSubscribeFallbackOrRecover",!1),h(this,"_inSubscribeRecoverChecking",!1),h(this,"_subRecoverCheckTimer",void 0),h(this,"_forbidSubRecover",!1),h(this,"_forbidSubRecoverTimer",void 0),h(this,"_forbidSubRecoverDuration",aW),h(this,"onSubscribeFallback",void 0),this._room=t}var t;return l(e,[{key:"updateNetworkQuality",value:function(e,t){this._preDownlinkNetworkQuality.push(t),this._preDownlinkNetworkQuality=this._preDownlinkNetworkQuality.slice(-10),this._inSubscribeRecoverChecking&&this._preDownlinkNetworkQuality.find((function(e){return e===W.BAD||e===W.VBAD}))&&this._startForbidSubRecover(),this._preDownlinkNetworkQuality.slice(-3).reduce((function(e,t){return e+t}),0)>3*W.POOR&&this._subscribeFallbackOrRecover("fallback"),!this._forbidSubRecover&&10===this._preDownlinkNetworkQuality.length&&this._preDownlinkNetworkQuality.every((function(e){return e===W.EXCELLENT}))&&this._subscribeFallbackOrRecover("recover")}},{key:"destroy",value:function(){this._stopSubscribeRecoverCheck(),this._stopForbidSubRecover(),delete this.onSubscribeFallback}},{key:"_subscribeFallbackOrRecover",value:(t=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l,h,f=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isSubscribeFallbackOrRecover&&this._room.connectionState===Wz.CONNECTED){e.next=2;break}return e.abrupt("return");case 2:if(this._room.subscribeFallbackOption!==X.AUDIO_ONLY&&this._room.subscribeFallbackOption!==X.VIDEO_STREAM_LOW){e.next=24;break}if(r=new Map,this._room.remoteStreams.forEach((function(e){e.forEach((function(e){if(e.hasSubscribed){var n="fallback"===t?e.getSubscribeFallbackParams(f._room.subscribeFallbackOption):e.getSubscribeRecoverParams();if(n){var i=e.getStreamPriority(),o=r.get(i)||[];o.push({stream:e,fallbackOrRecoverOption:n}),r.set(i,o)}}}))})),!(r.size>0)){e.next=24;break}if(oW.print("_subscribeFallbackOrRecover()","start subscribe ".concat(t,".")),n=Array.from(r.keys()).sort((function(e,t){return e-t}))["fallback"===t?0:r.size-1],i=r.get(n)||[],a=E(i,1),!(s=a[0])){e.next=24;break}return u=s.stream,c=s.fallbackOrRecoverOption,this._isSubscribeFallbackOrRecover=!0,d=u.subLayer.spatialLayer,l=u.subVideo,oW.print("_subscribeFallbackOrRecover()","".concat(u.userId,"'s stream will be ").concat(t," to: MediaType=").concat(c[0]," subState=").concat(c[1]," subLayer=").concat(c[2])),e.prev=15,e.next=18,IP([(h=this._room).updateSubTrack.apply(h,[u].concat(k(c))).then((function(){"recover"===t?f._startSubscribeRecoverCheck():oW.print("_subscribeFallbackOrRecover()","fallback success."),"function"==typeof f.onSubscribeFallback&&f.onSubscribeFallback({userId:u.userId,isScreen:u.isScreen,beforeEnable:l,beforeVideoIndex:d,afterEnable:u.subVideo,afterVideoIndex:u.subLayer.spatialLayer,reason:"fallback"===t?Y.SubscribeFallbackByBandwidth:Y.SubscribeRecoverByBandwidth})})),vP(2e3)]);case 18:e.next=22;break;case 20:e.prev=20,e.t0=e.catch(15);case 22:this._preDownlinkNetworkQuality=[],this._isSubscribeFallbackOrRecover=!1;case 24:case"end":return e.stop()}}),e,this,[[15,20]])}))),function(e){return t.apply(this,arguments)})},{key:"_startSubscribeRecoverCheck",value:function(){var e=this;this._stopSubscribeRecoverCheck(),this._inSubscribeRecoverChecking=!0,this._subRecoverCheckTimer=window.setTimeout((function(){e._inSubscribeRecoverChecking=!1,e._forbidSubRecoverDuration=aW,delete e._subRecoverCheckTimer,oW.print("_subscribeFallbackOrRecover()","recover success.")}),2e4)}},{key:"_stopSubscribeRecoverCheck",value:function(){this._subRecoverCheckTimer&&(window.clearTimeout(this._subRecoverCheckTimer),delete this._subRecoverCheckTimer),this._inSubscribeRecoverChecking=!1}},{key:"_startForbidSubRecover",value:function(){var e=this;this._stopSubscribeRecoverCheck(),this._stopForbidSubRecover(),this._forbidSubRecoverDuration=Math.min(this._forbidSubRecoverDuration+2e4,12e4),oW.print("_subscribeFallbackOrRecover()","subscribe-recover failed, and subscribe-recover not allowed within ".concat(this._forbidSubRecoverDuration/1e3,"s")),this._forbidSubRecover=!0,this._forbidSubRecoverTimer=window.setTimeout((function(){e._forbidSubRecover=!1,delete e._forbidSubRecoverTimer}),this._forbidSubRecoverDuration)}},{key:"_stopForbidSubRecover",value:function(){this._forbidSubRecoverTimer&&(window.clearTimeout(this._forbidSubRecoverTimer),delete this._forbidSubRecoverTimer)}}]),e}(),uW=new ML("Room",1),cW=function(e){f(M,e);var t,r,n,a,s,d,p,v,_,y,S,b,k,T,I,A,w,C,x,N,D=g(M);function M(e,t){var r;return c(this,M),h(m(r=D.call(this)),"_mediaServerClient",void 0),h(m(r),"_localStream",void 0),h(m(r),"_localScreenStream",void 0),h(m(r),"_remoteUsers",new Map),h(m(r),"_remoteStreams",new Map),h(m(r),"_joinResolveCallback",void 0),h(m(r),"_joinRejectCallback",void 0),h(m(r),"_getAccessNode",void 0),h(m(r),"_getAccessFeedback",void 0),h(m(r),"_getAccessFeedbackIceNode",void 0),h(m(r),"_reconnectTimer",void 0),h(m(r),"_isReconnecting",void 0),h(m(r),"_context",void 0),h(m(r),"_sessionId",void 0),h(m(r),"_reconnectRecord",void 0),h(m(r),"_connectionLostTimer",void 0),h(m(r),"_liveControlMessage",void 0),h(m(r),"_serverConfig",void 0),h(m(r),"_roomConfig",void 0),h(m(r),"_roomInfo",void 0),h(m(r),"_waitForNewToken",!1),h(m(r),"_userDuplicateLoginTimerMap",new Map),h(m(r),"_networkQualityManager",void 0),h(m(r),"userPriorityMap",void 0),h(m(r),"subscribeFallbackOption",void 0),h(m(r),"_videoSizeObserver",void 0),h(m(r),"_subFallbackManager",void 0),h(m(r),"_hasPublished",!1),r._roomConfig=e,r._mediaServerClient=new Jz(t),r._reconnectRecord=new dW,r._addHandlerEventHandler(),r._isReconnecting=!1,r._networkQualityManager=new nW,r._networkQualityManager.reportor=r._reportNetworkQuality.bind(m(r)),r._videoSizeObserver=new iW(m(r)),r._videoSizeObserver.onchange=r._emitVideoSizeChange.bind(m(r)),r._subFallbackManager=new sW(m(r)),r._subFallbackManager.onSubscribeFallback=r._emitSubscribeFallback.bind(m(r)),r._context=t,r}return l(M,[{key:"hasScreenPublished",get:function(){var e;return null===(e=this._localScreenStream)||void 0===e?void 0:e.hasPublished}},{key:"hasPublished",get:function(){var e;return null===(e=this._localStream)||void 0===e?void 0:e.hasPublished}},{key:"connectionState",get:function(){return this._mediaServerClient.connectionState}},{key:"remoteUsers",get:function(){return this._remoteUsers}},{key:"remoteStreams",get:function(){return this._remoteStreams}},{key:"localStream",get:function(){return this._localStream}},{key:"localScreenStream",get:function(){return this._localScreenStream}},{key:"roomInfo",get:function(){return this._roomInfo}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E,k,T,I=this;null===(e=this._mediaServerClient)||void 0===e||e.on($B.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._mediaServerClient)||void 0===t||t.on($B.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(r=this._mediaServerClient)||void 0===r||r.on($B.USER_CONNECTION,this._onUserConnection.bind(this)),null===(n=this._mediaServerClient)||void 0===n||n.on($B.USER_DISCONNECTION,this._onUserDisconnection.bind(this)),null===(i=this._mediaServerClient)||void 0===i||i.on($B.ON_UPDATE_ROOM_ATTRIBUTES,this._onUpdateRoomAttributes.bind(this)),null===(o=this._mediaServerClient)||void 0===o||o.on($B.ON_UPDATE_USER_ATTRIBUTES,this._onUpdateUserAttributes.bind(this)),null===(a=this._mediaServerClient)||void 0===a||a.on($B.ON_UPDATE_STREAM_ATTRIBUTES,this._onUpdateStreamAttributes.bind(this)),null===(s=this._mediaServerClient)||void 0===s||s.on($B.ON_PUSH_TRACK,this._onPushTrack.bind(this)),null===(u=this._mediaServerClient)||void 0===u||u.on($B.ON_REMOVE_TRACK,this._onRemoveTrack.bind(this)),null===(c=this._mediaServerClient)||void 0===c||c.on($B.NODE_CHANGE,this._nodeChange.bind(this)),null===(d=this._mediaServerClient)||void 0===d||d.on($B.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(l=this._mediaServerClient)||void 0===l||l.on($B.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(h=this._mediaServerClient)||void 0===h||h.on($B.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(f=this._mediaServerClient)||void 0===f||f.on($B.POST_PROCESSING_MESSAGE,this._onPostProcessingMessage.bind(this)),null===(p=this._mediaServerClient)||void 0===p||p.on($B.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(v=this._mediaServerClient)||void 0===v||v.on($B.STREAM_CONTROL_MESSAGE,this._onStreamControlMessage.bind(this)),null===(_=this._mediaServerClient)||void 0===_||_.on($B.ON_SCENE_CONFIG,this._onSceneConfig.bind(this)),null===(m=this._mediaServerClient)||void 0===m||m.on(ej.RSCP,this._onPublishOnDemand.bind(this)),null===(y=this._mediaServerClient)||void 0===y||y.on(ej.RTT,this._onRTT.bind(this)),null===(g=this._mediaServerClient)||void 0===g||g.on(tj.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(S=this._mediaServerClient)||void 0===S||S.on(tj.ABNORMAL_DISCONNECTION,this._handleAbnormalDisconnection.bind(this)),null===(b=this._mediaServerClient)||void 0===b||b.on("onRemoteStreamStats",(function(e){I._networkQualityManager.updateDownlinkStats(e,I._findRemoteStreamByScreen(e.userId,e.isScreen)),I.emit(gz.ON_REMOTE_STREAM_STATS,CP(e))})),null===(E=this._mediaServerClient)||void 0===E||E.on("onLocalStreamStats",(function(e){I._networkQualityManager.updateUplinkStats(e),I.emit(gz.ON_LOCAL_STREAM_STATS,CP(e))})),null===(k=this._mediaServerClient)||void 0===k||k.on("prevIceNode",(function(e){I._getAccessFeedbackIceNode=e})),null===(T=this._mediaServerClient)||void 0===T||T.on("prevIceNode",(function(e){I._getAccessFeedbackIceNode=e}))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._mediaServerClient)||void 0===e||e.removeAllListeners()}},{key:"join",value:(N=u(o().mark((function e(t,r,n,i,a,s,u){var c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return EB.setStats({rtc_app_id:t,room_id:r,user_id:i.userId}),$K.setStats({rtc_session_id:t,rtc_room_id:r}),uW.print("join()"),e.abrupt("return",new Promise((function(e,o){var d,l,h=lP();c._joinResolveCallback=function(t){var r;gB.joinRoom(hB.END,h,!0,"",{enable_cloud_proxy:null===(r=c._roomInfo)||void 0===r?void 0:r.useCloudProxy}),e(t)},c._joinRejectCallback=function(e){var t;gB.joinRoom(hB.END,h,!1,e.message,{enable_cloud_proxy:null===(t=c._roomInfo)||void 0===t?void 0:t.useCloudProxy}),o(e)},c._liveControlMessage=a,c._roomInfo={appId:t,roomId:r,token:n,userInfo:i,useCloudProxy:s,roomProfile:c._roomConfig.roomProfileType,expectedIDC:u},c.setSessionId(),gB.joinRoom(hB.BEGIN,h,!1,"",{enable_cloud_proxy:null===(d=c._roomInfo)||void 0===d?void 0:d.useCloudProxy,expectedIDC:null===(l=c._roomInfo)||void 0===l?void 0:l.expectedIDC}),c._join(c._joinResolveCallback,c._joinRejectCallback,!1)})));case 4:case"end":return e.stop()}}),e)}))),function(e,t,r,n,i,o,a){return N.apply(this,arguments)})},{key:"_join",value:(x=u(o().mark((function e(t,r){var n,i,a,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]&&s[2],i=lP(),uW.print("_join()"),e.prev=3,e.next=6,this._mediaServerClient.join(this._roomInfo,{node:this._getAccessNode,reason:this._getAccessFeedback,sessionId:this._sessionId,feedbackNode:this._getAccessFeedbackIceNode},n,this._liveControlMessage);case 6:a=e.sent,this._mediaServerClient.roomAttributes=a.roomAttributes,this._reconnectRecord.clear(),this._joinResolveCallback=void 0,this._joinRejectCallback=void 0,this._getAccessFeedback=void 0,this._getAccessNode=void 0,"function"==typeof t&&t({users:a.clients,streams:a.streams}),this._isReconnecting=!1,gB.rtcJoinRoom(0,"web","web",lP()-i),this._onJoinSucc(a,n),e.next=23;break;case 19:if(e.prev=19,e.t0=e.catch(3),e.t0.code===JN.OPERATION_CANCEL||"function"!=typeof r){e.next=23;break}return e.abrupt("return",r(e.t0));case 23:case"end":return e.stop()}}),e,this,[[3,19]])}))),function(e,t){return x.apply(this,arguments)})},{key:"publishScreen",value:(C=u(o().mark((function e(t,r,n,i,a){var s,u,c,d,l,h,f,p,v,_;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uW.print("publishScreen()"),this._localScreenStream||(this._localScreenStream=new Iz,this._localScreenStream.isScreen=!0,this._mediaServerClient.handler&&(this._localScreenStream.observer=new tW(this._localScreenStream,this._mediaServerClient.handler))),s=!1,u=!1,c=!1,d=!1,!this._localScreenStream.videoTrack&&r?(r instanceof NH&&(u=!0),s=!0):this._localScreenStream.videoTrack&&!r&&(s=!1),!this._localScreenStream.audioTrack&&n?(n instanceof DH&&(d=!0),c=!0):this._localScreenStream.audioTrack&&!n&&(c=!1),this._localScreenStream.videoTrack=r,this._localScreenStream.audioTrack=n,this._localScreenStream.videoEncodeConfig=t,i&&(AP(i)&&(this._localScreenStream.pubAudio=a===bz.PUB),wP(i)&&(this._localScreenStream.pubVideo=a===bz.PUB),uW.print("publishScreen mediaType","pubAudio: %o, pubVideo: %o",this._localScreenStream.pubAudio,this._localScreenStream.pubVideo)),this._localScreenStream.pubAudio||this._localScreenStream.pubVideo){e.next=18;break}if(null===(l=this._localScreenStream)||void 0===l||!l.hasPublished){e.next=17;break}return e.abrupt("return",this.unpublishScreen());case 17:return e.abrupt("return");case 18:if(this._localScreenStream.hasPublished){e.next=24;break}return null===(h=this._localScreenStream.observer)||void 0===h||h.setPublish(!0),e.next=22,this._mediaServerClient.publish(this._localScreenStream);case 22:e.next=28;break;case 24:return u?null===(f=this._localScreenStream.observer)||void 0===f||f.setPushVideo(s):null===(p=this._localScreenStream.observer)||void 0===p||p.setEnableVideo(s),d?null===(v=this._localScreenStream.observer)||void 0===v||v.setPushAudio(c):null===(_=this._localScreenStream.observer)||void 0===_||_.setEnableAudio(c),e.next=28,this.updatePubScreenTrack();case 28:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n,i){return C.apply(this,arguments)})},{key:"updatePubScreenTrack",value:(w=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uW.print("updatePubScreenTrack","Invoke updatePubScreenTrack"),!this._localScreenStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localScreenStream);case 4:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"unpublishScreen",value:(A=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uW.print("unpublish","Invoke unpublishScreen"),!this._localScreenStream){e.next=7;break}return null===(t=this._localScreenStream.observer)||void 0===t||t.setPublish(!1),e.next=5,this._mediaServerClient.unpublish(this._localScreenStream);case 5:this._localScreenStream.clean(),this._localScreenStream=void 0;case 7:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"liveControlMessage",value:(I=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uW.print("controlMessage","Invoke controlMessage"),null===(r=t.transcodeMeta)||void 0===r||r.layout.regions.forEach((function(e){n.roomInfo&&(e.roomID=n.roomInfo.roomId)})),this._liveControlMessage=t,e.next=5,this._mediaServerClient.controlMessage(t);case 5:"stopped"===t.action&&delete this._liveControlMessage;case 6:case"end":return e.stop()}}),e,this)}))),function(e){return I.apply(this,arguments)})},{key:"publicStreamControlMessage",value:(T=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"stopped"===t.action&&delete t.publicStreamMeta,e.next=3,this._mediaServerClient.controlMessage(t);case 3:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"updateUserAttributes",value:(k=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uW.print("updateUserAttributes","Invoke updateUserAttributes"),t.role&&this._roomInfo&&(this._roomInfo.userInfo.role=t.role),e.next=4,this._mediaServerClient.updateUserAttributes(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"publish",value:(b=u(o().mark((function e(t,r,n,i,a,s){var u,c,d,l,h,f,p,v,_,m,y,g,S=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=S.length>6&&void 0!==S[6]&&S[6],uW.print("publish","Invoke publish"),c=!1,this._localStream||(this._localStream=new Iz,this._mediaServerClient.handler&&(this._localStream.observer=new tW(this._localStream,this._mediaServerClient.handler)),c=!0),this._localStream.videoTrack=n,this._localStream.audioTrack=i,this._localStream.videoEncodeConfig=t,this._localStream.enableSimulcast=r,a&&(AP(a)&&(this._localStream.pubAudio=s===bz.PUB),wP(a)&&(this._localStream.pubVideo=s===bz.PUB),uW.print("publish mediaType","pubAudio: %o, pubVideo: %o",this._localStream.pubAudio,this._localStream.pubVideo)),this._localStream.hasPublished){e.next=26;break}if(this._localStream.pubAudio||this._localStream.pubVideo){e.next=12;break}return e.abrupt("return");case 12:return e.prev=12,u?null===(d=this._localStream.observer)||void 0===d||d.setLogin(!0):c&&(l=!!this._localStream.videoTrack,h=!!this._localStream.audioTrack,f=this._localStream.videoTrack instanceof NH,p=this._localStream.audioTrack instanceof DH,this._roomConfig.isAutoPublish&&!this._hasPublished?(l&&(f?null===(v=this._localStream.observer)||void 0===v||v.setPushVideo(!0):null===(_=this._localStream.observer)||void 0===_||_.setEnableVideo(!0)),h&&(p?null===(m=this._localStream.observer)||void 0===m||m.setPushAudio(!0):null===(y=this._localStream.observer)||void 0===y||y.setEnableAudio(!0))):null===(g=this._localStream.observer)||void 0===g||g.setPublish(!0)),e.next=16,this._mediaServerClient.publish(this._localStream);case 16:this._hasPublished=!0,this.emit(gz.ON_PUBLISH_RESULT,{isScreen:!1,state:P.PUBLISH_SUCC}),e.next=24;break;case 20:throw e.prev=20,e.t0=e.catch(12),this.emit(gz.ON_PUBLISH_RESULT,{isScreen:!1,state:P.PUBLISH_FAIL}),e.t0;case 24:e.next=28;break;case 26:return e.next=28,this.updatePubTrack();case 28:case"end":return e.stop()}}),e,this,[[12,20]])}))),function(e,t,r,n,i,o){return b.apply(this,arguments)})},{key:"updatePubTrack",value:(S=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uW.print("updatePubTrack","Invoke updatePubTrack"),!this._localStream){e.next=4;break}return e.next=4,this._mediaServerClient.updatePubTrack(this._localStream);case 4:case"end":return e.stop()}}),e,this)}))),function(){return S.apply(this,arguments)})},{key:"unpublish",value:(y=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(uW.print("unpublish","Invoke unpublish"),!this._localStream){e.next=6;break}return e.next=4,this._mediaServerClient.unpublish(this._localStream);case 4:this._localStream.clean(),this._localStream=void 0;case 6:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"subscribe",value:(_=u(o().mark((function e(t,r,n){var i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uW.print("subscribe","remoteStream %o",t),i=void 0,n&&(i=this._getSubLayer(n,t)),e.next=5,this._mediaServerClient.subscribe(t,r,i);case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return _.apply(this,arguments)})},{key:"updateSubTrack",value:(v=u(o().mark((function e(t,r,n,i){var a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uW.print("updateSubTrack","Invoke updateSubTrack"),e.abrupt("return",null===(a=this._mediaServerClient)||void 0===a?void 0:a.updateSubTrack(t,r,n,i));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t,r,n){return v.apply(this,arguments)})},{key:"updateSubVideoConfig",value:(p=u(o().mark((function e(t,r){var n,i,a,s,u;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((s=this._findRemoteStreamByScreen(t,!1))&&s.hasSubscribed&&!((null==s||null===(n=s.attributes)||void 0===n||null===(i=n.videoDescriptions)||void 0===i?void 0:i.length)<=1)){e.next=3;break}return e.abrupt("return");case 3:return u=this._getSubLayer(r,s),s.originalStreamIndex=u.spatialLayer,e.abrupt("return",null===(a=this._mediaServerClient)||void 0===a?void 0:a.updateSubTrack(s,s.subMediaType,Ez.SUB,u));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return p.apply(this,arguments)})},{key:"_getSubLayer",value:function(e,t){for(var r,n,i,o,a,s=null==t?void 0:t.attributes,u=s.videoDescriptions,c=s.subVideoDescriptions,d=Array.isArray(c)?c:u,l=-1,h=e.width*e.height,f=0;f<(null==d?void 0:d.length);f++){var p,v;if(h>=(null===(p=d[f])||void 0===p?void 0:p.width)*(null===(v=d[f])||void 0===v?void 0:v.height)){l=f;break}}var _=d[0];if(-1===l)_=d[l=d.length-1];else if(0!==l){var m=d[l-1].width*d[l-1].height,y=(m-h)/(m-d[l].width*d[l].height);_=y<.1?d[l-1]:d[l],l=y<.1?l-1:l}return a=null!==(r=null===(n=_)||void 0===n?void 0:n.sub_index)&&void 0!==r?r:-1,{spatialLayer:null!==(i=null===(o=_)||void 0===o?void 0:o.video_index)&&void 0!==i?i:l,spatialSubLayer:a}}},{key:"unsubscribe",value:(d=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uW.print("unsubscribe","Invoke unsubscribe"),e.next=3,this._mediaServerClient.unsubscribe(t,r);case 3:case"end":return e.stop()}}),e,this)}))),function(e,t){return d.apply(this,arguments)})},{key:"leave",value:(s=u(o().mark((function e(){var t,r,n,i,a,s,u=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=u.length>0&&void 0!==u[0]&&u[0],uW.print("leave","Invoke leave"),r=lP(),e.prev=3,clearTimeout(this._reconnectTimer),n=R(this._remoteStreams.values());try{for(n.s();!(i=n.n()).done;)a=i.value,Array.isArray(a)&&a.forEach((function(e){var t;null===(t=e.observer)||void 0===t||t.setLogin(!1)}))}catch(o){n.e(o)}finally{n.f()}return this._localStream&&(null===(s=this._localStream.observer)||void 0===s||s.setLogin(!1)),e.next=10,this._mediaServerClient.leave();case 10:this.destroy(),gB.rtcLeaveRoom(0,"",lP()-r),e.next=23;break;case 14:if(e.prev=14,e.t0=e.catch(3),e.t0 instanceof ZN&&e.t0.code===JN.NOT_CONNECTED_YET&&this._joinRejectCallback&&this._joinRejectCallback(new Error(fB.LEAVE_ROOM)),!t){e.next=21;break}throw e.t0;case 21:this.destroy();case 22:e.t0 instanceof Error&&gB.rtcLeaveRoom(-1,e.t0.message,lP()-r);case 23:case"end":return e.stop()}}),e,this,[[3,14]])}))),function(){return s.apply(this,arguments)})},{key:"setRemoteUserPriority",value:function(e,t){var r,n;null===(r=this.remoteStreams.get(e))||void 0===r||r.forEach((function(e){return e.setRemoteUserPriority(t)})),null===(n=this.userPriorityMap)||void 0===n||n.set(e,t)}},{key:"destroy",value:function(){uW.print("destroy","Invoke destroy"),this._destroyAndInitMediaServerClient(),this._roomInfo=void 0,this._remoteUsers=new Map;var e,t,r,n=R(this._remoteStreams);try{for(n.s();!(e=n.n()).done;){var i=E(e.value,2)[1];Array.isArray(i)&&i.forEach((function(e){e&&e.clean()}))}}catch(o){n.e(o)}finally{n.f()}(this._remoteStreams=new Map,this._localStream)&&(null===(t=this._localStream)||void 0===t||t.clean(),this._localStream=void 0);this._localScreenStream&&(null===(r=this._localScreenStream)||void 0===r||r.clean(),this._localScreenStream=void 0);this._context=void 0,this._reconnectRecord=new dW,this._removeHandlerEventHandler(),clearTimeout(this._connectionLostTimer),this._userDuplicateLoginTimerMap.forEach((function(e){clearTimeout(e)})),this._userDuplicateLoginTimerMap.clear(),this._networkQualityManager.destroy(),this._videoSizeObserver.destroy(),this._subFallbackManager.destroy()}},{key:"updateToken",value:(a=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return uW.print("updateToken","Invoke updateToken"),this._roomInfo&&(this._roomInfo.token=t),e.next=4,this._mediaServerClient.updateToken(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"pauseAllSubscribedStream",value:(n=u(o().mark((function e(t){var r,n,i,a,s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=R(this._remoteStreams.values());try{for(n.s();!(i=n.n()).done;)a=i.value,Array.isArray(a)&&a.forEach((function(e){if(e.hasSubscribed){var n=s.updateSubTrack(e,t,Ez.UNSUB);n&&r.push(n)}}))}catch(o){n.e(o)}finally{n.f()}return e.abrupt("return",Promise.all(r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"resumeAllSubscribedStream",value:(r=u(o().mark((function e(t){var r,n,i,a,s=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=R(this._remoteStreams.values());try{for(n.s();!(i=n.n()).done;)a=i.value,Array.isArray(a)&&a.forEach((function(e){if(e.hasSubscribed&&e.hasSubscribed){var n=s.updateSubTrack(e,t,Ez.SUB);n&&r.push(n)}}))}catch(o){n.e(o)}finally{n.f()}return e.abrupt("return",Promise.all(r));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"sendUserMessage",value:function(e,t){var r;return null===(r=this._mediaServerClient)||void 0===r?void 0:r.sendUserMessage(e,t)}},{key:"setSessionId",value:function(){this._sessionId=sP(),EB.setStats({rtc_session_id:this._sessionId}),$K.setStats({rtc_session_id:this._sessionId})}},{key:"sendRoomMessage",value:(t=u(o().mark((function e(t){var r,n,i,a,s=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=s.length>1&&void 0!==s[1]&&s[1],a={clientId:null===(r=this._roomInfo)||void 0===r?void 0:r.userInfo.userId,binary:i,message:""},!i){e.next=8;break}return e.next=5,pP.ab2b64str(t);case 5:a.message=e.sent,e.next=9;break;case 8:a.message=t;case 9:return e.abrupt("return",null===(n=this._mediaServerClient)||void 0===n?void 0:n.sendRoomMessage(a));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_destroyAndInitMediaServerClient",value:function(){uW.print("_destroyAndInitMediaServerClient()"),this._mediaServerClient&&(this._mediaServerClient.destroy(),this._removeHandlerEventHandler()),this._mediaServerClient=new Jz(this._context),this._addHandlerEventHandler()}},{key:"_onJoinSucc",value:function(e,t){var r,n=this;uW.print("JoinSuccess()"),this._serverConfig=e.config;var i=[],o=[],a=[],s=[];null===(r=e.clientsDetail)||void 0===r||r.forEach((function(t){if(t.attributes&&(t.attributes.serverMuteVideo&&n.safeEmit(gz.ON_VIDEO_STREAM_BANNED,{uid:t.clientId,banned:1===t.attributes.serverMuteVideo}),t.attributes.serverMuteAudio&&n.safeEmit(gz.ON_AUDIO_STREAM_BANNED,{uid:t.clientId,banned:1===t.attributes.serverMuteAudio})),t.clientId!==e.clientId){var r=n._remoteUsers.get(t.clientId);r?r._stillExist=!0:i.push(t)}}));var u,c=R(this._remoteUsers.values());try{for(c.s();!(u=c.n()).done;){var d=u.value;d._stillExist||o.push({clientId:d.userId}),delete d._stillExist}}catch(p){c.e(p)}finally{c.f()}e.streams.forEach((function(e){var t=n._findRemoteStreamByScreen(e.clientId,e.screen);t?(t.stillExist=!0,t.streamId=e.streamId):s.push(e)}));var l,h=R(this._remoteStreams.values());try{for(h.s();!(l=h.n()).done;){var f=l.value;Array.isArray(f)&&f.forEach((function(e){e.stillExist?delete e.stillExist:a.push({clientId:e.userId,streamId:e.streamId,message:QB.clientDisconnected})}))}}catch(p){h.e(p)}finally{h.f()}setTimeout((function(){o.forEach((function(e){return n._onUserDisconnection(e)})),i.forEach((function(e){return n._onUserConnection(e)})),a.forEach((function(e){return n._onRemoveStream(e)})),s.forEach((function(e){return n._onAddStream(e,!0,!1)})),t&&n._handleSendOrRecvStreamAfterReconnect()}))}},{key:"_handleSendOrRecvStreamAfterReconnect",value:function(){var e=this;this._localStream&&(this._localStream.clean(),this._mediaServerClient.publish(this._localStream).catch((function(e){}))),this._localScreenStream&&(this._localScreenStream.clean(),this._mediaServerClient.publish(this._localScreenStream).catch((function(e){})));var t,r=R(this._remoteStreams.values());try{for(r.s();!(t=r.n()).done;){var n=t.value;Array.isArray(n)&&n.forEach(function(){var t=u(o().mark((function t(r){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r.hasSubscribed){t.next=15;break}return r.resetHasSubscribed(),t.prev=2,uW.print("start resubscribe ".concat(r.userId," with ").concat(r.subMediaType)),t.next=6,e._mediaServerClient.subscribe(r,r.subMediaType);case 6:uW.print("success resubscribe ".concat(r.userId," with ").concat(r.subMediaType)),e.safeEmit(gz.RESUBSCRIBE,{stream:r}),t.next=15;break;case 10:t.prev=10,t.t0=t.catch(2),uW.print("failed resubscribe ".concat(r.userId," with ").concat(r.subMediaType,", error:").concat(t.t0)),r.clean(),null==r||r.resetHasSubscribed();case 15:case"end":return t.stop()}}),t,null,[[2,10]])})));return function(e){return t.apply(this,arguments)}}())}}catch(i){r.e(i)}finally{r.f()}}},{key:"_findRemoteStream",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?r.find((function(e){return e.streamId===t})):null}},{key:"_findRemoteStreamByScreen",value:function(e,t){var r=this._remoteStreams.get(e);return Array.isArray(r)?r.find((function(e){return e.isScreen===t})):null}},{key:"_onAddStream",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var i=this._roomConfig,o=i.isAutoSubscribeAudio,a=i.isAutoSubscribeVideo,s=this._findRemoteStreamByScreen(e.clientId,e.screen);if(s&&s.streamId!==e.streamId){var u,c=null===(u=this._remoteStreams.get(e.clientId))||void 0===u?void 0:u.filter((function(e){return e.streamId!==s.streamId}));s.clean(),this._remoteStreams.set(e.clientId,c||[])}var d=this._findRemoteStream(e.clientId,e.streamId);if(d)d.attributes=e.attributes;else{var l;d=new Rz(e.clientId,e.streamId,e.screen,e.attributes,null===(l=this.userPriorityMap)||void 0===l?void 0:l.get(e.clientId)),this._initStreamListeners(d);var h=this._remoteStreams.get(e.clientId);h?h.push(d):this._remoteStreams.set(e.clientId,[d])}if(this._mediaServerClient.handler&&(d.observer=new eW(d,this._mediaServerClient.handler)),!d.isScreen&&a){var f,p,v,_,m,y,g,S;if(n&&d.hasVideo)if(d.attributes.extvideo)null===(f=d.observer)||void 0===f||f.setExternalVideoSource(!0),null===(p=d.observer)||void 0===p||p.setPushVideo(!0);else null===(v=d.observer)||void 0===v||v.setExternalVideoSource(!1),null===(_=d.observer)||void 0===_||_.setPublishVideo(!0);if(n&&d.hasAudio&&o&&!this._mediaServerClient.roomAttributes.multiChatMode)if(d.attributes.extaudio)null===(m=d.observer)||void 0===m||m.setExternalAudioSource(!0),null===(y=d.observer)||void 0===y||y.setPushAudio(!0);else null===(g=d.observer)||void 0===g||g.setExternalAudioSource(!1),null===(S=d.observer)||void 0===S||S.setPublishAudio(!0);if(!0===r&&!1===n){var b,E=this._roomConfig,k=E.isAutoSubscribeAudio,T=E.isAutoSubscribeVideo;null===(b=d.observer)||void 0===b||b.setLogin(!0,{audio:!!k,video:!!T})}}return r&&this.safeEmit($B.ON_ADD_STREAM,{stream:d}),d}}},{key:"_onUserConnection",value:function(e){var t;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var r=this._userDuplicateLoginTimerMap.get(e.clientId);if("number"==typeof r)return this._userDuplicateLoginTimerMap.delete(e.clientId),void self.clearTimeout(r);var n={userId:e.clientId,extraInfo:e.attributes.extra_info};this._remoteUsers.set(e.clientId,i({},n)),this.safeEmit($B.USER_CONNECTION,{userInfo:n}),e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(gz.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(gz.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}}},{key:"_onUserDisconnection",value:function(e){var t,r=this,n=e.clientId,i=e.tag,o=e.code;if(n)if(n===(null===(t=this.roomInfo)||void 0===t?void 0:t.userInfo.userId)){var a=null;i===rj.kickedByAdmin?a=JN.KICKED_OUT:i===rj.onUserTokenDidExpire?a=JN.TOKEN_EXPIRED:i===rj.userDuplicateLogin&&(a=JN.DUPLICATE_LOGIN),o===nj.roomDismissByAdmin&&(a=JN.ROOM_DISMISS),a&&this.safeEmit(gz.ON_ROOM_ERROR,{errorCode:a})}else{var s=O.DROPPED;i===rj.userLeave?s=O.QUIT:i===rj.kickedByAdmin?s=O.KICKED_BY_ADMIN:i===rj.roleChanged&&(s=O.SWITCH_TO_INVISIBLE);var u=function(){var e;r._remoteUsers.delete(n),null===(e=r._remoteStreams.get(n))||void 0===e||e.forEach((function(e){r._onRemoveStream({clientId:e.userId,streamId:e.streamId,message:"client disconnected"})})),r._remoteStreams.delete(n),r.safeEmit(gz.ON_USER_LEAVE,{userInfo:{userId:n},reason:s})};if(i===rj.userDuplicateLogin){var c=this._userDuplicateLoginTimerMap.get(n);null!=c||self.clearTimeout(c);var d=self.setTimeout(u,5e3);this._userDuplicateLoginTimerMap.set(n,d)}else u()}}},{key:"_onRemoveStream",value:function(e){var t,r=this;if(e.clientId!==(null===(t=this._roomInfo)||void 0===t?void 0:t.userInfo.userId)){var n=this._remoteStreams.get(e.clientId);if(n){var i=n.find((function(t){return t.streamId===e.streamId}));if(i){var o,a,s;if(null===(o=this._mediaServerClient)||void 0===o||o.handleRemoveStream(i,e).then((function(){if(null==i||!i._workaround_1_){var t=r._remoteStreams.get(e.clientId);if(!t)return;t=t.filter((function(t){return t.streamId!==e.streamId})),r._remoteStreams.set(e.clientId,t)}})).finally((function(){r.safeEmit($B.ON_REMOVE_STREAM,{stream:i,reason:e.message})})),i.hasVideo)null===(a=i.observer)||void 0===a||a.setPublishVideo(!1);if(i.hasAudio&&!this._mediaServerClient.roomAttributes.multiChatMode)null===(s=i.observer)||void 0===s||s.setPublishAudio(!1)}}}}},{key:"_onUpdateUserAttributes",value:function(e){e.attributes&&(e.attributes.serverMuteVideo&&this.safeEmit(gz.ON_VIDEO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteVideo}),e.attributes.serverMuteAudio&&this.safeEmit(gz.ON_AUDIO_STREAM_BANNED,{uid:e.clientId,banned:1===e.attributes.serverMuteAudio}))}},{key:"_onUpdateRoomAttributes",value:function(e){e.roomAttributes&&(this._mediaServerClient.roomAttributes=i(i({},this._mediaServerClient.roomAttributes),e.roomAttributes))}},{key:"_onUpdateStreamAttributes",value:function(e){var t=this._roomConfig,r=t.isAutoSubscribeAudio,n=t.isAutoSubscribeVideo,o=e.clientId,a=e.streamId,s=e.attributes,u=this._findRemoteStream(o,a);if(u){var c,d,l=u.attributes,h=i(i({},l),s),f=!1,p=h.localaudio!==l.localaudio,v=!1,_=!1,m=h.localvideo!==l.localvideo,y=!1,g=nz.NONE,S=nz.NONE;if(h.audiostream!==l.audiostream&&(f=h.localaudio,v=!!h.audiostream,h.audiostream?g|=V.AUDIO:S|=V.AUDIO),h.videostream!==l.videostream&&(_=h.localvideo,y=!!h.videostream,h.videostream?g|=V.VIDEO:S|=V.VIDEO),g&&this.safeEmit(gz.ON_USER_PUBLISH_STATE_CHANGE,{userId:o,mediaType:g,isScreen:u.isScreen,pubState:bz.PUB,remoteStream:u}),S&&this.safeEmit(gz.ON_USER_PUBLISH_STATE_CHANGE,{userId:o,mediaType:S,isScreen:u.isScreen,pubState:bz.UNPUB,remoteStream:u}),u.attributes=h,h.localaudio!==l.localaudio)if(h.localaudio&&r){var b,E,k,T;if(h.extaudio)null===(b=u.observer)||void 0===b||b.setExternalAudioSource(!0),null===(E=u.observer)||void 0===E||E.setPushAudio(!0);else null===(k=u.observer)||void 0===k||k.setExternalAudioSource(!1),null===(T=u.observer)||void 0===T||T.setEnableAudio(!0);this.safeEmit(gz.ON_USER_START_AUDIO_CAPTURE,{userId:o},u)}else{var I,R,A,w;if(h.extaudio)null===(I=u.observer)||void 0===I||I.setExternalAudioSource(!0),null===(R=u.observer)||void 0===R||R.setPushAudio(!1);else null===(A=u.observer)||void 0===A||A.setExternalAudioSource(!1),null===(w=u.observer)||void 0===w||w.setEnableAudio(!1);!u.isScreen&&this.safeEmit(gz.ON_USER_STOP_AUDIO_CAPTURE,{userId:o})}if(h.localvideo!==l.localvideo)if(h.localvideo&&n){var C,O,x,N;if(h.extvideo)null===(C=u.observer)||void 0===C||C.setExternalVideoSource(!0),null===(O=u.observer)||void 0===O||O.setPushVideo(!0);else null===(x=u.observer)||void 0===x||x.setExternalVideoSource(!1),null===(N=u.observer)||void 0===N||N.setEnableVideo(!0);this.safeEmit(gz.ON_USER_START_VIDEO_CAPTURE,{userId:o})}else{var D,P,M,L;if(h.extvideo)null===(D=u.observer)||void 0===D||D.setExternalVideoSource(!0),null===(P=u.observer)||void 0===P||P.setPushVideo(!1);else null===(M=u.observer)||void 0===M||M.setExternalVideoSource(!1),null===(L=u.observer)||void 0===L||L.setEnableVideo(!1);!u.isScreen&&this.safeEmit(gz.ON_USER_STOP_VIDEO_CAPTURE,{userId:o})}if(f&&!p)null===(c=u.observer)||void 0===c||c.setRemoteUnmuteAudio(v);if(_&&!m)null===(d=u.observer)||void 0===d||d.setRemoteUnmuteVideo(y)}}},{key:"_onPushTrack",value:function(e){var t=this,r=e.clientId,n=e.streamId,i=this._findRemoteStream(r,n);i||(i=this._onAddStream(e,!1,!1)),this._mediaServerClient.subscribe4pushTrack(i,e).then((function(){return t.safeEmit(gz.SUBSCRIBE_PUSH_TRACK,{stream:i})})).catch((function(e){uW.print("subscribe push track failed: ".concat(e))}))}},{key:"_onRemoveTrack",value:function(e){var t=this,r=e.clientId,n=e.streamId,i=e.message,o=this._findRemoteStream(r,n);o&&this._mediaServerClient.unsubscribe4removeTrack(o,i).then((function(){if(o._workaround_1_){var e,i=null===(e=t._remoteStreams.get(r))||void 0===e?void 0:e.filter((function(e){return e.streamId!==n}));t._remoteStreams.set(r,i||[])}t.safeEmit(gz.REMOVE_PUSH_TRACK,{stream:o})})).catch((function(e){uW.print("remove push track failed: ".concat(e))}))}},{key:"_nodeChange",value:function(e){var t,r=e.nodes,n=e.reason;UB.clearAccessNode(null===(t=this._roomInfo)||void 0===t?void 0:t.appId),this._destroyAndInitMediaServerClient(),Array.isArray(r)&&r.length?this._getAccessNode=r[0]:this._getAccessFeedback=n,gB.rtcNodeChange(0,JSON.stringify(e),JSON.stringify(n)),this._joinResolveCallback&&this._joinRejectCallback?this._join(this._joinResolveCallback,this._joinRejectCallback):this._reconnect()}},{key:"_reconnect",value:function(){var e=this;this._isReconnecting=!0;var t,r=R(this._remoteStreams.values());try{for(r.s();!(t=r.n()).done;){var n=t.value;Array.isArray(n)&&n.forEach((function(e){return e.clean()}))}}catch(i){r.e(i)}finally{r.f()}gB.rtcReconnect(1002,jF.PEERCONNECTION_RECONNECTING,this._roomInfo.userInfo.userId,GF.PEERCONNECTION),this._join((function(){gB.rtcReconnected(HF.PEERCONNECTION_RECONNECTED,zF.PEERCONNECTION)}),(function(t){e._reconnectRecord.record(t),e._reconnectRecord.shouldReconnect?(uW.print("Reconnecting error, will reconnect after 3s",t),e._reconnectTimer=window.setTimeout(e._reconnect.bind(e),3e3)):(e.safeEmit(gz.RECONNECT_FAILED),e.destroy())}),!0)}},{key:"_handleAbnormalDisconnection",value:function(){uW.print("on ABNORMAL_DISCONNECTION"),this._destroyAndInitMediaServerClient(),navigator.onLine?this._reconnect():this._reconnectTimer=window.setTimeout(this._reconnect.bind(this),3e3)}},{key:"_onConnectionStateChange",value:function(e){var t,r=this;if(e.next===Wz.DISCONNECTED)t=B.CONNECTION_STATE_DISCONNECTED;else if(e.next===Wz.CONNECTED)clearTimeout(this._connectionLostTimer),t=this._isReconnecting?B.CONNECTION_STATE_RECONNECTED:B.CONNECTION_STATE_CONNECTED;else{if(e.next!==Wz.CONNECTING)return;t=this._isReconnecting?B.CONNECTION_STATE_RECONNECTING:B.CONNECTION_STATE_CONNECTING}e.prev===Wz.CONNECTED&&e.next===Wz.DISCONNECTED&&(this._connectionLostTimer=window.setTimeout((function(){r.safeEmit(tj.ON_CONNECTION_STATE_CHANGE,{state:B.CONNECTION_STATE_LOST})}),1e4)),this._networkQualityManager.setConnectionState(e.next),this.safeEmit(tj.ON_CONNECTION_STATE_CHANGE,{state:t})}},{key:"_initStreamListeners",value:function(e){var t=this;e.on("ontrack",(function(e){e.track})),e.on("onSEIMessage",(function(r){var n;t.emit(gz.ON_SEI_MESSAGED_RECEIVED,{sei:r,remoteStreamKey:{userId:e.userId,roomId:null===(n=t._roomInfo)||void 0===n?void 0:n.roomId,streamIndex:e.isScreen?U.STREAM_INDEX_SCREEN:U.STREAM_INDEX_MAIN}})}))}},{key:"_onCustomMessage",value:function(e){this.safeEmit($B.ON_CUSTOM_MESSAGE,e)}},{key:"_onUserMessageReceived",value:function(e){this.safeEmit($B.USER_MESSAGE_RECEIVED,{userId:e.from,message:e.msg})}},{key:"_onUserBinaryMessageReceived",value:function(e){this.safeEmit($B.USER_BINARY_MESSAGE_RECEIVED,{userId:e.from,message:e.msg})}},{key:"_onPostProcessingMessage",value:function(e){if(e.body){var t=e.body,r=t.error||0,n=Sz.START,i=["success","parameter error","subscription timeout","ffmpeg error","cdn error","publish error"];if("2.0"===t.protocol){switch(t.eventType){case"TranscodeStarted":0!==t.error&&(n=Sz.START_FAILED);break;case"TranscodeStateChanged":n=0!==t.error?Sz.START_FAILED:Sz.START_SUCCESS;break;case"TranscodeStopped":n=0!==t.error?Sz.STOP_FAILED:Sz.STOP_SUCCESS;break;case"TranscodeUpdated":n=0!==t.error?Sz.UPDATE_FAILED:Sz.UPDATE_SUCCESS}this.safeEmit($B.POST_PROCESSING_MESSAGE,{code:r,protocol:t.protocol,error:t.error,eventType:n,message:i[r]})}this.safeEmit($B.POST_PROCESSING_MESSAGE,{code:r,message:i[r],type:e.type})}}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit($B.ON_USER_TOKEN_WILL_EXPIRE,null)}},{key:"_onSceneConfig",value:function(e){var t=e.multiSceneConfig,r=Gz[this._roomConfig.roomProfileType][1];if(t){var n,i,o,a,s=t[r];if(null!=s&&s.engine_BAC)null===(n=this._context)||void 0===n||null===(i=n.audioProfileManager)||void 0===i||i.updateEngineBAC(s.engine_BAC);if(null!=s&&s.engine_ANM)null===(o=this._context)||void 0===o||null===(a=o.audioProfileManager)||void 0===a||a.updateEngineANM(s.engine_ANM)}}},{key:"_onStreamControlMessage",value:function(e){var t,r;e.type===ZB.PushLimitWarn&&(null!==(t=this._localStream)&&void 0!==t&&t.pubAudio||null!==(r=this._localStream)&&void 0!==r&&r.pubVideo||this.unpublish())}},{key:"_onPublishOnDemand",value:function(e){var t,r,n,i,o;if(!1!==(null===(t=this._serverConfig)||void 0===t||null===(r=t.engine_VPM)||void 0===r||null===(n=r.ondemand)||void 0===n?void 0:n.enable)&&null!==(i=this._localStream)&&void 0!==i&&i.enableSimulcast&&null!==(o=this._localStream)&&void 0!==o&&o.videoTransceiver){var a,s,u=null===(a=this._localStream)||void 0===a?void 0:a.stream.id,c=null===(s=this._localStream)||void 0===s?void 0:s.videoTransceiver.sender,d=c.getParameters();if(Array.isArray(d.encodings)&&Array.isArray(e)){var l,h,f,p,v={};uW.print("_onPublishOnDemand","usedDescriptions: %o",e),e.forEach((function(e){var t;if(null!=e&&null!==(t=e.StreamIds)&&void 0!==t&&t.includes(u)){var r=null==e?void 0:e.Metadata.SubvideoIndex;v[r]=r}}));var _={};null===(l=this._localStream)||void 0===l||null===(h=l.subVideoDescriptions)||void 0===h||h.forEach((function(e){void 0!==v[e.sub_index]&&(_[e.video_index]=e)}));var m=(null===(f=c.track)||void 0===f||null===(p=f.getSettings())||void 0===p?void 0:p.height)||720,y=[];d.encodings=d.encodings.map((function(e){return e.rid&&(_[e.rid]?(e.active=!0,e.scaleResolutionDownBy=Math.max(m/_[e.rid].height,1),y.push({type:1,rid:e.rid,downBy:e.scaleResolutionDownBy})):(y.push({type:0,rid:e.rid}),e.active=!1)),e})),gB.rtcInvokeStatus(JSON.stringify(y),0,"rscp",u,0)}c.setParameters(d)}}},{key:"_onRTT",value:function(e){var t=e.StreamIds,r=e.Metadata;if(t.length&&r){var n,i=t[0];null!==(n=this._context)&&void 0!==n&&n.streamRTT&&(this._context.streamRTT[i]={audio:r.audio_rtt,video:r.video_rtt})}}},{key:"_reportNetworkQuality",value:function(e,t){this._subFallbackManager.updateNetworkQuality(e,t),this.emit(gz.ON_NETWORK_QUALITY,e,t)}},{key:"_emitVideoSizeChange",value:function(e,t,r,n){var i;this.emit(gz.ON_REMOTE_VIDEO_SIZE_CHANGED,{roomId:null===(i=this.roomInfo)||void 0===i?void 0:i.roomId,userId:e,streamIndex:t?U.STREAM_INDEX_SCREEN:U.STREAM_INDEX_MAIN},{width:r,height:n})}},{key:"_emitSubscribeFallback",value:function(e){this.emit(gz.ON_SIMULCAST_SUBSCRIBE_FALLBACK,e)}}]),M}(UL),dW=function(){function e(){c(this,e),h(this,"_all_201_count",void 0),h(this,"_has_4xx",void 0),this._all_201_count=0,this._has_4xx=!1}return l(e,[{key:"shouldReconnect",get:function(){return!(this._all_201_count>=3||this._has_4xx)}},{key:"record",value:function(e){var t=!1,r=!1;if(Array.isArray(e)){var n=0;e.map((function(e){var t,i,o;400<=(null===(t=e.error)||void 0===t?void 0:t.code)&&(null===(i=e.error)||void 0===i?void 0:i.code)<500&&(r=!0),201===(null===(o=e.error)||void 0===o?void 0:o.code)&&n++})),n===e.length&&(t=!0),t&&this._all_201_count++,r&&(this._has_4xx=!0)}}},{key:"clear",value:function(){this._all_201_count=0,this._has_4xx=!1}}]),e}(),lW=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement(e);return t.id&&(r.id=t.id),t.classList&&t.classList.forEach((function(e){r.classList.add(e)})),t.style&&Object.assign(r.style,t.style),t.attributes&&Object.entries(t.attributes).forEach((function(e){var t=E(e,2),n=t[0],i=t[1];"muted"===n?r.muted=!0:r.setAttribute(n,i)})),r},hW=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.id&&(e.id=t.id),t.classList&&t.classList.forEach((function(t){e.classList.add(t)})),t.style&&Object.assign(e.style,t.style),t.attributes&&Object.entries(t.attributes).forEach((function(t){var r=E(t,2),n=r[0],i=r[1];e.setAttribute(n,i)})),e},fW=new ML("Player",0),pW=["play","playing","pause","ended","error","seeking","seeked","waiting","canplay","canplaythrough","durationchange","volumechange","loadedmetadata","loadeddata","loadstart","timeupdate"],vW={playsinline:"","webkit-playsinline":""},_W={playsinline:"","webkit-playsinline":"","x5-playsinline":"","x5-video-player-type":"h5","x-webkit-airplay":"allow",preload:"",muted:""},mW=new(function(){function e(){c(this,e),h(this,"videoCache",[]),h(this,"audioCache",[])}return l(e,[{key:"getOrCreate",value:function(e,t){var r="audio"===e?vW:_W;if("video"===e&&this.videoCache.length>0){var n=this.videoCache.pop();if(n)return hW(n,{style:t,attributes:r}),n}else if("audio"===e&&this.audioCache.length>0){var i=this.audioCache.pop();if(i)return hW(i,{style:t,attributes:r}),i}return lW(e,{style:t,attributes:r})}},{key:"recycle",value:function(e){for(;e.attributes.length>0;)e.removeAttribute(e.attributes[0].name);e instanceof HTMLVideoElement?this.videoCache.push(e):this.audioCache.push(e)}}]),e}()),yW=function(e){f(n,e);var t,r=g(n);function n(e){var t;c(this,n),h(m(t=r.call(this)),"_containerDom",void 0),h(m(t),"_videoDom",void 0),h(m(t),"__cumulativeTime",void 0),h(m(t),"userId",void 0),h(m(t),"renderMode",void 0),h(m(t),"mirrorType",j.MIRROR_TYPE_NONE),h(m(t),"isScreen",void 0),h(m(t),"isLocal",void 0),h(m(t),"played",!1),h(m(t),"_emitPlayFailed",!1),h(m(t),"emitVideoEvent",(function(e){var r,n,i={type:"video",rawEvent:e,readyState:(null===(r=t._videoDom)||void 0===r?void 0:r.readyState)||0,userId:t.userId,eventName:e.type,currentTime:(null===(n=t._videoDom)||void 0===n?void 0:n.currentTime)||0,isScreen:t.isScreen};t.emit("playback_event",i)})),h(m(t),"_internalPlay",(function(){var e;if(null!==(e=t._videoDom)&&void 0!==e&&e.paused){var r=t._videoDom.play();null!=r&&r.then&&r.catch((function(e){var r,n;t._emitPlayFailed||(t._emitPlayFailed=!0,gB.rtcError("video autoplay failed, userId: ".concat(t.userId),-1e3),t.emit("playback_event",{type:"video",rawEvent:e,readyState:(null===(r=t._videoDom)||void 0===r?void 0:r.readyState)||0,userId:t.userId,eventName:"autoplay-error",currentTime:(null===(n=t._videoDom)||void 0===n?void 0:n.currentTime)||0}))}))}}));var i=e.renderDom,o=e.userId;t.renderMode=void 0!==e.renderMode?e.renderMode:L.RENDER_MODE_FIT;var a="string"==typeof i?document.getElementById(i):i;if(!a)throw new ZN(JN.CANT_FIND_DOM,"can't find dom");return t._containerDom=a,t.userId=o,t.isLocal=!!e.isLocal,t.isScreen=!!e.isScreen,t._initVideo(),t}return l(n,[{key:"_initVideo",value:function(){this._videoDom||(this._videoDom=mW.getOrCreate("video",{width:"100%",height:"100%"}),this._videoDom.id="".concat(this.userId,"_").concat(dP()),this.renderMode===L.RENDER_MODE_FIT?this._videoDom.style.objectFit="contain":this._videoDom.style.objectFit="cover",this.mirror(this.mirrorType===j.MIRROR_TYPE_RENDER)),this._containerDom.appendChild(this._videoDom),this._initListeners()}},{key:"_initListeners",value:function(){var e=this;this._videoDom&&pW.forEach((function(t){var r;null===(r=e._videoDom)||void 0===r||r.addEventListener(t,e.emitVideoEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._videoDom&&(pW.forEach((function(t){var r;null===(r=e._videoDom)||void 0===r||r.removeEventListener(t,e.emitVideoEvent)})),this._videoDom.addEventListener("canplay",this._internalPlay),this._videoDom.addEventListener("loadeddata",this._internalPlay))}},{key:"_recordFrame",value:function(e){var t=this;this.on("playback_event",(function(r){var n,i=e.isScreen?1.5:.5;if("timeupdate"===r.eventName){if(0===(null===(n=t._videoDom)||void 0===n?void 0:n.currentTime))return;if(void 0===t.__cumulativeTime)return void(t.__cumulativeTime=t._videoDom.currentTime);if(e.recordedVideoFrames||(e.recordedVideoFrames=[]),t._videoDom.currentTime>t.__cumulativeTime){var o=Math.floor(1e3*(t._videoDom.currentTime-t.__cumulativeTime)),a=t._videoDom.currentTime-t.__cumulativeTime>i;e.recordedVideoFrames.push({playTime:t._videoDom.currentTime,isStall:a,stallCount:a?1:0,stallDuration:o%2e3})}t.__cumulativeTime=t._videoDom.currentTime}}))}},{key:"playVideo",value:(t=u(o().mark((function e(t,r){var n,i,a,s,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._videoDom,fW.print("playVideo","play video track: ".concat(this.userId)),!(a&&a.srcObject instanceof MediaStream&&a.srcObject.getTrackById(null===(n=t.getTrack())||void 0===n?void 0:n.id))){e.next=4;break}return e.abrupt("return");case 4:a||(this._initVideo(),a=this._videoDom),fW.print("playVideo","play video by dom: ".concat(null===(i=a)||void 0===i?void 0:i.id)),(s=new MediaStream).addTrack(t.getTrack("preprocessing")),a.srcObject=s,a&&!this._containerDom.contains(a)&&this._containerDom.appendChild(a),a.addEventListener("canplay",this._internalPlay),a.addEventListener("loadeddata",this._internalPlay),setTimeout((function(){return u._internalPlay()})),r&&this._recordFrame(r),this.played=!0;case 15:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"updateSrcObject",value:function(e){var t=e.getTrack();if(t&&this._videoDom){var r=new MediaStream;r.addTrack(t),this._videoDom.srcObject=r}}},{key:"manuallyPlay",value:function(){if(fW.print("Invoke VideoPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._videoDom)throw new ZN(JN.INVALID_PARAMS,"Player not found");return this._videoDom.play()}},{key:"mirror",value:function(e){fW.print("mirror","".concat(this.userId," set mirror: ").concat(e)),this.mirrorType=e?j.MIRROR_TYPE_RENDER:j.MIRROR_TYPE_NONE,this._videoDom&&(this._videoDom.style.transform=e?"rotateY(180deg)":"")}},{key:"stop",value:function(){var e=this._containerDom;fW.print("stop","stop video track: ".concat(this.userId)),this._videoDom&&(this._videoDom.srcObject=null,null!=e&&e.contains(this._videoDom)&&e.removeChild(this._videoDom)),this.__cumulativeTime=void 0,this.played=!1}},{key:"destroy",value:function(){fW.print("destroy","video player: ".concat(this.userId)),this.stop(),b(p(n.prototype),"removeAllListeners",this).call(this),this._removeListeners(),this._videoDom&&(mW.recycle(this._videoDom),delete this._videoDom)}},{key:"domElement",get:function(){return this._videoDom}}]),n}(OL.exports.EventEmitter),gW=function(e){f(i,e);var t,r,n=g(i);function i(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{divId:void 0,muted:!1},o=r.divId,a=r.muted;if(c(this,i),h(m(t=n.call(this)),"_containerDom",void 0),h(m(t),"_audioDom",void 0),h(m(t),"_fakeAudioDom",void 0),h(m(t),"userId",void 0),h(m(t),"muted",!1),h(m(t),"_emitPlayFailed",!1),h(m(t),"played",!1),h(m(t),"emitAudioEvent",(function(e){var r,n,i={type:"audio",rawEvent:e,readyState:(null===(r=t._audioDom)||void 0===r?void 0:r.readyState)||0,userId:t.userId,eventName:e.type,currentTime:(null===(n=t._audioDom)||void 0===n?void 0:n.currentTime)||0};t.emit("playback_event",i)})),h(m(t),"_internalPlay",(function(){var e,r;if(wB("_internalPlay",{paused:null===(e=t._audioDom)||void 0===e?void 0:e.paused}),null!==(r=t._audioDom)&&void 0!==r&&r.paused)try{var n=t._audioDom.play();null!=n&&n.then&&n.catch((function(e){t._autoPlayError(e)})).then((function(){wB("_internalPlay successfully",{userId:t.userId})}))}catch(i){t._autoPlayError(i)}})),o){var s=document.getElementById(o);if(!s)throw new ZN(JN.CANT_FIND_DOM,"can't find dom");t._containerDom=s}else t._containerDom=document.body;return t.userId=e,t.muted=a,t._initAudio(),t}return l(i,[{key:"_initAudio",value:function(){this._audioDom||(this._audioDom=mW.getOrCreate("audio",{display:"none"}),this._audioDom.volume=this.muted?0:1,this._audioDom.id="".concat(this.userId,"_").concat(dP()),this._containerDom.appendChild(this._audioDom)),this._initListeners()}},{key:"_initListeners",value:function(){var e=this;this._audioDom&&pW.forEach((function(t){var r;null===(r=e._audioDom)||void 0===r||r.addEventListener(t,e.emitAudioEvent)}))}},{key:"_removeListeners",value:function(){var e=this;this._audioDom&&(pW.forEach((function(t){var r;null===(r=e._audioDom)||void 0===r||r.removeEventListener(t,e.emitAudioEvent)})),this._audioDom.removeEventListener("canplay",this._internalPlay),this._audioDom.removeEventListener("loadeddata",this._internalPlay))}},{key:"playAudio",value:(r=u(o().mark((function e(t){var r,n,i,a,s,u=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(fW.print("playAudio","play audio track: ".concat(this.userId)),!((a=this._audioDom)&&a.srcObject instanceof MediaStream&&a.srcObject.getTrackById(null===(r=t.getTrack())||void 0===r?void 0:r.id))){e.next=4;break}return e.abrupt("return");case 4:a||(this._initAudio(),a=this._audioDom),(s=new MediaStream).addTrack(t.getTrack("preprocessing")),a.srcObject=s,null===(n=a)||void 0===n||n.addEventListener("canplay",this._internalPlay),null===(i=a)||void 0===i||i.addEventListener("loadeddata",this._internalPlay),setTimeout((function(){return u._internalPlay()})),this.played=!0;case 12:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_autoPlayError",value:function(e){var t,r;this._emitPlayFailed||(this._emitPlayFailed=!0,gB.rtcError("audio autoplay failed, userId: ".concat(this.userId,": ").concat(e.message),-1e3),this.emit("playback_event",{type:"audio",rawEvent:e,readyState:(null===(t=this._audioDom)||void 0===t?void 0:t.readyState)||0,userId:this.userId,eventName:"autoplay-error",currentTime:(null===(r=this._audioDom)||void 0===r?void 0:r.currentTime)||0}))}},{key:"manuallyPlay",value:function(){var e;if(fW.print("Invoke AudioPlayer.manuallyPlay"),this._emitPlayFailed=!1,!this._audioDom)throw new ZN(JN.INVALID_PARAMS,"Player not found");this._audioDom.volume=1,null===(e=this._fakeAudioDom)||void 0===e||e.play();var t=this._audioDom.play();return null!=t&&t.then?t:Promise.resolve(t)}},{key:"setPlaybackDevice",value:(t=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fW.print("setPlaybackDevice","setPlaybackDevice: ".concat(t)),e.next=3,vH.enumerateAudioPlaybackDevices();case 3:if(e.sent.map((function(e){return e.deviceId})).includes(t)&&this._audioDom&&this._audioDom.setSinkId){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this._audioDom.setSinkId(t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"stop",value:function(){var e=this._containerDom;fW.print("stopAudio","stop audio track: ".concat(this.userId)),this._audioDom&&(this._audioDom.srcObject=null,null!=e&&e.contains(this._audioDom)&&e.removeChild(this._audioDom)),this._fakeAudioDom&&(this._fakeAudioDom.srcObject=null,this._fakeAudioDom=void 0)}},{key:"domElement",get:function(){return this._audioDom}},{key:"destroy",value:function(){fW.print("destroy","audio player: ".concat(this.userId)),this.stop(),b(p(i.prototype),"removeAllListeners",this).call(this),this._removeListeners(),this._audioDom&&(mW.recycle(this._audioDom),delete this._audioDom)}}]),i}(OL.exports.EventEmitter),SW=function(){function e(){c(this,e),h(this,"_timer",void 0),h(this,"userMessage",void 0),h(this,"roomMessage",void 0),this.userMessage={},this.roomMessage={},this._setTimer()}return l(e,[{key:"_setTimer",value:function(){var e=this;!function t(){e._reportAndgReset(),clearTimeout(e._timer),e._timer=setTimeout(t,1e4)}()}},{key:"_reportAndgReset",value:function(){this._report(),this._reset()}},{key:"_report",value:function(){var e=this;gB.rtcMessageStatistics(Object.keys(this.userMessage).map((function(t){return e.userMessage[t]})),Object.keys(this.roomMessage).map((function(t){return e.roomMessage[t]})),"")}},{key:"_reset",value:function(){this.userMessage={},this.roomMessage={}}},{key:"_checkInitUserMessage",value:function(e,t){this.userMessage["".concat(t,"-").concat(e)]||(this.userMessage["".concat(t,"-").concat(e)]={dc_peer_user_id:e,dc_send_total:0,dc_recv_total:0,dc_send_ack:0,dc_send_fail:0,dc_cost_time:0,dc_cost_e2s:0,dc_cost_s2s:0,dc_least_time:1/0,dc_most_time:0,dc_cost_peer_s2e:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_message_type:t,dc_send_binary:0})}},{key:"_sendUserMessage",value:function(e,t,r){this._checkInitUserMessage(e,t),this.userMessage["".concat(t,"-").concat(e)].dc_send_total++,r&&this.userMessage["".concat(t,"-").concat(e)].dc_send_binary++}},{key:"_recvUserMessage",value:function(e,t){this._checkInitUserMessage(e,t),this.userMessage["".concat(t,"-").concat(e)].dc_recv_total++}},{key:"_sendUserFail",value:function(e,t){var r=this.userMessage["".concat(t,"-").concat(e)];r&&r.dc_send_fail++}},{key:"_sendUserAck",value:function(e,t,r,n,i){var o=this.userMessage["".concat(t,"-").concat(e)];o&&(o.dc_send_ack++,o.dc_cost_time+=r,o.dc_cost_s2s+=n||0,o.dc_cost_peer_s2e+=i,o.dc_cost_e2s+=r-(n||0)-i,r<=100?(o.dc_send_ack_100++,o.dc_send_ack_200++,o.dc_send_ack_400++,o.dc_send_ack_1s++):r<=200?(o.dc_send_ack_200++,o.dc_send_ack_400++,o.dc_send_ack_1s++):r<=400?(o.dc_send_ack_400++,o.dc_send_ack_1s++):r<=1e3&&o.dc_send_ack_1s++,r<o.dc_least_time&&(o.dc_least_time=r),r>o.dc_most_time&&(o.dc_most_time=r))}},{key:"sendRoomMessage",value:function(e,t){this.roomMessage[e]||(this.roomMessage[e]={dc_room_id:e,dc_send_total:0,dc_send_ack:0,dc_cost_time:0,dc_least_time:1/0,dc_most_time:0,dc_send_fail:0,dc_send_ack_100:0,dc_send_ack_200:0,dc_send_ack_400:0,dc_send_ack_1s:0,dc_send_binary:0}),this.roomMessage[e].dc_send_total++,t&&this.roomMessage[e].dc_send_binary++}},{key:"sendRoomFail",value:function(e){var t=this.roomMessage[e];t&&t.dc_send_fail++}},{key:"sendRoomAck",value:function(e,t){var r=this.roomMessage[e];r&&(r.dc_send_ack++,r.dc_cost_time+=t,t<r.dc_least_time&&(r.dc_least_time=t),t>r.dc_most_time&&(r.dc_most_time=t),t<=100?(r.dc_send_ack_100++,r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=200?(r.dc_send_ack_200++,r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=400?(r.dc_send_ack_400++,r.dc_send_ack_1s++):t<=1e3&&r.dc_send_ack_1s++)}},{key:"sendP2PMessage",value:function(e,t){this._sendUserMessage(e,pB.P2P,t)}},{key:"recvP2PMessage",value:function(e){this._recvUserMessage(e,pB.P2P)}},{key:"sendP2PFail",value:function(e){this._sendUserFail(e,pB.P2P)}},{key:"sendP2PAck",value:function(e,t,r,n){this._sendUserAck(e,pB.P2P,t,r,n)}},{key:"sendP2POutRoomMessage",value:function(e,t){this._sendUserMessage(e,pB.P2P_OUTSIDE_ROOM,t)}},{key:"recvP2POutRoomMessage",value:function(e){this._recvUserMessage(e,pB.P2P_OUTSIDE_ROOM)}},{key:"sendP2POutRoomFail",value:function(e){this._sendUserFail(e,pB.P2P_OUTSIDE_ROOM)}},{key:"sendP2POutRoomAck",value:function(e,t,r,n){this._sendUserAck(e,pB.P2P_OUTSIDE_ROOM,t,r,n)}},{key:"sendP2serverMessage",value:function(e){this._sendUserMessage("",pB.P2SERVER,e)}},{key:"sendP2serverFail",value:function(){this._sendUserFail("",pB.P2SERVER)}},{key:"sendP2serveAck",value:function(e){this._sendUserAck("",pB.P2SERVER,e,0,0)}},{key:"countP2PMessage",value:function(e,t,r,n,i){this.sendP2PMessage(t,r),e?this.sendP2PAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2PFail(t)}},{key:"countRoomMessage",value:function(e,t,r,n){this.sendRoomMessage(t,r),e?this.sendRoomAck(t,Date.now()-n):this.sendRoomFail(t)}},{key:"countUserMessageOutsideRoom",value:function(e,t,r,n,i){this.sendP2POutRoomMessage(t,r),e?this.sendP2POutRoomAck(t,Date.now()-n,i.s2s_time,i.s2e_time):this.sendP2POutRoomFail(t)}},{key:"countServerMessage",value:function(e,t,r){this.sendP2serverMessage(t),e?this.sendP2serveAck(Date.now()-r):this.sendP2serverFail()}},{key:"destroy",value:function(){this._reset(),clearTimeout(this._timer)}}]),e}(),bW="object"==typeof global&&global&&global.Object===Object&&global,EW="object"==typeof self&&self&&self.Object===Object&&self,kW=bW||EW||Function("return this")(),TW=kW.Symbol,IW=Object.prototype,RW=IW.hasOwnProperty,AW=IW.toString,wW=TW?TW.toStringTag:void 0;var CW=Object.prototype.toString;var OW=TW?TW.toStringTag:void 0;function xW(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":OW&&OW in Object(e)?function(e){var t=RW.call(e,wW),r=e[wW];try{e[wW]=void 0;var n=!0}catch(o){}var i=AW.call(e);return n&&(t?e[wW]=r:delete e[wW]),i}(e):function(e){return CW.call(e)}(e)}function NW(e){return null!=e&&"object"==typeof e}var DW=Array.isArray;function PW(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function MW(e){return e}function LW(e){if(!PW(e))return!1;var t=xW(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var UW,VW=kW["__core-js_shared__"],FW=(UW=/[^.]+$/.exec(VW&&VW.keys&&VW.keys.IE_PROTO||""))?"Symbol(src)_1."+UW:"";var BW=Function.prototype.toString;var jW=/^\[object .+?Constructor\]$/,GW=Function.prototype,HW=Object.prototype,zW=GW.toString,qW=HW.hasOwnProperty,XW=RegExp("^"+zW.call(qW).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function KW(e){return!(!PW(e)||(t=e,FW&&FW in t))&&(LW(e)?XW:jW).test(function(e){if(null!=e){try{return BW.call(e)}catch(t){}try{return e+""}catch(t){}}return""}(e));var t}function WW(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var YW=Date.now;var JW,QW,ZW,$W=function(){try{var e=KW(t=function(e,t){return null==e?void 0:e[t]}(Object,"defineProperty"))?t:void 0;return e({},"",{}),e}catch(r){}var t}(),eY=$W,tY=eY?function(e,t){return eY(e,"toString",{configurable:!0,enumerable:!1,value:(r=t,function(){return r}),writable:!0});var r}:MW,rY=(JW=tY,QW=0,ZW=0,function(){var e=YW(),t=16-(e-ZW);if(ZW=e,t>0){if(++QW>=800)return arguments[0]}else QW=0;return JW.apply(void 0,arguments)}),nY=rY,iY=/^(?:0|[1-9]\d*)$/;function oY(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&iY.test(e))&&e>-1&&e%1==0&&e<t}function aY(e,t,r){"__proto__"==t&&eY?eY(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function sY(e,t){return e===t||e!=e&&t!=t}var uY=Object.prototype.hasOwnProperty;function cY(e,t,r){var n=e[t];uY.call(e,t)&&sY(n,r)&&(void 0!==r||t in e)||aY(e,t,r)}var dY=Math.max;function lY(e,t){return nY(function(e,t,r){return t=dY(void 0===t?e.length-1:t,0),function(){for(var n=arguments,i=-1,o=dY(n.length-t,0),a=Array(o);++i<o;)a[i]=n[t+i];i=-1;for(var s=Array(t+1);++i<t;)s[i]=n[i];return s[t]=r(a),WW(e,this,s)}}(e,t,MW),e+"")}function hY(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function fY(e){return null!=e&&hY(e.length)&&!LW(e)}var pY=Object.prototype;function vY(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||pY)}function _Y(e){return NW(e)&&"[object Arguments]"==xW(e)}var mY=Object.prototype,yY=mY.hasOwnProperty,gY=mY.propertyIsEnumerable,SY=_Y(function(){return arguments}())?_Y:function(e){return NW(e)&&yY.call(e,"callee")&&!gY.call(e,"callee")},bY=SY;var EY="object"==typeof exports&&exports&&!exports.nodeType&&exports,kY=EY&&"object"==typeof module&&module&&!module.nodeType&&module,TY=kY&&kY.exports===EY?kW.Buffer:void 0,IY=(TY?TY.isBuffer:void 0)||function(){return!1},RY={};RY["[object Float32Array]"]=RY["[object Float64Array]"]=RY["[object Int8Array]"]=RY["[object Int16Array]"]=RY["[object Int32Array]"]=RY["[object Uint8Array]"]=RY["[object Uint8ClampedArray]"]=RY["[object Uint16Array]"]=RY["[object Uint32Array]"]=!0,RY["[object Arguments]"]=RY["[object Array]"]=RY["[object ArrayBuffer]"]=RY["[object Boolean]"]=RY["[object DataView]"]=RY["[object Date]"]=RY["[object Error]"]=RY["[object Function]"]=RY["[object Map]"]=RY["[object Number]"]=RY["[object Object]"]=RY["[object RegExp]"]=RY["[object Set]"]=RY["[object String]"]=RY["[object WeakMap]"]=!1;var AY="object"==typeof exports&&exports&&!exports.nodeType&&exports,wY=AY&&"object"==typeof module&&module&&!module.nodeType&&module,CY=wY&&wY.exports===AY&&bW.process,OY=function(){try{var e=wY&&wY.require&&wY.require("util").types;return e||CY&&CY.binding&&CY.binding("util")}catch(t){}}(),xY=OY&&OY.isTypedArray,NY=xY?function(e){return function(t){return e(t)}}(xY):function(e){return NW(e)&&hY(e.length)&&!!RY[xW(e)]},DY=NY,PY=Object.prototype.hasOwnProperty;function MY(e,t){var r=DW(e),n=!r&&bY(e),i=!r&&!n&&IY(e),o=!r&&!n&&!i&&DY(e),a=r||n||i||o,s=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],u=s.length;for(var c in e)!t&&!PY.call(e,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||oY(c,u))||s.push(c);return s}var LY=function(e,t){return function(r){return e(t(r))}}(Object.keys,Object),UY=LY,VY=Object.prototype.hasOwnProperty;function FY(e){return fY(e)?MY(e):function(e){if(!vY(e))return UY(e);var t=[];for(var r in Object(e))VY.call(e,r)&&"constructor"!=r&&t.push(r);return t}(e)}var BY=Object.prototype.hasOwnProperty;function jY(e){if(!PW(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=vY(e),r=[];for(var n in e)("constructor"!=n||!t&&BY.call(e,n))&&r.push(n);return r}var GY,HY=(GY=function(e,t){!function(e,t,r,n){var i=!r;r||(r={});for(var o=-1,a=t.length;++o<a;){var s=t[o],u=n?n(r[s],e[s],s,r,e):void 0;void 0===u&&(u=e[s]),i?aY(r,s,u):cY(r,s,u)}}(t,function(e){return fY(e)?MY(e,!0):jY(e)}(t),e)},lY((function(e,t){var r=-1,n=t.length,i=n>1?t[n-1]:void 0,o=n>2?t[2]:void 0;for(i=GY.length>3&&"function"==typeof i?(n--,i):void 0,o&&function(e,t,r){if(!PW(r))return!1;var n=typeof t;return!!("number"==n?fY(r)&&oY(t,r.length):"string"==n&&t in r)&&sY(r[t],e)}(t[0],t[1],o)&&(i=n<3?void 0:i,n=1),e=Object(e);++r<n;){var a=t[r];a&&GY(e,a,r,i)}return e})));function zY(e,t){return function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(t,(function(t){return e[t]}))}function qY(e){return null==e?[]:zY(e,FY(e))}var XY=ye,KY=_t("iterator"),WY=!XY((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[KY]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),YY=Te,JY=2147483647,QY=/[^\0-\u007E]/,ZY=/[.\u3002\uFF0E\uFF61]/g,$Y="Overflow: input needs wider integers to process",eJ=RangeError,tJ=YY(ZY.exec),rJ=Math.floor,nJ=String.fromCharCode,iJ=YY("".charCodeAt),oJ=YY([].join),aJ=YY([].push),sJ=YY("".replace),uJ=YY("".split),cJ=YY("".toLowerCase),dJ=function(e){return e+22+75*(e<26)},lJ=function(e,t,r){var n=0;for(e=r?rJ(e/700):e>>1,e+=rJ(e/t);e>455;)e=rJ(e/35),n+=36;return rJ(n+36*e/(e+38))},hJ=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=iJ(e,r++);if(i>=55296&&i<=56319&&r<n){var o=iJ(e,r++);56320==(64512&o)?aJ(t,((1023&i)<<10)+(1023&o)+65536):(aJ(t,i),r--)}else aJ(t,i)}return t}(e);var r,n,i=e.length,o=128,a=0,s=72;for(r=0;r<e.length;r++)(n=e[r])<128&&aJ(t,nJ(n));var u=t.length,c=u;for(u&&aJ(t,"-");c<i;){var d=JY;for(r=0;r<e.length;r++)(n=e[r])>=o&&n<d&&(d=n);var l=c+1;if(d-o>rJ((JY-a)/l))throw eJ($Y);for(a+=(d-o)*l,o=d,r=0;r<e.length;r++){if((n=e[r])<o&&++a>JY)throw eJ($Y);if(n==o){for(var h=a,f=36;;){var p=f<=s?1:f>=s+26?26:f-s;if(h<p)break;var v=h-p,_=36-p;aJ(t,nJ(dJ(p+v%_))),h=rJ(v/_),f+=36}aJ(t,nJ(dJ(h))),s=lJ(a,l,c==u),a=0,c++}}a++,o++}return oJ(t,"")},fJ=ha,pJ=se,vJ=Ut,_J=Te,mJ=St,yJ=WY,gJ=wn,SJ=gh,bJ=wc,EJ=Mc,kJ=ln,TJ=Xl,IJ=He,RJ=Pe,AJ=Zn,wJ=Fn,CJ=Pt,OJ=kt,xJ=es,NJ=La,DJ=Gr,PJ=Il,MJ=yl,LJ=v_,UJ=DI,VJ=_t("iterator"),FJ="URLSearchParams",BJ="URLSearchParamsIterator",jJ=kJ.set,GJ=kJ.getterFor(FJ),HJ=kJ.getterFor(BJ),zJ=Object.getOwnPropertyDescriptor,qJ=function(e){if(!mJ)return pJ[e];var t=zJ(pJ,e);return t&&t.value},XJ=qJ("fetch"),KJ=qJ("Request"),WJ=qJ("Headers"),YJ=KJ&&KJ.prototype,JJ=WJ&&WJ.prototype,QJ=pJ.RegExp,ZJ=pJ.TypeError,$J=pJ.decodeURIComponent,eQ=pJ.encodeURIComponent,tQ=_J("".charAt),rQ=_J([].join),nQ=_J([].push),iQ=_J("".replace),oQ=_J([].shift),aQ=_J([].splice),sQ=_J("".split),uQ=_J("".slice),cQ=/\+/g,dQ=Array(4),lQ=function(e){return dQ[e-1]||(dQ[e-1]=QJ("((?:%[\\da-f]{2}){"+e+"})","gi"))},hQ=function(e){try{return $J(e)}catch(X$){return e}},fQ=function(e){var t=iQ(e,cQ," "),r=4;try{return $J(t)}catch(X$){for(;r;)t=iQ(t,lQ(r--),hQ);return t}},pQ=/[!'()~]|%20/g,vQ={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},_Q=function(e){return vQ[e]},mQ=function(e){return iQ(eQ(e),pQ,_Q)},yQ=EJ((function(e,t){jJ(this,{type:BJ,iterator:PJ(GJ(e).entries),kind:t})}),"Iterator",(function(){var e=HJ(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),gQ=function(e){this.entries=[],this.url=null,void 0!==e&&(OJ(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===tQ(e,0)?uQ(e,1):e:xJ(e)))};gQ.prototype={type:FJ,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,i,o,a,s,u=MJ(e);if(u)for(r=(t=PJ(e,u)).next;!(n=vJ(r,t)).done;){if(o=(i=PJ(CJ(n.value))).next,(a=vJ(o,i)).done||(s=vJ(o,i)).done||!vJ(o,i).done)throw ZJ("Expected sequence with length 2");nQ(this.entries,{key:xJ(a.value),value:xJ(s.value)})}else for(var c in e)RJ(e,c)&&nQ(this.entries,{key:c,value:xJ(e[c])})},parseQuery:function(e){if(e)for(var t,r,n=sQ(e,"&"),i=0;i<n.length;)(t=n[i++]).length&&(r=sQ(t,"="),nQ(this.entries,{key:fQ(oQ(r)),value:fQ(rQ(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],nQ(r,mQ(e.key)+"="+mQ(e.value));return rQ(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var SQ=function(){TJ(this,bQ);var e=arguments.length>0?arguments[0]:void 0;jJ(this,new gQ(e))},bQ=SQ.prototype;if(SJ(bQ,{append:function(e,t){LJ(arguments.length,2);var r=GJ(this);nQ(r.entries,{key:xJ(e),value:xJ(t)}),r.updateURL()},delete:function(e){LJ(arguments.length,1);for(var t=GJ(this),r=t.entries,n=xJ(e),i=0;i<r.length;)r[i].key===n?aQ(r,i,1):i++;t.updateURL()},get:function(e){LJ(arguments.length,1);for(var t=GJ(this).entries,r=xJ(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){LJ(arguments.length,1);for(var t=GJ(this).entries,r=xJ(e),n=[],i=0;i<t.length;i++)t[i].key===r&&nQ(n,t[i].value);return n},has:function(e){LJ(arguments.length,1);for(var t=GJ(this).entries,r=xJ(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){LJ(arguments.length,1);for(var r,n=GJ(this),i=n.entries,o=!1,a=xJ(e),s=xJ(t),u=0;u<i.length;u++)(r=i[u]).key===a&&(o?aQ(i,u--,1):(o=!0,r.value=s));o||nQ(i,{key:a,value:s}),n.updateURL()},sort:function(){var e=GJ(this);UJ(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=GJ(this).entries,n=AJ(e,arguments.length>1?arguments[1]:void 0),i=0;i<r.length;)n((t=r[i++]).value,t.key,this)},keys:function(){return new yQ(this,"keys")},values:function(){return new yQ(this,"values")},entries:function(){return new yQ(this,"entries")}},{enumerable:!0}),gJ(bQ,VJ,bQ.entries,{name:"entries"}),gJ(bQ,"toString",(function(){return GJ(this).serialize()}),{enumerable:!0}),bJ(SQ,FJ),fJ({global:!0,constructor:!0,forced:!yJ},{URLSearchParams:SQ}),!yJ&&IJ(WJ)){var EQ=_J(JJ.has),kQ=_J(JJ.set),TQ=function(e){if(OJ(e)){var t,r=e.body;if(wJ(r)===FJ)return t=e.headers?new WJ(e.headers):new WJ,EQ(t,"content-type")||kQ(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),NJ(e,{body:DJ(0,xJ(r)),headers:DJ(0,t)})}return e};if(IJ(XJ)&&fJ({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return XJ(e,arguments.length>1?TQ(arguments[1]):{})}}),IJ(KJ)){var IQ=function(e){return TJ(this,YJ),new KJ(e,arguments.length>1?TQ(arguments[1]):{})};YJ.constructor=IQ,IQ.prototype=YJ,fJ({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:IQ})}}var RQ,AQ=ha,wQ=St,CQ=WY,OQ=se,xQ=Zn,NQ=Te,DQ=wn,PQ=pg,MQ=Xl,LQ=Pe,UQ=Sp,VQ=UD,FQ=Pd,BQ=Iu.codeAt,jQ=function(e){var t,r,n=[],i=uJ(sJ(cJ(e),ZY,"."),".");for(t=0;t<i.length;t++)r=i[t],aJ(n,tJ(QY,r)?"xn--"+hJ(r):r);return oJ(n,".")},GQ=es,HQ=wc,zQ=v_,qQ={URLSearchParams:SQ,getState:GJ},XQ=ln,KQ=XQ.set,WQ=XQ.getterFor("URL"),YQ=qQ.URLSearchParams,JQ=qQ.getState,QQ=OQ.URL,ZQ=OQ.TypeError,$Q=OQ.parseInt,eZ=Math.floor,tZ=Math.pow,rZ=NQ("".charAt),nZ=NQ(/./.exec),iZ=NQ([].join),oZ=NQ(1..toString),aZ=NQ([].pop),sZ=NQ([].push),uZ=NQ("".replace),cZ=NQ([].shift),dZ=NQ("".split),lZ=NQ("".slice),hZ=NQ("".toLowerCase),fZ=NQ([].unshift),pZ="Invalid scheme",vZ="Invalid host",_Z="Invalid port",mZ=/[a-z]/i,yZ=/[\d+-.a-z]/i,gZ=/\d/,SZ=/^0x/i,bZ=/^[0-7]+$/,EZ=/^\d+$/,kZ=/^[\da-f]+$/i,TZ=/[\0\t\n\r #%/:<>?@[\\\]^|]/,IZ=/[\0\t\n\r #/:<>?@[\\\]^|]/,RZ=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,AZ=/[\t\n\r]/g,wZ=function(e){var t,r,n,i;if("number"==typeof e){for(t=[],r=0;r<4;r++)fZ(t,e%256),e=eZ(e/256);return iZ(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,i=0,o=0;o<8;o++)0!==e[o]?(i>r&&(t=n,r=i),n=null,i=0):(null===n&&(n=o),++i);return i>r&&(t=n,r=i),t}(e),r=0;r<8;r++)i&&0===e[r]||(i&&(i=!1),n===r?(t+=r?":":"::",i=!0):(t+=oZ(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},CZ={},OZ=UQ({},CZ,{" ":1,'"':1,"<":1,">":1,"`":1}),xZ=UQ({},OZ,{"#":1,"?":1,"{":1,"}":1}),NZ=UQ({},xZ,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),DZ=function(e,t){var r=BQ(e,0);return r>32&&r<127&&!LQ(t,e)?e:encodeURIComponent(e)},PZ={ftp:21,file:null,http:80,https:443,ws:80,wss:443},MZ=function(e,t){var r;return 2==e.length&&nZ(mZ,rZ(e,0))&&(":"==(r=rZ(e,1))||!t&&"|"==r)},LZ=function(e){var t;return e.length>1&&MZ(lZ(e,0,2))&&(2==e.length||"/"===(t=rZ(e,2))||"\\"===t||"?"===t||"#"===t)},UZ=function(e){return"."===e||"%2e"===hZ(e)},VZ={},FZ={},BZ={},jZ={},GZ={},HZ={},zZ={},qZ={},XZ={},KZ={},WZ={},YZ={},JZ={},QZ={},ZZ={},$Z={},e$={},t$={},r$={},n$={},i$={},o$=function(e,t,r){var n,i,o,a=GQ(e);if(t){if(i=this.parse(a))throw ZQ(i);this.searchParams=null}else{if(void 0!==r&&(n=new o$(r,!0)),i=this.parse(a,null,n))throw ZQ(i);(o=JQ(new YQ)).bindURL(this),this.searchParams=o}};o$.prototype={type:"URL",parse:function(e,t,r){var n,i,o,a,s,u=this,c=t||VZ,d=0,l="",h=!1,f=!1,p=!1;for(e=GQ(e),t||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,e=uZ(e,RZ,"")),e=uZ(e,AZ,""),n=VQ(e);d<=n.length;){switch(i=n[d],c){case VZ:if(!i||!nZ(mZ,i)){if(t)return pZ;c=BZ;continue}l+=hZ(i),c=FZ;break;case FZ:if(i&&(nZ(yZ,i)||"+"==i||"-"==i||"."==i))l+=hZ(i);else{if(":"!=i){if(t)return pZ;l="",c=BZ,d=0;continue}if(t&&(u.isSpecial()!=LQ(PZ,l)||"file"==l&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=l,t)return void(u.isSpecial()&&PZ[u.scheme]==u.port&&(u.port=null));l="","file"==u.scheme?c=QZ:u.isSpecial()&&r&&r.scheme==u.scheme?c=jZ:u.isSpecial()?c=qZ:"/"==n[d+1]?(c=GZ,d++):(u.cannotBeABaseURL=!0,sZ(u.path,""),c=r$)}break;case BZ:if(!r||r.cannotBeABaseURL&&"#"!=i)return pZ;if(r.cannotBeABaseURL&&"#"==i){u.scheme=r.scheme,u.path=FQ(r.path),u.query=r.query,u.fragment="",u.cannotBeABaseURL=!0,c=i$;break}c="file"==r.scheme?QZ:HZ;continue;case jZ:if("/"!=i||"/"!=n[d+1]){c=HZ;continue}c=XZ,d++;break;case GZ:if("/"==i){c=KZ;break}c=t$;continue;case HZ:if(u.scheme=r.scheme,i==RQ)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=FQ(r.path),u.query=r.query;else if("/"==i||"\\"==i&&u.isSpecial())c=zZ;else if("?"==i)u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=FQ(r.path),u.query="",c=n$;else{if("#"!=i){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=FQ(r.path),u.path.length--,c=t$;continue}u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,u.path=FQ(r.path),u.query=r.query,u.fragment="",c=i$}break;case zZ:if(!u.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){u.username=r.username,u.password=r.password,u.host=r.host,u.port=r.port,c=t$;continue}c=KZ}else c=XZ;break;case qZ:if(c=XZ,"/"!=i||"/"!=rZ(l,d+1))continue;d++;break;case XZ:if("/"!=i&&"\\"!=i){c=KZ;continue}break;case KZ:if("@"==i){h&&(l="%40"+l),h=!0,o=VQ(l);for(var v=0;v<o.length;v++){var _=o[v];if(":"!=_||p){var m=DZ(_,NZ);p?u.password+=m:u.username+=m}else p=!0}l=""}else if(i==RQ||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(h&&""==l)return"Invalid authority";d-=VQ(l).length+1,l="",c=WZ}else l+=i;break;case WZ:case YZ:if(t&&"file"==u.scheme){c=$Z;continue}if(":"!=i||f){if(i==RQ||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(u.isSpecial()&&""==l)return vZ;if(t&&""==l&&(u.includesCredentials()||null!==u.port))return;if(a=u.parseHost(l))return a;if(l="",c=e$,t)return;continue}"["==i?f=!0:"]"==i&&(f=!1),l+=i}else{if(""==l)return vZ;if(a=u.parseHost(l))return a;if(l="",c=JZ,t==YZ)return}break;case JZ:if(!nZ(gZ,i)){if(i==RQ||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()||t){if(""!=l){var y=$Q(l,10);if(y>65535)return _Z;u.port=u.isSpecial()&&y===PZ[u.scheme]?null:y,l=""}if(t)return;c=e$;continue}return _Z}l+=i;break;case QZ:if(u.scheme="file","/"==i||"\\"==i)c=ZZ;else{if(!r||"file"!=r.scheme){c=t$;continue}if(i==RQ)u.host=r.host,u.path=FQ(r.path),u.query=r.query;else if("?"==i)u.host=r.host,u.path=FQ(r.path),u.query="",c=n$;else{if("#"!=i){LZ(iZ(FQ(n,d),""))||(u.host=r.host,u.path=FQ(r.path),u.shortenPath()),c=t$;continue}u.host=r.host,u.path=FQ(r.path),u.query=r.query,u.fragment="",c=i$}}break;case ZZ:if("/"==i||"\\"==i){c=$Z;break}r&&"file"==r.scheme&&!LZ(iZ(FQ(n,d),""))&&(MZ(r.path[0],!0)?sZ(u.path,r.path[0]):u.host=r.host),c=t$;continue;case $Z:if(i==RQ||"/"==i||"\\"==i||"?"==i||"#"==i){if(!t&&MZ(l))c=t$;else if(""==l){if(u.host="",t)return;c=e$}else{if(a=u.parseHost(l))return a;if("localhost"==u.host&&(u.host=""),t)return;l="",c=e$}continue}l+=i;break;case e$:if(u.isSpecial()){if(c=t$,"/"!=i&&"\\"!=i)continue}else if(t||"?"!=i)if(t||"#"!=i){if(i!=RQ&&(c=t$,"/"!=i))continue}else u.fragment="",c=i$;else u.query="",c=n$;break;case t$:if(i==RQ||"/"==i||"\\"==i&&u.isSpecial()||!t&&("?"==i||"#"==i)){if(".."===(s=hZ(s=l))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(u.shortenPath(),"/"==i||"\\"==i&&u.isSpecial()||sZ(u.path,"")):UZ(l)?"/"==i||"\\"==i&&u.isSpecial()||sZ(u.path,""):("file"==u.scheme&&!u.path.length&&MZ(l)&&(u.host&&(u.host=""),l=rZ(l,0)+":"),sZ(u.path,l)),l="","file"==u.scheme&&(i==RQ||"?"==i||"#"==i))for(;u.path.length>1&&""===u.path[0];)cZ(u.path);"?"==i?(u.query="",c=n$):"#"==i&&(u.fragment="",c=i$)}else l+=DZ(i,xZ);break;case r$:"?"==i?(u.query="",c=n$):"#"==i?(u.fragment="",c=i$):i!=RQ&&(u.path[0]+=DZ(i,CZ));break;case n$:t||"#"!=i?i!=RQ&&("'"==i&&u.isSpecial()?u.query+="%27":u.query+="#"==i?"%23":DZ(i,CZ)):(u.fragment="",c=i$);break;case i$:i!=RQ&&(u.fragment+=DZ(i,OZ))}d++}},parseHost:function(e){var t,r,n;if("["==rZ(e,0)){if("]"!=rZ(e,e.length-1))return vZ;if(t=function(e){var t,r,n,i,o,a,s,u=[0,0,0,0,0,0,0,0],c=0,d=null,l=0,h=function(){return rZ(e,l)};if(":"==h()){if(":"!=rZ(e,1))return;l+=2,d=++c}for(;h();){if(8==c)return;if(":"!=h()){for(t=r=0;r<4&&nZ(kZ,h());)t=16*t+$Q(h(),16),l++,r++;if("."==h()){if(0==r)return;if(l-=r,c>6)return;for(n=0;h();){if(i=null,n>0){if(!("."==h()&&n<4))return;l++}if(!nZ(gZ,h()))return;for(;nZ(gZ,h());){if(o=$Q(h(),10),null===i)i=o;else{if(0==i)return;i=10*i+o}if(i>255)return;l++}u[c]=256*u[c]+i,2!=++n&&4!=n||c++}if(4!=n)return;break}if(":"==h()){if(l++,!h())return}else if(h())return;u[c++]=t}else{if(null!==d)return;l++,d=++c}}if(null!==d)for(a=c-d,c=7;0!=c&&a>0;)s=u[c],u[c--]=u[d+a-1],u[d+--a]=s;else if(8!=c)return;return u}(lZ(e,1,-1)),!t)return vZ;this.host=t}else if(this.isSpecial()){if(e=jQ(e),nZ(TZ,e))return vZ;if(t=function(e){var t,r,n,i,o,a,s,u=dZ(e,".");if(u.length&&""==u[u.length-1]&&u.length--,(t=u.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(i=u[n]))return e;if(o=10,i.length>1&&"0"==rZ(i,0)&&(o=nZ(SZ,i)?16:8,i=lZ(i,8==o?1:2)),""===i)a=0;else{if(!nZ(10==o?EZ:8==o?bZ:kZ,i))return e;a=$Q(i,o)}sZ(r,a)}for(n=0;n<t;n++)if(a=r[n],n==t-1){if(a>=tZ(256,5-t))return null}else if(a>255)return null;for(s=aZ(r),n=0;n<r.length;n++)s+=r[n]*tZ(256,3-n);return s}(e),null===t)return vZ;this.host=t}else{if(nZ(IZ,e))return vZ;for(t="",r=VQ(e),n=0;n<r.length;n++)t+=DZ(r[n],CZ);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return LQ(PZ,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&MZ(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,i=e.host,o=e.port,a=e.path,s=e.query,u=e.fragment,c=t+":";return null!==i?(c+="//",e.includesCredentials()&&(c+=r+(n?":"+n:"")+"@"),c+=wZ(i),null!==o&&(c+=":"+o)):"file"==t&&(c+="//"),c+=e.cannotBeABaseURL?a[0]:a.length?"/"+iZ(a,"/"):"",null!==s&&(c+="?"+s),null!==u&&(c+="#"+u),c},setHref:function(e){var t=this.parse(e);if(t)throw ZQ(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new a$(e.path[0]).origin}catch(X$){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+wZ(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(GQ(e)+":",VZ)},getUsername:function(){return this.username},setUsername:function(e){var t=VQ(GQ(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=DZ(t[r],NZ)}},getPassword:function(){return this.password},setPassword:function(e){var t=VQ(GQ(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=DZ(t[r],NZ)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?wZ(e):wZ(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,WZ)},getHostname:function(){var e=this.host;return null===e?"":wZ(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,YZ)},getPort:function(){var e=this.port;return null===e?"":GQ(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=GQ(e))?this.port=null:this.parse(e,JZ))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+iZ(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,e$))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=GQ(e))?this.query=null:("?"==rZ(e,0)&&(e=lZ(e,1)),this.query="",this.parse(e,n$)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=GQ(e))?("#"==rZ(e,0)&&(e=lZ(e,1)),this.fragment="",this.parse(e,i$)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var a$=function(e){var t=MQ(this,s$),r=zQ(arguments.length,1)>1?arguments[1]:void 0,n=KQ(t,new o$(e,!1,r));wQ||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},s$=a$.prototype,u$=function(e,t){return{get:function(){return WQ(this)[e]()},set:t&&function(e){return WQ(this)[t](e)},configurable:!0,enumerable:!0}};if(wQ&&(PQ(s$,"href",u$("serialize","setHref")),PQ(s$,"origin",u$("getOrigin")),PQ(s$,"protocol",u$("getProtocol","setProtocol")),PQ(s$,"username",u$("getUsername","setUsername")),PQ(s$,"password",u$("getPassword","setPassword")),PQ(s$,"host",u$("getHost","setHost")),PQ(s$,"hostname",u$("getHostname","setHostname")),PQ(s$,"port",u$("getPort","setPort")),PQ(s$,"pathname",u$("getPathname","setPathname")),PQ(s$,"search",u$("getSearch","setSearch")),PQ(s$,"searchParams",u$("getSearchParams")),PQ(s$,"hash",u$("getHash","setHash"))),DQ(s$,"toJSON",(function(){return WQ(this).serialize()}),{enumerable:!0}),DQ(s$,"toString",(function(){return WQ(this).serialize()}),{enumerable:!0}),QQ){var c$=QQ.createObjectURL,d$=QQ.revokeObjectURL;c$&&DQ(a$,"createObjectURL",xQ(c$,QQ)),d$&&DQ(a$,"revokeObjectURL",xQ(d$,QQ))}HQ(a$,"URL"),AQ({global:!0,constructor:!0,forced:!CQ,sham:!wQ},{URL:a$});var l$=function(){var e=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new Audio(URL.createObjectURL(new Blob([t],r))),e.prev=1,n.muted=!0,e.next=5,n.play();case 5:return n.pause(),e.abrupt("return",!0);case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t,r){return e.apply(this,arguments)}}(),h$=Object.defineProperty,f$=Object.getOwnPropertyDescriptor,p$=function(e,t,r,n){for(var i,o=n>1?void 0:n?f$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&h$(t,r,o),o},v$=function(){function e(t){c(this,e),h(this,"_sharedAudioContext",new AudioContext),h(this,"_audioDestination",this._sharedAudioContext.createMediaStreamDestination()),h(this,"_localGainNode",this._sharedAudioContext.createGain()),h(this,"_bufferGainNode",this._sharedAudioContext.createGain()),h(this,"_audioBufferSource",void 0),h(this,"_localSource",void 0),h(this,"_context",void 0),h(this,"_failedAudioList",[]),h(this,"mixingMap",new Map),h(this,"resourcesCache",new Map),h(this,"volumeConfig",new Map),h(this,"cachedBuffer",[]),this._context=t,this._localGainNode.gain.value=1}var t,r,n;return l(e,[{key:"mixMediaStream",value:function(e){this._localSource&&this._localSource.disconnect(this._localGainNode),this._localSource=this._sharedAudioContext.createMediaStreamSource(e),this._localSource.connect(this._localGainNode).connect(this._audioDestination)}},{key:"startAudioMixing",value:(n=u(o().mark((function e(t,r,n){var i,a,s,u,c,d,l,h,f,p,v,_,m,y=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.playCount,PP(a=n.type,"mixingType",qY(te)),s=this._context.getLocalAudioTrack()){e.next=5;break}return e.abrupt("return");case 5:if((u=s.getTrack("preprocessing"))&&this.mixMediaStream(new MediaStream([u])),null!=(c=this.mixingMap.get(t))&&c.audioNode){c.audioNode.pause(),this._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_STOPPED,error:QN.AUDIO_MIXING_ERROR_OK});try{c.gainNode.disconnect(this._audioDestination),c.audioSource.disconnect(c.gainNode)}catch(o){}}if(!(l=this.resourcesCache.get(t))||l.filePath!==r){e.next=14;break}d=l.getAudioNode(),e.next=27;break;case 14:return e.next=16,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw y._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_FAILED,error:QN.AUDIO_MIXING_ERROR_START_FAILED}),new ZN(JN.LOAD_RESOURCES_FAILED,e.statusText)}));case 16:return h=e.sent,r.endsWith("mp3")?f={type:"audio/mpeg"}:r.endsWith("aac")&&(f={type:"audio/aac"}),e.next=20,l$(h,f);case 20:if(e.sent){e.next=24;break}throw this._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_FAILED,error:QN.AUDIO_MIXING_ERROR_START_FAILED}),new ZN(JN.LOAD_RESOURCES_FAILED,"invalid audio resource");case 24:(d=new Audio).crossOrigin="anonymous",d.src=URL.createObjectURL(new Blob([h],f));case 27:return i<=0?d.loop=!0:i>0&&(p=i,d.onended=function(){--p>0?d.play():(y.mixingMap.delete(t),y._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_FINISHED,error:QN.AUDIO_MIXING_ERROR_OK}))}),e.prev=28,e.next=31,d.play();case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(28),console.error(e.t0),this._failedAudioList.push(d),this._context.onAutoPlayFailed();case 38:if(v=this._sharedAudioContext.createMediaElementSource(d),_=this._sharedAudioContext.createGain(),m=this.volumeConfig.get(t),_.gain.value=m?m/100:1,v.connect(_).connect(this._audioDestination),this.mixingMap.set(t,{audioSource:v,audioNode:d,gainNode:_,type:"file"}),a===te.PUBLISH)try{_.disconnect(this._sharedAudioContext.destination)}catch(o){}else _.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],n.type),this._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_PLAYING,error:QN.AUDIO_MIXING_ERROR_OK});case 47:case"end":return e.stop()}}),e,this,[[28,33]])}))),function(e,t,r){return n.apply(this,arguments)})},{key:"stopAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&"file"===t.type&&(this.mixingMap.delete(e),t.audioNode.pause(),t.audioSource.disconnect(t.gainNode),t.gainNode.disconnect(this._audioDestination),this._context.emitMessage({mixId:e,state:re.AUDIO_MIXING_STATE_STOPPED,error:QN.AUDIO_MIXING_ERROR_OK}))}},{key:"pauseAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:re.AUDIO_MIXING_STATE_PAUSED,error:QN.AUDIO_MIXING_ERROR_OK}),t.audioNode.pause())}},{key:"resumeAudioMixing",value:function(e){var t=this.mixingMap.get(e);t&&(this._context.emitMessage({mixId:e,state:re.AUDIO_MIXING_STATE_PLAYING,error:QN.AUDIO_MIXING_ERROR_OK}),t.audioNode.play())}},{key:"preloadAudioMixing",value:(r=u(o().mark((function e(t,r){var n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.stopAudioMixing(t),e.next=3,fetch(r,{mode:"cors",credentials:"include"}).then((function(e){if(e.ok)return e.arrayBuffer();throw i._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_FAILED,error:QN.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new ZN(JN.LOAD_RESOURCES_FAILED,e.statusText)})).catch((function(e){throw i._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_FAILED,error:QN.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new ZN(JN.LOAD_RESOURCES_FAILED,"Load resources failed",e)}));case 3:return n=e.sent,e.next=6,l$(n);case 6:if(e.sent){e.next=10;break}throw this._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_FAILED,error:QN.AUDIO_MIXING_ERROR_PRELOAD_FAILED}),new ZN(JN.LOAD_RESOURCES_FAILED,"Load resources failed");case 10:this._context.emitMessage({mixId:t,state:re.AUDIO_MIXING_STATE_PRELOADED,error:QN.AUDIO_MIXING_ERROR_OK}),this.resourcesCache.set(t,{getAudioNode:function(){return new Audio(URL.createObjectURL(new Blob([n])))},filePath:r});case 12:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"unloadAudioMixing",value:function(e){this.resourcesCache.has(e)&&this.resourcesCache.delete(e)}},{key:"getAudioMixingVolume",value:function(e){var t=this.mixingMap.get(e);return t?100*t.gainNode.gain.value:0}},{key:"setAudioMixingVolume",value:function(e,t){t<0?t=0:t>400&&(t=400),this.volumeConfig.set(e,t);var r=this.mixingMap.get(e);r&&(r.gainNode.gain.value=Number(t)/100)}},{key:"getAudioMixingDuration",value:function(e){var t=this.mixingMap.get(e),r=this.mixingMap.get(e);return t||r?t?1e3*t.audioNode.duration:r?1e3*r.audioNode.duration:0:0}},{key:"getAudioMixingCurrentPosition",value:function(e){var t=this.mixingMap.get(e);return t?1e3*t.audioNode.currentTime:0}},{key:"setAudioMixingPosition",value:function(e,t){var r=this.mixingMap.get(e);r&&(r.audioNode.currentTime=t/1e3,r.audioNode.play())}},{key:"enableAudioMixingBuffer",value:function(e){PP(e,"type",qY(te));var t=this._context.getLocalAudioTrack();if(t){var r=t.getTrack("preprocessing");if(r&&this.mixMediaStream(new MediaStream([r])),e===te.PUBLISH)try{this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(n){}else this._bufferGainNode.connect(this._sharedAudioContext.destination);this._context.updateLocalAudioTrack(this._audioDestination.stream.getAudioTracks()[0],e),this._bufferGainNode.connect(this._audioDestination),this._context.emitMessage({mixId:-1,state:re.AUDIO_MIXING_STATE_PCM_ENABLED,error:QN.AUDIO_MIXING_ERROR_OK})}}},{key:"disableAudioMixingBuffer",value:function(){if(this.cachedBuffer=[],this._audioBufferSource){try{this._audioBufferSource.disconnect(this._bufferGainNode),this._bufferGainNode.disconnect(this._audioDestination),this._bufferGainNode.disconnect(this._sharedAudioContext.destination)}catch(e){}finally{this._audioBufferSource=void 0}this._context.updateLocalAudioTrack(),this._context.emitMessage({mixId:-1,state:re.AUDIO_MIXING_STATE_PCM_DISABLED,error:QN.AUDIO_MIXING_ERROR_OK})}}},{key:"pushAudioMixingBuffer",value:function(e){var t=this;if(!(this._audioBufferSource&&(this.cachedBuffer.push(e),this.cachedBuffer.length>0))){this._audioBufferSource=this._sharedAudioContext.createBufferSource(),this._audioBufferSource.buffer=e,this._audioBufferSource.connect(this._bufferGainNode);try{this._audioBufferSource.start()}catch(r){this._failedAudioList.push(this._audioBufferSource)}this._audioBufferSource.onended=function(){var e;if(null===(e=t._audioBufferSource)||void 0===e||e.disconnect(t._bufferGainNode),t._audioBufferSource=void 0,t.cachedBuffer.length){var r=t.cachedBuffer.shift();r&&t.pushAudioMixingBuffer(r)}}}}},{key:"stopAll",value:function(){var e=this;if(this._localSource)try{this._localSource.disconnect(this._localGainNode),delete this._localSource}catch(t){}this.mixingMap.forEach((function(t,r){e.stopAudioMixing(r)}))}},{key:"mixTrack",get:function(){return this._audioDestination.stream.getAudioTracks()[0]}},{key:"sharedAudioContext",get:function(){return this._sharedAudioContext}},{key:"resumeLocalPlay",value:(t=u(o().mark((function e(){var t,r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],r=R(this._failedAudioList),e.prev=2,r.s();case 4:if((n=r.n()).done){e.next=24;break}if(i=n.value,e.prev=6,!(i instanceof HTMLAudioElement)){e.next=13;break}return i.muted=!1,e.next=11,i.play();case 11:e.next=14;break;case 13:i.start();case 14:e.next=22;break;case 16:return e.prev=16,e.t0=e.catch(6),t.push(i),console.error(e.t0),this._context.onAutoPlayFailed(),e.abrupt("break",24);case 22:e.next=4;break;case 24:e.next=29;break;case 26:e.prev=26,e.t1=e.catch(2),r.e(e.t1);case 29:return e.prev=29,r.f(),e.finish(29);case 32:this._failedAudioList=t;case 33:case"end":return e.stop()}}),e,this,[[2,26,29,32],[6,16]])}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e=this._sharedAudioContext;"closed"!==e.state&&"function"==typeof e.close&&e.close(),this.cachedBuffer=[],this.mixingMap.clear(),this.resourcesCache.clear(),this.volumeConfig.clear()}}]),e}();p$([RB("default","id","filePath","options")],v$.prototype,"startAudioMixing",1),p$([RB("default","id")],v$.prototype,"stopAudioMixing",1),p$([RB("default","id")],v$.prototype,"pauseAudioMixing",1),p$([RB("default","id")],v$.prototype,"resumeAudioMixing",1),p$([RB("default","id")],v$.prototype,"preloadAudioMixing",1),p$([RB("default","id")],v$.prototype,"unloadAudioMixing",1),p$([RB("default","id")],v$.prototype,"getAudioMixingVolume",1),p$([RB("default","id","volume")],v$.prototype,"setAudioMixingVolume",1),p$([RB("default","id")],v$.prototype,"getAudioMixingDuration",1),p$([RB("default","id")],v$.prototype,"getAudioMixingCurrentPosition",1),p$([RB("default","id","position")],v$.prototype,"setAudioMixingPosition",1),p$([RB("default","type")],v$.prototype,"enableAudioMixingBuffer",1),p$([RB()],v$.prototype,"disableAudioMixingBuffer",1),p$([RB("default","buffer")],v$.prototype,"pushAudioMixingBuffer",1);var _$=function(e){return e.NORMAL_USER="normalUser",e.SILENT_USER="silentUser",e}(_$||{}),m$=new ML("RTMClient",1),y$=function(e){f(_,e);var t,r,n,i,a,s,d,v=g(_);function _(e){var t;return c(this,_),h(m(t=v.call(this)),"_dataChannelSignal",null),h(m(t),"_handler",null),h(m(t),"_dataChannelSignalState",Wz.DISCONNECTED),h(m(t),"_loginSessionId",null),h(m(t),"_userId",null),h(m(t),"_token",null),h(m(t),"_isReconnecting",!1),h(m(t),"_reconnectTimer",null),h(m(t),"_loginResolveCallback",null),h(m(t),"_loginRejectCallback",null),h(m(t),"_iceConfigNode",null),h(m(t),"_wait_login_token",!1),h(m(t),"_serverParamsCache",void 0),t._appId=e,t}return l(_,[{key:"login",value:function(e,t){var r=this;return new Promise((function(n,i){if(m$.print("login","invoke login, token: %o, userId: %o",e,t),r._loginSessionId)throw new ZN(JN.ALREADY_LOGIN,"Already logined");if(r._loginResolveCallback)throw new ZN(JN.LOGIN_FAILED,"Is logging in, please try again later.");r._userId=t,r._token=e,kB.setStats({rtc_app_id:r._appId,user_id:t}),r._loginResolveCallback=n,r._loginRejectCallback=i,r._dataChannelSignal?r._login():(m$.print("login","init dataChannelSingling"),r._dataChannelSignalState=Wz.CONNECTING,r._createDataChannelSignaling(t).then((function(e){r._dataChannelSignal=e,r._login()})).catch((function(){r._onDisconnect()})))}))}},{key:"logout",value:(d=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new ZN(JN.NOT_LOGIN,"login first");case 2:return e.next=4,null===(t=this._dataChannelSignal)||void 0===t?void 0:t.sendSignaling("logout",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._appId},{functionType:dj.C2RTM}).catch((function(){}));case 4:this._closeDataChannelSignaling(),this._clearState();case 6:case"end":return e.stop()}}),e,this)}))),function(){return d.apply(this,arguments)})},{key:"updateLoginToken",value:(s=u(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._token=t,e.abrupt("return",new Promise((function(e,t){r._wait_login_token?(r._loginResolveCallback=e,r._loginRejectCallback=t,r._login()):e()})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(a=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new ZN(JN.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.next=5,this._dataChannelSignal.sendSignaling("getPeerOnlineStatus",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._appId,peerUserId:t},{functionType:dj.C2RTM});case 5:return r=e.sent,e.abrupt("return",null==r?void 0:r.status);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(i=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new ZN(JN.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._appId,to:t,room:"",msg:r}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return i.apply(this,arguments)})},{key:"setServerParams",value:(n=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,DP(t,"signature"),DP(r,"url"),this._loginSessionId&&this._userId){e.next=5;break}throw new ZN(JN.NOT_LOGIN,"login first");case 5:return this._checkDataChannelSignal(),e.next=8,this._dataChannelSignal.sendSignaling("setServerParams",{loginSessionId:this._loginSessionId,userId:this._userId,appId:this._appId,signature:t,url:r},{functionType:dj.C2RTM}).catch((function(e){throw new ZN(JN.UNEXPECTED_ERROR,e.msg)}));case 8:this._serverParamsCache={signature:t,url:r},this.emit("onServerParamsSetResult"),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),this.emit("onServerParamsSetResult",e.t0),e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,12]])}))),function(e,t){return n.apply(this,arguments)})},{key:"sendServerMessage",value:(r=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._loginSessionId&&this._userId){e.next=2;break}throw new ZN(JN.NOT_LOGIN,"login first");case 2:return this._checkDataChannelSignal(),e.abrupt("return",this._dataChannelSignal.sendP2PMessage({from:this._userId,app:this._appId,to:"",room:"",type:oj.BUSINESS_SERVER,msg:t}));case 4:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"destroy",value:function(){this._clearState(),this._closeDataChannelSignaling(),b(p(_.prototype),"removeAllListeners",this).call(this),delete this._serverParamsCache}},{key:"_login",value:function(){var e=this;if(this._userId){var t=dP();this._checkDataChannelSignal(),this._dataChannelSignal.sendSignaling("login",{Token:pP.token2auth(this._appId,null,this._userId,this._token),timestamp:Date.now(),loginSessionId:t,params:{deviceType:"web",userAgent:window.navigator.userAgent,sdkVersion:GB.VERSION,deviceId:UB.getDeviceId(),appId:this._appId,userId:this._userId}},{functionType:dj.C2RTM}).then((function(){"function"==typeof e._loginResolveCallback&&e._loginResolveCallback(),e._loginSessionId=t,e._wait_login_token=!1,e._serverParamsCache&&e.setServerParams(e._serverParamsCache.signature,e._serverParamsCache.url)})).catch((function(t){var r,n,i=t||{},o=i.code,a=i.message;e._wait_login_token=!1,o>=700&&o<800?708===o?(r=JN.INVALID_PARAMS,n="Invalid userId"):(r=JN.INVALID_TOKEN,n="Invalid token",e._wait_login_token=!0,e._loginRejectCallback||e.emit("onRTMTokenError")):(r=JN.LOGIN_FAILED,n="login failed"),"function"==typeof e._loginRejectCallback&&e._loginRejectCallback(new ZN(r,a||n))})).finally((function(){e._loginResolveCallback=null,e._loginRejectCallback=null}))}}},{key:"_createDataChannelSignaling",value:(t=u(o().mark((function e(t){var r,n,i,a,s,u,c,d=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new vj,i=this._iceConfigNode){e.next=16;break}return e.prev=3,e.next=6,null==n?void 0:n.getAccessNode(this._appId,"",t,UB.getDeviceId(),"");case 6:if(a=e.sent,i=a[0]){e.next=10;break}throw new Error;case 10:e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(3),wB("rtm.login.getNodeFailed","",0,!0),new ZN(JN.ICE_SERVER_WRONG,"get ICE config failed");case 16:return wB("rtm.login.getNodeSuccess",i,0,!0),m$.print("_createDataChannelSignaling()","get node success",i),this._handler=Vz(SB),null===(r=this._handler)||void 0===r||r.once("disconnect",(function(){m$.print("_createDataChannelSignaling()","recv BasicHandler event: disconnect"),d._onDisconnect()})),e.prev=20,e.next=23,null===(u=this._handler)||void 0===u?void 0:u.connect(i);case 23:s=e.sent,m$.print("_createDataChannelSignaling()","establish peerConnection success"),this._dataChannelSignalState=Wz.CONNECTED,e.next=33;break;case 28:throw e.prev=28,e.t1=e.catch(20),this._iceConfigNode=null,this._dataChannelSignalState=Wz.DISCONNECTED,new ZN(JN.ESTABLISH_DATACHANNEL_FAILED,"establish dataChannel failed",e.t1);case 33:return c=new hj(s),m$.print("_createDataChannelSignaling()","send ping"),c.sendPingSignaling(),c.once("close",(function(){m$.print("_createDataChannelSignaling()","recv DataChannelSignaling event: close"),d._onDisconnect()})),c.on($B.USER_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){d.emit("onUserMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),c.on($B.USER_BINARY_MESSAGE_RECEIVED_OUTSIDE_ROOM,(function(e){d.emit("onUserBinaryMessageReceivedOutsideRoom",{userId:e.from,message:e.msg})})),c.on($B.USER_DISCONNECTION,(function(){d.emit("onUserDisconnection"),d._clearState()})),c.on($B.NODE_CHANGE,(function(e){wB("rtm.nodeChange",JSON.stringify(e),0,!0),Array.isArray(e.nodes)&&e.nodes.length&&(d._iceConfigNode=e.nodes[0]),d._loginResolveCallback&&d._loginRejectCallback?d._login():d._reconnect()})),e.abrupt("return",c);case 42:case"end":return e.stop()}}),e,this,[[3,12],[20,28]])}))),function(e){return t.apply(this,arguments)})},{key:"_closeDataChannelSignaling",value:function(){var e,t;null===(e=this._dataChannelSignal)||void 0===e||e.destroy(),this._dataChannelSignal=null,null===(t=this._handler)||void 0===t||t.destroy(),this._handler=null}},{key:"_checkDataChannelSignal",value:function(){if(!this._dataChannelSignal||this._dataChannelSignalState!==Wz.CONNECTED)throw new ZN(JN.NOT_CONNECTED_YET,"datachannel not connect")}},{key:"_onDisconnect",value:function(){this._dataChannelSignalState=Wz.DISCONNECTED,this._closeDataChannelSignaling(),navigator.onLine?this._reconnect():this._reconnectTimer=self.setTimeout(this._reconnect.bind(this),3e3)}},{key:"_reconnect",value:function(){var e=this;!this._isReconnecting&&this._userId&&(m$.print("_reconnect()","start reconnect..."),this._isReconnecting=!0,this._createDataChannelSignaling(this._userId).then((function(t){m$.print("_reconnect()","reconnect success!"),e._dataChannelSignal=t,e._login(),e._reconnectTimer=null})).catch((function(t){m$.print("_reconnect()","Reconnecting error, will reconnect after 3s",t),e._reconnectTimer=self.setTimeout(e._reconnect.bind(e),3e3)})).finally((function(){e._isReconnecting=!1})))}},{key:"_clearState",value:function(){this._userId=null,this._token=null,this._loginSessionId=null,null!==this._reconnectTimer&&(self.clearTimeout(this._reconnectTimer),this._reconnectTimer=null)}}]),_}(OL.exports.EventEmitter),g$=function(e){f(a,e);var t,r,n,i=g(a);function a(e){var t;return c(this,a),h(m(t=i.call(this)),"_mediaServerClient",void 0),h(m(t),"_appId",void 0),h(m(t),"_reconnectTimer",void 0),h(m(t),"remoteStreams",void 0),t._appId=e,t.remoteStreams=new Map,t}return l(a,[{key:"connect",value:(n=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._mediaServerClient=new Jz({}),this._bindEvents(),e.next=4,this._mediaServerClient.connect(this._appId);case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"startPlayPublicStream",value:(r=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.remoteStreams.get(t)){e.next=2;break}throw new ZN(JN.REPEAT_PLAY,"repeat play public media stream");case 2:return(r=new Rz(t,t,!1,{audiostream:!0,localaudio:!0,videostream:!0,localvideo:!0,extaudio:!1,extvideo:!1,videoDescriptions:[]})).on("onSEIMessage",(function(e){if(e instanceof Uint8Array)for(var t=OP(e),i=0;i<t.seiCount;i++)n.emit(gz.ON_SEI_MESSAGED_RECEIVED,{sei:t.seis[i],publicStreamId:r.streamId})})),e.next=6,this._mediaServerClient.subscribePublicStream(r);case 6:return this.remoteStreams.set(t,r),e.abrupt("return",r);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stopPlayPublicStream",value:function(e){var t=this.remoteStreams.get(e);if(t)return this.remoteStreams.delete(e),this._mediaServerClient.unsubscribePublicStream(t)}},{key:"destroy",value:function(){this.remoteStreams=new Map,this._mediaServerClient&&this._mediaServerClient.destroy()}},{key:"_handleReconnected",value:(t=u(o().mark((function e(){var t,r,n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:clearTimeout(this._reconnectTimer),t=R(this.remoteStreams);try{for(n=function(){var e=E(r.value,1)[0];i.remoteStreams.delete(e),i.startPlayPublicStream(e).then((function(){var t=i.remoteStreams.get(e);i.safeEmit(gz.RESUBSCRIBE,{stream:t})}))},t.s();!(r=t.n()).done;)n()}catch(o){t.e(o)}finally{t.f()}case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_reconnect",value:function(){var e=this;this._mediaServerClient.removeAllListeners(),this._mediaServerClient.destroy(),navigator.onLine?this.connect().then(this._handleReconnected.bind(this)):this._reconnectTimer=window.setTimeout((function(){return e.connect().then(e._handleReconnected.bind(e))}),3e3)}},{key:"_bindEvents",value:function(){var e,t,r=this;null===(e=this._mediaServerClient)||void 0===e||e.on(tj.ABNORMAL_DISCONNECTION,this._reconnect.bind(this)),null===(t=this._mediaServerClient)||void 0===t||t.on("onRemoteStreamStats",(function(e){r.emit("onRemoteStreamStats",e)}))}}]),a}(UL),S$=new ML("AudioDeviceManager",1),b$=function(e){f(a,e);var t,r,n,i=g(a);function a(e){var t;return c(this,a),h(m(t=i.call(this)),"_audioLevelFetcher",void 0),h(m(t),"_playbackDeviceTestTimer",void 0),h(m(t),"_audioElement",void 0),h(m(t),"_audioTrack",void 0),h(m(t),"_mediaRecorder",void 0),h(m(t),"_recoderTimer",void 0),h(m(t),"_isAudioPlaybackDeviceTesting",!1),h(m(t),"_isAudioDeviceRecordTesting",!1),h(m(t),"_audioCaptureAndRecoderResolve",void 0),t._extensionManager=e,t}return l(a,[{key:"startAudioPlaybackDeviceTest",value:(n=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAudioPlaybackDeviceTesting&&!this._isAudioDeviceRecordTesting){e.next=2;break}throw new ZN(JN.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 2:return this._isAudioPlaybackDeviceTesting=!0,S$.print("startAudioPlaybackDeviceTest()","Invoke"),e.prev=4,e.next=7,this._playAudioFile(t,{loop:!0});case 7:e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(4),this.stopAudioPlaybackDeviceTest(),e.t0;case 13:this._startEmitAudioPlaybackDeviceTestVolume(r);case 14:case"end":return e.stop()}}),e,this,[[4,9]])}))),function(e,t){return n.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){this._isAudioPlaybackDeviceTesting&&(S$.print("stopAudioPlaybackDeviceTest()","Invoke"),this._isAudioPlaybackDeviceTesting=!1,this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}},{key:"startAudioDeviceRecordTest",value:(r=u(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this._isAudioDeviceRecordTesting){e.next=2;break}throw new ZN(JN.REPEAT_DEVICE_TEST,"device test cannot be called repeatedly at the same time.");case 2:return this._isAudioDeviceRecordTesting=!0,S$.print("startAudioDeviceRecordTest()","Invoke"),this._recoderTimer=window.setTimeout((function(){S$.print("startAudioDeviceRecordTest()","".concat(3e4,'ms automatic call method "stopAudioDeviceRecordAndPlayTest"')),r._stopAudioCaptureAndRecoder()}),3e4),e.next=7,this._startAudioCaptureAndRecoder(t);case 7:delete this._audioCaptureAndRecoderResolve;case 8:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){S$.print("stopAudioDeviceRecordAndPlayTest()","Invoke"),void 0!==this._recoderTimer&&(clearTimeout(this._recoderTimer),delete this._recoderTimer),this._stopAudioCaptureAndRecoder()}},{key:"stopAudioDevicePlayTest",value:function(){this._isAudioDeviceRecordTesting&&(S$.print("stopAudioDevicePlayTest()","Invoke"),this._isAudioDeviceRecordTesting=!1,this.stopAudioDeviceRecordAndPlayTest(),this._stopEmitAudioPlaybackDeviceTestVolume(),this._destroyAudioElement())}},{key:"getRecordTrack",value:function(){return this._audioTrack}},{key:"destroy",value:function(){S$.print("destroy()","Invoke"),b(p(a.prototype),"removeAllListeners",this).call(this),this.stopAudioPlaybackDeviceTest(),this.stopAudioDevicePlayTest()}},{key:"_playAudioFile",value:function(e,t){var r=this;return new Promise((function(n,i){r._audioElement=lW("audio",{attributes:{src:e,crossOrigin:"",autoplay:"true"}}),r._audioElement.loop=t.loop,S$.print("_playAudioFile()","url=".concat(e,";loop=").concat(t.loop)),r._audioElement.oncanplay=function(){S$.print("_playAudioFile()","oncanplay"),n()},r._audioElement.onerror=function(e){var t,n;i(new ZN(JN.LOAD_RESOURCES_FAILED,"audio error: ".concat(e.message||(null===(t=r._audioElement)||void 0===t||null===(n=t.error)||void 0===n?void 0:n.message))))}}))}},{key:"_destroyAudioElement",value:function(){this._audioElement&&(S$.print("_destroyAudioElement()","Invoke"),this._audioElement.src="",delete this._audioElement,"function"==typeof this._audioCaptureAndRecoderResolve&&this._audioCaptureAndRecoderResolve())}},{key:"_startEmitAudioPlaybackDeviceTestVolume",value:function(e){var t=this;e=Math.max(e,100),this._audioElement&&(S$.print("_startEmitAudioPlaybackDeviceTestVolume()","start timer(".concat(e,"ms)")),this._audioLevelFetcher=new mH(this._audioElement),this._playbackDeviceTestTimer=self.setInterval((function(){t._audioLevelFetcher&&t.emit("onAudioPlaybackDeviceTestVolume",t._audioLevelFetcher.getAudioLevel())}),e))}},{key:"_stopEmitAudioPlaybackDeviceTestVolume",value:function(){var e;void 0!==this._playbackDeviceTestTimer&&(S$.print("_stopEmitAudioPlaybackDeviceTestVolume()","stop timer"),self.clearInterval(this._playbackDeviceTestTimer),delete this._playbackDeviceTestTimer),null===(e=this._audioLevelFetcher)||void 0===e||e.destroy(),delete this._audioLevelFetcher}},{key:"_startAudioCaptureAndRecoder",value:(t=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,zH({},this._extensionManager);case 2:return this._audioTrack=e.sent,i=this._audioTrack.getTrack("preprocessing"),r=EH.get(i),S$.print("startAudioDeviceRecordTest()","create microphone track success!"),e.abrupt("return",new Promise((function(e,i){n._mediaRecorder=new MediaRecorder(r),n._mediaRecorder.ondataavailable=function(){var r=u(o().mark((function r(a){var s,u;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!n._isAudioDeviceRecordTesting){r.next=16;break}return S$.print("startAudioDeviceRecordTest()","get recorded file."),u=new Blob([a.data]),r.prev=3,r.next=6,n._playAudioFile(URL.createObjectURL(u),{loop:!1});case 6:r.next=11;break;case 8:return r.prev=8,r.t0=r.catch(3),r.abrupt("return",i(r.t0));case 11:n._startEmitAudioPlaybackDeviceTestVolume(t),null===(s=n._audioElement)||void 0===s||s.addEventListener("ended",(function(){n.stopAudioDevicePlayTest(),e()})),n._audioCaptureAndRecoderResolve=e,r.next=17;break;case 16:e();case 17:case"end":return r.stop()}}),r,null,[[3,8]])})));return function(e){return r.apply(this,arguments)}}(),n._mediaRecorder.onerror=function(e){i(new ZN(JN.AUDIO_DEVICE_TEST_FAILED,e.message||"mediaRecorder error"))},n._mediaRecorder.start()})));case 6:case"end":return e.stop()}var i}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"_stopAudioCaptureAndRecoder",value:function(){var e;this._mediaRecorder&&("recording"===this._mediaRecorder.state&&this._mediaRecorder.stop(),delete this._mediaRecorder),null===(e=this._audioTrack)||void 0===e||e.close(),delete this._audioTrack}}]),a}(OL.exports.EventEmitter),E$=function(){function e(){c(this,e),h(this,"engineBAC",{adm:{},agc:{},ans:{}}),h(this,"engineANM",{}),h(this,"bitrate",void 0),h(this,"sampleRate",void 0),h(this,"channel",void 0),h(this,"aec",void 0),h(this,"agc",void 0),h(this,"ans",void 0),this._init()}var t;return l(e,[{key:"_init",value:(t=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _j,e.next=3,t.getAudioProfile();case 3:this.engineBAC=e.sent;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateEngineBAC",value:function(e){e&&(this.engineBAC={codec:i(i({},this.engineBAC.codec),e.codec),adm:i(i({},this.engineBAC.adm),e.adm)},this.setAEC(!!e.aec),this.setAGC(!!e.agc),this.setANS(!!e.ans))}},{key:"updateEngineANM",value:function(e){e&&(this.engineANM=e)}},{key:"setAudioProfile",value:function(e){var t,r,n;switch(e){case Q.fluent:r=16e3,t=24e3;break;case Q.standard:r=48e3,t=48e3;break;case Q.hd:r=48e3,t=128e3,n=2;break;case Q.standardStereo:r=48e3,t=8e4,n=2;break;case Q.hdMono:r=48e3,t=128e3}t&&(this.bitrate=t),n&&(this.channel=n),r&&(this.sampleRate=r)}},{key:"setBitrate",value:function(e){e>128e3&&(e=128e3),this.bitrate=e}},{key:"setAEC",value:function(e){this.aec=e}},{key:"setAGC",value:function(e){this.agc=e}},{key:"setANS",value:function(e){this.ans=e}},{key:"getOpusConfigStr",value:function(){var e=";",t=this.config;return t.bitrate&&(e+="maxaveragebitrate=".concat(t.bitrate,";")),t.encSampleRate&&(e+="sprop-maxcapturerate=".concat(t.encSampleRate,";")),t.playbackRate&&(e+="maxplaybackrate=".concat(t.playbackRate,";")),t.encChannel&&t.encChannel>1&&(e+="sprop-stereo=1;"),t.playChannel&&t.playChannel>1&&(e+="stereo=1;"),e.slice(0,-1)}},{key:"config",get:function(){var e,t,r,n,i,o,a,s,u,c,d,l,h,f,p,v,_;return{bitrate:this.bitrate||(null===(e=this.engineANM.enc_param)||void 0===e?void 0:e.bitrate)||0,playChannel:(null===(t=this.engineBAC.adm)||void 0===t||null===(r=t.play)||void 0===r?void 0:r.chn)||1,encChannel:this.channel||(null===(n=this.engineANM)||void 0===n||null===(i=n.enc_param)||void 0===i?void 0:i.chn)||(null===(o=this.engineBAC.adm)||void 0===o||null===(a=o.record)||void 0===a?void 0:a.chn),channel:this.channel||(null===(s=this.engineBAC.adm)||void 0===s||null===(u=s.record)||void 0===u?void 0:u.chn),aec:this.aec,agc:this.agc,ans:this.ans,encSampleRate:this.sampleRate||(null===(c=this.engineBAC.codec)||void 0===c?void 0:c.enc_fs)||(null===(d=this.engineANM.enc_param)||void 0===d?void 0:d.sr)||(null===(l=this.engineBAC.adm)||void 0===l||null===(h=l.record)||void 0===h?void 0:h.sr),sampleRate:this.sampleRate||(null===(f=this.engineBAC.adm)||void 0===f||null===(p=f.record)||void 0===p?void 0:p.sr),playbackRate:null===(v=this.engineBAC.adm)||void 0===v||null===(_=v.play)||void 0===_?void 0:_.sr}}}]),e}(),k$=new ML("VideoSnapshot",1),T$=function(e){var t=null==e?void 0:e.domElement;if(t&&!t.paused&&4===t.readyState)return t},I$=function(){var e=u(o().mark((function e(t,r,n){var i,a,s,u,c,d,l,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=document.createElement("canvas"),a=i.getContext("2d")){e.next=4;break}throw new Error("canvas.getContext error");case 4:if(s=function(e,t,n){return t=t||e.width,n=n||e.height,i.width=t,i.height=n,r?a.setTransform(-1,0,0,1,t,0):a.setTransform(1,0,0,1,0,0),a.drawImage(e,0,0,t,n),a.getImageData(0,0,t,n)},u=Date.now(),!(c=T$(n))){e.next=16;break}return k$.print("takeSnapshot","VideoPlayer already set."),e.next=11,s(c,c.videoWidth,c.videoHeight);case 11:return d=e.sent,k$.print("takeSnapshot","success, cost ".concat(Date.now()-u,"ms")),e.abrupt("return",d);case 16:if(!window.ImageCapture){e.next=29;break}if("live"!==(l=new window.ImageCapture(t)).track.readyState||!l.track.enabled||l.track.muted){e.next=29;break}return k$.print("takeSnapshot","use ImageCapture"),e.t0=s,e.next=23,l.grabFrame();case 23:return e.t1=e.sent,e.next=26,(0,e.t0)(e.t1);case 26:return h=e.sent,k$.print("takeSnapshot","success, cost ".concat(Date.now()-u,"ms")),e.abrupt("return",h);case 29:return k$.print("takeSnapshot","use temp video"),e.abrupt("return",new Promise((function(e,r){var n=new MediaStream([t]),i=document.createElement("video");i.setAttribute("playsinline",""),i.muted=!0,document.body.appendChild(i),i.onplaying=function(){var r=s(i,i.videoWidth,i.videoHeight);k$.print("takeSnapshot","success, cost ".concat(Date.now()-u,"ms")),e(r),n.removeTrack(t),i.srcObject=null,i.load()},i.onerror=r,i.srcObject=n,i.play()})));case 31:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),R$=new WeakMap,A$=function(e,t,r){var n;if(requestAnimationFrame){var i=R$.get(e);null!==(n=i)&&void 0!==n&&n[t]?w$(e,t):i||(i={},R$.set(e,i));var o=e[t];!function n(){var a=requestAnimationFrame(n);i[t]=a;var s=e[t];o!==s&&(o=s,r(s))}()}},w$=function(e,t){var r=R$.get(e);t&&r[t]?cancelAnimationFrame(r[t]):Object.keys(r).length&&Object.keys(r).forEach((function(e){cancelAnimationFrame(r[e])}))},C$=Object.defineProperty,O$=Object.getOwnPropertyDescriptor,x$=function(e,t,r,n){for(var i,o=n>1?void 0:n?O$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(n?i(t,r,o):i(o))||o);return n&&o&&C$(t,r,o),o},N$=new ML("Engine",0),D$=function(e){f(Fe,e);var t,r,n,a,s,d,v,_,y,S,k,T,I,R,A,O,x,N,M,L,G,H,z,q,W,Y,Q,$,ee,re,ne,oe,ae,se,ue,ce,de,le,he,fe,pe,ve,_e,me,ye,ge,Se,be,Ee,ke,Te,Ie,Re,Ae,we,Ce,Oe,xe,Ne,De,Pe,Me,Le,Ue,Ve=g(Fe);function Fe(e,t){var r;return c(this,Fe),h(m(r=Ve.call(this)),"_room",void 0),h(m(r),"_outsideRoom",void 0),h(m(r),"_appId",void 0),h(m(r),"_businessId",void 0),h(m(r),"_visibility",!0),h(m(r),"_localVideoTrack",void 0),h(m(r),"_localAudioTrack",void 0),h(m(r),"_localImgVideoTrack",void 0),h(m(r),"_localImgScreenTrack",void 0),h(m(r),"_localScreenVideoTrack",void 0),h(m(r),"_localScreenAudioTrack",void 0),h(m(r),"_tempMixingAudioTrack",void 0),h(m(r),"_audioPlaybackDeviceId",void 0),h(m(r),"_videoPlayer",void 0),h(m(r),"_screenPlayer",void 0),h(m(r),"_remoteVideoPlayer",new Map),h(m(r),"_remoteScreenPlayer",new Map),h(m(r),"_remoteAudioPlayer",new Map),h(m(r),"_publicStreamAudioPlayer",new Map),h(m(r),"_publicStreamVideoPlayer",new Map),h(m(r),"_publicStreamIds",new Map),h(m(r),"_roomConfig",void 0),h(m(r),"_videoStreamConstraints",{}),h(m(r),"_audioStreamConstraints",{}),h(m(r),"_enableSimulcast",!1),h(m(r),"_videoStreamEncodeConfig",[YB]),h(m(r),"_screenStreamEncodeConfig",[JB]),h(m(r),"_trackSourceType",void 0),h(m(r),"_liveTranscodeConfig",void 0),h(m(r),"_useCloudProxy",void 0),h(m(r),"_startCloudProxyTimestamp",void 0),h(m(r),"_localVideoDeviceId",void 0),h(m(r),"_localAudioDeviceId",void 0),h(m(r),"_pauseAllSubscribeState",{audio:!1,video:!1}),h(m(r),"_audioVolumeIndicationTimer",void 0),h(m(r),"_dummyMainTimer",void 0),h(m(r),"_dummyScreenTimer",void 0),h(m(r),"_audioPropertiesReportTimer",null),h(m(r),"_mirrorType",j.MIRROR_TYPE_RENDER),h(m(r),"_audioMixingManager",void 0),h(m(r),"_pubLock",void 0),h(m(r),"_rtmClient",void 0),h(m(r),"_messageStatisticsObserver",void 0),h(m(r),"_tempRoomConfig",void 0),h(m(r),"_originIceConfigRequestUrls",void 0),h(m(r),"_originConfigServerUrls",void 0),h(m(r),"_originLogServerUrl",void 0),h(m(r),"_extensionManager",new SH),h(m(r),"_audioDeviceManager",new b$(r._extensionManager)),h(m(r),"_audioProfileManager",new E$),h(m(r),"_remoteVideoConfig",new Map),h(m(r),"_userPriorityMap",new Map),h(m(r),"_subscribeFallbackOption",X.DISABLE),h(m(r),"_cameraCapturing",!1),h(m(r),"_interruptCameraCapture",!1),h(m(r),"_micCapturing",!1),h(m(r),"_interruptMicCapture",!1),h(m(r),"_config",void 0),h(m(r),"_updateMixAudioTrack",function(){var e=u(o().mark((function e(t){var n,i,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>1&&void 0!==a[1]?a[1]:te.PLAYOUT_AND_PUBLISH,N$.print("_updateMixAudioTrack()"),r._localAudioTrack){e.next=5;break}return t&&(r._tempMixingAudioTrack={track:t,type:i}),e.abrupt("return");case 5:if(t?(r._localAudioTrack.mixType=i,r._localAudioTrack.mixedAudioTrack=t):(delete r._localAudioTrack.mixType,delete r._localAudioTrack.mixedAudioTrack),null===(n=r._room)||void 0===n||!n.hasPublished){e.next=9;break}return e.next=9,r._updatePublish();case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),h(m(r),"_onAudioMixingMessage",(function(e){r.safeEmit(ie.onAudioMixingStateChanged,e)})),h(m(r),"_onAudioMixingAutoplayFailed",(function(){r.safeEmit(ie.onAutoplayFailed,{})})),r._appId=e,r._pubLock=new jz("pubLock"),r._addDeviceEventHandler(),r._audioMixingManager=new v$({getLocalAudioTrack:function(){return r._localAudioTrack},updateLocalAudioTrack:r._updateMixAudioTrack,emitMessage:r._onAudioMixingMessage,onAutoPlayFailed:r._onAudioMixingAutoplayFailed}),window.__rtc_engine__=m(r),window["__rtc_engine__".concat(Math.floor(100*Math.random()+1))]=m(r),r._trackSourceType={video:w.VIDEO_SOURCE_TYPE_INTERNAL,screenVideo:w.VIDEO_SOURCE_TYPE_INTERNAL,audio:C.AUDIO_SOURCE_TYPE_INTERNAL,screenAudio:C.AUDIO_SOURCE_TYPE_INTERNAL},r._config=t,r._rtmClient=new y$(e),r._handleRTMClient(r._rtmClient),r._useCloudProxy=!1,r._handleAudioDeviceManager(),r._messageStatisticsObserver=new SW,r._extensionManager.setMinotor(gB),r}return l(Fe,[{key:"appId",get:function(){return this._appId},set:function(e){this._appId=e}},{key:"updateToken",value:(Ue=u(o().mark((function e(t){var r,n,i,a,s,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("updateToken()","token: %s",t),DP(t,"token"),!(this.waitForNewToken&&null!==(r=this._room)&&void 0!==r&&r._roomInfo&&this._tempRoomConfig)){e.next=9;break}return a=null===(i=this._room)||void 0===i?void 0:i._roomInfo,s=a.roomId,u=a.userInfo,c=this._tempRoomConfig,delete this._tempRoomConfig,e.next=8,this.joinRoom(t,s,u,c);case 8:return e.abrupt("return",e.sent);case 9:if(this._room){e.next=11;break}throw new ZN(JN.UPDATE_TOKEN_BEFORE_JOIN,"update token before join room");case 11:return e.next=13,null===(n=this._room)||void 0===n?void 0:n.updateToken(t);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return Ue.apply(this,arguments)})},{key:"setVideoCaptureDevice",value:(Le=u(o().mark((function e(t){var r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setVideoCaptureDevice()","deviceId: %s",t),DP(t,"deviceId"),this._localVideoDeviceId=t,this._localVideoTrack){e.next=5;break}return e.abrupt("return");case 5:return n=this._videoStreamConstraints,"user"===t||"environment"===t||"left"===t||"right"===t?(delete n.deviceId,n.facingMode=t):n.deviceId={exact:t},this._videoStreamConstraints=n,e.next=10,GH(n,this._extensionManager);case 10:if(i=e.sent,this._initLocalTrackEvents(i),this._localVideoTrack.close(),this._localVideoTrack=i,null!==(r=this._videoPlayer)&&void 0!==r&&r.played&&(this._videoPlayer.stop(),this._videoPlayer.playVideo(i),this._videoPlayer.mirror(!!this._mirrorType)),this._room){e.next=17;break}return e.abrupt("return");case 17:if(!this._room.hasPublished){e.next=20;break}return e.next=20,this._updatePublish();case 20:case"end":return e.stop()}}),e,this)}))),function(e){return Le.apply(this,arguments)})},{key:"setAudioCaptureDevice",value:(Me=u(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setAudioCaptureDevice()","deviceId: %s",t),DP(t,"deviceId"),this._localAudioDeviceId=t,this._localAudioTrack){e.next=5;break}return e.abrupt("return");case 5:return(r=this._audioStreamConstraints).deviceId={exact:t},this._audioStreamConstraints=r,this._localAudioTrack.close(),e.next=11,zH(r,this._extensionManager,this._audioProfileManager);case 11:if(n=e.sent,this._initLocalTrackEvents(n),this._localAudioTrack=n,this._room){e.next=16;break}return e.abrupt("return");case 16:if(!this._room.hasPublished){e.next=19;break}return e.next=19,this._updatePublish();case 19:case"end":return e.stop()}}),e,this)}))),function(e){return Me.apply(this,arguments)})},{key:"_addDeviceEventHandler",value:function(){vH.on(ie.onVideoDeviceStateChanged,this._onVideoDeviceStateChange.bind(this)),vH.on(ie.onAudioDeviceStateChanged,this._onAudioDeviceStateChange.bind(this))}},{key:"_addHandlerEventHandler",value:function(){var e,t,r,n,i,o,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E,k,T,I,R,A,w,C=this;null===(e=this._room)||void 0===e||e.on($B.ON_ADD_STREAM,this._onAddStream.bind(this)),null===(t=this._room)||void 0===t||t.on($B.ON_REMOVE_STREAM,this._onRemoveStream.bind(this)),null===(r=this._room)||void 0===r||r.on($B.USER_CONNECTION,this._onUserConnection.bind(this)),null===(n=this._room)||void 0===n||n.on(gz.ON_USER_LEAVE,this._onUserLeave.bind(this)),null===(i=this._room)||void 0===i||i.on(gz.ON_ROOM_ERROR,this._onRoomError.bind(this)),null===(o=this._room)||void 0===o||o.on(gz.ON_NETWORK_QUALITY,this._onNetworkQuality.bind(this)),null===(a=this._room)||void 0===a||a.on($B.ON_CUSTOM_MESSAGE,this._onCustomMessage.bind(this)),null===(s=this._room)||void 0===s||s.on($B.USER_MESSAGE_RECEIVED,this._onUserMessageReceived.bind(this)),null===(u=this._room)||void 0===u||u.on($B.USER_BINARY_MESSAGE_RECEIVED,this._onUserBinaryMessageReceived.bind(this)),null===(c=this._room)||void 0===c||c.on($B.ON_USER_TOKEN_WILL_EXPIRE,this._onUserTokenWillExpire.bind(this)),null===(d=this._room)||void 0===d||d.on($B.POST_PROCESSING_MESSAGE,(function(e){"2.0"===e.protocol?C._onStreamMixingEvent({error:e.error,event:e.eventType,message:e.message}):"publicStreamCallback"===e.type?C._onPushPublicStreamResult(e):"transcodeStatusCallback"===e.type&&C._onLiveTranscodingResult(e)})),null===(l=this._room)||void 0===l||l.on(tj.ON_CONNECTION_STATE_CHANGE,this._onConnectionStateChange.bind(this)),null===(h=this._room)||void 0===h||h.on(gz.RESUBSCRIBE,this._onResubscribe.bind(this)),null===(f=this._room)||void 0===f||f.on(gz.SUBSCRIBE_PUSH_TRACK,this._onSubscribePushTrack.bind(this)),null===(p=this._room)||void 0===p||p.on(gz.REMOVE_PUSH_TRACK,this._onRemovePushTrack.bind(this)),null===(v=this._room)||void 0===v||v.on(gz.ON_PUBLISH_RESULT,(function(e){var t;null!==(t=C._room)&&void 0!==t&&t._roomConfig.isAutoPublish&&C.safeEmit(ie.onAutoPublishResult,e)})),null===(_=this._room)||void 0===_||_.on(gz.ON_REMOTE_STREAM_STATS,(function(e){C.safeEmit(ie.onRemoteStreamStats,e)})),null===(m=this._room)||void 0===m||m.on(gz.ON_LOCAL_STREAM_STATS,(function(e){C.safeEmit(ie.onLocalStreamStats,e)})),null===(y=this._room)||void 0===y||y.on(gz.ON_USER_PUBLISH_STATE_CHANGE,this._onUserPublishStateChange.bind(this)),null===(g=this._room)||void 0===g||g.on(gz.ON_USER_START_AUDIO_CAPTURE,(function(e,t){var r=e.userId;C._updateAudioPlayerState(t),C.safeEmit(ie.onUserStartAudioCapture,{userId:r})})),null===(S=this._room)||void 0===S||S.on(gz.ON_USER_STOP_AUDIO_CAPTURE,(function(e){var t=e.userId;C.safeEmit(ie.onUserStopAudioCapture,{userId:t})})),null===(b=this._room)||void 0===b||b.on(gz.ON_USER_START_VIDEO_CAPTURE,(function(e){var t=e.userId;C.safeEmit(ie.onUserStartVideoCapture,{userId:t})})),null===(E=this._room)||void 0===E||E.on(gz.ON_USER_STOP_VIDEO_CAPTURE,(function(e){var t=e.userId;C.safeEmit(ie.onUserStopVideoCapture,{userId:t})})),null===(k=this._room)||void 0===k||k.on(gz.ON_SEI_MESSAGED_RECEIVED,(function(e){C.safeEmit(ie.onSEIMessageReceived,e)})),null===(T=this._room)||void 0===T||T.on(gz.ON_REMOTE_VIDEO_SIZE_CHANGED,(function(e,t){C.safeEmit(ie.onRemoteVideoSizeChanged,e,t)})),null===(I=this._room)||void 0===I||I.on(gz.ON_SIMULCAST_SUBSCRIBE_FALLBACK,(function(e){return C.safeEmit(ie.onSimulcastSubscribeFallback,e)})),null===(R=this._room)||void 0===R||R.on(gz.RECONNECT_FAILED,(function(){C.safeEmit(ie.onError,{errorCode:JN.RECONNECT_FAILED})})),null===(A=this._room)||void 0===A||A.on(gz.ON_VIDEO_STREAM_BANNED,(function(e){C.safeEmit(ie.onVideoStreamBanned,{uid:e.uid,banned:e.banned})})),null===(w=this._room)||void 0===w||w.on(gz.ON_AUDIO_STREAM_BANNED,(function(e){C.safeEmit(ie.onAudioStreamBanned,{uid:e.uid,banned:e.banned})}))}},{key:"safeEmit",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return WP(e)&&AB(e,kP(n)),(t=b(p(Fe.prototype),"safeEmit",this)).call.apply(t,[this,e].concat(n))}},{key:"_removeHandlerEventHandler",value:function(){var e;null===(e=this._room)||void 0===e||e.removeAllListeners()}},{key:"joinRoom",value:(Pe=u(o().mark((function e(t,r,n,a){var s,u,c,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("joinRoom()","token: %o roomId: %o, userInfo: %o, roomConfig: %o",t,r,n,a),BP(t)||DP(t,"token"),jP(r),zP(n),s={isAutoPublish:!0,isAutoSubscribeAudio:!0,isAutoSubscribeVideo:!0,roomProfileType:J.communication},HY(s,a),qP(s),!this._room||this._room.connectionState===Wz.DISCONNECTED){e.next=11;break}throw new ZN(JN.REPEAT_JOIN,"Already joined");case 11:return this._room=new cW(a,{audioProfileManager:this._audioProfileManager,streamRTT:{}}),this._room.userPriorityMap=this._userPriorityMap,this._room.subscribeFallbackOption=this._subscribeFallbackOption,this._addHandlerEventHandler(),u=this._liveTranscodeConfig&&qB("started",this._liveTranscodeConfig),e.prev=16,this._useCloudProxy&&(this._startCloudProxyTimestamp=Date.now()),e.next=20,this._room.join(this._appId,r,t,i(i({},n),{},{businessId:this._businessId,role:this._visibility?_$.NORMAL_USER:_$.SILENT_USER}),u,this._useCloudProxy,null===(c=this._config)||void 0===c?void 0:c.expectedIDC);case 20:return d=e.sent,this._roomConfig=a,this._tempRoomConfig&&delete this._tempRoomConfig,null!=a&&a.isAutoPublish&&(this._visibility?this._updatePublish({invokeByJoinRoom:!0,mediaType:V.AUDIO_AND_VIDEO}):this.safeEmit(ie.onAutoPublishResult,{isScreen:!1,state:P.PUBLISH_FAIL})),e.abrupt("return",d);case 27:throw e.prev=27,e.t0=e.catch(16),e.t0.code===JN.INVALID_TOKEN&&(this._tempRoomConfig=a),e.t0;case 31:case"end":return e.stop()}}),e,this,[[16,27]])}))),function(e,t,r,n){return Pe.apply(this,arguments)})},{key:"leaveRoom",value:(De=u(o().mark((function e(){var t,r,n,i=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]&&i[0],N$.print("leaveRoom()"),!t){e.next=7;break}return e.next=5,null===(r=this._room)||void 0===r?void 0:r.leave(t);case 5:e.next=8;break;case 7:null===(n=this._room)||void 0===n||n.leave(t).catch();case 8:this._removeHandlerEventHandler(),this._liveTranscodeConfig&&this.stopLiveTranscoding(),this._room=void 0,this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new Map,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new Map,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new Map,this._roomConfig=void 0,this._publicStreamIds=new Map;case 19:case"end":return e.stop()}}),e,this)}))),function(){return De.apply(this,arguments)})},{key:"destroy",value:function(){var e,t,r;N$.print("destroy()"),this.removeAllListeners(),this._removeHandlerEventHandler(),null===(e=this._room)||void 0===e||e.destroy(),this._room=void 0,null===(t=this._videoPlayer)||void 0===t||t.destroy(),this._videoPlayer=void 0,this._screenPlayer=void 0,this._videoStreamConstraints={},this._audioStreamConstraints={},this._videoStreamEncodeConfig=[YB],this._screenStreamEncodeConfig=[JB],this._pauseAllSubscribeState={audio:!1,video:!1},this._messageStatisticsObserver.destroy(),clearInterval(this._audioVolumeIndicationTimer),clearInterval(this._dummyMainTimer),clearInterval(this._dummyScreenTimer),this._audioVolumeIndicationTimer=void 0,this._stopAudioPropertiesReport(),this._localAudioTrack&&(this._localAudioTrack.close(),this._localAudioTrack=void 0),this._localVideoTrack&&(this._localVideoTrack.close(),this._localVideoTrack=void 0),this._localScreenAudioTrack&&(this._localScreenAudioTrack.close(),this._localScreenAudioTrack=void 0),this._localScreenVideoTrack&&(this._localScreenVideoTrack.close(),this._localScreenVideoTrack=void 0),this._localImgVideoTrack&&(this._localImgVideoTrack.stop(),this._localImgVideoTrack=void 0),this._localImgScreenTrack&&(this._localImgScreenTrack.stop(),this._localImgScreenTrack=void 0),this._remoteAudioPlayer.forEach((function(e){return e.destroy()})),this._remoteAudioPlayer=new Map,this._remoteScreenPlayer.forEach((function(e){return e.destroy()})),this._remoteScreenPlayer=new Map,this._remoteVideoPlayer.forEach((function(e){return e.destroy()})),this._remoteVideoPlayer=new Map,this._publicStreamAudioPlayer.forEach((function(e){return e.destroy()})),this._publicStreamAudioPlayer=new Map,this._publicStreamVideoPlayer.forEach((function(e){return e.destroy()})),this._publicStreamVideoPlayer=new Map,this._roomConfig=void 0,this._audioMixingManager.destroy(),this._rtmClient.destroy(),null===(r=this._outsideRoom)||void 0===r||r.destroy(),this._publicStreamIds=new Map,this._audioDeviceManager.destroy(),this._remoteVideoConfig=new Map,this._userPriorityMap.clear(),this._extensionManager.destroy(),this._cameraCapturing=!1,this._micCapturing=!1,this._interruptCameraCapture=!1,this._interruptMicCapture=!1}},{key:"publishStream",value:(Ne=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("publishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!wP(t)||this._localVideoTrack||!this._localImgVideoTrack){e.next=7;break}return e.next=6,VH(this._localImgVideoTrack,this._extensionManager);case 6:this._localVideoTrack=e.sent;case 7:return e.next=9,this._updatePublish({mediaType:t});case 9:case"end":return e.stop()}}),e,this)}))),function(e){return Ne.apply(this,arguments)})},{key:"unpublishStream",value:(xe=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("unpublishStream()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),!r){e.next=5;break}return e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.unpublish());case 5:return e.next=7,this._updatePublish({mediaType:t,pubState:bz.UNPUB});case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return xe.apply(this,arguments)})},{key:"publishScreen",value:(Oe=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("publishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.prev=3,!wP(t)||this._localScreenVideoTrack||!this._localImgScreenTrack){e.next=8;break}return e.next=7,BH(this._localImgScreenTrack,this._extensionManager);case 7:this._localScreenVideoTrack=e.sent;case 8:return e.next=10,this._updateScreenPublish({mediaType:t,pubState:bz.PUB});case 10:e.next=19;break;case 12:if(e.prev=12,e.t0=e.catch(3),!(e.t0 instanceof ZN)){e.next=18;break}throw e.t0;case 18:throw new ZN(JN.UNEXPECTED_ERROR,"unexpected error",e.t0);case 19:case"end":return e.stop()}}),e,this,[[3,12]])}))),function(e){return Oe.apply(this,arguments)})},{key:"unpublishScreen",value:(Ce=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("unpublishScreen()","mediaType: %o",t),this._checkMediaType(t),this._assertNotInRoom(),e.next=5,this._updateScreenPublish({mediaType:t,pubState:bz.UNPUB});case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Ce.apply(this,arguments)})},{key:"subscribeStream",value:(we=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("subscribeStream()","userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!1,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return we.apply(this,arguments)})},{key:"_subscribe",value:(Ae=u(o().mark((function e(t,r,n){var i,a,s,u,c,d,l,h,f,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._checkMediaType(n),this._assertNotInRoom(),u=this._room.remoteStreams.get(r),c=null==u?void 0:u.find((function(e){return e.isScreen===t}))){e.next=6;break}throw new ZN(JN.STREAM_NOT_EXIST,"stream not exist");case 6:return this._pauseAllSubscribeState.audio&&(n-=n&V.AUDIO),this._pauseAllSubscribeState.video&&(n-=n&V.VIDEO),N$.print("subscribeStream()","due to pauseAll mediaType: %o",n),d=c.hasSubscribed,l=this._remoteVideoConfig.get(r)||(null===(i=this._roomConfig)||void 0===i?void 0:i.remoteVideoConfig),c.originalMediaType=n,e.next=14,this._room.subscribe(c,n,l);case 14:AP(n)&&this._updateAudioPlayerState(c),wP(n)&&this._updateVideoPlayerState(c),!t&&(null!==(a=this._roomConfig)&&void 0!==a&&a.isAutoSubscribeAudio||null!==(s=this._roomConfig)&&void 0!==s&&s.isAutoSubscribeVideo)&&(c.audioTrack||c.videoTrack)&&(h={userId:r,isScreen:!1,state:D.SUBSCRIBE_SUCC},this.safeEmit(ie.onAutoSubscribeResult,h)),!d&&AP(n)&&c.hasAudio&&(null===(f=c.observer)||void 0===f||f.setSubscribeAudio(!0)),!d&&wP(n)&&c.hasVideo&&(null===(p=c.observer)||void 0===p||p.setSubscribeVideo(!0));case 19:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return Ae.apply(this,arguments)})},{key:"unsubscribeStream",value:(Re=u(o().mark((function e(t,r){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("unsubscribeStream()","userId: %o, mediaType: %o",t,r),this._checkMediaType(r),this._assertNotInRoom(),n=this._room.remoteStreams.get(t),null!=(i=null==n?void 0:n.find((function(e){return!e.isScreen})))&&i.hasSubscribed){e.next=7;break}throw new ZN(JN.STREAM_NOT_EXIST,"stream not exist");case 7:this._room.unsubscribe(i,r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return Re.apply(this,arguments)})},{key:"subscribeScreen",value:(Ie=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("subscribeScreen() userId: %o, mediaType: %o",t,r),e.abrupt("return",this._subscribe(!0,t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return Ie.apply(this,arguments)})},{key:"unsubscribeScreen",value:(Te=u(o().mark((function e(t,r){var n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("unsubscribeScreen() userId: %o, mediaType: %o",t,r),this._checkMediaType(r),this._assertNotInRoom(),n=this._room.remoteStreams.get(t),null!=(i=null==n?void 0:n.find((function(e){return e.isScreen})))&&i.hasSubscribed){e.next=7;break}throw new ZN(JN.STREAM_NOT_EXIST,"stream not exist");case 7:this._room.unsubscribe(i,r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return Te.apply(this,arguments)})},{key:"setRemoteVideoConfig",value:(ke=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("setRemoteVideoConfig() userId: %o, remoteVideoConfig: %o",t,r),GP(t),YP(r),this._remoteVideoConfig.set(t,r),e.abrupt("return",null===(n=this._room)||void 0===n?void 0:n.updateSubVideoConfig(t,r).then((function(){})));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t){return ke.apply(this,arguments)})},{key:"startVideoCapture",value:(Ee=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l,h=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("startVideoCapture()","deviceId: %s",t),BP(t)||DP(t,"deviceId"),t=t||this._localVideoDeviceId,this._localVideoDeviceId=t,!(this._cameraCapturing||this._localVideoTrack&&!this._localVideoTrack.dummy)){e.next=6;break}throw new ZN(JN.REPEAT_CAPTURE,"Has already capture");case 6:return i=this._videoStreamConstraints,t&&("user"===t||"environment"===t||"left"===t||"right"===t?i.facingMode=t:i.deviceId={exact:t},this._videoStreamConstraints=i),a={},e.prev=9,this._cameraCapturing=!0,e.next=13,GH(i,this._extensionManager);case 13:if(u=e.sent,!this._interruptCameraCapture){e.next=18;break}throw this._interruptCameraCapture=!1,u.close(),new ZN(JN.INTERRUPT,"interrupt by stopVideoCapture");case 18:this._initLocalTrackEvents(u),this._localVideoTrack=u,null===(s=this._videoPlayer)||void 0===s||s.playVideo(u),(c=null==u?void 0:u.getTrack())&&(a=c.getSettings(),d={width:a.width,height:a.height},this._localVideoTrack.resolution=d,setTimeout((function(){return h.safeEmit(ie.onLocalVideoSizeChanged,{streamIndex:U.STREAM_INDEX_MAIN,info:d})})));case 23:return e.prev=23,this._cameraCapturing=!1,e.finish(23);case 26:if(this._room){e.next=28;break}return e.abrupt("return",a);case 28:return l=this._room._roomConfig.isAutoPublish,(this._room.hasPublished||l)&&(this._visibility?this._updatePublish():this.safeEmit(ie.onAutoPublishResult,{isScreen:!1,state:P.PUBLISH_FAIL})),null===(r=this._room.localStream)||void 0===r||null===(n=r.observer)||void 0===n||n.setEnableVideo(!0),e.abrupt("return",a);case 32:case"end":return e.stop()}}),e,this,[[9,,23,26]])}))),function(e){return Ee.apply(this,arguments)})},{key:"stopVideoCapture",value:(be=u(o().mark((function e(){var t,r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("stopVideoCapture()"),!this._cameraCapturing){e.next=5;break}return this._interruptCameraCapture=!0,N$.print("stopVideoCapture()","capturing"),e.abrupt("return");case 5:if(this._trackSourceType.video!==w.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 7:if(null===(t=this._videoPlayer)||void 0===t||t.stop(),this._localVideoTrack&&(this._localVideoTrack.dummy||(this._localVideoTrack.close(),this._localImgVideoTrack?(null===(i=this._localVideoTrack)||void 0===i||i.setTrack(this._localImgVideoTrack,this._extensionManager),this._localVideoTrack.dummy=!0):this._localVideoTrack=void 0)),this._room){e.next=11;break}return e.abrupt("return");case 11:if(!this._room.hasPublished){e.next=14;break}return e.next=14,this._updatePublish();case 14:null===(r=this._room.localStream)||void 0===r||null===(n=r.observer)||void 0===n||n.setEnableVideo(!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return be.apply(this,arguments)})},{key:"startAudioCapture",value:(Se=u(o().mark((function e(t){var r,n,i,a,s;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("startAudioCapture()","deviceId: $o",t),BP(t)||DP(t,"deviceId"),t=t||this._localAudioDeviceId,this._localAudioDeviceId=t,!this._micCapturing&&!this._localAudioTrack){e.next=6;break}throw new ZN(JN.REPEAT_CAPTURE,"Has already capture");case 6:return i=this._audioStreamConstraints,t&&(i.deviceId={exact:t},this._audioStreamConstraints=i),e.prev=8,this._micCapturing=!0,e.next=12,zH(i,this._extensionManager,this._audioProfileManager);case 12:if(a=e.sent,!this._interruptMicCapture){e.next=17;break}throw this._interruptMicCapture=!1,a.close(),new ZN(JN.INTERRUPT,"interrupt by stopAudioCapture");case 17:this._initLocalTrackEvents(a),this._localAudioTrack=a,this._tempMixingAudioTrack&&(this._localAudioTrack.mixType=this._tempMixingAudioTrack.type,this._localAudioTrack.mixedAudioTrack=this._tempMixingAudioTrack.track,delete this._tempMixingAudioTrack);case 20:return e.prev=20,this._micCapturing=!1,e.finish(20);case 23:if(this._room){e.next=25;break}return e.abrupt("return");case 25:s=this._room._roomConfig.isAutoPublish,(this._room.hasPublished||s)&&(this._visibility?this._updatePublish():this.safeEmit(ie.onAutoPublishResult,{isScreen:!1,state:P.PUBLISH_FAIL})),null===(r=this._room.localStream)||void 0===r||null===(n=r.observer)||void 0===n||n.setEnableAudio(!0);case 28:case"end":return e.stop()}}),e,this,[[8,,20,23]])}))),function(e){return Se.apply(this,arguments)})},{key:"stopAudioCapture",value:(ge=u(o().mark((function e(){var t,r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("stopAudioCapture()"),!this._micCapturing){e.next=5;break}return this._interruptMicCapture=!0,N$.print("stopAudioCapture()","capturing"),e.abrupt("return");case 5:if(null===(t=this._localAudioTrack)||void 0===t||t.close(),this._localAudioTrack=void 0,this._audioMixingManager.stopAll(),this._trackSourceType.audio!==C.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=10;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 10:if(this._room){e.next=12;break}return e.abrupt("return");case 12:if(!this._room.hasPublished){e.next=15;break}return e.next=15,this._updatePublish();case 15:null===(r=this._room.localStream)||void 0===r||null===(n=r.observer)||void 0===n||n.setEnableAudio(!1);case 16:case"end":return e.stop()}}),e,this)}))),function(){return ge.apply(this,arguments)})},{key:"getAudioMixingManager",value:function(){return N$.print("getAudioMixingManager()"),this._audioMixingManager}},{key:"startScreenCapture",value:(ye=u(o().mark((function e(){var t,r,n,i,a,s,u,c,d,l,h,f,p,v,_,m=this,y=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=y.length>0&&void 0!==y[0]?y[0]:{},N$.print("startScreenCapture()","config: %o",a),s=a.enableAudio,u=void 0!==s&&s,this._trackSourceType.screenVideo!==w.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=5;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as internal first");case 5:if(this._trackSourceType.screenAudio!==C.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=7;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as internal first");case 7:return e.next=9,XH(u,this._extensionManager,this._screenStreamEncodeConfig[0]);case 9:if(c=e.sent,d=E(c,2),l=d[0],h=d[1],this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&this._localScreenVideoTrack.close(),null===(t=this._localScreenAudioTrack)||void 0===t||t.close(),this._localScreenVideoTrack=l,null!==(r=this._screenStreamEncodeConfig[0])&&void 0!==r&&r.contentHint&&l.setContentHint(null===(f=this._screenStreamEncodeConfig[0])||void 0===f?void 0:f.contentHint),(p=null==l?void 0:l.getTrack())&&(v=p.getSettings(),_={width:v.width,height:v.height},l.resolution=_,setTimeout((function(){return m.safeEmit(ie.onLocalVideoSizeChanged,{streamIndex:U.STREAM_INDEX_SCREEN,info:{width:v.width,height:v.height}})}))),h&&(this._localScreenAudioTrack=h,this._initLocalTrackEvents(h)),null===(n=this._screenPlayer)||void 0===n||n.playVideo(this._localScreenVideoTrack),this._initLocalTrackEvents(this._localScreenVideoTrack,!0),null===(i=this._room)||void 0===i||!i.hasScreenPublished){e.next=25;break}return e.next=25,this._updateScreenPublish();case 25:case"end":return e.stop()}}),e,this)}))),function(){return ye.apply(this,arguments)})},{key:"stopScreenCapture",value:(me=u(o().mark((function e(){var t,r,n,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("stopScreenCapture()"),null===(t=this._screenPlayer)||void 0===t||t.stop(),this._localScreenVideoTrack&&(this._localScreenVideoTrack.dummy||(this._localScreenVideoTrack.close(),this._localImgScreenTrack&&(null===(i=this._localScreenVideoTrack)||void 0===i||i.setTrack(this._localImgScreenTrack,this._extensionManager),this._localScreenVideoTrack.dummy=!0))),null===(r=this._localScreenAudioTrack)||void 0===r||r.close(),this._localScreenAudioTrack=void 0,null===(n=this._room)||void 0===n||!n.hasScreenPublished){e.next=8;break}return e.next=8,this._updateScreenPublish();case 8:case"end":return e.stop()}}),e,this)}))),function(){return me.apply(this,arguments)})},{key:"setLocalVideoPlayer",value:function(e,t){if(N$.print("setLocalVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),PP(e,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),t&&t.renderDom){var r,n,o=i(i({userId:this._getUserId()},t),{},{isLocal:!0});if(XP(o),e===U.STREAM_INDEX_MAIN&&!this._videoPlayer)return this._videoPlayer=new yW(o),this._initPlayerEvents(this._videoPlayer,!1,e),this._videoPlayer.mirror(!!this._mirrorType),this._localVideoTrack&&!this._localVideoTrack.dummy&&(null===(r=this._config)||void 0===r?void 0:r.autoPlayPolicy)!==Z.PLAY_MANUALLY&&this._videoPlayer.playVideo(this._localVideoTrack),this._videoPlayer.domElement;if(e===U.STREAM_INDEX_SCREEN&&!this._screenPlayer)return this._screenPlayer=new yW(i(i({},o),{},{isScreen:!0,isLocal:!0})),this._initPlayerEvents(this._screenPlayer,!1,e),this._localScreenVideoTrack&&!this._localScreenVideoTrack.dummy&&(null===(n=this._config)||void 0===n?void 0:n.autoPlayPolicy)!==Z.PLAY_MANUALLY&&this._screenPlayer.playVideo(this._localScreenVideoTrack),this._screenPlayer.domElement}else{var a,s;e===U.STREAM_INDEX_MAIN?(null===(a=this._videoPlayer)||void 0===a||a.destroy(),delete this._videoPlayer):(null===(s=this._screenPlayer)||void 0===s||s.destroy(),delete this._screenPlayer)}}},{key:"startLiveTranscoding",value:(_e=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("startLiveTranscoding()","transcode: %o",t),DP(t.url,"liveTranscode.url"),this._liveTranscodeConfig=t,e.prev=3,this.safeEmit(ie.onStreamMixingEvent,{event:Sz.START,error:0,message:""}),e.next=7,null===(r=this._room)||void 0===r?void 0:r.liveControlMessage(qB("started",this._liveTranscodeConfig));case 7:e.next=16;break;case 9:if(e.prev=9,e.t0=e.catch(3),!(e.t0 instanceof ZN)){e.next=15;break}throw e.t0;case 15:throw new ZN(JN.UNEXPECTED_ERROR,"unexpected error",e.t0);case 16:case"end":return e.stop()}}),e,this,[[3,9]])}))),function(e){return _e.apply(this,arguments)})},{key:"updateLiveTranscoding",value:(ve=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("updateLiveTranscoding()","transcode: %o",t),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return this._liveTranscodeConfig=HY(this._liveTranscodeConfig,t),e.prev=4,this.safeEmit(ie.onStreamMixingEvent,{event:Sz.UPDATE,error:0,message:""}),e.next=8,null===(r=this._room)||void 0===r?void 0:r.liveControlMessage(qB("layoutChanged",this._liveTranscodeConfig));case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof ZN)){e.next=16;break}throw e.t0;case 16:throw new ZN(JN.UNEXPECTED_ERROR,"unexpected error",e.t0);case 17:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(e){return ve.apply(this,arguments)})},{key:"stopLiveTranscoding",value:(pe=u(o().mark((function e(){var t;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("stopLiveTranscoding()"),this._liveTranscodeConfig){e.next=3;break}return e.abrupt("return");case 3:return delete this._liveTranscodeConfig,e.prev=4,this.safeEmit(ie.onStreamMixingEvent,{event:Sz.STOP,error:0,message:""}),e.next=8,null===(t=this._room)||void 0===t?void 0:t.liveControlMessage({action:"stopped",type:"transcode"});case 8:e.next=17;break;case 10:if(e.prev=10,e.t0=e.catch(4),!(e.t0 instanceof ZN)){e.next=16;break}throw e.t0;case 16:throw new ZN(JN.UNEXPECTED_ERROR,"unexpected error",e.t0);case 17:case"end":return e.stop()}}),e,this,[[4,10]])}))),function(){return pe.apply(this,arguments)})},{key:"setBusinessId",value:function(e){return N$.print("setBusinessId()","businessId: %s",e),!function(e){return"string"!=typeof e}(e)&&!this._room&&(EB.setStats({rtc_business_id:e}),$K.setStats({rtc_business_id:e}),this._businessId=e,!0)}},{key:"setUserVisibility",value:(fe=u(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setUserVisibility()","enable: %o",t),t=!!t,this._visibility!==t){e.next=4;break}return e.abrupt("return");case 4:if(this._room){e.next=7;break}return this._visibility=t,e.abrupt("return");case 7:if(this._room.connectionState===Wz.CONNECTED){e.next=9;break}throw new ZN(JN.NOT_CONNECTED_YET,"server not connected");case 9:if(this._room.localStream&&(null===(n=this._room.localStream.observer)||void 0===n||n.setPublisher(t)),e.t0=!t,!e.t0){e.next=14;break}return e.next=14,this._room.unpublish();case 14:return e.next=16,this._room.updateUserAttributes({role:t?_$.NORMAL_USER:_$.SILENT_USER});case 16:this._visibility=t,t&&null!==(r=this._roomConfig)&&void 0!==r&&r.isAutoPublish&&this._updatePublish({mediaType:V.AUDIO_AND_VIDEO});case 18:case"end":return e.stop()}}),e,this)}))),function(e){return fe.apply(this,arguments)})},{key:"_initPlayerEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:U.STREAM_INDEX_MAIN,i=n===U.STREAM_INDEX_SCREEN;e.on("playback_event",(function(n){switch(n.eventName){case"timeupdate":return;case"loadeddata":if("audio"===n.type){var o=e.userId.replace("_screen","");r?t.safeEmit(ie.onFirstPublicStreamAudioFrameDecoded,{publicStreamId:o}):(t.safeEmit(ie.onAudioFirstFrameDecoded,{userId:o,isScreen:i}),t.safeEmit(ie.onRemoteAudioFirstFrame,{userId:o,isScreen:i})),gB.firstRemoteAudioRender("",o||"",{isScreen:i})}else{var a,s,u={userId:e.userId,height:(null===(a=e.domElement)||void 0===a?void 0:a.videoHeight)||0,width:(null===(s=e.domElement)||void 0===s?void 0:s.videoWidth)||0,isScreen:i};r?(u.publicStreamId=u.userId,delete u.userId,delete u.isScreen,t.safeEmit(ie.onFirstPublicStreamVideoFrameRendered,u),t.safeEmit(ie.onFirstPublicStreamVideoFrameDecoded,u)):e.isLocal||(t.safeEmit(ie.onVideoFirstFrameRendered,u),t.safeEmit(ie.onVideoFirstFrameDecoded,u),t.safeEmit(ie.onRemoteVideoFirstFrame,u)),gB.firstRemoteVideoRender("",n.userId||"",{isScreen:i})}break;case"autoplay-error":return r&&(n.publicStreamId=n.userId),void t.safeEmit(ie.onAutoplayFailed,{userId:n.userId||n.publicStreamId,kind:e instanceof yW?"video":"audio"})}t.safeEmit(ie.onPlayerEvent,n)}))}},{key:"_initLocalTrackEvents",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.on("track-ended",(function(e){var r=!1;e!==t._localScreenAudioTrack&&e!==t._localScreenVideoTrack||(r=!0),t.safeEmit(ie.onTrackEnded,{kind:e.getTrack().kind,isScreen:r})})),e.on("resolution-change",(function(e){t.safeEmit(ie.onLocalVideoSizeChanged,{streamIndex:r?U.STREAM_INDEX_SCREEN:U.STREAM_INDEX_MAIN,info:e})}))}},{key:"setRemoteVideoPlayer",value:function(e,t){N$.print("setRemoteVideoPlayer()","streamIndex: %o, videoPlayerOption: %o",e,t),PP(e,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),XP(t);var r,n,o,a=t.userId;if(e===U.STREAM_INDEX_MAIN){var s,u,c;if(null===(s=this._remoteVideoPlayer.get(a))||void 0===s||s.destroy(),!t.renderDom)return;var d=new yW(t);this._initPlayerEvents(d,!1,e),this._remoteVideoPlayer.set(a,d);var l=null===(u=this._room)||void 0===u||null===(c=u.remoteStreams.get(a))||void 0===c?void 0:c.find((function(e){return!e.isScreen}));return l&&this._updateVideoPlayerState(l),d.domElement}if(null===(r=this._remoteScreenPlayer.get(a))||void 0===r||r.destroy(),t.renderDom){var h=new yW(i(i({},t),{},{isScreen:!0}));this._remoteScreenPlayer.set(a,h),this._initPlayerEvents(h,!1,e);var f=null===(n=this._room)||void 0===n||null===(o=n.remoteStreams.get(a))||void 0===o?void 0:o.find((function(e){return e.isScreen}));return f&&this._updateVideoPlayerState(f),h.domElement}}},{key:"setLocalVideoMirrorType",value:function(e){N$.print("setLocalVideoMirrorType()","mirrorType: %o",e),PP(e,"mirrorType",[j.MIRROR_TYPE_NONE,j.MIRROR_TYPE_RENDER]),this._mirrorType=e,this._videoPlayer&&this._videoPlayer.mirror(!!e)}},{key:"setAudioPlaybackDevice",value:(he=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setAudioPlaybackDevice()","deviceId: %s",t),DP(t,"deviceId"),void 0!==HTMLAudioElement.prototype.setSinkId){e.next=5;break}return N$.print("setAudioPlaybackDevice failed","setSinkId not supported by current browser"),e.abrupt("return");case 5:return e.next=7,vH.getDeviceById(t);case 7:if(r=e.sent){e.next=10;break}throw new ZN(JN.INVALID_DEVICE_ID,"audio playback device id ".concat(t," is invalid"));case 10:this._remoteAudioPlayer.forEach((function(e){e.setPlaybackDevice(t)})),this._audioPlaybackDeviceId=t,r&&this.safeEmit(ie.onAudioPlaybackDeviceChanged,r),gB.rtcAudioDevice(aB.PLAYOUT_DEVICE_SWITCH,t,0);case 14:case"end":return e.stop()}}),e,this)}))),function(e){return he.apply(this,arguments)})},{key:"play",value:(le=u(o().mark((function e(t){var r,n,i,a,s,u,c,d,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("play()","userId | publicStreamId: %s",t),s=null===(r=this._room)||void 0===r||null===(n=r.remoteStreams.get(t||""))||void 0===n?void 0:n.find((function(e){return!e.isScreen})),i=this._remoteAudioPlayer.get(t||""),a=this._remoteVideoPlayer.get(t||""),i||(i=this._publicStreamAudioPlayer.get(t||"")),a||(a=this._publicStreamVideoPlayer.get(t||"")),!t&&this._videoPlayer&&(a=this._videoPlayer),a&&(a.played?a.manuallyPlay():null!=s&&s.videoTrack?a.playVideo(s.videoTrack,s):!t&&this._localVideoTrack&&(a.mirror(!!this._mirrorType),a.playVideo(this._localVideoTrack))),i&&(i.played?i.manuallyPlay():null!=s&&s.audioTrack&&(i.playAudio(s.audioTrack),(c=null==s||null===(u=s.audioTrack._audioLevelFetcher)||void 0===u?void 0:u._ctx)&&c.resume())),null!=s&&s.audioTrack&&(l=null==s||null===(d=s.audioTrack._audioLevelFetcher)||void 0===d?void 0:d._ctx)&&"suspended"===l.state&&l.resume(),t||!this._audioMixingManager){e.next=13;break}return e.next=13,this._audioMixingManager.resumeLocalPlay();case 13:case"end":return e.stop()}}),e,this)}))),function(e){return le.apply(this,arguments)})},{key:"pauseAllSubscribedStream",value:(de=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("pauseAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),!this._pauseAllSubscribeState.audio||!this._pauseAllSubscribeState.video){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(r=function(){AP(t)&&(n._pauseAllSubscribeState.audio=!0),wP(t)&&(n._pauseAllSubscribeState.video=!0)},this._room){e.next=8;break}return r(),e.abrupt("return",Promise.resolve());case 8:return e.abrupt("return",this._room.pauseAllSubscribedStream(t).then((function(){r()})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return de.apply(this,arguments)})},{key:"resumeAllSubscribedStream",value:(ce=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("resumeAllSubscribedStream()","mediaType: %o",t),this._checkMediaType(t),this._pauseAllSubscribeState.audio||this._pauseAllSubscribeState.video){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:if(r=function(){AP(t)&&(n._pauseAllSubscribeState.audio=!1),wP(t)&&(n._pauseAllSubscribeState.video=!1)},this._room){e.next=8;break}return r(),e.abrupt("return",Promise.resolve());case 8:return e.abrupt("return",this._room.resumeAllSubscribedStream(t).then((function(){var e,t;r(),null===(e=n._room)||void 0===e||null===(t=e.remoteStreams)||void 0===t||t.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){n._updateAudioPlayerState(e),n._updateVideoPlayerState(e)}))}))})));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return ce.apply(this,arguments)})},{key:"sendUserMessage",value:(ue=u(o().mark((function e(t,r){var n,i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(GP(t),KP(r),this._room&&this._room.connectionState===Wz.CONNECTED){e.next=4;break}throw new ZN(JN.IM_BEFORE_JOIN,"join first");case 4:return i=Date.now(),e.abrupt("return",null===(n=this._room.sendUserMessage(t,r))||void 0===n?void 0:n.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!1,i,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!1,i),e})));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return ue.apply(this,arguments)})},{key:"sendUserBinaryMessage",value:(se=u(o().mark((function e(t,r){var n,i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(GP(t),UP(r,"message"),KP(r),this._room&&this._room.connectionState===Wz.CONNECTED){e.next=5;break}throw new ZN(JN.IM_BEFORE_JOIN,"join first");case 5:return i=Date.now(),e.abrupt("return",null===(n=this._room.sendUserMessage(t,r))||void 0===n?void 0:n.then((function(e){return a._messageStatisticsObserver.countP2PMessage(!0,t,!0,i,e),e.id})).catch((function(e){throw a._messageStatisticsObserver.countP2PMessage(!1,t,!0,i),e})));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return se.apply(this,arguments)})},{key:"sendRoomMessage",value:(ae=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(KP(t),this._room&&this._room.connectionState===Wz.CONNECTED){e.next=3;break}throw new ZN(JN.IM_BEFORE_JOIN,"join first");case 3:return r=Date.now(),e.abrupt("return",this._room.sendRoomMessage(t).then((function(e){var t,i;return n._messageStatisticsObserver.countRoomMessage(!0,null===(t=n._room)||void 0===t||null===(i=t.roomInfo)||void 0===i?void 0:i.roomId,!1,r),e})).catch((function(e){var t,i;throw n._messageStatisticsObserver.countRoomMessage(!1,null===(t=n._room)||void 0===t||null===(i=t.roomInfo)||void 0===i?void 0:i.roomId,!1,r),e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return ae.apply(this,arguments)})},{key:"sendRoomBinaryMessage",value:(oe=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(KP(t),this._room&&this._room.connectionState===Wz.CONNECTED){e.next=3;break}throw new ZN(JN.IM_BEFORE_JOIN,"join first");case 3:return r=Date.now(),e.abrupt("return",this._room.sendRoomMessage(t,!0).then((function(e){var t,i;return n._messageStatisticsObserver.countRoomMessage(!0,null===(t=n._room)||void 0===t||null===(i=t.roomInfo)||void 0===i?void 0:i.roomId,!0,r),e})).catch((function(e){var t,i;throw n._messageStatisticsObserver.countRoomMessage(!1,null===(t=n._room)||void 0===t||null===(i=t.roomInfo)||void 0===i?void 0:i.roomId,!0,r),e})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return oe.apply(this,arguments)})},{key:"setAudioCaptureConfig",value:(ne=u(o().mark((function e(){var t,r,n,i=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},N$.print("setAudioCaptureConfig()","config: %o",t),delete t.deviceId,VP(t),r=this._audioStreamConstraints.deviceId,this._audioStreamConstraints=t,r&&(this._audioStreamConstraints.deviceId=r),!this._localAudioTrack){e.next=11;break}return this._localAudioTrack.audioCaptureConfig=this._audioStreamConstraints,e.next=11,null===(n=this._localAudioTrack)||void 0===n?void 0:n.updateAudioCaptureConfig();case 11:case"end":return e.stop()}}),e,this)}))),function(){return ne.apply(this,arguments)})},{key:"setVideoCaptureConfig",value:(re=u(o().mark((function e(){var t,r,n,i=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.length>0&&void 0!==i[0]?i[0]:{},N$.print("setVideoCaptureConfig()","config: %o",t),delete t.deviceId,VP(t),r=this._videoStreamConstraints.deviceId,this._videoStreamConstraints=t,r&&(this._videoStreamConstraints.deviceId=r),!this._localVideoTrack){e.next=12;break}return this._localVideoTrack.videoCaptureConfig=this._videoStreamConstraints,e.next=11,null===(n=this._localVideoTrack)||void 0===n?void 0:n.updateVideoCaptureConfig();case 11:this._updatePublish();case 12:case"end":return e.stop()}}),e,this)}))),function(){return re.apply(this,arguments)})},{key:"enableSimulcastMode",value:function(e){return N$.print("enableSimulcastMode()","enabled: %o",e),this._enableSimulcast=e,!0}},{key:"setVideoEncoderConfig",value:(ee=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N$.print("setVideoEncoderConfig()"," descriptions: %o",t),Array.isArray(t)||(t=[t]),t.length>3&&(t=t.slice(0,3)),t.sort((function(e,t){return t.maxKbps-e.maxKbps})),this._videoStreamEncodeConfig=t,null!==(r=this._room)&&void 0!==r&&r.hasPublished&&this._updatePublish();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return ee.apply(this,arguments)})},{key:"setScreenEncoderConfig",value:($=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N$.print("setScreenEncoderConfig()","description: %o",t),this._screenStreamEncodeConfig=[t],this._localScreenVideoTrack&&(this._localScreenVideoTrack.videoCaptureConfig=t,this._localScreenVideoTrack.updateVideoCaptureConfig(),t.contentHint&&this._localScreenVideoTrack.setContentHint(t.contentHint)),null!==(r=this._room)&&void 0!==r&&r.hasScreenPublished&&this._updateScreenPublish();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return $.apply(this,arguments)})},{key:"sendSEIMessage",value:function(e,t,r){N$.print("sendSEIMessage()","streamIdex: %o, message: %o, repeatCount: %o",e,t,r),PP(e,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),NP(r,"repeatCount",0,30);var n="string"==typeof t?new Uint8Array(pP.str2ab(t)):t;if(t.length){var i;if(e===U.STREAM_INDEX_MAIN){var o,a,s;if(null===(o=this._room)||void 0===o||null===(a=o.localStream)||void 0===a||!a.hasPublished)return;i=null===(s=this._room)||void 0===s?void 0:s.localStream}else{var u,c,d;if(null===(u=this._room)||void 0===u||null===(c=u.localScreenStream)||void 0===c||!c.hasPublished)return;i=null===(d=this._room)||void 0===d?void 0:d.localScreenStream}if(n.byteLength>4096)N$.print("sei size must not bigger than 4KB");else{var l=dP();i.seiList.push({content:n,uuid:l,repeatCount:r}),setTimeout((function(){if(i){var e=i.seiList.findIndex((function(e){return e.uuid===l}));e&&i.seiList.splice(e,1)}}),2e3)}}else N$.print("sei message must not be empty")}},{key:"setAudioVolumeIndicationInterval",value:function(e){var t=this;N$.print("setAudioVolumeIndicationInterval()","interval %o: ",e),("number"!=typeof e||e<200)&&(e=200);var r=[];this._audioVolumeIndicationTimer&&clearInterval(this._audioVolumeIndicationTimer),this._audioVolumeIndicationTimer=setInterval((function(){var e,n;r=[],null===(e=t._room)||void 0===e||e.remoteStreams.forEach((function(e,t){var n;if(0!==e.length){var i=e.find((function(e){return!1===e.isScreen})),o=null==i||null===(n=i.audioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t,volume:o||0})}}));var i=null===(n=t._localAudioTrack)||void 0===n?void 0:n.getAudioLevel();r.push({userId:t._getUserId(),volume:i||0}),t.safeEmit(ie.onAudioVolumeIndication,{speakers:r})}),e)}},{key:"_sendActiveSpeaker",value:function(e,t){if(this._room&&this._room.remoteUsers.size>=1){var r,n=e[0],i=t.reduce((function(e,t){return e&&e.audioPropertiesInfo.nonlinearVolume>t.audioPropertiesInfo.nonlinearVolume?e:t}),void 0);if((r=n?i?n.audioPropertiesInfo.nonlinearVolume>i.audioPropertiesInfo.nonlinearVolume?n:i:n:i)&&r.audioPropertiesInfo.nonlinearVolume>-35){var o,a;if(r.streamKey)o=this._room.remoteUsers.get(r.streamKey.userId);else o=null===(a=this._room._roomInfo)||void 0===a?void 0:a.userInfo;o&&this.safeEmit(ie.onActiveSpeaker,{userId:o.userId,extraInfo:o.extraInfo})}}}},{key:"enableAudioPropertiesReport",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};N$.print("enableAudioPropertiesReport()","config %o: ",t);var r=t.enableInBackground,n=void 0===r||r,i=t.interval,o=void 0===i?100:i;this._stopAudioPropertiesReport(),o<=0||(o=Math.max(100,o),this._audioPropertiesReportTimer=self.setInterval((function(){if(n||"hidden"!==document.visibilityState){var t=[],r=e._audioDeviceManager.getRecordTrack()||e._localAudioTrack;if(r){var i=r.getAudioLevel();t.push({streamIndex:U.STREAM_INDEX_MAIN,audioPropertiesInfo:{linearVolume:i,nonlinearVolume:RP(i)}})}if(e._localScreenAudioTrack){var o=e._localScreenAudioTrack.getAudioLevel();t.push({streamIndex:U.STREAM_INDEX_SCREEN,audioPropertiesInfo:{linearVolume:o,nonlinearVolume:RP(o)}})}if(e.safeEmit(ie.onLocalAudioPropertiesReport,t),e._room){var a=[];e._room.remoteStreams.forEach((function(t,r){t.forEach((function(t){if(t.audioTrack){var n,i,o=t.audioTrack.getAudioLevel();a.push({streamKey:{userId:r,streamIndex:t.isScreen?U.STREAM_INDEX_SCREEN:U.STREAM_INDEX_MAIN,roomId:null===(n=e._room)||void 0===n||null===(i=n.roomInfo)||void 0===i?void 0:i.roomId},audioPropertiesInfo:{linearVolume:o,nonlinearVolume:RP(o)}})}}))})),e._sendActiveSpeaker(t,a.filter((function(e){return e.streamKey.streamIndex!==U.STREAM_INDEX_SCREEN}))),e.safeEmit(ie.onRemoteAudioPropertiesReport,a)}}}),o))}},{key:"setVideoSourceType",value:(Q=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E,k,T;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setVideoSourceType()","index: %o, videoSourceType: %o",t,r),PP(t,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),PP(r,"VideoSourceType",[w.VIDEO_SOURCE_TYPE_EXTERNAL,w.VIDEO_SOURCE_TYPE_INTERNAL]),n=t===U.STREAM_INDEX_MAIN?"video":"screenVideo",this._trackSourceType[n]===r){e.next=26;break}if(this._trackSourceType[n]=r,N$.print("setVideoSourceType","set ".concat(n," source type to ").concat(r)),!this._localVideoTrack||t!==U.STREAM_INDEX_MAIN){e.next=17;break}if(u=!1,r===w.VIDEO_SOURCE_TYPE_EXTERNAL&&(u=!0,this._localVideoTrack.close()),null===(i=this._videoPlayer)||void 0===i||i.stop(),this._localVideoTrack=void 0,c=null===(a=this._room)||void 0===a?void 0:a._roomConfig.isAutoPublish,u?null===(d=this._room)||void 0===d||null===(l=d.localStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setEnableVideo(!1):null===(f=this._room)||void 0===f||null===(p=f.localStream)||void 0===p||null===(v=p.observer)||void 0===v||v.setPushVideo(!1),!(null!==(s=this._room)&&void 0!==s&&s.hasPublished||c)){e.next=17;break}return e.next=17,this._updatePublish();case 17:if(!this._localScreenVideoTrack||t!==U.STREAM_INDEX_SCREEN){e.next=26;break}if(y=!1,r===w.VIDEO_SOURCE_TYPE_EXTERNAL&&(y=!0,this._localScreenVideoTrack.close()),null===(_=this._screenPlayer)||void 0===_||_.stop(),this._localScreenVideoTrack=void 0,y?null===(g=this._room)||void 0===g||null===(S=g.localScreenStream)||void 0===S||null===(b=S.observer)||void 0===b||b.setEnableVideo(!1):null===(E=this._room)||void 0===E||null===(k=E.localScreenStream)||void 0===k||null===(T=k.observer)||void 0===T||T.setPushVideo(!1),null===(m=this._room)||void 0===m||!m.hasScreenPublished){e.next=26;break}return e.next=26,this._updateScreenPublish();case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return Q.apply(this,arguments)})},{key:"setExternalVideoTrack",value:(Y=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setExternalVideoTrack()","index: %o, track: %o",t,r),PP(t,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),MP(r),t!==U.STREAM_INDEX_MAIN){e.next=15;break}if(this._trackSourceType.video===w.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 6:return e.next=8,WH(r,this._extensionManager);case 8:if(this._localVideoTrack=e.sent,this._initLocalTrackEvents(this._localVideoTrack),null===(n=this._videoPlayer)||void 0===n||n.playVideo(this._localVideoTrack),s=null===(i=this._room)||void 0===i?void 0:i._roomConfig.isAutoPublish,!(null!==(a=this._room)&&void 0!==a&&a.hasPublished||s)){e.next=15;break}return e.next=15,this._updatePublish();case 15:if(t!==U.STREAM_INDEX_SCREEN){e.next=27;break}if(this._trackSourceType.screenVideo===w.VIDEO_SOURCE_TYPE_EXTERNAL){e.next=18;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setVideoSourceType as external first");case 18:return e.next=20,ZH(r,this._extensionManager);case 20:if(this._localScreenVideoTrack=e.sent,this._initLocalTrackEvents(this._localScreenVideoTrack,!0),null===(u=this._screenPlayer)||void 0===u||u.playVideo(this._localScreenVideoTrack),null===(c=this._room)||void 0===c||null===(d=c.localScreenStream)||void 0===d||null===(l=d.observer)||void 0===l||l.setPushVideo(!0),null===(h=this._room)||void 0===h||!h.hasScreenPublished){e.next=27;break}return e.next=27,this._updateScreenPublish();case 27:case"end":return e.stop()}}),e,this)}))),function(e,t){return Y.apply(this,arguments)})},{key:"setAudioSourceType",value:(W=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h,f,p,v,_,m,y,g,S,b,E;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setAudioSourceType()","index: %o, audioSourceType: %o",t,r),PP(t,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),PP(r,"audioSourceType",[C.AUDIO_SOURCE_TYPE_EXTERNAL,C.AUDIO_SOURCE_TYPE_INTERNAL]),n=t===U.STREAM_INDEX_MAIN?"audio":"screenAudio",this._trackSourceType[n]===r){e.next=24;break}if(this._trackSourceType[n]=r,N$.print("setVideoSourceType","set ".concat(n," source type to ").concat(r)),!this._localAudioTrack||t!==U.STREAM_INDEX_MAIN){e.next=16;break}if(s=!1,this._trackSourceType.audio===C.AUDIO_SOURCE_TYPE_EXTERNAL&&(s=!0,this._localAudioTrack.close()),this._localAudioTrack=void 0,u=null===(i=this._room)||void 0===i?void 0:i._roomConfig.isAutoPublish,s?null===(c=this._room)||void 0===c||null===(d=c.localStream)||void 0===d||null===(l=d.observer)||void 0===l||l.setEnableAudio(!1):null===(h=this._room)||void 0===h||null===(f=h.localStream)||void 0===f||null===(p=f.observer)||void 0===p||p.setPushAudio(!1),!(null!==(a=this._room)&&void 0!==a&&a.hasPublished||u)){e.next=16;break}return e.next=16,this._updatePublish();case 16:if(!this._localScreenAudioTrack||t!==U.STREAM_INDEX_SCREEN){e.next=24;break}if(_=!1,this._trackSourceType.audio===C.AUDIO_SOURCE_TYPE_EXTERNAL&&(_=!0,this._localScreenAudioTrack.close()),this._localScreenAudioTrack=void 0,_?null===(m=this._room)||void 0===m||null===(y=m.localScreenStream)||void 0===y||null===(g=y.observer)||void 0===g||g.setEnableAudio(!1):null===(S=this._room)||void 0===S||null===(b=S.localScreenStream)||void 0===b||null===(E=b.observer)||void 0===E||E.setPushAudio(!1),null===(v=this._room)||void 0===v||!v.hasScreenPublished){e.next=24;break}return e.next=24,this._updateScreenPublish();case 24:case"end":return e.stop()}}),e,this)}))),function(e,t){return W.apply(this,arguments)})},{key:"setExternalAudioTrack",value:(q=u(o().mark((function e(t,r){var n,i,a,s,u,c,d,l,h,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("setExternalAudioTrack()","index: %o, track: %o",t,r),PP(t,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),MP(r),t!==U.STREAM_INDEX_MAIN){e.next=15;break}if(this._trackSourceType.audio===C.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=6;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 6:return e.next=8,JH(r,this._extensionManager);case 8:if(this._localAudioTrack=e.sent,this._initLocalTrackEvents(this._localAudioTrack),c=null===(n=this._room)||void 0===n?void 0:n._roomConfig.isAutoPublish,null===(i=this._room)||void 0===i||null===(a=i.localStream)||void 0===a||null===(s=a.observer)||void 0===s||s.setPushAudio(!0),!(null!==(u=this._room)&&void 0!==u&&u.hasPublished||c)){e.next=15;break}return e.next=15,this._updatePublish();case 15:if(t!==U.STREAM_INDEX_SCREEN){e.next=26;break}if(this._trackSourceType.screenAudio===C.AUDIO_SOURCE_TYPE_EXTERNAL){e.next=18;break}throw new ZN(JN.STREAM_TYPE_NOT_MATCH,"setAudioSourceType as external first");case 18:return e.next=20,ez(r,this._extensionManager);case 20:if(this._localScreenAudioTrack=e.sent,this._initLocalTrackEvents(this._localScreenAudioTrack),null===(d=this._room)||void 0===d||null===(l=d.localScreenStream)||void 0===l||null===(h=l.observer)||void 0===h||h.setPushAudio(!0),null===(f=this._room)||void 0===f||!f.hasScreenPublished){e.next=26;break}return e.next=26,this._updateScreenPublish();case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return q.apply(this,arguments)})},{key:"login",value:(z=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("login()","token: %o, userInfo: %o",t,r),BP(t)||DP(t,"token"),GP(r),e.abrupt("return",this._rtmClient.login(t,r));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return z.apply(this,arguments)})},{key:"logout",value:(H=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("logout()"),e.abrupt("return",this._rtmClient.logout());case 2:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"updateLoginToken",value:(G=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("updateLoginToken()","token: %o",t),BP(t)||DP(t,"token"),e.abrupt("return",this._rtmClient.updateLoginToken(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return G.apply(this,arguments)})},{key:"getPeerOnlineStatus",value:(L=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("getPeerOnlineStatus()","userId: %o",t),GP(t),e.abrupt("return",this._rtmClient.getPeerOnlineStatus(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return L.apply(this,arguments)})},{key:"sendUserMessageOutsideRoom",value:(M=u(o().mark((function e(t,r){var n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return GP(t),KP(r),n=Date.now(),e.prev=3,e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!1,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,n),e})));case 7:throw e.prev=7,e.t0=e.catch(3),this._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!1,n),e.t0;case 11:case"end":return e.stop()}}),e,this,[[3,7]])}))),function(e,t){return M.apply(this,arguments)})},{key:"sendUserBinaryMessageOutsideRoom",value:(N=u(o().mark((function e(t,r){var n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return GP(t),UP(r,"message"),KP(r),n=Date.now(),e.prev=4,e.abrupt("return",this._rtmClient.sendUserMessageOutsideRoom(t,r).then((function(e){return i._messageStatisticsObserver.countUserMessageOutsideRoom(!0,t,!0,n,e),e.id})).catch((function(e){throw i._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,n),e})));case 8:throw e.prev=8,e.t0=e.catch(4),this._messageStatisticsObserver.countUserMessageOutsideRoom(!1,t,!0,n),e.t0;case 12:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(e,t){return N.apply(this,arguments)})},{key:"setServerParams",value:(x=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("setServerParams()","signature: %o, url: %0",t,r),e.abrupt("return",this._rtmClient.setServerParams(t,r));case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return x.apply(this,arguments)})},{key:"sendServerMessage",value:(O=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return DP(t,"message"),KP(t),r=Date.now(),e.prev=3,e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(){n._messageStatisticsObserver.countServerMessage(!0,!1,r)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!1,r),e})));case 7:throw e.prev=7,e.t0=e.catch(3),this._messageStatisticsObserver.countServerMessage(!1,!1,r),e.t0;case 11:case"end":return e.stop()}}),e,this,[[3,7]])}))),function(e){return O.apply(this,arguments)})},{key:"sendServerBinaryMessage",value:(A=u(o().mark((function e(t){var r,n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return UP(t,"message"),KP(t),r=Date.now(),e.prev=3,e.abrupt("return",this._rtmClient.sendServerMessage(t).then((function(){n._messageStatisticsObserver.countServerMessage(!0,!0,r)})).catch((function(e){throw n._messageStatisticsObserver.countServerMessage(!1,!0,r),e})));case 7:throw e.prev=7,e.t0=e.catch(3),this._messageStatisticsObserver.countServerMessage(!1,!0,r),e.t0;case 11:case"end":return e.stop()}}),e,this,[[3,7]])}))),function(e){return A.apply(this,arguments)})},{key:"startCloudProxy",value:function(e){if(this._room)throw new ZN(JN.START_CLOUD_PROXY_AFTER_JOIN,"[startCloudProxy] should be invoke before join room ");N$.print("startCloudProxy()",e),DP(e.logProxy,"logProxy"),DP(e.accessProxy,"accessProxy"),DP(e.configProxy,"configProxy"),this._originIceConfigRequestUrls=zB("ICE_CONFIG_REQUEST_URLS"),this._originLogServerUrl=zB("LOG_SERVER_URL"),this._originConfigServerUrls=zB("CONFIG_REQUEST_DOMAINS"),HB("ICE_CONFIG_REQUEST_URLS",e.accessProxy),HB("LOG_SERVER_URL",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return/^https?:\/\/.+/.test(e)||(e="https://"+e),"".concat(e,"/video/v1/webrtc_log/")}(e.logProxy)),HB("CONFIG_REQUEST_DOMAINS",[e.configProxy]),this._useCloudProxy=!0}},{key:"stopCloudProxy",value:function(){if(this._room)throw new ZN(JN.STOP_CLOUD_PROXY_BEFORE_LEAVE,"[stopCloudProxy] should be invoke after leave room ");N$.print("stopCloudProxy()"),HB("ICE_CONFIG_REQUEST_URLS",[]),HB("LOG_SERVER_URL",this._originLogServerUrl),HB("CONFIG_REQUEST_DOMAINS",this._originConfigServerUrls),this._useCloudProxy=!1,this._startCloudProxyTimestamp=void 0}},{key:"startPushPublicStream",value:(R=u(o().mark((function e(t,r){var n,i=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),HP(t),this._room&&this._room.connectionState===Wz.CONNECTED){e.next=4;break}throw new ZN(JN.START_PUBLIC_STREAM_BEFORE_JOIN,"join first");case 4:if(!this._publicStreamIds.get(t)){e.next=6;break}throw new ZN(JN.REPEAT_PUSH,"repeat push public media stream");case 6:return n=XB(t,"started",r),e.abrupt("return",this._room.publicStreamControlMessage(n).then((function(){i._publicStreamIds.set(t,t)})));case 8:case"end":return e.stop()}}),e,this)}))),function(e,t){return R.apply(this,arguments)})},{key:"updatePublicStreamParam",value:(I=u(o().mark((function e(t,r){var n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("startPushPublicStream()","publicStreamId: %o, publicStreamParam: %o",t,r),HP(t),this._room&&this._room.connectionState===Wz.CONNECTED){e.next=4;break}throw new ZN(JN.START_PUBLIC_STREAM_BEFORE_JOIN,"join first");case 4:return n=XB(t,"layoutChanged",r),e.abrupt("return",this._room.publicStreamControlMessage(n));case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return I.apply(this,arguments)})},{key:"stopPushPublicStream",value:(T=u(o().mark((function e(t){var r=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("startPushPublicStream()","publicStreamId: %o",t),HP(t),this._room&&this._room.connectionState===Wz.CONNECTED){e.next=4;break}throw new ZN(JN.START_PUBLIC_STREAM_BEFORE_JOIN,"join first");case 4:return e.abrupt("return",this._room.publicStreamControlMessage({type:"publicstream",action:"stopped",publicStreamID:t}).then((function(){r._publicStreamIds.delete(t)})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return T.apply(this,arguments)})},{key:"startPlayPublicStream",value:(k=u(o().mark((function e(t){var r,n,i,a,s,u,c=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(HP(t),this._outsideRoom){e.next=8;break}return this._outsideRoom=new g$(this._appId),this._outsideRoom.on(gz.RESUBSCRIBE,(function(e){var t=e.stream;if(t){var r,n=c._publicStreamAudioPlayer.get(t.streamId);n&&t.audioTrack&&(n.stop(),n.playAudio(null===(r=e.stream)||void 0===r?void 0:r.audioTrack));var i,o=c._publicStreamVideoPlayer.get(t.streamId);o&&t.videoTrack&&o.playVideo(null===(i=e.stream)||void 0===i?void 0:i.videoTrack)}})),null===(r=this._outsideRoom)||void 0===r||r.on("onRemoteStreamStats",(function(e){e.publicStreamId=e.userId,delete e.userId,delete e.isScreen,c.safeEmit(ie.onPublicStreamStats,e)})),null===(n=this._outsideRoom)||void 0===n||n.on(gz.ON_SEI_MESSAGED_RECEIVED,(function(e){c.safeEmit(ie.onPublicStreamSEIMessageReceived,e)})),e.next=8,this._outsideRoom.connect();case 8:return e.next=10,this._outsideRoom.startPlayPublicStream(t);case 10:i=e.sent,(a=this._publicStreamVideoPlayer.get(t))&&null!=i&&i.videoTrack&&a.playVideo(i.videoTrack,i),!(s=this._publicStreamAudioPlayer.get(t))&&null!=i&&i.audioTrack&&(s=new gW(t,{muted:(null===(u=this._config)||void 0===u?void 0:u.autoPlayPolicy)===Z.VIDEO_ONLY}),this._initPlayerEvents(s,!0),s.playAudio(i.audioTrack),this._publicStreamAudioPlayer.set(t,s));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return k.apply(this,arguments)})},{key:"stopPlayPublicStream",value:(S=u(o().mark((function e(t){var r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._outsideRoom){e.next=2;break}return e.abrupt("return");case 2:this._outsideRoom.stopPlayPublicStream(t),(r=this._publicStreamAudioPlayer.get(t))&&(r.destroy(),this._publicStreamAudioPlayer.delete(t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return S.apply(this,arguments)})},{key:"setAudioProfile",value:(y=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this._audioProfileManager.setAudioProfile(t);case 1:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"setPublicStreamVideoPlayer",value:function(e,t){var r,n,o,a;N$.print("setPublicStreamVideoPlayer()","publicStreamId: %o, videoPlayerOption: %o",e,t);var s=this._publicStreamVideoPlayer.get(e);if(null===(r=s)||void 0===r||r.destroy(),null!=t&&t.renderDom){s=new yW(i(i({},t),{},{userId:e})),this._initPlayerEvents(s,!0),this._publicStreamVideoPlayer.set(e,s);var u=null===(n=this._outsideRoom)||void 0===n||null===(o=n.remoteStreams)||void 0===o?void 0:o.get(e);null!=u&&u.videoTrack&&(null===(a=this._config)||void 0===a?void 0:a.autoPlayPolicy)!==Z.PLAY_MANUALLY&&s.playVideo(u.videoTrack,u)}else this._publicStreamVideoPlayer.delete(e)}},{key:"setDummyCaptureImagePath",value:(_=u(o().mark((function e(t,r){var n=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,i){DP(r,"filePath");var o=new Image;o.crossOrigin="anonymous",o.src=r,o.onload=function(){try{var r=document.createElement("canvas"),a=r.getContext("2d");if(!a)return i(new ZN(JN.UNEXPECTED_ERROR,"Not support canvas"));r.width=o.width,r.height=o.height,a.drawImage(o,0,0,o.width,o.height);var s=window.setInterval((function(){a.drawImage(o,0,0,o.width,o.height)}),200);t===U.STREAM_INDEX_MAIN?(clearInterval(n._dummyMainTimer),n._dummyMainTimer=s):(clearInterval(n._dummyScreenTimer),n._dummyScreenTimer=s);var u=r.captureStream(5).getVideoTracks()[0];t===U.STREAM_INDEX_MAIN?n._localImgVideoTrack=u:n._localImgScreenTrack=u,e()}catch(c){i(new ZN(JN.UNEXPECTED_ERROR,c.message))}},o.onerror=function(){i(new ZN(JN.UNEXPECTED_ERROR,"Load image error"))}})));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return _.apply(this,arguments)})},{key:"registerExtension",value:(v=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.monitor=gB,t.isSupported()){e.next=3;break}throw new Error("This extension is not supported.");case 3:return e.next=5,t.init();case 5:this._extensionManager.register(t);case 6:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"defaultTranscoding",value:function(){return JSON.parse(JSON.stringify(WB))}},{key:"_updatePublish",value:(d=u(o().mark((function e(){var t,r,n,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{},N$.print("_updatePublish()","config: %o",t),r={mediaType:void 0,invokeByJoinRoom:!1,pubState:bz.PUB},t=i(i({},r),t),this._visibility){e.next=6;break}throw new ZN(JN.NO_PUBLISH_PERMISSION,"no publish permission");case 6:return e.next=8,this._pubLock.lock();case 8:if(n=e.sent,this._room&&this._room.connectionState===Wz.CONNECTED){e.next=12;break}return n(),e.abrupt("return");case 12:return e.prev=12,e.next=15,this._room.publish(this._videoStreamEncodeConfig,this._enableSimulcast,this._localVideoTrack,this._localAudioTrack,t.mediaType,t.pubState,t.invokeByJoinRoom);case 15:e.next=24;break;case 17:if(e.prev=17,e.t0=e.catch(12),!(e.t0 instanceof ZN)){e.next=23;break}throw e.t0;case 23:throw new ZN(JN.UNEXPECTED_ERROR,"unexpected error",e.t0);case 24:return e.prev=24,n(),e.finish(24);case 27:case"end":return e.stop()}}),e,this,[[12,17,24,27]])}))),function(){return d.apply(this,arguments)})},{key:"startAudioPlaybackDeviceTest",value:(s=u(o().mark((function e(t,r){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("startAudioPlaybackDeviceTest()","filePath: %o, indicationInterval: %o",t,r),DP(t,"filePath"),NP(r,"indicationInterval"),e.next=5,this._audioDeviceManager.startAudioPlaybackDeviceTest(t,r);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return s.apply(this,arguments)})},{key:"stopAudioPlaybackDeviceTest",value:function(){N$.print("stopAudioPlaybackDeviceTest()"),this._audioDeviceManager.stopAudioPlaybackDeviceTest()}},{key:"startAudioDeviceRecordTest",value:(a=u(o().mark((function e(t){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N$.print("startAudioDeviceRecordTest()","indicationInterval: %o",t),NP(t,"indicationInterval"),e.next=4,this._audioDeviceManager.startAudioDeviceRecordTest(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"stopAudioDeviceRecordAndPlayTest",value:function(){N$.print("stopAudioDeviceRecordAndPlayTest()"),this._audioDeviceManager.stopAudioDeviceRecordAndPlayTest()}},{key:"stopAudioDevicePlayTest",value:function(){N$.print("stopAudioDevicePlayTest()"),this._audioDeviceManager.stopAudioDevicePlayTest()}},{key:"setRemoteUserPriority",value:function(e,t){var r;N$.print("setRemoteUserPriority()","userId: %o, priority: %o",e,t);try{GP(e),PP(t,"priority",[K.HIGH,K.MEDIUM,K.LOW])}catch(n){return console.warn(n),!1}return this._userPriorityMap.set(e,t),null===(r=this._room)||void 0===r||r.setRemoteUserPriority(e,t),!0}},{key:"takeLocalSnapshot",value:(n=u(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("takeLocalSnapshot()","streamIndex: %o",t),PP(t,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),r=t===U.STREAM_INDEX_MAIN?this.localVideoTrack:this.localScreenVideoTrack){e.next=5;break}throw new ZN(JN.INVOKED_BEFORE_CAPTURE,"capture first");case 5:return n=t===U.STREAM_INDEX_MAIN?this._videoPlayer:this._screenPlayer,e.abrupt("return",I$(r.getTrack("preprocessing"),(null==n?void 0:n.mirrorType)===j.MIRROR_TYPE_RENDER,n));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"takeRemoteSnapshot",value:(r=u(o().mark((function e(t,r){var n,i,a,s,u,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N$.print("takeRemoteSnapshot()","id: %o, streamIndex: %o",t,r),DP(t,"id"),PP(r,"streamIndex",[U.STREAM_INDEX_MAIN,U.STREAM_INDEX_SCREEN]),c=(null===(n=this._room)||void 0===n||null===(i=n.remoteStreams.get(t))||void 0===i||null===(a=i.find((function(e){return e.isScreen===(r===U.STREAM_INDEX_SCREEN)})))||void 0===a?void 0:a.videoTrack)||(null===(s=this._outsideRoom)||void 0===s||null===(u=s.remoteStreams.get(t))||void 0===u?void 0:u.videoTrack)){e.next=6;break}throw new ZN(JN.STREAM_NOT_EXIST,"stream not exist");case 6:return e.abrupt("return",I$(c.getTrack(),!1,r===U.STREAM_INDEX_MAIN?this._remoteVideoPlayer.get(t):this._remoteScreenPlayer.get(t)));case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"setSubscribeFallbackOption",value:function(e){N$.print("setSubscribeFallbackOption()","option: %o",e);try{PP(e,"option",[X.DISABLE,X.VIDEO_STREAM_LOW,X.AUDIO_ONLY])}catch(t){return console.warn(t),!1}return!this._room&&(this._subscribeFallbackOption=e,!0)}},{key:"getLocalStreamTrack",value:function(e,t){var r,n,i=this;if(e===U.STREAM_INDEX_MAIN?(r="video"===t?this.localVideoTrack:this.localAudioTrack,n=function(){var e;return null===(e=i._room)||void 0===e?void 0:e.localStream}):(r="video"===t?this.localScreenVideoTrack:this.localScreenAudioTrack,n=function(){var e;return null===(e=i._room)||void 0===e?void 0:e.localScreenStream}),r){var o=r instanceof rz&&r.mixedAudioTrack?r.mixedAudioTrack:r.getTrack("preprocessing");if(o){var a=n();return A$(o,"enabled",this._reportMsTrackEvent.bind(this,"enabled",(null==a?void 0:a.streamId)||"","getLocalStreamTrack",t)),A$(o,"readyState",(function(e){"ended"===e&&(w$(o,"enabled"),w$(o,"readyState")),i._reportMsTrackEvent("readyState",(null==a?void 0:a.streamId)||"","getLocalStreamTrack",t,e)})),o.addEventListener("ended",(function(){w$(o,"enabled"),w$(o,"readyState")})),o}}}},{key:"getRemoteStreamTrack",value:function(e,t,r){var n,i,o=this,a=(null===(n=this._room)||void 0===n?void 0:n.remoteStreams.get(e))||[];if(a&&a.length){var s,u,c,d,l;if(t===U.STREAM_INDEX_MAIN)s=a.find((function(e){return!e.isScreen})),i="video"===r?null===(u=s)||void 0===u?void 0:u.videoTrack:null===(c=s)||void 0===c?void 0:c.audioTrack;else s=a.find((function(e){return e.isScreen})),i="video"===r?null===(d=s)||void 0===d?void 0:d.videoTrack:null===(l=s)||void 0===l?void 0:l.audioTrack;if(i){var h=i.getTrack();if(h&&s){var f=s.streamId;return A$(h,"enabled",this._reportMsTrackEvent.bind(this,"enabled",f,"getRemoteStreamTrack",r)),A$(h,"readyState",(function(e){"ended"===e&&(w$(h,"enabled"),w$(h,"readyState")),o._reportMsTrackEvent("readyState",f,"getRemoteStreamTrack",r,e)})),h.addEventListener("ended",(function(){w$(h,"enabled"),w$(h,"readyState")})),h}}}}},{key:"getPublicStreamTrack",value:function(e,t){var r=this;if(this._outsideRoom&&this._outsideRoom.remoteStreams){var n=this._outsideRoom.remoteStreams.get(e);if(n){var i="video"===t?n.videoTrack:n.audioTrack;if(i){var o=i.getTrack();if(o){var a=n.streamId;return A$(o,"enabled",this._reportMsTrackEvent.bind(this,"enabled",a,"getPublicStreamTrack",t)),A$(o,"readyState",(function(e){"ended"===e&&(w$(o,"enabled"),w$(o,"readyState")),r._reportMsTrackEvent("readyState",a,"getPublicStreamTrack",t,e)})),o.addEventListener("ended",(function(){w$(o,"enabled"),w$(o,"readyState")})),o}}}}}},{key:"_reportMsTrackEvent",value:function(e,t,r,n,i){var o;switch(e){case"readyState":o="live"!==i?"".concat(n," stopped"):"unknown";break;case"enabled":o="".concat(n,!0===i?" unmuted":" muted");break;default:o="unknown"}gB.rtcInvokeStatus(o,0,r,t||"",0,{direction:"getLocalStreamTrack"===r?"up":"down"})}},{key:"_updateScreenPublish",value:(t=u(o().mark((function e(){var t,r,n,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},N$.print("_updateScreenPublish()"),r={mediaType:void 0,pubState:bz.PUB},t=i(i({},r),t),e.next=6,this._pubLock.lock();case 6:if(n=e.sent,this._room&&this._room.connectionState===Wz.CONNECTED){e.next=10;break}return n(),e.abrupt("return");case 10:return e.prev=10,e.next=13,this._room.publishScreen(this._screenStreamEncodeConfig,this._localScreenVideoTrack,this._localScreenAudioTrack,t.mediaType,t.pubState);case 13:e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(10),!(e.t0 instanceof ZN)){e.next=21;break}throw e.t0;case 21:throw new ZN(JN.UNEXPECTED_ERROR,"unexpected error",e.t0);case 22:return e.prev=22,n(),e.finish(22);case 25:case"end":return e.stop()}}),e,this,[[10,15,22,25]])}))),function(){return t.apply(this,arguments)})},{key:"_updateAudioPlayerState",value:function(e){N$.print("_updateAudioPlayerState()");var t,r=e.userId,n=e.isScreen;if(t=n?this._remoteAudioPlayer.get("".concat(r,"_screen")):this._remoteAudioPlayer.get(r),e.audioTrack&&(e.attributes.audiostream&&e.subAudio||this.multiChatMode)){var i;if(!t){var o,a=n?"".concat(r,"_screen"):r;t=new gW(a,{muted:(null===(o=this._config)||void 0===o?void 0:o.autoPlayPolicy)===Z.VIDEO_ONLY}),this._initPlayerEvents(t,!1,n?U.STREAM_INDEX_SCREEN:U.STREAM_INDEX_MAIN),this._remoteAudioPlayer.set(a,t),this._audioPlaybackDeviceId&&t.setPlaybackDevice(this._audioPlaybackDeviceId)}(null===(i=this._config)||void 0===i?void 0:i.autoPlayPolicy)!==Z.PLAY_MANUALLY&&t.playAudio(e.audioTrack)}else{var s;null===(s=t)||void 0===s||s.stop()}}},{key:"_updateVideoPlayerState",value:function(e){var t;N$.print("_updateVideoPlayerState()");var r,n,i=e.userId;if(r=e.isScreen?this._remoteScreenPlayer.get(i):this._remoteVideoPlayer.get(i),e.videoTrack)r&&(null===(n=this._config)||void 0===n?void 0:n.autoPlayPolicy)!==Z.PLAY_MANUALLY&&r.playVideo(e.videoTrack,e);else if(null!==(t=r)&&void 0!==t&&t.played){var o;null===(o=r)||void 0===o||o.stop()}}},{key:"_onAddStream",value:function(e){var t=e.stream,r=null==t?void 0:t.attributes,n=r.localaudio,i=r.audiostream,o=r.localvideo,a=r.videostream,s=nz.NONE;if(i&&(s|=V.AUDIO),a&&(s|=V.VIDEO),s){var u;if(null!=t&&t.isScreen)this.safeEmit(ie.onUserPublishScreen,{userId:t.userId,mediaType:s});else this.safeEmit(ie.onUserPublishStream,{userId:t.userId,mediaType:s,videoStreamDescriptions:null==t||null===(u=t.attributes)||void 0===u?void 0:u.videoDescriptions}),this._handleAutoSubscribe(t,!0);this.safeEmit("onAddStream",{userId:t.userId,mediaType:s,isScreen:!(null==t||!t.isScreen)}),null!=t&&t.isScreen||(n&&this.safeEmit(ie.onUserStartAudioCapture,{userId:t.userId}),o&&this.safeEmit(ie.onUserStartVideoCapture,{userId:t.userId}))}}},{key:"_handleAutoSubscribe",value:function(e,t){var r,n,i=nz.NONE;if(null!==(r=this._roomConfig)&&void 0!==r&&r.isAutoSubscribeAudio&&(i|=V.AUDIO),null!==(n=this._roomConfig)&&void 0!==n&&n.isAutoSubscribeVideo&&(i|=V.VIDEO),N$.print("_onAddStream","autoSubType: ".concat(i)),i){var o,a;if(t&&AP(i))null===(o=e.observer)||void 0===o||o.setAutoSubscribeAudio(!0);if(t&&wP(i))null===(a=e.observer)||void 0===a||a.setAutoSubscribeVideo(!0);this._subscribe(!1,e.userId,i)}}},{key:"_onRemoveStream",value:function(e){var t,r=this,n=e.stream,i=null!==(t=P$[e.reason])&&void 0!==t?t:F.STREAM_REMOVE_REASON_OTHER,o=n.isScreen?ie.onUserUnpublishScreen:ie.onUserUnpublishStream,a=nz.NONE;n.attributes.audiostream&&(a|=V.AUDIO),n.attributes.videostream&&(a|=V.VIDEO),null!=n&&n._workaround_1_&&(a=V.VIDEO),a!==nz.NONE&&(this.safeEmit(o,{userId:n.userId,mediaType:a,reason:i}),this.safeEmit("onRemoveStream",{userId:n.userId,isScreen:n.isScreen})),this._getRemotePlayer(n.userId,n.isScreen).forEach((function(e){if(null==n||!n._workaround_1_){var t=n.isScreen?"".concat(n.userId,"_screen"):n.userId;r._remoteAudioPlayer.delete(t),n.isScreen?r._remoteScreenPlayer.delete(n.userId):r._remoteVideoPlayer.delete(n.userId),null==e||e.destroy()}}))}},{key:"_onUserConnection",value:function(e){this.safeEmit(ie.onUserJoined,e)}},{key:"_onUserLeave",value:function(e){this.safeEmit(ie.onUserLeave,e)}},{key:"_onRoomError",value:function(e){var t;this.safeEmit(ie.onError,e),null===(t=this._room)||void 0===t||t.destroy(),this._room=void 0}},{key:"_onNetworkQuality",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.safeEmit.apply(this,[ie.onNetworkQuality].concat(t))}},{key:"_onConnectionStateChange",value:function(e){void 0!==this._startCloudProxyTimestamp&&this._useCloudProxy&&e.state===B.CONNECTION_STATE_CONNECTED&&this.safeEmit(ie.onCloudProxyConnected,{interval:Date.now()-this._startCloudProxyTimestamp}),this.safeEmit(ie.onConnectionStateChanged,e)}},{key:"_getRemotePlayer",value:function(e,t){return[this._remoteAudioPlayer.get(t?"".concat(e,"_screen"):e),(t?this._remoteScreenPlayer:this._remoteVideoPlayer).get(e)]}},{key:"_stopAudioPropertiesReport",value:function(){null!==this._audioPropertiesReportTimer&&(clearInterval(this._audioPropertiesReportTimer),this._audioPropertiesReportTimer=null)}},{key:"_onResubscribe",value:function(e){e.stream&&(this._getRemotePlayer(e.stream.userId,e.stream.isScreen).forEach((function(e){return null==e?void 0:e.stop()})),this._updateAudioPlayerState(e.stream),this._updateVideoPlayerState(e.stream))}},{key:"_onSubscribePushTrack",value:function(e){e.stream&&this._updateAudioPlayerState(e.stream)}},{key:"_onRemovePushTrack",value:function(e){e.stream&&this._updateAudioPlayerState(e.stream)}},{key:"_onVideoDeviceStateChange",value:function(e){this.safeEmit(ie.onVideoDeviceStateChanged,e)}},{key:"_onAudioDeviceStateChange",value:function(e){this.safeEmit(ie.onAudioDeviceStateChanged,e)}},{key:"_onUserPublishStateChange",value:function(e){var t,r=e.userId,n=e.isScreen,o=e.mediaType,a=e.pubState,s=e.remoteStream,u={userId:r,mediaType:o};n?a===bz.PUB?this.safeEmit(ie.onUserPublishScreen,u):this.safeEmit(ie.onUserUnpublishScreen,i(i({},u),{},{reason:F.STREAM_REMOVE_REASON_UNPUBLISH})):a===bz.PUB?(u.videoStreamDescriptions=null==s||null===(t=s.attributes)||void 0===t?void 0:t.videoDescriptions,this.safeEmit(ie.onUserPublishStream,u),this._handleAutoSubscribe(s,!0)):this.safeEmit(ie.onUserUnpublishStream,i(i({},u),{},{reason:F.STREAM_REMOVE_REASON_UNPUBLISH}))}},{key:"_onCustomMessage",value:function(e){var t=e.message;e.binary?this.safeEmit(ie.onRoomBinaryMessageReceived,{userId:e.clientId,message:t}):this.safeEmit(ie.onRoomMessageReceived,{userId:e.clientId,message:t})}},{key:"_onUserMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(ie.onUserMessageReceived,e)}},{key:"_onUserBinaryMessageReceived",value:function(e){this._messageStatisticsObserver.recvP2PMessage(e.userId),this.safeEmit(ie.onUserBinaryMessageReceived,e)}},{key:"_onLiveTranscodingResult",value:function(e){this.safeEmit(ie.onLiveTranscodingResult,e)}},{key:"_onStreamMixingEvent",value:function(e){this.safeEmit(ie.onStreamMixingEvent,e)}},{key:"_onUserTokenWillExpire",value:function(){this.safeEmit(ie.onTokenWillExpire)}},{key:"_onPushPublicStreamResult",value:function(e){this.safeEmit(ie.onPushPublicStreamResult,e)}},{key:"_handleRTMClient",value:function(e){var t=this;e.on("onUserMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(ie.onUserMessageReceivedOutsideRoom,e)})),e.on("onUserBinaryMessageReceivedOutsideRoom",(function(e){t._messageStatisticsObserver.recvP2POutRoomMessage(e.userId),t.safeEmit(ie.onUserBinaryMessageReceivedOutsideRoom,e)})),e.on("onUserDisconnection",(function(){t.safeEmit(ie.onError,{errorCode:JN.RTM_DUPLICATE_LOGIN})})),e.on("onRTMTokenError",(function(){t.safeEmit(ie.onError,{errorCode:JN.RTM_TOKEN_ERROR})})),e.on("onServerParamsSetResult",(function(e){t.safeEmit(ie.onServerParamsSetResult,null==e?void 0:e.code)}))}},{key:"waitForNewToken",get:function(){return!!this._tempRoomConfig}},{key:"localAudioTrack",get:function(){return this._localAudioTrack}},{key:"localVideoTrack",get:function(){return this._localVideoTrack}},{key:"localScreenAudioTrack",get:function(){return this._localScreenAudioTrack}},{key:"localScreenVideoTrack",get:function(){return this._localScreenVideoTrack}},{key:"remoteStreams",get:function(){var e,t,r=[];null!==(e=this._room)&&void 0!==e&&e.remoteStreams&&(null===(t=this._room)||void 0===t||t.remoteStreams.forEach((function(e){Array.isArray(e)&&e.forEach((function(e){r.push({userId:e.userId,isScreen:e.isScreen,hasVideo:e.hasVideo,hasAudio:e.hasAudio,videoStreamDescriptions:e.attributes.videoDescriptions})}))})));return r}},{key:"remoteUsers",get:function(){var e,t,r=[];null!==(e=this._room)&&void 0!==e&&e.remoteUsers&&(null===(t=this._room)||void 0===t||t.remoteUsers.forEach((function(e){r.push({userId:e.userId})})));return r}},{key:"multiChatMode",get:function(){var e,t;return!(null===(e=this._room)||void 0===e||null===(t=e._mediaServerClient)||void 0===t||!t.roomAttributes.multiChatMode)}},{key:"_handleAudioDeviceManager",value:function(){var e=this;this._audioDeviceManager.on("onAudioPlaybackDeviceTestVolume",(function(t){e.safeEmit(ie.onAudioPlaybackDeviceTestVolume,t)}))}},{key:"_assertNotInRoom",value:function(){if(!this._room||this._room.connectionState!==Wz.CONNECTED)throw new ZN(JN.INVOKED_BEFORE_JOIN_ROOM,"join first")}},{key:"_checkMediaType",value:function(e){PP(e,"mediaType",[V.AUDIO,V.VIDEO,V.AUDIO_AND_VIDEO])}},{key:"_getUserId",value:function(){var e,t;return(null===(e=this._room)||void 0===e||null===(t=e.roomInfo)||void 0===t?void 0:t.userInfo.userId)||"local_user"}}]),Fe}(UL);x$([RB()],D$.prototype,"updateToken",1),x$([RB()],D$.prototype,"setVideoCaptureDevice",1),x$([RB()],D$.prototype,"setAudioCaptureDevice",1),x$([RB()],D$.prototype,"joinRoom",1),x$([RB()],D$.prototype,"leaveRoom",1),x$([RB()],D$.prototype,"destroy",1),x$([RB()],D$.prototype,"publishStream",1),x$([RB()],D$.prototype,"unpublishStream",1),x$([RB()],D$.prototype,"publishScreen",1),x$([RB()],D$.prototype,"unpublishScreen",1),x$([RB()],D$.prototype,"subscribeStream",1),x$([RB()],D$.prototype,"unsubscribeStream",1),x$([RB()],D$.prototype,"subscribeScreen",1),x$([RB()],D$.prototype,"unsubscribeScreen",1),x$([RB()],D$.prototype,"setRemoteVideoConfig",1),x$([RB()],D$.prototype,"startVideoCapture",1),x$([RB()],D$.prototype,"stopVideoCapture",1),x$([RB()],D$.prototype,"startAudioCapture",1),x$([RB()],D$.prototype,"stopAudioCapture",1),x$([RB()],D$.prototype,"getAudioMixingManager",1),x$([RB()],D$.prototype,"startScreenCapture",1),x$([RB()],D$.prototype,"stopScreenCapture",1),x$([RB()],D$.prototype,"setLocalVideoPlayer",1),x$([RB()],D$.prototype,"startLiveTranscoding",1),x$([RB()],D$.prototype,"updateLiveTranscoding",1),x$([RB()],D$.prototype,"stopLiveTranscoding",1),x$([RB()],D$.prototype,"setBusinessId",1),x$([RB()],D$.prototype,"setUserVisibility",1),x$([RB()],D$.prototype,"setRemoteVideoPlayer",1),x$([RB()],D$.prototype,"setLocalVideoMirrorType",1),x$([RB()],D$.prototype,"setAudioPlaybackDevice",1),x$([RB()],D$.prototype,"play",1),x$([RB()],D$.prototype,"pauseAllSubscribedStream",1),x$([RB()],D$.prototype,"resumeAllSubscribedStream",1),x$([RB()],D$.prototype,"sendUserMessage",1),x$([RB()],D$.prototype,"sendUserBinaryMessage",1),x$([RB()],D$.prototype,"sendRoomMessage",1),x$([RB()],D$.prototype,"sendRoomBinaryMessage",1),x$([RB()],D$.prototype,"setAudioCaptureConfig",1),x$([RB()],D$.prototype,"setVideoCaptureConfig",1),x$([RB()],D$.prototype,"enableSimulcastMode",1),x$([RB()],D$.prototype,"setVideoEncoderConfig",1),x$([RB()],D$.prototype,"setScreenEncoderConfig",1),x$([RB()],D$.prototype,"sendSEIMessage",1),x$([RB()],D$.prototype,"setAudioVolumeIndicationInterval",1),x$([RB()],D$.prototype,"enableAudioPropertiesReport",1),x$([RB()],D$.prototype,"setVideoSourceType",1),x$([RB()],D$.prototype,"setExternalVideoTrack",1),x$([RB()],D$.prototype,"setAudioSourceType",1),x$([RB()],D$.prototype,"setExternalAudioTrack",1),x$([RB("rtm")],D$.prototype,"login",1),x$([RB("rtm")],D$.prototype,"logout",1),x$([RB("rtm")],D$.prototype,"updateLoginToken",1),x$([RB("rtm")],D$.prototype,"getPeerOnlineStatus",1),x$([RB("rtm")],D$.prototype,"sendUserMessageOutsideRoom",1),x$([RB("rtm")],D$.prototype,"sendUserBinaryMessageOutsideRoom",1),x$([RB("rtm")],D$.prototype,"setServerParams",1),x$([RB("rtm")],D$.prototype,"sendServerMessage",1),x$([RB("rtm")],D$.prototype,"sendServerBinaryMessage",1),x$([RB()],D$.prototype,"startCloudProxy",1),x$([RB()],D$.prototype,"stopCloudProxy",1),x$([RB()],D$.prototype,"startPushPublicStream",1),x$([RB()],D$.prototype,"updatePublicStreamParam",1),x$([RB()],D$.prototype,"stopPushPublicStream",1),x$([RB("outsideRoom")],D$.prototype,"startPlayPublicStream",1),x$([RB("outsideRoom")],D$.prototype,"stopPlayPublicStream",1),x$([RB()],D$.prototype,"setAudioProfile",1),x$([RB("outsideRoom")],D$.prototype,"setPublicStreamVideoPlayer",1),x$([RB()],D$.prototype,"setDummyCaptureImagePath",1),x$([RB()],D$.prototype,"registerExtension",1),x$([RB()],D$.prototype,"startAudioPlaybackDeviceTest",1),x$([RB()],D$.prototype,"stopAudioPlaybackDeviceTest",1),x$([RB()],D$.prototype,"startAudioDeviceRecordTest",1),x$([RB()],D$.prototype,"stopAudioDeviceRecordAndPlayTest",1),x$([RB()],D$.prototype,"stopAudioDevicePlayTest",1),x$([RB()],D$.prototype,"setRemoteUserPriority",1),x$([RB()],D$.prototype,"takeLocalSnapshot",1),x$([RB()],D$.prototype,"takeRemoteSnapshot",1),x$([RB()],D$.prototype,"setSubscribeFallbackOption",1),x$([RB()],D$.prototype,"getLocalStreamTrack",1),x$([RB()],D$.prototype,"getRemoteStreamTrack",1),x$([RB()],D$.prototype,"getPublicStreamTrack",1);var P$={"client unpublished":F.STREAM_REMOVE_REASON_UNPUBLISH,"publish failed":F.STREAM_REMOVE_REASON_PUBLISH_FAILED,"stream removed":F.STREAM_REMOVE_REASON_KEEP_LIVE_FAILED,"client disconnected":F.STREAM_REMOVE_REASON_CLIENT_DISCONNECTED,"client republish":F.STREAM_REMOVE_REASON_REPUBLISH},M$=new ML("VERTC",0);[EB,kB,TB].forEach((function(e){var t;return e.setStats({rtc_sdk_version:GB.VERSION,product_line:UF.RTC,report_version:VF.W_5,os:FF.WEB,device_id:UB.getDeviceId(),user_agent:fP()?"":null===(t=navigator)||void 0===t?void 0:t.userAgent})})),$K.setStats({rtc_sdk_version:GB.VERSION});var L$=function(e,t){return M$.print("createEngine","Invoke VERTC.createEngine"),DP(e,"appId"),[EB,kB,TB].forEach((function(r){return r.setStats({rtc_app_id:e,auto_play_policy:null==t?void 0:t.autoPlayPolicy})})),$K.setStats({rtc_app_id:e}),gB.sdkInitEngine(Date.now(),lB.BEGIN),new D$(e,t)},U$=function(e){if(M$.print("destroyEngine","Invoke VERTC.destroyEngine"),!(e instanceof D$))throw new ZN(JN.INVALID_ENGINE,"Invalid engine object");e.destroy(),gB.sdkInitEngine(Date.now(),lB.END)},V$=function(){var e=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vH.enumerateDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F$=function(){var e=u(o().mark((function e(){var t,r,n,i,a=arguments;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=a.length>0&&void 0!==a[0]?a[0]:{video:!0,audio:!0},r=t.video,n=t.audio,i={video:!1,audio:!1},!r){e.next=12;break}return e.prev=4,e.next=7,vH.getVideoPermission();case 7:i.video=e.sent,e.next=12;break;case 10:e.prev=10,e.t0=e.catch(4);case 12:if(!n){e.next=21;break}return e.prev=13,e.next=16,vH.getAudioPermission();case 16:i.audio=e.sent,e.next=21;break;case 19:e.prev=19,e.t1=e.catch(13);case 21:return e.abrupt("return",i);case 22:case"end":return e.stop()}}),e,null,[[4,10],[13,19]])})));return function(){return e.apply(this,arguments)}}(),B$=function(){var e=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vH.enumerateAudioCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j$=function(){var e=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vH.enumerateVideoCaptureDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),G$=function(){var e=u(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",vH.enumerateAudioPlaybackDevices());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),H$=function(){return GB.VERSION},z$=function(){return gB.rtcSdkApiCall("isSupported",0,""),wj()},q$=function(){return gB.rtcSdkApiCall("getSupportedCodecs",0,""),Oj()};return!fP()&&location.search.includes("_rtc_autotest_"),i(i(i(i({},new(l((function e(){c(this,e),h(this,"getSdkVersion",H$),h(this,"createEngine",L$),h(this,"destroyEngine",U$),h(this,"enumerateDevices",V$),h(this,"enableDevices",F$),h(this,"enumerateAudioCaptureDevices",B$),h(this,"enumerateVideoCaptureDevices",j$),h(this,"enumerateAudioPlaybackDevices",G$),h(this,"getParameter",zB),h(this,"setParameter",HB),h(this,"isSupported",z$),h(this,"getSupportedCodecs",q$),h(this,"events",ie),h(this,"ErrorCode",JN),h(this,"platform","".concat({}.PRODUCT_PLATFORM)),h(this,"_monitor",gB)})))),$),ne),{},{events:ie})}));
